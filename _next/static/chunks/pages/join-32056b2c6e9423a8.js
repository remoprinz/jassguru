(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6288],{1032:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var n=(0,r(3122).A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},1232:(e,t,r)=>{"use strict";r.d(t,{$S:()=>h,cc:()=>s,fn:()=>a,n_:()=>u,q5:()=>l});var n="jassguru_tournament_invite_token",o="jassguru_group_invite_token",i=function(e){try{e&&(sessionStorage.setItem(n,e),console.log("[tokenStorage] Turniertoken gespeichert:",e))}catch(e){console.error("[tokenStorage] Fehler beim Speichern des Turniertokens:",e)}},a=function(){try{return sessionStorage.getItem(n)}catch(e){console.error("[tokenStorage] Fehler beim Lesen des Turniertokens:",e)}return null},s=function(){try{sessionStorage.removeItem(n),console.log("[tokenStorage] Turniertoken gel\xf6scht")}catch(e){console.error("[tokenStorage] Fehler beim L\xf6schen des Turniertokens:",e)}},c=function(e){try{e&&(sessionStorage.setItem(o,e),console.log("[tokenStorage] Gruppentoken gespeichert:",e))}catch(e){console.error("[tokenStorage] Fehler beim Speichern des Gruppentokens:",e)}},u=function(){try{return sessionStorage.getItem(o)}catch(e){console.error("[tokenStorage] Fehler beim Lesen des Gruppentokens:",e)}return null},l=function(){try{sessionStorage.removeItem(o),console.log("[tokenStorage] Gruppentoken gel\xf6scht")}catch(e){console.error("[tokenStorage] Fehler beim L\xf6schen des Gruppentokens:",e)}},h=function(e){e.tournamentToken&&i(e.tournamentToken),e.token&&c(e.token)}},4525:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>E,dynamic:()=>_});var n=r(4232),o=r(9099),i=r(950),a=r(3649),s=r(2322),c=r(5881),u=r(7746),l=r(6042),h=r(1032),f=r(9229),p=r(7947),d=r(9770),g=r(7133),m=r(1232),y=r(7078),v=r(7876);function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(){x=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(t,r,n,i){var a,s,c,u,l=Object.create((r&&r.prototype instanceof m?r:m).prototype);return o(l,"_invoke",{value:(a=t,s=n,c=new N(i||[]),u=f,function(t,r){if(u===p)throw Error("Generator is already running");if(u===d){if("throw"===t)throw r;return{value:e,done:!0}}for(c.method=t,c.arg=r;;){var n=c.delegate;if(n){var o=function t(r,n){var o=n.method,i=r.iterator[o];if(i===e)return n.delegate=null,"throw"===o&&r.iterator.return&&(n.method="return",n.arg=e,t(r,n),"throw"===n.method)||"return"!==o&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+o+"' method")),g;var a=h(i,r.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,g;var s=a.arg;return s?s.done?(n[r.resultName]=s.value,n.next=r.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):s:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,g)}(n,c);if(o){if(o===g)continue;return o}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if(u===f)throw u=d,c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);u=p;var i=h(a,s,c);if("normal"===i.type){if(u=c.done?d:"suspendedYield",i.arg===g)continue;return{value:i.arg,done:c.done}}"throw"===i.type&&(u=d,c.method="throw",c.arg=i.arg)}})}),l}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var f="suspendedStart",p="executing",d="completed",g={};function m(){}function y(){}function v(){}var w={};u(w,a,function(){return this});var k=Object.getPrototypeOf,S=k&&k(k(T([])));S&&S!==r&&n.call(S,a)&&(w=S);var E=v.prototype=m.prototype=Object.create(w);function _(e){["next","throw","return"].forEach(function(t){u(e,t,function(e){return this._invoke(t,e)})})}function j(e,t){var r;o(this,"_invoke",{value:function(o,i){function a(){return new t(function(r,a){!function r(o,i,a,s){var c=h(e[o],e,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==b(l)&&n.call(l,"__await")?t.resolve(l.__await).then(function(e){r("next",e,a,s)},function(e){r("throw",e,a,s)}):t.resolve(l).then(function(e){u.value=e,a(u)},function(e){return r("throw",e,a,s)})}s(c.arg)}(o,i,r,a)})}return r=r?r.then(a,a):a()}})}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function T(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw TypeError(b(t)+" is not iterable")}return y.prototype=v,o(E,"constructor",{value:v,configurable:!0}),o(v,"constructor",{value:y,configurable:!0}),y.displayName=u(v,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u(e,c,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},_(j.prototype),u(j.prototype,s,function(){return this}),t.AsyncIterator=j,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new j(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},_(E),u(E,c,"Generator"),u(E,a,function(){return this}),u(E,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=T,N.prototype={constructor:N,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:T(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function w(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){r(e);return}s.done?t(c):Promise.resolve(c).then(n,o)}function k(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return S(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return S(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}let E=function(){var e=(0,o.useRouter)(),t=(0,i.useAuthStore)(),r=t.isAuthenticated,b=t.status,S=t.user,E=(0,a.useUIStore)(),_=E.showNotification,j=E.setLoading,O=(0,s.Q5)().setCurrentGroup,L=(0,n.useRef)(!1),N=k((0,n.useState)(null),2),T=N[0],A=N[1],G=k((0,n.useState)("idle"),2),C=G[0],I=G[1],P=k((0,n.useState)(null),2),F=P[0],B=P[1],R=e.query,z=R.token,K=R.tournamentToken,M=R.groupToken;return((0,n.useEffect)(function(){var t,n,o=Array.isArray(K)?K[0]:K,i=Array.isArray(M)?M[0]:M,a=Array.isArray(z)?z[0]:z;!i&&a&&(console.log('[JOIN_PAGE_EFFECT] Generic "token" found and no explicit groupToken, using generic token as groupToken.'),i=a),e.isReady&&"idle"!==b&&!L.current&&(o||i)&&(L.current=!0,(t=x().mark(function t(){var n,a,c,h,f,p,d,y,v,w,k,E,O,L,N,T,G,C,P,F;return x().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(I("processing"),!(!i&&!o)){t.next=1;break}return console.error("[PROCESS_TOKENS_LOGIC] Error: No group or tournament token found."),A("Kein Einladungscode im Link gefunden."),B("Weder in der URL noch im lokalen Speicher war ein Code vorhanden."),I("error"),(0,m.q5)(),(0,m.cc)(),t.abrupt("return");case 1:if("loading"!==b){t.next=2;break}return t.abrupt("return");case 2:if(r()){t.next=3;break}return _({message:"Bitte melde dich an, um der Einladung zu folgen.",type:"info"}),n={redirect:e.asPath},e.push({pathname:"/auth/login",query:n}),t.abrupt("return");case 3:if(S){t.next=4;break}return console.error("[PROCESS_TOKENS_LOGIC] Error: User object is null/undefined despite being authenticated."),A("Benutzerdaten nicht geladen. Bitte versuche es erneut."),B("Benutzerdaten nicht geladen. Bitte versuche es erneut."),I("error"),t.abrupt("return");case 4:if(j(!0),a=null,c=null,h="",f="idle",!o){t.next=9;break}return A("Bearbeite Turniereinladung..."),t.prev=5,t.next=6,(0,g.redeemTournamentInvite)(o);case 6:(p=t.sent).success&&p.tournamentId?(_({message:p.message||"Erfolgreich dem Turnier beigetreten!",type:"success"}),I("success"),A(p.message||"Erfolgreich dem Turnier beigetreten!"),c="/view/tournament/".concat(p.tournamentId),(0,m.cc)(),f="success"):(console.error("[PROCESS_TOKENS_LOGIC] Error redeeming tournament token:",p.message),A(p.message||"Fehler beim Beitritt zum Turnier."),B(p.message||"Fehler beim Beitritt zum Turnier."),I("error"),_({message:p.message||"Fehler beim Beitritt zum Turnier.",type:"error"}),f="error"),t.next=8;break;case 7:t.prev=7,console.error("[PROCESS_TOKENS_LOGIC] Exception redeeming tournament token:",d=(C=t.catch(5))instanceof Error?C.message:"Ein unerwarteter Fehler ist aufgetreten."),A(d),B(d),I("error"),_({message:d,type:"error"}),f="error";case 8:t.next=16;break;case 9:if(!i){t.next=16;break}return A("Gruppeneinladung wird verarbeitet..."),t.prev=10,v=(0,u.Uz)(void 0,"europe-west1"),w=(0,u.Qg)(v,"joinGroupByToken"),t.prev=11,t.next=12,w({token:i});case 12:k=t.sent,t.next=14;break;case 13:throw t.prev=13,console.error("[PROCESS_TOKENS_LOGIC] Error calling joinGroupByToken:",P=t.catch(11)),P;case 14:if((a=k.data)&&a.success&&null!=(y=a.group)&&y.id){try{(E=s.Q5.getState()).addUserGroup(a.group),E.setCurrentGroup(a.group)}catch(e){console.error("[PROCESS_TOKENS_LOGIC] Error updating group store:",e)}_({message:h=a.alreadyMember?"Du bist bereits Mitglied dieser Gruppe.":"Du bist erfolgreich der Gruppe beigetreten!",type:"success"}),I("success"),A(h),O=new URLSearchParams({joined:a.group.name||"unbekannte Gruppe",newMember:a.alreadyMember?"false":"true"}),c="/start?".concat(O.toString()),(0,m.q5)(),f="success"}else console.error("[PROCESS_TOKENS_LOGIC] Cloud Function reported failure:",a),B(h=(null==(L=a)?void 0:L.message)||"Der Beitritt zur Gruppe ist fehlgeschlagen. Bitte versuche es erneut oder pr\xfcfe den Code."),I("error"),_&&_({message:h,type:"error"}),f="error";t.next=16;break;case 15:t.prev=15,T=(N=(F=t.catch(10))instanceof l.g)?F.code:"unknown",console.error("[PROCESS_TOKENS_LOGIC] Exception joining group:",G=F instanceof Error?F.message:"Ein unerwarteter Fehler ist aufgetreten."),N&&console.error("[PROCESS_TOKENS_LOGIC] Firebase error code:",T),A("Fehler beim Beitritt zur Gruppe."),B(G),I("error"),_&&_({message:"Fehler: ".concat(G.substring(0,100)).concat(G.length>100?"...":""),type:"error"}),f="error";case 16:I(f),"error"===f&&B(h),_&&("success"===f&&h?_({message:h,type:"success"}):"error"===f&&h&&_({message:h,type:"error"})),j(!1),"success"===f&&c&&setTimeout(function(){e.push(c)},1500);case 17:case"end":return t.stop()}},t,null,[[5,7],[10,15],[11,13]])}),n=function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(e){w(i,n,o,a,s,"next",e)}function s(e){w(i,n,o,a,s,"throw",e)}a(void 0)})},function(){return n.apply(this,arguments)})())},[e.isReady,K,M,z,b,r,S,_,j,e.asPath,O]),"loading"===b||"idle"===b)?(0,v.jsx)(y.A,{message:"Authentifizierung wird gepr\xfcft..."}):"processing"===C?(0,v.jsx)(y.A,{message:T||"Einladung wird verarbeitet..."}):"error"===C?(0,v.jsx)(c.A,{children:(0,v.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center p-4",children:[(0,v.jsx)(h.A,{className:"h-12 w-12 text-red-500 mb-4"}),(0,v.jsx)("p",{className:"text-red-500 text-xl font-semibold",children:"Fehler beim Beitritt"}),(0,v.jsx)("p",{className:"mt-2 text-gray-300",children:T}),F&&(0,v.jsxs)("p",{className:"text-xs text-gray-400 mt-1",children:["Detail: ",F]}),(0,v.jsx)(d.$,{onClick:function(){return e.push("/start")},variant:"default",className:"mt-4 bg-blue-600 hover:bg-blue-700 text-white",children:"Zur Startseite"})]})}):"success"===C?(0,v.jsx)(c.A,{children:(0,v.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center p-4",children:[(0,v.jsx)(f.A,{className:"h-12 w-12 text-green-500 mb-4"}),(0,v.jsx)("p",{className:"text-green-500 text-xl font-semibold",children:T}),(0,v.jsx)("p",{className:"mt-2 text-gray-300",children:"Du wirst weitergeleitet..."}),(0,v.jsx)("div",{className:"mt-4",children:(0,v.jsx)(p.A,{className:"h-8 w-8 text-white animate-spin"})})]})}):(0,v.jsx)(y.A,{message:"Status wird ermittelt..."})};var _="force-dynamic"},7078:(e,t,r)=>{"use strict";r.d(t,{A:()=>i}),r(4232);var n=r(7947),o=r(7876);let i=function(e){var t=e.message,r=e.color,i=void 0===r?"white":r;return(0,o.jsxs)("div",{className:"fixed inset-0 flex flex-col items-center justify-center bg-gray-900 bg-opacity-80 z-[9999]",children:[(0,o.jsx)(n.A,{className:"h-16 w-16 ".concat("white"===i?"text-white":"purple"===i?"text-purple-400":"text-".concat(i)," animate-spin")}),(0,o.jsx)("p",{className:"mt-4 text-white text-lg",children:t||"Wird geladen..."})]})}},7947:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var n=(0,r(3122).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},9229:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var n=(0,r(3122).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},9276:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/join",function(){return r(4525)}])}},e=>{var t=t=>e(e.s=t);e.O(0,[227,8230,1111,4455,8714,5881,636,6593,8792],()=>t(9276)),_N_E=e.O()}]);