(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7521],{4712:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/view/[gameId]",function(){return r(4734)}])},4734:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>y});var n=r(9099),o=r(4232),i=r(5519),a=r(2322),s=r(2009),l=r(9370),c=r(3649),u=r(7876);function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach(function(t){var n,o,i;n=e,o=t,i=r[t],(o=function(e){var t=function(e,t){if("object"!==m(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==m(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===m(t)?t:String(t)}(o))in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return s}}(e,t)||g(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){if(e){if("string"==typeof e)return b(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return b(e,t)}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}let y=function(){var e,t=(0,n.useRouter)().query.gameId,r=(0,c.useUIStore)(function(e){return e.setReadOnlyMode}),m=(0,a.Q5)(function(e){return e.setCurrentGroup}),d=p((0,o.useState)(!0),2),y=d[0],v=d[1],h=p((0,o.useState)(null),2),w=h[0],S=h[1],G=p((0,o.useState)(null),2),P=G[0],j=G[1],O=p((0,o.useState)([]),2),V=O[0],N=O[1],x=p((0,o.useState)([]),2),I=x[0],E=x[1],D=p((0,o.useState)(null),2),A=D[0],k=D[1],C=p((0,o.useState)(!1),2),_=C[0],R=C[1];if((0,o.useEffect)(function(){if(!t||"string"!=typeof t){j(null),N([]),k(null),S(void 0!==t?"Ung\xfcltige Spiel-ID.":null),v(void 0!==t);return}_||(console.log("[GameView] Setting ReadOnly mode."),r(!0),R(!0)),S(null),v(!0),console.log("[GameView] Setting up game listener for gameId: ".concat(t));var e=(0,s.doc)(i.db,"activeGames",t),n=(0,s.onSnapshot)(e,function(e){e.exists()?(console.log("[GameView] Received game data snapshot."),j(e.data())):(console.warn("[GameView] Game document ".concat(t," does not exist.")),S("Spiel nicht gefunden oder bereits archiviert."),j(null))},function(e){console.error("[GameView] Error listening to game document:",e),S("Fehler beim Laden des Spiels."),j(null),v(!1)});return function(){console.log("[GameView] Cleaning up game listener for gameId: ".concat(t)),n()}},[t,r,_]),(0,o.useEffect)(function(){if(!t||"string"!=typeof t)return void N([]);console.log("[GameView] Setting up rounds listener for gameId: ".concat(t));var e=(0,s.collection)(i.db,"activeGames",t,"rounds"),r=(0,s.query)(e,(0,s.orderBy)("roundNumber","asc")),n=(0,s.onSnapshot)(r,function(e){console.log("[GameView] Received rounds data snapshot.");var t=[];e.forEach(function(e){t.push(f({id:e.id},e.data()))}),N(t)},function(e){console.error("[GameView] Error listening to rounds collection:",e),N([])});return function(){console.log("[GameView] Cleaning up rounds listener for gameId: ".concat(t)),n()}},[t]),(0,o.useEffect)(function(){E([]);var e=null==P?void 0:P.sessionId;if(console.log("[GameView] Attempting to load summaries for sessionId:",e),!e||"string"!=typeof e)return void console.log("[GameView] No sessionId found in gameData, skipping completed games listener.");console.log("[GameView] Setting up completed games listener for sessionId: ".concat(e));var t=(0,s.collection)(i.db,"jassSessions",e,"jassGameSummaries"),r=(0,s.query)(t,(0,s.orderBy)("gameNumber","asc")),n=(0,s.onSnapshot)(r,function(e){console.log("[GameView] Received completed games snapshot.");var t=[];e.forEach(function(e){t.push(f({id:e.id},e.data()))}),console.log("[GameView] Fetched summaries:",t),E(t),console.log("[GameView] Loaded ".concat(t.length," completed games."))},function(e){console.error("[GameView] Error listening to completed games collection:",e),S("Fehler beim Laden der Spielhistorie."),E([])});return function(){console.log("[GameView] Cleaning up completed games listener for sessionId: ".concat(e)),n()}},[null==P?void 0:P.sessionId]),(0,o.useEffect)(function(){if(P&&V&&t&&"string"==typeof t){console.log("[GameView] All data sources available. Creating/Updating combined viewer data...");try{var e,r,n,o,i,a,l,c,u,m,d,p,h,G,j=Date.now();P.createdAt instanceof s.Timestamp?j=P.createdAt.toMillis():console.warn("[GameView] gameData.createdAt is not a Timestamp, using Date.now().");var O=V.map(function(e){var t,r,n={id:e.id||"round-".concat(e.roundNumber),roundId:e.roundNumber,actionType:"jass",timestamp:e.timestamp instanceof s.Timestamp?e.timestamp.toMillis():Date.now(),startingPlayer:e.startingPlayer,scores:{top:(null==(t=e.scores)?void 0:t.top)||0,bottom:(null==(r=e.scores)?void 0:r.bottom)||0},isRoundFinalized:!0,isCompleted:!0,currentPlayer:e.startingPlayer,weisPoints:{top:e.weisTop||0,bottom:e.weisBottom||0},jassPoints:{top:e.topPoints||0,bottom:e.bottomPoints||0},weisActions:[],roundState:{roundNumber:e.roundNumber,nextPlayer:e.startingPlayer}};return f(f({},n),{},{cardStyle:"french",farbe:e.gespielteFarbe||e.farbe})}),N={striche:0,points:0,weisPoints:0},x={1:f({},N),2:f({},N),3:f({},N),4:f({},N)},E={id:null!=(e=P.currentGameNumber)?e:1,gameNumber:null!=(r=P.currentGameNumber)?r:1,activeGameId:t,timestamp:j,sessionId:P.sessionId,currentRound:P.currentRound,startingPlayer:P.startingPlayer,initialStartingPlayer:P.initialStartingPlayer,currentPlayer:P.currentPlayer,isGameStarted:!0,isRoundCompleted:!1,isGameCompleted:"completed"===P.status,teams:{top:{striche:null!=(n=null==(o=P.striche)?void 0:o.top)?n:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0},jassPoints:0,weisPoints:null!=(i=null==(a=P.weisPoints)?void 0:a.top)?i:0,total:null!=(l=null==(c=P.scores)?void 0:c.top)?l:0,bergActive:!1,bedankenActive:!1,isSigned:!1,playerStats:x},bottom:{striche:null!=(u=null==(m=P.striche)?void 0:m.bottom)?u:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0},jassPoints:0,weisPoints:null!=(d=null==(p=P.weisPoints)?void 0:p.bottom)?d:0,total:null!=(h=null==(G=P.scores)?void 0:G.bottom)?h:0,bergActive:!1,bedankenActive:!1,isSigned:!1,playerStats:x}},roundHistory:O,currentHistoryIndex:0,historyState:{lastNavigationTimestamp:Date.now()}},D=function(e){if(Array.isArray(e))return b(e)}(I)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(I)||g(I)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),A=I.some(function(e){return e.gameNumber===E.gameNumber});E.isGameCompleted||A?E.isGameCompleted&&!A?(console.log("[GameView] Current game marked as completed, adding its representation until summary arrives."),D.push(E)):A&&console.log("[GameView] Current game number ".concat(E.gameNumber," already found in completed summaries. Not adding duplicate.")):D.push(E),D.sort(function(e,t){var r=function(e){if("gameNumber"in e&&"number"==typeof e.gameNumber)return e.gameNumber;if("id"in e){if("number"==typeof e.id)return e.id;if("string"==typeof e.id){var t=parseInt(e.id,10);return isNaN(t)?0:t}}return 0},n=r(e),o=r(t);return n-o}),console.log("[GameView] Data just before setting viewerGamesData:",{completed:I,current:E,combined:D}),k(D),S(null),v(!1)}catch(e){console.error("[GameView] Error creating combined viewer game data:",e),S("Fehler bei der Datenaufbereitung."),k(null),v(!1)}}else!t||w||y?t||w||(v(!1),S(null),k(null)):(v(!0),k(null))},[P,V,I,t,w]),(0,o.useEffect)(function(){if(P&&_&&P.sessionId){var e=P.sessionId;console.log("[GameView] Session gefunden mit ID: ".concat(e,", suche nach zugeh\xf6riger Gruppe..."));var t=(0,s.doc)(i.db,"jassSessions",e),r=null,n=(0,s.onSnapshot)(t,function(t){if(t.exists()){var n=t.data().gruppeId;if(n){console.log("[GameView] Gruppe f\xfcr Session ".concat(e," gefunden: ").concat(n));var o=(0,s.doc)(i.db,"groups",n);r=(0,s.onSnapshot)(o,function(e){if(e.exists()){var t=e.data();console.log("[GameView] Gruppeneinstellungen geladen:",t),m(f({id:n},t))}else console.log("[GameView] Gruppe mit ID ".concat(n," existiert nicht mehr."))},function(e){console.error("[GameView] Fehler beim Laden der Gruppe ".concat(n,":"),e)})}else console.log("[GameView] Session ".concat(e," hat keine zugeh\xf6rige Gruppe."))}else console.log("[GameView] Session mit ID ".concat(e," nicht gefunden."))},function(t){console.error("[GameView] Fehler beim Listener f\xfcr Session ".concat(e,":"),t)});return function(){console.log("[GameView] Cleanup Session- und Gruppen-Listener"),n(),r&&r()}}},[P,_,m]),console.log("[GameView] Checking render conditions:",{isLoading:y,error:w,gameDataExists:!!P,viewerGamesDataExists:!!A}),y)return console.log("[GameView] Rendering: Loading"),(0,u.jsx)("div",{className:"flex justify-center items-center min-h-screen text-white",children:"Lade Spiel..."});if(w)return console.log("[GameView] Rendering: Error -",w),(0,u.jsxs)("div",{className:"flex justify-center items-center min-h-screen text-red-500",children:["Fehler: ",w]});if(!A||0===A.length)return console.log("[GameView] Rendering: Not Available (viewerGamesData is null or empty)"),(0,u.jsx)("div",{className:"flex justify-center items-center min-h-screen text-yellow-500",children:"Spieldaten nicht verf\xfcgbar oder noch nicht geladen."});var T=A[A.length-1],F={top:0,bottom:0},z={top:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0},bottom:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0}},L={top:0,bottom:0};T&&("teams"in T&&T.teams?T.teams.top&&T.teams.bottom&&(F={top:T.teams.top.total,bottom:T.teams.bottom.total},z={top:T.teams.top.striche,bottom:T.teams.bottom.striche},L={top:T.teams.top.weisPoints,bottom:T.teams.bottom.weisPoints}):"finalStriche"in T&&T.finalStriche&&(F=T.finalScores,z=T.finalStriche,L=T.weisPoints));var B={games:A,playerNames:null!=(e=null==P?void 0:P.playerNames)?e:{1:"P1",2:"P2",3:"P3",4:"P4"},currentScores:F,currentStriche:z,weisPoints:L};return console.log("[GameView] Final props for GameViewerKreidetafel:",B),(0,u.jsx)(l.A,{gameData:B})}},9770:(e,t,r)=>{"use strict";r.d(t,{$:()=>d,r:()=>m});var n=r(4232),o=r(2987),i=r(7137),a=r(6722),s=r(7876);function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var c=["className","variant","size","asChild"];function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}var m=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),d=n.forwardRef(function(e,t){var r=e.className,n=e.variant,i=e.size,d=e.asChild,f=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,c),p=void 0!==d&&d?o.DX:"button";return(0,s.jsx)(p,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach(function(t){var n,o,i;n=e,o=t,i=r[t],(o=function(e){var t=function(e,t){if("object"!==l(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==l(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===l(t)?t:String(t)}(o))in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({className:(0,a.cn)(m({variant:n,size:i,className:r})),ref:t},f))});d.displayName="Button"}},e=>{var t=t=>e(e.s=t);e.O(0,[7141,2366,7887,6738,4264,6348,1451,9370,636,6593,8792],()=>t(4712)),_N_E=e.O()}]);