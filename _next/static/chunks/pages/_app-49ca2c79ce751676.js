(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{92:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/_app",function(){return r(6468)}])},112:(e,t,r)=>{"use strict";r.d(t,{k5:()=>h});var n=r(4232),i={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},o=n.createContext&&n.createContext(i);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var s=["attr","size","title"];function u(){return(u=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach(function(t){var n,i,o;n=e,i=t,o=r[t],(i=function(e){var t=function(e,t){if("object"!=a(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=a(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==a(t)?t:t+""}(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function h(e){return function(t){return n.createElement(d,u({attr:l({},e.attr)},t),function e(t){return t&&t.map(function(t,r){return n.createElement(t.tag,l({key:r},t.attr),e(t.child))})}(e.child))}}function d(e){var t=function(t){var r,i=e.attr,o=e.size,a=e.title,c=function(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}(e,s),h=o||t.size||"1em";return t.className&&(r=t.className),e.className&&(r=(r?r+" ":"")+e.className),n.createElement("svg",u({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,i,c,{className:r,style:l(l({color:e.color||t.color},t.style),e.style),height:h,width:h,xmlns:"http://www.w3.org/2000/svg"}),a&&n.createElement("title",null,a),e.children)};return void 0!==o?n.createElement(o.Consumer,null,function(e){return t(e)}):t(i)}},132:(e,t,r)=>{"use strict";r.d(t,{FT:()=>o,mG:()=>a,u4:()=>i});var n={backgroundColor:"bg-gradient-to-b from-gray-600 to-gray-700 shadow-inner border border-gray-500/30 hover:from-gray-500 hover:to-gray-600 group-[.has-active]:bg-gray-600/75 group-[.active]:!from-gray-500 group-[.active]:!to-gray-600"},i=[{id:"mis\xe8re",name:"Mis\xe8re",multiplier:1,order:1,emojiStyle:{backgroundColor:"bg-[#f87171] group-[.has-active]:bg-gray-600/75 group-[.active]:!bg-[#f87171]"},standardStyle:n,frStyle:{backgroundColor:"bg-gradient-to-b from-gray-600 to-gray-700 shadow-inner border border-gray-500/30 hover:from-gray-500 hover:to-gray-600 group-[.has-active]:bg-gray-600/75 group-[.active]:!from-gray-500 group-[.active]:!to-gray-600"}},{id:"eicheln",name:"Eicheln",multiplier:7,order:7,emojiStyle:{backgroundColor:"bg-[#65a30d] group-[.has-active]:bg-gray-600/75 group-[.active]:!bg-[#65a30d]"},standardStyle:n,frStyle:{backgroundColor:"bg-gradient-to-b from-gray-600 to-gray-700 shadow-inner border border-gray-500/30 hover:from-gray-500 hover:to-gray-600 group-[.has-active]:bg-gray-600/75 group-[.active]:!from-gray-500 group-[.active]:!to-gray-600"}},{id:"rosen",name:"Rosen",multiplier:4,order:3,emojiStyle:{backgroundColor:"bg-[#fde047] group-[.has-active]:bg-gray-600/75 group-[.active]:!bg-[#fde047]"},standardStyle:n,frStyle:{backgroundColor:"bg-gradient-to-b from-gray-600 to-gray-700 shadow-inner border border-gray-500/30 hover:from-gray-500 hover:to-gray-600 group-[.has-active]:bg-gray-600/75 group-[.active]:!from-gray-500 group-[.active]:!to-gray-600"}},{id:"schellen",name:"Schellen",multiplier:2,order:4,emojiStyle:{backgroundColor:"bg-[#fbbf24] group-[.has-active]:bg-gray-600/75 group-[.active]:!bg-[#fbbf24]"},standardStyle:n,frStyle:{backgroundColor:"bg-gradient-to-b from-gray-600 to-gray-700 shadow-inner border border-gray-500/30 hover:from-gray-500 hover:to-gray-600 group-[.has-active]:bg-gray-600/75 group-[.active]:!from-gray-500 group-[.active]:!to-gray-600"}},{id:"schilten",name:"Schilten",multiplier:3,order:5,emojiStyle:{backgroundColor:"bg-[#64748b] group-[.has-active]:bg-gray-600/75 group-[.active]:!bg-[#6b7280]"},standardStyle:n,frStyle:{backgroundColor:"bg-gradient-to-b from-gray-600 to-gray-700 shadow-inner border border-gray-500/30 hover:from-gray-500 hover:to-gray-600 group-[.has-active]:bg-gray-600/75 group-[.active]:!from-gray-500 group-[.active]:!to-gray-600"}},{id:"obe",name:"Obe",multiplier:5,order:6,emojiStyle:{backgroundColor:"bg-[#0891b2] group-[.has-active]:bg-gray-600/75 group-[.active]:!bg-[#0284c7]"},standardStyle:n,frStyle:{backgroundColor:"bg-gradient-to-b from-gray-600 to-gray-700 shadow-inner border border-gray-500/30 hover:from-gray-500 hover:to-gray-600 group-[.has-active]:bg-gray-600/75 group-[.active]:!from-gray-500 group-[.active]:!to-gray-600"}},{id:"une",name:"Une",multiplier:6,order:7,emojiStyle:{backgroundColor:"bg-[#0369a1] group-[.has-active]:bg-gray-600/75 group-[.active]:!bg-[#854d0e]"},standardStyle:n,frStyle:{backgroundColor:"bg-gradient-to-b from-gray-600 to-gray-700 shadow-inner border border-gray-500/30 hover:from-gray-500 hover:to-gray-600 group-[.has-active]:bg-gray-600/75 group-[.active]:!from-gray-500 group-[.active]:!to-gray-600"}},{id:"dreimal",name:"3x3",multiplier:4,order:8,emojiStyle:{backgroundColor:"bg-[#f0abfc] group-[.has-active]:bg-gray-600/75 group-[.active]:!bg-[#f0abfc]"},standardStyle:n,frStyle:{backgroundColor:"bg-gradient-to-b from-gray-600 to-gray-700 shadow-inner border border-gray-500/30 hover:from-gray-500 hover:to-gray-600 group-[.has-active]:bg-gray-600/75 group-[.active]:!from-gray-500 group-[.active]:!to-gray-600"}},{id:"quer",name:"Quer",multiplier:7,order:9,emojiStyle:{backgroundColor:"bg-[#f87171] group-[.has-active]:bg-gray-600/75 group-[.active]:!bg-[#0891b2]"},standardStyle:n,frStyle:{backgroundColor:"bg-gradient-to-b from-gray-600 to-gray-700 shadow-inner border border-gray-500/30 hover:from-gray-500 hover:to-gray-600 group-[.has-active]:bg-gray-600/75 group-[.active]:!from-gray-500 group-[.active]:!to-gray-600"}},{id:"slalom",name:"Slalom",multiplier:7,order:10,emojiStyle:{backgroundColor:"bg-white group-[.has-active]:bg-gray-600/75 group-[.active]:!bg-white"},standardStyle:n,frStyle:{backgroundColor:"bg-gradient-to-b from-gray-600 to-gray-700 shadow-inner border border-gray-500/30 hover:from-gray-500 hover:to-gray-600 group-[.has-active]:bg-gray-600/75 group-[.active]:!from-gray-500 group-[.active]:!to-gray-600"}}],o={values:{eicheln:1,rosen:1,schellen:2,schilten:2,obe:3,une:3,misère:0,dreimal:0,quer:0,slalom:0},cardStyle:"DE"},a=function(e){return!e.values||Object.values(e.values).every(function(e){return"number"==typeof e&&e>=0&&e<=8})}},181:(e,t,r)=>{"use strict";r.d(t,{E:()=>i});var n=r(4232);let i=r(2205).B?n.useLayoutEffect:n.useEffect},415:(e,t,r)=>{"use strict";r.d(t,{S:()=>n});var n={Misère:{DE:"Mis\xe8re",FR:"Mis\xe8re"},Eicheln:{DE:"Eichel",FR:"Schaufel"},Rosen:{DE:"Rosen",FR:"Kreuz"},Schellen:{DE:"Schellen",FR:"Herz"},Schilten:{DE:"Schilten",FR:"Ecke"},Obe:{DE:"Obe",FR:"Obe"},Une:{DE:"Unde",FR:"Unde"},"3x3":{DE:"3x3",FR:"3x3"},Quer:{DE:"Quer",FR:"Quer"},Slalom:{DE:"Slalom",FR:"Slalom"}}},950:(e,t,r)=>{"use strict";r.r(t),r.d(t,{useAuthStore:()=>j});var n=r(8106),i=r(4319),o=r(5519),a=r(3786),s=r(6042),u=r(5230),c=r(2322),l=r(2009),h=r(7746),d="pendingInviteToken",f=r(3649);function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(){m=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(t,r,n,o){var a,s,u,c,l=Object.create((r&&r.prototype instanceof v?r:v).prototype);return i(l,"_invoke",{value:(a=t,s=n,u=new A(o||[]),c=d,function(t,r){if(c===f)throw Error("Generator is already running");if(c===g){if("throw"===t)throw r;return{value:e,done:!0}}for(u.method=t,u.arg=r;;){var n=u.delegate;if(n){var i=function t(r,n){var i=n.method,o=r.iterator[i];if(o===e)return n.delegate=null,"throw"===i&&r.iterator.return&&(n.method="return",n.arg=e,t(r,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+i+"' method")),y;var a=h(o,r.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,y;var s=a.arg;return s?s.done?(n[r.resultName]=s.value,n.next=r.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):s:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,y)}(n,u);if(i){if(i===y)continue;return i}}if("next"===u.method)u.sent=u._sent=u.arg;else if("throw"===u.method){if(c===d)throw c=g,u.arg;u.dispatchException(u.arg)}else"return"===u.method&&u.abrupt("return",u.arg);c=f;var o=h(a,s,u);if("normal"===o.type){if(c=u.done?g:"suspendedYield",o.arg===y)continue;return{value:o.arg,done:u.done}}"throw"===o.type&&(c=g,u.method="throw",u.arg=o.arg)}})}),l}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var d="suspendedStart",f="executing",g="completed",y={};function v(){}function b(){}function w(){}var S={};c(S,a,function(){return this});var x=Object.getPrototypeOf,I=x&&x(x(O([])));I&&I!==r&&n.call(I,a)&&(S=I);var E=w.prototype=v.prototype=Object.create(S);function T(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function k(e,t){var r;i(this,"_invoke",{value:function(i,o){function a(){return new t(function(r,a){!function r(i,o,a,s){var u=h(e[i],e,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==p(l)&&n.call(l,"__await")?t.resolve(l.__await).then(function(e){r("next",e,a,s)},function(e){r("throw",e,a,s)}):t.resolve(l).then(function(e){c.value=e,a(c)},function(e){return r("throw",e,a,s)})}s(u.arg)}(i,o,r,a)})}return r=r?r.then(a,a):a()}})}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function O(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw TypeError(p(t)+" is not iterable")}return b.prototype=w,i(E,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:b,configurable:!0}),b.displayName=c(w,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,c(e,u,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},T(k.prototype),c(k.prototype,s,function(){return this}),t.AsyncIterator=k,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new k(l(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},T(E),c(E,u,"Generator"),c(E,a,function(){return this}),c(E,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function g(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(n,i)}var y=function(){var e,t=(e=m().mark(function e(){var t,r,n,i,o,a,s,u,l,p,g,y,v=arguments;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=v.length>0&&void 0!==v[0]&&v[0],r=f.useUIStore.getState().showNotification,n=c.Q5.getState().addUserGroup,i=c.Q5.getState().setCurrentGroup,o=null,e.prev=1,o=localStorage.getItem(d),e.next=3;break;case 2:return e.prev=2,console.error("Failed to read from localStorage:",e.catch(1)),e.abrupt("return",null);case 3:if(!o){e.next=10;break}try{localStorage.removeItem(d)}catch(e){console.error("Failed to remove item from localStorage:",e)}return e.prev=4,a=(0,h.Uz)(void 0,"europe-west1"),s=(0,h.Qg)(a,"joinGroupByToken"),e.next=5,s({token:o});case 5:if(!(null!=(u=e.sent.data)&&u.success&&u.group&&u.group.id)){e.next=6;break}return l=u.group,n(l),i(l),t||r({message:"Du bist jetzt Mitglied der Gruppe '".concat(l.name,"'."),type:"success",duration:5e3}),e.abrupt("return",l.id);case 6:return console.error("Error joining group via pending token (success=false or group/id object missing):",u),p=(null==u?void 0:u.message)||"Beitritt fehlgeschlagen. Ung\xfcltige Antwort von Funktion.",r({message:p,type:"error",duration:7e3}),e.abrupt("return",null);case 7:e.next=9;break;case 8:return e.prev=8,console.error("Error joining group via pending token:",y=e.catch(4)),g="Beitritt fehlgeschlagen. Der Code war ung\xfcltig oder ist abgelaufen.",y instanceof Error&&(g=y.message||g),r({message:g,type:"error",duration:7e3}),e.abrupt("return",null);case 9:e.next=11;break;case 10:return e.abrupt("return",null);case 11:case"end":return e.stop()}},e,null,[[1,2],[4,8]])}),function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){g(o,n,i,a,s,"next",e)}function s(e){g(o,n,i,a,s,"throw",e)}a(void 0)})});return function(){return t.apply(this,arguments)}}(),v=r(2219),b=r(1411),w=r(9099),S=r.n(w),x=r(5844);function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T(Object(r),!0).forEach(function(t){var n,i,o;n=e,i=t,o=r[t],(i=function(e){var t=function(e,t){if("object"!==E(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==E(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===E(t)?t:String(t)}(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function _(){_=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(t,r,n,o){var a,s,u,c,l=Object.create((r&&r.prototype instanceof g?r:g).prototype);return i(l,"_invoke",{value:(a=t,s=n,u=new A(o||[]),c=d,function(t,r){if(c===f)throw Error("Generator is already running");if(c===p){if("throw"===t)throw r;return{value:e,done:!0}}for(u.method=t,u.arg=r;;){var n=u.delegate;if(n){var i=function t(r,n){var i=n.method,o=r.iterator[i];if(o===e)return n.delegate=null,"throw"===i&&r.iterator.return&&(n.method="return",n.arg=e,t(r,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+i+"' method")),m;var a=h(o,r.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,m;var s=a.arg;return s?s.done?(n[r.resultName]=s.value,n.next=r.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):s:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,m)}(n,u);if(i){if(i===m)continue;return i}}if("next"===u.method)u.sent=u._sent=u.arg;else if("throw"===u.method){if(c===d)throw c=p,u.arg;u.dispatchException(u.arg)}else"return"===u.method&&u.abrupt("return",u.arg);c=f;var o=h(a,s,u);if("normal"===o.type){if(c=u.done?p:"suspendedYield",o.arg===m)continue;return{value:o.arg,done:u.done}}"throw"===o.type&&(c=p,u.method="throw",u.arg=o.arg)}})}),l}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var d="suspendedStart",f="executing",p="completed",m={};function g(){}function y(){}function v(){}var b={};c(b,a,function(){return this});var w=Object.getPrototypeOf,S=w&&w(w(O([])));S&&S!==r&&n.call(S,a)&&(b=S);var x=v.prototype=g.prototype=Object.create(b);function I(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function T(e,t){var r;i(this,"_invoke",{value:function(i,o){function a(){return new t(function(r,a){!function r(i,o,a,s){var u=h(e[i],e,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==E(l)&&n.call(l,"__await")?t.resolve(l.__await).then(function(e){r("next",e,a,s)},function(e){r("throw",e,a,s)}):t.resolve(l).then(function(e){c.value=e,a(c)},function(e){return r("throw",e,a,s)})}s(u.arg)}(i,o,r,a)})}return r=r?r.then(a,a):a()}})}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function O(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw TypeError(E(t)+" is not iterable")}return y.prototype=v,i(x,"constructor",{value:v,configurable:!0}),i(v,"constructor",{value:y,configurable:!0}),y.displayName=c(v,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,c(e,u,"GeneratorFunction")),e.prototype=Object.create(x),e},t.awrap=function(e){return{__await:e}},I(T.prototype),c(T.prototype,s,function(){return this}),t.AsyncIterator=T,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new T(l(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},I(x),c(x,u,"Generator"),c(x,a,function(){return this}),c(x,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function P(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(n,i)}function A(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){P(o,n,i,a,s,"next",e)}function s(e){P(o,n,i,a,s,"throw",e)}a(void 0)})}}var O=null,C=null,D=null,N=null,R=!1,L=new Map,j=(0,n.v)()((0,i.Zr)(function(e,t){var n,i,h,d,f,p,m,g;return{status:"idle",user:null,firebaseUser:null,appMode:"offline",error:null,isGuest:!1,isLoggingOut:!1,uploadStatus:"idle",login:(n=A(_().mark(function t(r,n){var i;return _().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e({status:"loading",error:null}),t.next=1,(0,u._h)(r,n);case 1:e({user:t.sent,status:"authenticated",appMode:"online",isGuest:!1}),t.next=3;break;case 2:throw t.prev=2,e({status:"error",error:(i=t.catch(0))instanceof Error?i.message:"Ein unbekannter Fehler ist aufgetreten"}),i;case 3:case"end":return t.stop()}},t,null,[[0,2]])})),function(e,t){return n.apply(this,arguments)}),loginWithGoogle:(i=A(_().mark(function t(){var r;return _().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e({status:"loading",error:null}),t.next=1,(0,u.FE)();case 1:e({user:t.sent,status:"authenticated",appMode:"online",isGuest:!1}),t.next=3;break;case 2:throw t.prev=2,e({status:"error",error:(r=t.catch(0))instanceof Error?r.message:"Ein unbekannter Fehler ist aufgetreten"}),r;case 3:case"end":return t.stop()}},t,null,[[0,2]])})),function(){return i.apply(this,arguments)}),register:(h=A(_().mark(function t(r,n,i){var o,a,s;return _().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e({status:"loading",error:null}),t.prev=1,t.next=2,(0,u.Wq)(r,n,i);case 2:t.sent,e({status:"unauthenticated"}),t.next=4;break;case 3:throw t.prev=3,console.error("AUTH_STORE: Fehler bei Registrierung:",s=t.catch(1)),a="Registrierung fehlgeschlagen. Bitte versuchen Sie es erneut.","auth/email-already-in-use"===(o=s).code?a="Diese E-Mail-Adresse ist bereits registriert. Bitte melde dich an oder verwende eine andere E-Mail.":"auth/weak-password"===o.code&&(a="Das Passwort ist zu schwach. Es muss mindestens 6 Zeichen lang sein."),e({status:"error",error:a}),Error(a);case 4:case"end":return t.stop()}},t,null,[[1,3]])})),function(e,t,r){return h.apply(this,arguments)}),logout:(d=A(_().mark(function t(){return _().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("AUTH_STORE: Starting logout process..."),e({isLoggingOut:!0}),O&&(O(),O=null),C&&(C(),C=null),c.Q5.getState().resetGroupStore(),t.prev=1,e({status:"loading",error:null}),t.next=2,(0,u.ri)();case 2:e({user:null,firebaseUser:null,status:"unauthenticated",appMode:"offline",isGuest:!1,isLoggingOut:!1}),console.log("AUTH_STORE: Logout successful, navigating to /"),S().push("/"),t.next=4;break;case 3:t.prev=3,console.error("AUTH_STORE: Fehler beim Logout:",t.catch(1)),e({status:"error",error:"Abmeldung fehlgeschlagen",isLoggingOut:!1});case 4:case"end":return t.stop()}},t,null,[[1,3]])})),function(){return d.apply(this,arguments)}),resetPassword:(f=A(_().mark(function r(n){var i;return _().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,e({status:"loading",error:null}),r.next=1,(0,u.hE)(n);case 1:e({status:t().user?"authenticated":"unauthenticated"}),r.next=3;break;case 2:throw r.prev=2,e({status:"error",error:(i=r.catch(0))instanceof Error?i.message:"Ein unbekannter Fehler ist aufgetreten"}),i;case 3:case"end":return r.stop()}},r,null,[[0,2]])})),function(e){return f.apply(this,arguments)}),setAppMode:function(t){e({appMode:t})},continueAsGuest:function(){console.log("[AuthStore] continueAsGuest called");var n=t().status;if(t().user&&"authenticated"===n)return void console.warn("[AuthStore] User is already authenticated, ignoring continueAsGuest.");console.log("[AuthStore] Resetting game state for clean guest mode");try{Promise.resolve().then(r.bind(r,4536)).then(function(e){e.useJassStore.getState().resetJass()}),Promise.resolve().then(r.bind(r,4277)).then(function(e){e.useGameStore.getState().resetGameState({newActiveGameId:null})}),Promise.resolve().then(r.bind(r,4415)).then(function(e){e.useTimerStore.getState().resetAllTimers()})}catch(e){console.warn("[AuthStore] Error resetting game state during guest mode transition:",e)}e({user:null,firebaseUser:null,status:"unauthenticated",appMode:"offline",isGuest:!0,error:null}),console.log("[AuthStore] Set to Guest Mode:",t())},clearGuestStatus:function(){e(function(e){return e.isGuest?{isGuest:!1,appMode:"online"===e.appMode?"online":"offline"}:{}})},isAuthenticated:function(){return"authenticated"===t().status&&!!t().user},resendVerificationEmail:(p=A(_().mark(function t(){var r;return _().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e({status:"loading",error:null}),t.next=1,(0,u.nA)();case 1:e(function(e){return{status:"loading"===e.status?e.user?"authenticated":"unauthenticated":e.status}}),t.next=3;break;case 2:throw t.prev=2,console.error("Error in store resendVerificationEmail:",r=t.catch(0)),e({status:"error",error:r instanceof Error?r.message:"Fehler beim erneuten Senden der E-Mail."}),r;case 3:case"end":return t.stop()}},t,null,[[0,2]])})),function(){return p.apply(this,arguments)}),uploadProfilePicture:(m=A(_().mark(function r(n){var i,o;return _().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(i=t().firebaseUser){r.next=1;break}throw e({uploadStatus:"error",error:"Benutzer nicht angemeldet."}),Error("Benutzer nicht angemeldet.");case 1:return e({uploadStatus:"loading",error:null}),r.prev=2,r.next=3,(0,u.x)(n,i.uid);case 3:e({user:r.sent,uploadStatus:"success",error:null}),r.next=5;break;case 4:throw r.prev=4,console.error("AUTH_STORE: Fehler beim Hochladen des Profilbilds:",o=r.catch(2)),e({uploadStatus:"error",error:o instanceof Error?o.message:"Profilbild konnte nicht hochgeladen werden."}),o;case 5:case"end":return r.stop()}},r,null,[[2,4]])})),function(e){return m.apply(this,arguments)}),updateProfile:(g=A(_().mark(function r(n){var i,o;return _().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(t().user){r.next=1;break}throw Error("Benutzer nicht angemeldet.");case 1:return e({status:"loading",error:null}),r.prev=2,r.next=3,(0,u.eg)(n);case 3:i={},void 0!==n.displayName&&(i.displayName=n.displayName),void 0!==n.statusMessage&&(i.statusMessage=n.statusMessage),void 0!==n.profileTheme&&(i.profileTheme=n.profileTheme),e(function(e){return{user:e.user?k(k({},e.user),i):null,status:"authenticated",error:null}}),r.next=5;break;case 4:throw r.prev=4,console.error("AUTH_STORE: Fehler beim Aktualisieren des Profils:",o=r.catch(2)),e({status:"error",error:o instanceof Error?o.message:"Profil konnte nicht aktualisiert werden."}),o;case 5:case"end":return r.stop()}},r,null,[[2,4]])})),function(e){return g.apply(this,arguments)}),initAuth:function(){var n;R||(N&&(N(),N=null),R=!0,D&&clearTimeout(D),e({status:"loading"}),D=setTimeout(function(){if("loading"===t().status){console.error("AUTH_STORE: Watchdog-Alarm! onAuthStateChanged hat nicht innerhalb von 3s geantwortet.");var r=!1;try{var n=localStorage.getItem("auth-storage");if(n){var i,o=JSON.parse(n);if((null==o||null==(i=o.state)?void 0:i.status)==="authenticated"){console.error("AUTH_STORE: Erkenne persistierten authenticated Status - m\xf6gliche localStorage Corruption!");var a=parseInt(localStorage.getItem("auth-failed-attempts")||"0")+1;localStorage.setItem("auth-failed-attempts",a.toString()),a>=2&&(console.error("AUTH_STORE: 2+ failed attempts detected - Emergency localStorage cleanup!"),localStorage.removeItem("auth-storage"),localStorage.removeItem("auth-failed-attempts"),r=!0)}}}catch(e){console.error("AUTH_STORE: localStorage read error - Emergency cleanup!",e),localStorage.removeItem("auth-storage"),r=!0}e({status:"unauthenticated",user:null,firebaseUser:null,isGuest:!1,error:r?"Authentifizierung wurde zur\xfcckgesetzt. Bitte melde dich erneut an.":"Die Authentifizierung hat zu lange gedauert. Pr\xfcfe deine Internetverbindung und versuche es erneut."}),R=!1}},3e3),N=(0,a.hg)(o.j2,(n=A(_().mark(function n(i){var a,h,d,f,p,m,g,w,S,T,P,N,j,F,G;return _().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:D&&clearTimeout(D),R=!1;try{localStorage.removeItem("auth-failed-attempts")}catch(e){console.warn("AUTH_STORE: Could not reset failed attempts counter:",e)}if(O&&O(),C&&C(),O=null,C=null,!i){n.next=16;break}a=t().status,h=t().isGuest,d=(0,u._N)(i,null),e({status:"authenticated",firebaseUser:i,user:d,isGuest:!1});try{(p=(f=r(3649).useUIStore.getState()).notifications.filter(function(e){return e.message.includes("Registrierung erfolgreich")||e.message.includes("Pr\xfcfe deine Email")||e.message.includes("Gruppen-Einladung")})).forEach(function(e){f.removeNotification(e.id)}),p.length>0&&console.log("[AuthStore] Removed ".concat(p.length," hanging registration notifications"))}catch(e){console.warn("[AuthStore] Could not clear registration notifications:",e)}if(h&&("unauthenticated"===a||"loading"===a)){console.log("[AuthStore] Detected guest-to-authenticated transition, resetting game state");try{Promise.resolve().then(r.bind(r,4536)).then(function(e){e.useJassStore.getState().resetJass()}),Promise.resolve().then(r.bind(r,4277)).then(function(e){e.useGameStore.getState().resetGameState({newActiveGameId:null})}),Promise.resolve().then(r.bind(r,4415)).then(function(e){e.useTimerStore.getState().resetAllTimers()})}catch(e){console.warn("[AuthStore] Error resetting game state during guest-to-auth transition:",e)}}return m=null,n.prev=1,n.next=2,new Promise(function(e){return setTimeout(e,100)});case 2:return g=(0,l.doc)(o.db,v.sb,i.uid),n.next=3,(0,l.getDoc)(g);case 3:if((w=n.sent).exists()&&null!=(S=w.data())&&S.playerId&&"string"==typeof S.playerId&&(m=S.playerId),m){n.next=5;break}return T=i.displayName||"Spieler_".concat(i.uid.substring(0,6)),n.next=4,(0,b.getPlayerIdForUser)(i.uid,T);case 4:m=n.sent,n.next=6;break;case 5:case 6:if(!m){n.next=8;break}return n.next=7,c.Q5.getState().loadUserGroupsByPlayerId(m);case 7:n.next=8;break;case 8:if("loading"!==a&&"unauthenticated"!==a){n.next=13;break}return P=r(3649).useUIStore.getState().notifications.some(function(e){return e.message.includes("Registrierung erfolgreich")||e.message.includes("Pr\xfcfe deine Email")||e.message.includes("Gruppen-Einladung")}),n.next=9,y(P);case 9:if(!(N=n.sent)){n.next=13;break}return n.prev=10,n.next=11,(0,u.kQ)(i.uid,{lastActiveGroupId:N});case 11:n.next=13;break;case 12:n.prev=12,F=n.catch(10),console.error("AUTH_STORE: Fehler beim Aktualisieren der lastActiveGroupId auf ".concat(N,":"),F);case 13:O=(0,l.onSnapshot)(g,function(){var t=A(_().mark(function t(n){var a,s,h,d,f,p,m,y,b,w,S,I;return _().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.exists()){t.next=11;break}if(s=k({},a=n.data()),h=!1,d="".concat(i.uid,"_migration"),!L.get(d)){t.next=1;break}return e({user:(0,u._N)(i,s),status:"authenticated"}),t.abrupt("return");case 1:if(s.preferences&&"object"===E(s.preferences)&&(s.preferences.theme&&(s.profileTheme=s.preferences.theme,"light"===s.profileTheme&&delete s.profileTheme),delete s.preferences,h=!0),!s.email&&i.email&&(s.email=i.email,h=!0),s.profileTheme||(p=(f=Object.keys(x.lt))[Math.floor(Math.random()*f.length)],s.profileTheme=p,h=!0),!h){t.next=6;break}return L.set(d,!0),t.prev=2,t.next=3,(0,l.updateDoc)(g,s);case 3:t.next=5;break;case 4:t.prev=4,S=t.catch(2),console.error("AUTH_STORE: Fehler bei der automatischen Datenmigration f\xfcr User ".concat(i.uid,":"),S);case 5:return t.prev=5,setTimeout(function(){L.delete(d)},2e3),t.finish(5);case 6:if(!((m=(0,u._N)(i,s)).playerId&&m.displayName)){t.next=10;break}return t.prev=7,y=(0,l.doc)(o.db,v.eZ,m.playerId),t.next=8,(0,l.updateDoc)(y,{displayName:m.displayName});case 8:t.next=10;break;case 9:t.prev=9,I=t.catch(7),console.error("AUTH_STORE: Error syncing player nickname for ".concat(m.playerId,":"),I);case 10:e({user:m,status:"authenticated"}),a.lastActiveGroupId&&(b=new Map(c.Q5.getState().userGroups.map(function(e){return[e.id,e]})),w=c.Q5.getState().currentGroup,b.has(a.lastActiveGroupId)&&(null==w?void 0:w.id)!==a.lastActiveGroupId?c.Q5.getState().setCurrentGroup(b.get(a.lastActiveGroupId)):b.has(a.lastActiveGroupId)||(console.log("[AuthStore] lastActiveGroupId ".concat(a.lastActiveGroupId," nicht in userGroups gefunden, lade aus Firestore...")),Promise.resolve().then(r.bind(r,1223)).then(function(e){(0,e.getGroupById)(a.lastActiveGroupId).then(function(e){e?(console.log("[AuthStore] ✅ Gruppe ".concat(a.lastActiveGroupId," aus Firestore geladen und als currentGroup gesetzt")),c.Q5.getState().setCurrentGroup(e)):(console.warn("[AuthStore] ❌ Gruppe ".concat(a.lastActiveGroupId," existiert nicht mehr in Firestore")),(0,u.kQ)(i.uid,{lastActiveGroupId:null}).catch(console.error))}).catch(function(e){console.error("[AuthStore] Fehler beim Laden der Gruppe ".concat(a.lastActiveGroupId," aus Firestore:"),e)})}).catch(function(e){console.error("[AuthStore] Fehler beim Import von groupService:",e)}))),t.next=12;break;case 11:console.warn("AUTH_STORE: Firestore user document not found for ".concat(i.uid,". Using Auth data only.")),e({user:(0,u._N)(i,null),status:"authenticated"});case 12:case"end":return t.stop()}},t,null,[[2,4,5,6],[7,9]])}));return function(e){return t.apply(this,arguments)}}(),function(t){console.error("AUTH_STORE: Fehler beim User Doc Listener f\xfcr ".concat(i.uid,":"),t),e({status:"error",error:"Fehler beim Laden der Benutzerdaten."})}),m&&(j=(0,l.doc)(o.db,v.eZ,m),C=(0,l.onSnapshot)(j,function(e){if(e.exists()){var t,r=e.data().groupIds||[],n=new Set(c.Q5.getState().userGroups.map(function(e){return e.id})),i=new Set(r),o=!1,a=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return I(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return I(e,t)}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}(n);try{for(a.s();!(t=a.n()).done;){var s=t.value;i.has(s)||(o=!0)}}catch(e){a.e(e)}finally{a.f()}o||n.size===i.size||(o=!0)}},function(e){console.error("AUTH_STORE: Fehler beim Player Doc Listener f\xfcr Player ".concat(m,":"),e)})),n.next=15;break;case 14:n.prev=14,console.error("AUTH_STORE: Fehler bei der Initialisierung (playerId/Gruppenladen):",G=n.catch(1)),G instanceof s.g&&("permission-denied"===G.code||G.message.includes("Missing or insufficient permissions"))?(console.warn("AUTH_STORE: Permission error detected during initialization - this is normal during page reload. User stays authenticated."),e({status:"authenticated",error:null})):e({status:"error",error:"Initialisierung fehlgeschlagen."});case 15:n.next=17;break;case 16:e({user:null,firebaseUser:null,status:"unauthenticated",isGuest:t().isGuest}),c.Q5.getState().resetGroupStore();case 17:case"end":return n.stop()}},n,null,[[1,14],[10,12]])})),function(e){return n.apply(this,arguments)}),function(t){D&&clearTimeout(D),R=!1,console.error("AUTH_STORE: Kritischer Fehler im onAuthStateChanged-Listener:",t),e({status:"error",error:"Ein kritischer Fehler bei der Authentifizierung ist aufgetreten."})}))},clearError:function(){e({error:null})}}},{name:"auth-storage",partialize:function(e){return{appMode:e.appMode,isGuest:e.isGuest,user:e.user?{uid:e.user.uid,displayName:e.user.displayName,photoURL:e.user.photoURL,email:e.user.email}:null}}}))},1049:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"warnOnce",{enumerable:!0,get:function(){return r}});var r=function(e){}},1139:(e,t,r)=>{"use strict";r.d(t,{cY:()=>S,FA:()=>V,g:()=>U,dM:()=>M,u:()=>h,Uj:()=>l,p9:()=>Y,Fy:()=>E,tD:()=>W,bD:()=>function e(t,r){if(t===r)return!0;let n=Object.keys(t),i=Object.keys(r);for(let o of n){if(!i.includes(o))return!1;let n=t[o],a=r[o];if(H(n)&&H(a)){if(!e(n,a))return!1}else if(n!==a)return!1}for(let e of i)if(!n.includes(e))return!1;return!0},hp:()=>K,T9:()=>b,Tj:()=>y,yU:()=>v,XA:()=>w,mS:()=>d,Ku:()=>X,ZQ:()=>P,sr:()=>D,zJ:()=>x,c1:()=>C,Im:()=>z,lT:()=>R,zW:()=>F,jZ:()=>A,lV:()=>N,nr:()=>L,Ov:()=>j,gE:()=>I,Am:()=>q,I9:()=>$,P1:()=>_,eX:()=>G});let n=()=>void 0;var i=r(5364);let o=function(e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:((64512&i)==55296&&n+1<e.length&&(64512&e.charCodeAt(n+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128):t[r++]=i>>12|224,t[r++]=i>>6&63|128),t[r++]=63&i|128)}return t},a=function(e){let t=[],r=0,n=0;for(;r<e.length;){let i=e[r++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){let o=e[r++];t[n++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){let o=e[r++],a=((7&i)<<18|(63&o)<<12|(63&e[r++])<<6|63&e[r++])-65536;t[n++]=String.fromCharCode(55296+(a>>10)),t[n++]=String.fromCharCode(56320+(1023&a))}else{let o=e[r++],a=e[r++];t[n++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&a)}}return t.join("")},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){let i=e[t],o=t+1<e.length,a=o?e[t+1]:0,s=t+2<e.length,u=s?e[t+2]:0,c=i>>2,l=(3&i)<<4|a>>4,h=(15&a)<<2|u>>6,d=63&u;!s&&(d=64,o||(h=64)),n.push(r[c],r[l],r[h],r[d])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(o(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):a(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let t=0;t<e.length;){let i=r[e.charAt(t++)],o=t<e.length?r[e.charAt(t)]:0,a=++t<e.length?r[e.charAt(t)]:64,s=++t<e.length?r[e.charAt(t)]:64;if(++t,null==i||null==o||null==a||null==s)throw new u;let c=i<<2|o>>4;if(n.push(c),64!==a){let e=o<<4&240|a>>2;if(n.push(e),64!==s){let e=a<<6&192|s;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class u extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let c=function(e){let t=o(e);return s.encodeByteArray(t,!0)},l=function(e){return c(e).replace(/\./g,"")},h=function(e){try{return s.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function d(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r.g)return r.g;throw Error("Unable to locate global object.")}let f=()=>d().__FIREBASE_DEFAULTS__,p=()=>{if(void 0===i||void 0===i.env)return;let e=i.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},m=()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&h(e[1]);return t&&JSON.parse(t)},g=()=>{try{return n()||f()||p()||m()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},y=e=>{var t,r;return null==(r=null==(t=g())?void 0:t.emulatorHosts)?void 0:r[e]},v=e=>{let t=y(e);if(!t)return;let r=t.lastIndexOf(":");if(r<=0||r+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let n=parseInt(t.substring(r+1),10);return"["===t[0]?[t.substring(1,r-1),n]:[t.substring(0,r),n]},b=()=>{var e;return null==(e=g())?void 0:e.config},w=e=>{var t;return null==(t=g())?void 0:t[`_${e}`]};class S{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function x(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch(e){return!1}}async function I(e){return(await fetch(e,{credentials:"include"})).ok}function E(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let r=t||"demo-project",n=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:n,exp:n+3600,auth_time:n,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[l(JSON.stringify({alg:"none",type:"JWT"})),l(JSON.stringify(o)),""].join(".")}let T={},k=!1;function _(e,t){if("undefined"==typeof window||"undefined"==typeof document||!x(window.location.host)||T[e]===t||T[e]||k)return;function r(e){return`__firebase__banner__${e}`}T[e]=t;let n="__firebase__banner",i=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(T))T[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function o(){let e,t,o=(e=document.getElementById(n),t=!1,e||((e=document.createElement("div")).setAttribute("id",n),t=!0),{created:t,element:e}),a=r("text"),s=document.getElementById(a)||document.createElement("span"),u=r("learnmore"),c=document.getElementById(u)||document.createElement("a"),l=r("preprendIcon"),h=document.getElementById(l)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(o.created){let e=o.element;e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center",c.setAttribute("id",u),c.innerText="Learn more",c.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",c.setAttribute("target","__blank"),c.style.paddingLeft="5px",c.style.textDecoration="underline";let t=function(){let e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{k=!0;let e=document.getElementById(n);e&&e.remove()},e}();h.setAttribute("width","24"),h.setAttribute("id",l),h.setAttribute("height","24"),h.setAttribute("viewBox","0 0 24 24"),h.setAttribute("fill","none"),h.style.marginLeft="-6px",e.append(h,s,c,t),document.body.appendChild(e)}i?(s.innerText="Preview backend disconnected.",h.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(h.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,s.innerText="Preview backend running in this workspace."),s.setAttribute("id",a)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",o):o()}function P(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function A(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(P())}function O(){var e;let t=null==(e=g())?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(r.g.process)}catch(e){return!1}}function C(){return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function D(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function N(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function R(){let e=P();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function L(){return!O()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function j(){return!O()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function F(){try{return"object"==typeof indexedDB}catch(e){return!1}}function G(){return new Promise((e,t)=>{try{let r=!0,n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{r=!1},i.onerror=()=>{var e;t((null==(e=i.error)?void 0:e.message)||"")}}catch(e){t(e)}})}function M(){return"undefined"!=typeof navigator&&!!navigator.cookieEnabled}class U extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,U.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,V.prototype.create)}}class V{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){var r,n;let i=t[0]||{},o=`${this.service}/${e}`,a=this.errors[e],s=a?(r=a,n=i,r.replace(B,(e,t)=>{let r=n[t];return null!=r?String(r):`<${t}?>`})):"Error",u=`${this.serviceName}: ${s} (${o}).`;return new U(o,u,i)}}let B=/\{\$([^}]+)}/g;function z(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function H(e){return null!==e&&"object"==typeof e}function q(e){let t=[];for(let[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function $(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[r,n]=e.split("=");t[decodeURIComponent(r)]=decodeURIComponent(n)}}),t}function K(e){let t=e.indexOf("?");if(!t)return"";let r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}function W(e,t){let r=new J(e,t);return r.subscribe.bind(r)}class J{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let n;if(void 0===e&&void 0===t&&void 0===r)throw Error("Missing Observer.");void 0===(n=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let r of t)if(r in e&&"function"==typeof e[r])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:r}:e).next&&(n.next=Q),void 0===n.error&&(n.error=Q),void 0===n.complete&&(n.complete=Q);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}}),this.observers.push(n),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Q(){}function Y(e,t=1e3,r=2){let n=t*Math.pow(r,e),i=Math.round(.5*n*(Math.random()-.5)*2);return Math.min(144e5,n+i)}function X(e){return e&&e._delegate?e._delegate:e}},1200:(e,t,r)=>{"use strict";r.d(t,{M:()=>i});var n=r(4232);function i(e){let t=(0,n.useRef)(null);return null===t.current&&(t.current=e()),t.current}},1223:(e,t,r)=>{"use strict";r.r(t),r.d(t,{createGroup:()=>x,fetchGroupMembers:()=>A,getGroupById:()=>I,getGroupDetails:()=>O,getUserGroups:()=>E,getUserGroupsByPlayerId:()=>T,updateGroupMemberRole:()=>_,updateGroupSettings:()=>P,uploadGroupLogo:()=>k});var n=r(5519),i=r(2219),o=r(1411),a=r(5230),s=r(5226),u=r(2322),c=r(2009),l=r(132),h=r(8310),d=r(7044);function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return m(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return m(e,t)}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function g(){g=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(t,r,n,o){var a,s,u,c,l=Object.create((r&&r.prototype instanceof v?r:v).prototype);return i(l,"_invoke",{value:(a=t,s=n,u=new A(o||[]),c=d,function(t,r){if(c===p)throw Error("Generator is already running");if(c===m){if("throw"===t)throw r;return{value:e,done:!0}}for(u.method=t,u.arg=r;;){var n=u.delegate;if(n){var i=function t(r,n){var i=n.method,o=r.iterator[i];if(o===e)return n.delegate=null,"throw"===i&&r.iterator.return&&(n.method="return",n.arg=e,t(r,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+i+"' method")),y;var a=h(o,r.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,y;var s=a.arg;return s?s.done?(n[r.resultName]=s.value,n.next=r.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):s:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,y)}(n,u);if(i){if(i===y)continue;return i}}if("next"===u.method)u.sent=u._sent=u.arg;else if("throw"===u.method){if(c===d)throw c=m,u.arg;u.dispatchException(u.arg)}else"return"===u.method&&u.abrupt("return",u.arg);c=p;var o=h(a,s,u);if("normal"===o.type){if(c=u.done?m:"suspendedYield",o.arg===y)continue;return{value:o.arg,done:u.done}}"throw"===o.type&&(c=m,u.method="throw",u.arg=o.arg)}})}),l}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var d="suspendedStart",p="executing",m="completed",y={};function v(){}function b(){}function w(){}var S={};c(S,a,function(){return this});var x=Object.getPrototypeOf,I=x&&x(x(O([])));I&&I!==r&&n.call(I,a)&&(S=I);var E=w.prototype=v.prototype=Object.create(S);function T(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function k(e,t){var r;i(this,"_invoke",{value:function(i,o){function a(){return new t(function(r,a){!function r(i,o,a,s){var u=h(e[i],e,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==f(l)&&n.call(l,"__await")?t.resolve(l.__await).then(function(e){r("next",e,a,s)},function(e){r("throw",e,a,s)}):t.resolve(l).then(function(e){c.value=e,a(c)},function(e){return r("throw",e,a,s)})}s(u.arg)}(i,o,r,a)})}return r=r?r.then(a,a):a()}})}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function O(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw TypeError(f(t)+" is not iterable")}return b.prototype=w,i(E,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:b,configurable:!0}),b.displayName=c(w,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,c(e,u,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},T(k.prototype),c(k.prototype,s,function(){return this}),t.AsyncIterator=k,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new k(l(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},T(E),c(E,u,"Generator"),c(E,a,function(){return this}),c(E,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach(function(t){b(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function b(e,t,r){var n;return(n=function(e,t){if("object"!==f(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==f(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"),(t="symbol"===f(n)?n:String(n))in e)?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function w(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(n,i)}function S(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){w(o,n,i,a,s,"next",e)}function s(e){w(o,n,i,a,s,"throw",e)}a(void 0)})}}var x=function(){var e=S(g().mark(function e(t,r,s){var u,f,p,m,y,w,S,x,I,E,T,k,_,P;return g().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.db){e.next=1;break}throw Error("Firestore ist nicht initialisiert.");case 1:if(t){e.next=2;break}throw Error("Ung\xfcltige Benutzer-ID.");case 2:if(!(!s||s.trim().length<3||s.trim().length>50)){e.next=3;break}throw Error("Ung\xfcltiger Gruppenname (muss 3-50 Zeichen lang sein).");case 3:return u=s.trim(),f=(0,n.rJ)(n.db,i.ce),e.prev=4,p=(0,n.P)(f,(0,n._M)("name","==",u)),e.next=5,(0,n.GG)(p);case 5:if(e.sent.empty){e.next=6;break}throw Error('Eine Gruppe mit dem Namen "'.concat(u,'" existiert bereits.'));case 6:return e.next=7,(0,o.getPlayerIdForUser)(t,r);case 7:if(m=e.sent){e.next=8;break}throw console.error("createGroup: Could not get or create playerId for user ".concat(t,".")),Error("Konnte keine Spieler-ID f\xfcr den Benutzer finden oder erstellen.");case 8:return y={name:u,description:"Willkommen in unserer Jassrunde!",logoUrl:null,createdAt:(0,n.O5)(),updatedAt:(0,n.O5)(),createdBy:t,adminIds:[t],isPublic:!0,scoreSettings:h.$d,strokeSettings:d.zh,farbeSettings:l.FT,theme:"yellow",players:b({},m,{displayName:r||"Unbekannt",joinedAt:(0,n.O5)()})},e.next=9,(0,c.addDoc)(f,y);case 9:return S=(w=e.sent).id,e.next=10,(0,n.x7)(w);case 10:if((x=e.sent).exists()){e.next=11;break}throw console.error("createGroup: Newly created group document ".concat(S," not found immediately after creation.")),Error("Konnte das neu erstellte Gruppendokument nicht abrufen.");case 11:return I=x.data(),E=v({id:x.id},I),T=(0,n.H9)(n.db,i.eZ,m),e.prev=12,e.next=13,(0,n.mZ)(T,{groupIds:(0,c.arrayUnion)(S)});case 13:e.next=15;break;case 14:throw e.prev=14,k=e.catch(12),console.error("createGroup: FAILED to update player document ".concat(m," with groupId ").concat(S,":"),k),Error("Gruppe erstellt (ID: ".concat(S,"), aber Spieler konnte nicht zur Gruppe hinzugef\xfcgt werden."));case 15:return e.prev=16,e.next=17,(0,a.kQ)(t,{lastActiveGroupId:S});case 17:e.next=19;break;case 18:e.prev=18,_=e.catch(16),console.error("createGroup: FAILED to update user document ".concat(t," with lastActiveGroupId ").concat(S,":"),_);case 19:return e.abrupt("return",E);case 20:if(e.prev=20,P=e.catch(4),console.error("Fehler beim Erstellen der Gruppe (Gesamt-Catch):"),P instanceof Error&&P.message.includes("Spieler konnte nicht zur Gruppe hinzugef\xfcgt werden")||console.error(P),!(P instanceof Error&&P.message.startsWith("Eine Gruppe mit dem Namen"))){e.next=21;break}throw P;case 21:if(!(P instanceof Error&&P.message.includes("Spieler konnte nicht zur Gruppe hinzugef\xfcgt werden"))){e.next=22;break}throw P;case 22:throw Error("Gruppe konnte nicht erstellt werden.");case 23:case"end":return e.stop()}},e,null,[[4,20],[12,14],[16,18]])}));return function(t,r,n){return e.apply(this,arguments)}}(),I=function(){var e=S(g().mark(function e(t){var r,o,a,s,u,c,h;return g().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.db){e.next=1;break}throw Error("Firestore ist nicht initialisiert.");case 1:if(t){e.next=2;break}return console.warn("getGroupById ohne groupId aufgerufen."),e.abrupt("return",null);case 2:return e.prev=2,r=(0,n.H9)(n.db,i.ce,t),e.next=3,(0,n.x7)(r);case 3:if(!(o=e.sent).exists()){e.next=4;break}return u=null!=(a=(s=o.data()).farbeSettings)?a:l.FT,c=v(v({id:o.id},s),{},{farbeSettings:u}),e.abrupt("return",c);case 4:return console.log("Gruppe mit ID ".concat(t," nicht gefunden.")),e.abrupt("return",null);case 5:e.next=7;break;case 6:throw e.prev=6,h=e.catch(2),console.error("Fehler beim Abrufen der Gruppe ".concat(t,":"),h),Error("Fehler beim Abrufen der Gruppendaten.");case 7:case"end":return e.stop()}},e,null,[[2,6]])}));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=S(g().mark(function e(t){var r,a,s,u,h,d,f,m,y,b,w,S,x,I,E,T,k,_,P,A,O,C,D,N,R,L,j,F,G,M,U,V,B,z,H,q,$,K,W,J;return g().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.db){e.next=1;break}throw Error("Firestore ist nicht initialisiert.");case 1:if(t){e.next=2;break}return console.warn("getUserGroups ohne userId aufgerufen."),e.abrupt("return",[]);case 2:return e.prev=2,e.next=3,(0,o.getPlayerIdForUser)(t,null);case 3:if(r=e.sent){e.next=4;break}return console.log("Keine Spieler-ID f\xfcr Benutzer ".concat(t," gefunden.")),e.abrupt("return",[]);case 4:return e.next=5,(0,o.getPlayerDocument)(r);case 5:if(!(!(a=e.sent)||!a.groupIds||0===a.groupIds.length)){e.next=6;break}return console.log("Spieler ".concat(r," ist in keiner Gruppe (nach Pr\xfcfung des empfangenen playerDoc). groupIds:"),null==a?void 0:a.groupIds),e.abrupt("return",[]);case 6:s=a.groupIds,u=new Set,h=30,d=[],f=0;case 7:if(!(f<s.length)){e.next=13;break}if(0!==(m=s.slice(f,f+h)).length){e.next=8;break}return e.abrupt("continue",12);case 8:return y=(0,n.P)((0,n.rJ)(n.db,i.ce),(0,n._M)((0,c.documentId)(),"in",m)),e.prev=9,e.next=10,(0,n.GG)(y);case 10:e.sent.forEach(function(e){var t=e.data();t?(d.push({id:e.id,data:t}),u.add(e.id)):console.warn("getUserGroups: Document data for group ".concat(e.id," was undefined."))}),e.next=12;break;case 11:e.prev=11,$=e.catch(9),console.error("getUserGroups: Error fetching chunk with IDs [".concat(m.join(", "),"]:"),$);case 12:f+=h,e.next=7;break;case 13:if(!((b=Array.from(new Set(s)).filter(function(e){return!u.has(e)})).length>0)){e.next=18;break}if(console.warn("getUserGroups: WARNING - Could not find group documents for ".concat(b.length," requested IDs using 'in' query:"),b),e.prev=14,w=(0,n.H9)(n.db,i.eZ,r),(S=s.filter(function(e){return u.has(e)})).length===s.length){e.next=16;break}return console.log("getUserGroups: \uD83D\uDD27 AUTO-HEALING: Bereinige ".concat(b.length," fehlende Gruppenreferenzen f\xfcr Player ").concat(r)),e.next=15,(0,n.mZ)(w,{groupIds:S,updatedAt:(0,n.O5)()});case 15:console.log("getUserGroups: ✅ Player-Dokument bereinigt. Neue groupIds: [".concat(S.join(", "),"]"));case 16:e.next=18;break;case 17:e.prev=17,K=e.catch(14),console.error("getUserGroups: ❌ Fehler beim Auto-Healing f\xfcr Player ".concat(r,":"),K);case 18:if(x=[],I=new Set,d.forEach(function(e){(e.data.playerIds||[]).forEach(function(e){return I.add(e)})}),E=Array.from(I),T=new Map,!(E.length>0)){e.next=25;break}k=30,_=0;case 19:if(!(_<E.length)){e.next=25;break}if(0!==(P=E.slice(_,_+k)).length){e.next=20;break}return e.abrupt("continue",24);case 20:return A=(0,n.P)((0,n.rJ)(n.db,i.eZ),(0,n._M)((0,c.documentId)(),"in",P)),e.prev=21,e.next=22,(0,n.GG)(A);case 22:e.sent.forEach(function(e){var t=e.data();t?T.set(e.id,v(v({},t),{},{id:e.id})):console.warn("getUserGroups: Player document data for ID ".concat(e.id," was undefined."))}),e.next=24;break;case 23:e.prev=23,W=e.catch(21),console.error("getUserGroups: Error fetching player chunk with IDs [".concat(P.join(", "),"]:"),W);case 24:_+=k,e.next=19;break;case 25:for(O=0,C=d;O<C.length;O++){L=(R=(N=C[O]).data).playerIds||[],j={},F=p(L);try{for(F.s();!(G=F.n()).done;)U=G.value,V=T.get(U),B=null==(M=R.players)?void 0:M[U],V?(z=V.displayName||"Unbekannt",H=(null==B?void 0:B.joinedAt)instanceof c.Timestamp?B.joinedAt:c.Timestamp.now(),j[U]={displayName:z,joinedAt:H}):j[U]={displayName:"Unbekannter Spieler",joinedAt:(null==B?void 0:B.joinedAt)instanceof c.Timestamp?B.joinedAt:c.Timestamp.now()}}catch(e){F.e(e)}finally{F.f()}q=v(v({id:N.id},R),{},{players:j,farbeSettings:null!=(D=R.farbeSettings)?D:l.FT}),x.push(q)}return e.abrupt("return",x);case 26:throw e.prev=26,J=e.catch(2),console.error("Fehler beim Abrufen der Gruppen f\xfcr Benutzer ".concat(t,":"),J),Error("Gruppen konnten nicht abgerufen werden.");case 27:case"end":return e.stop()}},e,null,[[2,26],[9,11],[14,17],[21,23]])}));return function(t){return e.apply(this,arguments)}}(),T=function(){var e=S(g().mark(function e(t){var r,a,s,u,h,d,f,m,y,b,w,S,x,I,E,T,k,_,P,A,O,C,D,N,R,L,j,F,G,M,U,V,B,z,H,q,$,K,W;return g().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.db){e.next=1;break}throw Error("Firestore ist nicht initialisiert.");case 1:if(t){e.next=2;break}return console.warn("getUserGroupsByPlayerId ohne playerId aufgerufen."),e.abrupt("return",[]);case 2:return e.prev=2,e.next=3,(0,o.getPlayerDocument)(t);case 3:if(!(!(r=e.sent)||!r.groupIds||0===r.groupIds.length)){e.next=4;break}return e.abrupt("return",[]);case 4:a=r.groupIds,s=[],u=new Set,h=30,d=0;case 5:if(!(d<a.length)){e.next=11;break}if(0!==(f=a.slice(d,d+h)).length){e.next=6;break}return e.abrupt("continue",10);case 6:return m=(0,n.P)((0,n.rJ)(n.db,i.ce),(0,n._M)((0,c.documentId)(),"in",f)),e.prev=7,e.next=8,(0,n.GG)(m);case 8:e.sent.forEach(function(e){var t=e.data();t?(s.push({id:e.id,data:t}),u.add(e.id)):console.warn("getUserGroupsByPlayerId: Document data for group ".concat(e.id," was undefined."))}),e.next=10;break;case 9:e.prev=9,q=e.catch(7),console.error("getUserGroupsByPlayerId: Error fetching group chunk with IDs [".concat(f.join(", "),"]:"),q);case 10:d+=h,e.next=5;break;case 11:if(!((y=Array.from(new Set(a)).filter(function(e){return!u.has(e)})).length>0)){e.next=16;break}if(console.warn("getUserGroupsByPlayerId: WARNING - Could not find group documents for ".concat(y.length," requested IDs using 'in' query:"),y),e.prev=12,b=(0,n.H9)(n.db,i.eZ,t),(w=a.filter(function(e){return u.has(e)})).length===a.length){e.next=14;break}return console.log("getUserGroupsByPlayerId: \uD83D\uDD27 AUTO-HEALING: Bereinige ".concat(y.length," fehlende Gruppenreferenzen f\xfcr Player ").concat(t)),e.next=13,(0,n.mZ)(b,{groupIds:w,updatedAt:(0,n.O5)()});case 13:console.log("getUserGroupsByPlayerId: ✅ Player-Dokument bereinigt. Neue groupIds: [".concat(w.join(", "),"]"));case 14:e.next=16;break;case 15:e.prev=15,$=e.catch(12),console.error("getUserGroupsByPlayerId: ❌ Fehler beim Auto-Healing f\xfcr Player ".concat(t,":"),$);case 16:if(S=[],x=new Set,s.forEach(function(e){(e.data.playerIds||[]).forEach(function(e){return x.add(e)})}),I=Array.from(x),E=new Map,!(I.length>0)){e.next=24;break}T=30,k=0;case 17:if(!(k<I.length)){e.next=23;break}if(0!==(_=I.slice(k,k+T)).length){e.next=18;break}return e.abrupt("continue",22);case 18:return P=(0,n.P)((0,n.rJ)(n.db,i.eZ),(0,n._M)((0,c.documentId)(),"in",_)),e.prev=19,e.next=20,(0,n.GG)(P);case 20:e.sent.forEach(function(e){var t=e.data();t?E.set(e.id,v(v({},t),{},{id:e.id})):console.warn("getUserGroupsByPlayerId: Player document data for ID ".concat(e.id," was undefined."))}),e.next=22;break;case 21:e.prev=21,K=e.catch(19),console.error("getUserGroupsByPlayerId: Error fetching player chunk with IDs [".concat(_.join(", "),"]:"),K);case 22:k+=T,e.next=17;break;case 23:e.next=24;break;case 24:for(A=0,O=s;A<O.length;A++){R=(N=(D=O[A]).data).playerIds||[],L={},j=p(R);try{for(j.s();!(F=j.n()).done;)M=F.value,U=E.get(M),V=null==(G=N.players)?void 0:G[M],U?(B=U.displayName||"Unbekannt",z=(null==V?void 0:V.joinedAt)instanceof c.Timestamp?V.joinedAt:c.Timestamp.now(),L[M]={displayName:B,joinedAt:z}):L[M]={displayName:"Unbekannter Spieler",joinedAt:(null==V?void 0:V.joinedAt)instanceof c.Timestamp?V.joinedAt:c.Timestamp.now()}}catch(e){j.e(e)}finally{j.f()}H=v(v({id:D.id},N),{},{players:L,farbeSettings:null!=(C=N.farbeSettings)?C:l.FT}),S.push(H)}return e.abrupt("return",S);case 25:throw e.prev=25,W=e.catch(2),console.error("getUserGroupsByPlayerId: General error for player ".concat(t,":"),W),Error("Fehler beim Abrufen der Gruppendaten des Spielers.");case 26:case"end":return e.stop()}},e,null,[[2,25],[7,9],[12,15],[19,21]])}));return function(t){return e.apply(this,arguments)}}(),k=function(){var e=S(g().mark(function e(t,r){var o,a,c,l,h,d,p,m,y,v,b,w,S,x,I,E,T,k,_;return g().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.db){e.next=1;break}throw Error("Firestore ist nicht initialisiert.");case 1:if(t){e.next=2;break}throw Error("Gruppen-ID fehlt.");case 2:if(r){e.next=3;break}throw Error("Keine Datei zum Hochladen ausgew\xe4hlt.");case 3:if(o=(0,s.c7)()){e.next=4;break}throw Error("Firebase Storage nicht initialisiert.");case 4:return a=(0,n.H9)(n.db,i.ce,t),e.prev=5,e.next=6,(0,n.x7)(a);case 6:if(!(c=e.sent).exists()){e.next=11;break}if(!(h=null==(l=c.data())?void 0:l.logoUrl)){e.next=10;break}return e.prev=7,d=(0,s.KR)(o,h),console.log("Versuche altes Logo zu l\xf6schen: ".concat(h)),e.next=8,(0,s.XR)(d);case 8:console.log("Altes Gruppenlogo gel\xf6scht."),e.next=10;break;case 9:e.prev=9,T=e.catch(7),p=void 0,"object"===f(T)&&null!==T&&"code"in T&&(p=T.code),"storage/object-not-found"!==p?console.warn("Konnte altes Gruppenlogo nicht l\xf6schen:",T):console.log("Altes Gruppenlogo existierte nicht oder konnte nicht gefunden werden (ignoriert).");case 10:e.next=12;break;case 11:throw Error("Gruppe mit ID ".concat(t," nicht gefunden."));case 12:e.next=14;break;case 13:throw e.prev=13,console.error("Fehler beim Abrufen der Gruppe zum L\xf6schen des alten Logos:",e.catch(5)),Error("Fehler bei der Vorbereitung des Logo-Uploads.");case 14:if(m=r.name.split(".").pop()||"png",y=n.j2.currentUser){e.next=15;break}throw Error("Kein authentifizierter Benutzer f\xfcr Logo-Upload.");case 15:if(v=y.uid,b="groupLogos/".concat(v,"/").concat(t,"/logo.").concat(m),w=(0,s.KR)(o,b),e.prev=16,r.type.toLowerCase().startsWith("image/")){e.next=17;break}throw Error("Die Datei ist kein Bild.");case 17:if(!((S=r.size/1048576)>5)){e.next=18;break}throw Error("Logo ist zu gro\xdf (".concat(S.toFixed(2)," MB). Maximum: 5 MB."));case 18:return console.log("Lade Gruppenlogo hoch nach ".concat(b,"...")),e.next=19,(0,s.D)(w,r);case 19:return x=e.sent,console.log("Upload erfolgreich."),e.next=20,(0,s.qk)(x.ref);case 20:return console.log("Download URL erhalten:",I=e.sent),e.prev=21,e.next=22,(0,n.mZ)(a,{logoUrl:I,updatedAt:(0,n.O5)()});case 22:console.log("Firestore Gruppe ".concat(t," mit neuer logoUrl aktualisiert.")),e.next=25;break;case 23:if(e.prev=23,!((k=e.catch(21))instanceof Error&&k.message.includes("No document to update"))){e.next=24;break}console.warn("GROUP_SERVICE: Group ".concat(t," does not exist, silently ignoring logo URL update.")),e.next=25;break;case 24:throw console.error("Fehler beim Aktualisieren der logoUrl f\xfcr Gruppe ".concat(t,":"),k),Error("Fehler beim Aktualisieren der Gruppe mit neuer Logo-URL.");case 25:return u.Q5.getState().updateGroupInList(t,{logoUrl:I}),console.log("GroupStore f\xfcr Gruppe ".concat(t," mit neuer logoUrl direkt aktualisiert.")),e.abrupt("return",I);case 26:if(e.prev=26,console.error("Fehler beim Hochladen des Gruppenlogos oder Aktualisieren von Firestore:",_=e.catch(16)),!("object"===f(_)&&null!==_&&"code"in _&&_ instanceof Error)){e.next=27;break}throw E=_.code,Error("Fehler beim Logo-Upload (".concat(E,"): ").concat(_.message));case 27:if(!(_ instanceof Error)){e.next=28;break}throw Error("Fehler beim Logo-Upload: ".concat(_.message));case 28:throw Error("Fehler beim Hochladen des Gruppenlogos.");case 29:case"end":return e.stop()}},e,null,[[5,13],[7,9],[16,26],[21,23]])}));return function(t,r){return e.apply(this,arguments)}}(),_=function(){var e=S(g().mark(function e(t,r,o,a){var s,u,l;return g().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.db){e.next=1;break}throw Error("Firestore ist nicht initialisiert.");case 1:if(!(!t||!r||!a)){e.next=2;break}throw Error("Ung\xfcltige IDs f\xfcr Gruppen- oder Spieleroperation.");case 2:if("admin"===o||"member"===o){e.next=3;break}throw Error("Ung\xfcltige Zielrolle angegeben.");case 3:return s=(0,n.H9)(n.db,i.ce,t),e.prev=4,e.next=5,(0,c.runTransaction)(n.db,function(){var e=S(g().mark(function e(u){var l,h,d,f,p,m,y,v,b;return g().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,u.get(s);case 1:if((h=e.sent).exists()){e.next=2;break}throw Error("Gruppe mit ID ".concat(t," nicht gefunden."));case 2:return f=(d=h.data()).createdBy,p=(0,n.H9)(n.db,i.eZ,r),e.next=3,u.get(p);case 3:if((m=e.sent).exists()){e.next=4;break}throw console.error("[Tx Detail] Fehler: Player-Dokument ".concat(r," nicht gefunden.")),Error("Spieler-Dokument ".concat(r," nicht gefunden."));case 4:if(y=null==(l=m.data())?void 0:l.userId){e.next=5;break}throw console.error("[Tx Detail] Fehler: Player-Dokument ".concat(r," hat keine verkn\xfcpfte userId.")),Error("Zielspieler ".concat(r," ist kein registrierter Benutzer und kann nicht zum Admin ernannt/entfernt werden."));case 5:if(console.log("[Tx Detail] Ziel-UserID f\xfcr Player ".concat(r," ermittelt: ").concat(y)),!(!d.adminIds||!d.adminIds.includes(a))){e.next=6;break}throw Error("Nur Admins d\xfcrfen Mitgliederrollen \xe4ndern.");case 6:if(y!==f){e.next=7;break}throw console.error("[Tx Detail] Versuch, den Gruppengr\xfcnder (".concat(y,") als Admin zu entfernen.")),Error("Der Gruppengr\xfcnder kann nicht als Admin entfernt werden.");case 7:if(b=(v=d.adminIds||[]).includes(y),"admin"!==o){e.next=9;break}if(!b){e.next=8;break}return console.log("Spieler ".concat(r," ist bereits Admin in Gruppe ").concat(t,".")),e.abrupt("return",y);case 8:console.log("[Tx Detail] Ernenne User ".concat(y," (Player ").concat(r,") zum Admin.")),u.update(s,{adminIds:(0,c.arrayUnion)(y),updatedAt:(0,n.O5)()}),console.log("Benutzer ".concat(y," (Spieler ").concat(r,") erfolgreich zum Admin in Gruppe ").concat(t," ernannt.")),e.next=12;break;case 9:if(b){e.next=10;break}return console.log("Spieler ".concat(r," ist bereits nur Mitglied in Gruppe ").concat(t,".")),e.abrupt("return",y);case 10:if(!(v.length<=1)){e.next=11;break}throw console.error("[Tx Detail] Versuch, den letzten Admin zu entfernen."),Error("Der letzte Admin der Gruppe kann nicht entfernt werden.");case 11:console.log("[Tx Detail] Entferne Admin-Status f\xfcr User ".concat(y," (Player ").concat(r,")")),u.update(s,{adminIds:(0,c.arrayRemove)(y),updatedAt:(0,n.O5)()}),console.log("Admin-Status f\xfcr Spieler ".concat(r," in Gruppe ").concat(t," erfolgreich entfernt."));case 12:return e.abrupt("return",y);case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 5:return u=e.sent,e.abrupt("return",u);case 6:if(e.prev=6,l=e.catch(4),console.error("Fehler beim Aktualisieren der Mitgliedsrolle f\xfcr Spieler ".concat(r," in Gruppe ").concat(t,":"),l),!(l instanceof Error)){e.next=7;break}throw l;case 7:throw Error("Die Mitgliedsrolle konnte nicht aktualisiert werden.");case 8:case"end":return e.stop()}},e,null,[[4,6]])}));return function(t,r,n,i){return e.apply(this,arguments)}}(),P=function(){var e=S(g().mark(function e(t,r){var o,a,s;return g().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.db){e.next=1;break}throw Error("Firestore ist nicht initialisiert.");case 1:if(t){e.next=2;break}throw Error("Gruppen-ID fehlt.");case 2:if(!(!r||0===Object.keys(r).length)){e.next=3;break}return console.warn("updateGroupSettings ohne Einstellungen aufgerufen."),e.abrupt("return");case 3:return o=(0,n.H9)(n.db,i.ce,t),Object.keys(a=v(v({},r),{},{updatedAt:(0,n.O5)()})).forEach(function(e){void 0===a[e]&&delete a[e]}),e.prev=4,console.log("Aktualisiere Gruppe ".concat(t," mit Einstellungen:"),a),e.next=5,(0,n.mZ)(o,a);case 5:console.log("Gruppe ".concat(t," erfolgreich aktualisiert.")),e.next=8;break;case 6:if(e.prev=6,s=e.catch(4),console.error("Fehler beim Aktualisieren der Gruppe ".concat(t,":"),s),!(s instanceof Error&&s.message.includes("No document to update"))){e.next=7;break}return console.warn("GROUP_SERVICE: Group ".concat(t," does not exist, silently ignoring settings update.")),e.abrupt("return");case 7:throw Error("Fehler beim Aktualisieren der Gruppeneinstellungen.");case 8:case"end":return e.stop()}},e,null,[[4,6]])}));return function(t,r){return e.apply(this,arguments)}}(),A=function(){var e=S(g().mark(function e(t){var r,i,a,s;return g().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.db){e.next=1;break}throw Error("Firestore ist nicht initialisiert.");case 1:if(t){e.next=2;break}return console.warn("fetchGroupMembers ohne groupId aufgerufen."),e.abrupt("return",[]);case 2:return e.prev=2,e.next=3,I(t);case 3:if(!(!(r=e.sent)||!r.playerIds||0===r.playerIds.length)){e.next=4;break}return console.log("[groupService] Keine Player-IDs in Gruppe ".concat(t," gefunden oder Gruppe existiert nicht.")),e.abrupt("return",[]);case 4:return i=r.playerIds.map(function(e){return(0,o.getPlayerDocument)(e)}),e.next=5,Promise.all(i);case 5:return a=e.sent.filter(function(e){return!!e}),console.log("[groupService] Fetched ".concat(a.length," member profiles for group ").concat(t,".")),e.abrupt("return",a);case 6:return e.prev=6,s=e.catch(2),console.error("[groupService] Fehler beim Abrufen der Gruppenmitglieder f\xfcr Gruppe ".concat(t,":"),s),e.abrupt("return",[]);case 7:case"end":return e.stop()}},e,null,[[2,6]])}));return function(t){return e.apply(this,arguments)}}(),O=function(){var e=S(g().mark(function e(t){var r,o,a,s,u;return g().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}return console.error("getGroupDetails called without groupId."),e.abrupt("return",null);case 1:return e.prev=1,r=(0,n.H9)(n.db,i.ce,t),e.next=2,(0,n.x7)(r);case 2:if((o=e.sent).exists()){e.next=3;break}return console.warn("Group with ID ".concat(t," not found.")),e.abrupt("return",null);case 3:return s=v(v({id:t},a=o.data()),{},{players:a.players||{},playerIds:a.playerIds||[],adminIds:a.adminIds||[],scoreSettings:a.scoreSettings||h.$d,strokeSettings:a.strokeSettings||d.zh,farbeSettings:a.farbeSettings||l.FT}),e.abrupt("return",s);case 4:throw e.prev=4,u=e.catch(1),console.error("[getGroupDetails] Error fetching group ".concat(t,":"),u),Error("Failed to fetch group details: ".concat(u instanceof Error?u.message:String(u)));case 5:case"end":return e.stop()}},e,null,[[1,4]])}));return function(t){return e.apply(this,arguments)}}()},1302:(e,t,r)=>{"use strict";r.d(t,{A7C:()=>a,BS8:()=>u,HZi:()=>c,Mbp:()=>d,Pcn:()=>s,QVr:()=>i,RCe:()=>f,Z0P:()=>o,__w:()=>h,rQ8:()=>l,x$1:()=>p});var n=r(112);function i(e){return(0,n.k5)({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"},child:[]}]})(e)}function o(e){return(0,n.k5)({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"},child:[]}]})(e)}function a(e){return(0,n.k5)({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"},child:[]}]})(e)}function s(e){return(0,n.k5)({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"},child:[]}]})(e)}function u(e){return(0,n.k5)({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},child:[]}]})(e)}function c(e){return(0,n.k5)({tag:"svg",attr:{viewBox:"0 0 256 512"},child:[{tag:"path",attr:{d:"M96 496V16c0-8.8-7.2-16-16-16H48c-8.8 0-16 7.2-16 16v480c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16zm128 0V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v480c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16z"},child:[]}]})(e)}function l(e){return(0,n.k5)({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"},child:[]}]})(e)}function h(e){return(0,n.k5)({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"},child:[]}]})(e)}function d(e){return(0,n.k5)({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"},child:[]}]})(e)}function f(e){return(0,n.k5)({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M32 464a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128H32zm272-256a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zM432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16z"},child:[]}]})(e)}function p(e){return(0,n.k5)({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"},child:[]}]})(e)}},1370:(e,t)=>{"use strict";t.byteLength=function(e){var t=u(e),r=t[0],n=t[1];return(r+n)*3/4-n},t.toByteArray=function(e){var t,r,o=u(e),a=o[0],s=o[1],c=new i((a+s)*3/4-s),l=0,h=s>0?a-4:a;for(r=0;r<h;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;return 2===s&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,c[l++]=255&t),1===s&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t),c},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o=[],a=0,s=n-i;a<s;a+=16383)o.push(function(e,t,n){for(var i,o=[],a=t;a<n;a+=3)i=(e[a]<<16&0xff0000)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(r[i>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return o.join("")}(e,a,a+16383>s?s:a+16383));return 1===i?o.push(r[(t=e[n-1])>>2]+r[t<<4&63]+"=="):2===i&&o.push(r[(t=(e[n-2]<<8)+e[n-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),o.join("")};for(var r=[],n=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,s=o.length;a<s;++a)r[a]=o[a],n[o.charCodeAt(a)]=a;function u(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var n=r===t?0:4-r%4;return[r,n]}n[45]=62,n[95]=63},1411:(e,t,r)=>{"use strict";r.r(t),r.d(t,{createGuestPlayer:()=>w,createPlayer:()=>g,ensurePlayersExist:()=>k,getGroupMembersSortedByGames:()=>_,getPlayerByNickname:()=>y,getPlayerByUserId:()=>v,getPlayerDocument:()=>T,getPlayerIdForUser:()=>I,getPublicPlayerProfile:()=>b,getPublicPlayerProfilesByUserIds:()=>A,syncDisplayNameAcrossCollections:()=>P,updatePlayerDocument:()=>O});var n=r(5519),i=r(2009),o=r(8449),a=r(2219);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach(function(t){l(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function l(e,t,r){var n;return(n=function(e,t){if("object"!==s(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==s(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"),(t="symbol"===s(n)?n:String(n))in e)?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function h(e,t){if(e){if("string"==typeof e)return d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return d(e,t)}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function f(){f=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function h(t,r,n,o){var a,s,u,c,l=Object.create((r&&r.prototype instanceof v?r:v).prototype);return i(l,"_invoke",{value:(a=t,s=n,u=new A(o||[]),c=p,function(t,r){if(c===m)throw Error("Generator is already running");if(c===g){if("throw"===t)throw r;return{value:e,done:!0}}for(u.method=t,u.arg=r;;){var n=u.delegate;if(n){var i=function t(r,n){var i=n.method,o=r.iterator[i];if(o===e)return n.delegate=null,"throw"===i&&r.iterator.return&&(n.method="return",n.arg=e,t(r,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+i+"' method")),y;var a=d(o,r.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,y;var s=a.arg;return s?s.done?(n[r.resultName]=s.value,n.next=r.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):s:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,y)}(n,u);if(i){if(i===y)continue;return i}}if("next"===u.method)u.sent=u._sent=u.arg;else if("throw"===u.method){if(c===p)throw c=g,u.arg;u.dispatchException(u.arg)}else"return"===u.method&&u.abrupt("return",u.arg);c=m;var o=d(a,s,u);if("normal"===o.type){if(c=u.done?g:"suspendedYield",o.arg===y)continue;return{value:o.arg,done:u.done}}"throw"===o.type&&(c=g,u.method="throw",u.arg=o.arg)}})}),l}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var p="suspendedStart",m="executing",g="completed",y={};function v(){}function b(){}function w(){}var S={};l(S,a,function(){return this});var x=Object.getPrototypeOf,I=x&&x(x(O([])));I&&I!==r&&n.call(I,a)&&(S=I);var E=w.prototype=v.prototype=Object.create(S);function T(e){["next","throw","return"].forEach(function(t){l(e,t,function(e){return this._invoke(t,e)})})}function k(e,t){var r;i(this,"_invoke",{value:function(i,o){function a(){return new t(function(r,a){!function r(i,o,a,u){var c=d(e[i],e,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==s(h)&&n.call(h,"__await")?t.resolve(h.__await).then(function(e){r("next",e,a,u)},function(e){r("throw",e,a,u)}):t.resolve(h).then(function(e){l.value=e,a(l)},function(e){return r("throw",e,a,u)})}u(c.arg)}(i,o,r,a)})}return r=r?r.then(a,a):a()}})}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function O(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw TypeError(s(t)+" is not iterable")}return b.prototype=w,i(E,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:b,configurable:!0}),b.displayName=l(w,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,l(e,c,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},T(k.prototype),l(k.prototype,u,function(){return this}),t.AsyncIterator=k,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new k(h(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},T(E),l(E,c,"Generator"),l(E,a,function(){return this}),l(E,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function p(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(n,i)}function m(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){p(o,n,i,a,s,"next",e)}function s(e){p(o,n,i,a,s,"throw",e)}a(void 0)})}}var g=function(){var e=m(f().mark(function e(t){var r,i,a,s,u,c,l,h,d=arguments;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=d.length>1&&void 0!==d[1]?d[1]:null,i=d.length>2?d[2]:void 0,n._f.players){e.next=1;break}return e.abrupt("return",S(t,null==r?void 0:r.uid));case 1:return e.prev=1,e.next=2,y(t);case 2:if(!e.sent){e.next=3;break}throw Error("Ein Spieler mit dem Nickname '".concat(t,"' existiert bereits."));case 3:return a=!r,s=(null==r?void 0:r.uid)||null,c={id:u=(0,o.Ak)(),displayName:t,userId:s,isGuest:a,createdAt:(0,n.O5)(),updatedAt:(0,n.O5)(),groupIds:i?[i]:[],metadata:{isOG:!0}},e.next=4,(0,n.BN)((0,n.H9)(n._f.players,u),c);case 4:if(!(r&&n._f.users)){e.next=6;break}return l=(0,n.H9)(n._f.users,r.uid),e.next=5,(0,n.x7)(l);case 5:if(!e.sent.exists()){e.next=6;break}return e.next=6,(0,n.BN)(l,{playerId:u},{merge:!0});case 6:return e.abrupt("return",c);case 7:throw e.prev=7,console.error("Fehler beim Erstellen des Spielers:",h=e.catch(1)),h;case 8:case"end":return e.stop()}},e,null,[[1,7]])}));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=m(f().mark(function e(t){var r,i,o;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n._f.players){e.next=1;break}return e.abrupt("return",null);case 1:return e.prev=1,r=(0,n.P)(n._f.players,(0,n._M)("displayName","==",t)),e.next=2,(0,n.GG)(r);case 2:if(!(i=e.sent).empty){e.next=3;break}return e.abrupt("return",null);case 3:return e.abrupt("return",i.docs[0].data());case 4:throw e.prev=4,console.error("Fehler beim Abrufen des Spielers nach Nickname:",o=e.catch(1)),o;case 5:case"end":return e.stop()}},e,null,[[1,4]])}));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=m(f().mark(function e(t){var r,i,o,a;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n._f.players){e.next=1;break}return console.error("[getPlayerByUserId] collections.players is NULL for userId ".concat(t,"!"),{collections:n._f,hasDB:!!n.db,collectionsPlayers:n._f.players}),e.abrupt("return",null);case 1:return e.prev=1,r=(0,n.P)(n._f.players,(0,n._M)("userId","==",t)),e.next=2,(0,n.GG)(r);case 2:if(!(i=e.sent).empty){e.next=3;break}return e.abrupt("return",null);case 3:return(o=i.docs[0].data()).id=i.docs[0].id,e.abrupt("return",o);case 4:throw e.prev=4,console.error("Fehler beim Abrufen des Spielers nach User-ID:",a=e.catch(1)),a;case 5:case"end":return e.stop()}},e,null,[[1,4]])}));return function(t){return e.apply(this,arguments)}}(),b=function(){var e=m(f().mark(function e(t){var r,i,o;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n._f.players){e.next=1;break}return e.abrupt("return",null);case 1:return e.prev=1,e.next=2,(0,n.x7)((0,n.H9)(n._f.players,t));case 2:if((r=e.sent).exists()){e.next=3;break}return e.abrupt("return",null);case 3:return(i=r.data()).id=r.id,"email"in i&&delete i.email,e.abrupt("return",i);case 4:throw e.prev=4,console.error("Fehler beim Abrufen des \xf6ffentlichen Spielerprofils nach ID:",o=e.catch(1)),o;case 5:case"end":return e.stop()}},e,null,[[1,4]])}));return function(t){return e.apply(this,arguments)}}(),w=function(){var e=m(f().mark(function e(t,r){return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",g(t,null,r));case 1:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}(),S=function(e,t){return{id:(0,o.Ak)(),displayName:e,userId:t||null,isGuest:!t,createdAt:n.Dc.fromDate(new Date),updatedAt:n.Dc.fromDate(new Date),groupIds:[],metadata:{isMock:!0}}},x=function(e,t,r){return{displayName:r||"Spieler ".concat(e.slice(0,8),"..."),userId:t,isGuest:!1,createdAt:(0,n.O5)(),updatedAt:(0,n.O5)(),groupIds:[],metadata:{isOG:!1}}},I=function(){var e=m(f().mark(function e(t,r){var i;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!n.db||!t)){e.next=1;break}return console.error("getPlayerIdForUser: Ung\xfcltige Parameter (db, userId)."),e.abrupt("return",null);case 1:return e.prev=2,e.next=3,E(t,r);case 3:return e.abrupt("return",e.sent);case 4:return e.prev=4,i=e.catch(2),console.error("[getPlayerIdForUser] Error processing userId ".concat(t,":"),i),e.abrupt("return",null);case 5:case"end":return e.stop()}},e,null,[[2,4]])}));return function(t,r){return e.apply(this,arguments)}}(),E=function(){var e=m(f().mark(function e(t,r){var s,u,c,l,h,d,p,m,g,y,v,b,w,S,I,E,T,k,_,P;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,i.collection)(n.db,a.eZ),u=(0,n.H9)(n.db,a.sb,t),e.prev=1,e.next=2,(0,n.x7)(u);case 2:if(!(c=e.sent).exists()){e.next=10;break}if(!(null!=(l=c.data())&&l.playerId&&"string"==typeof l.playerId)){e.next=9;break}return h=l.playerId,d=(0,n.H9)(s,h),e.next=3,(0,n.x7)(d);case 3:if(!e.sent.exists()){e.next=5;break}return e.next=4,(0,n.BN)(u,{playerId:h},{merge:!0});case 4:case 7:return e.abrupt("return",h);case 5:return p=r||"Spieler ".concat(h.slice(0,8),"..."),m=x(h,t,p),e.next=6,(0,n.BN)(d,m);case 6:return e.next=7,(0,n.BN)(u,{playerId:h},{merge:!0});case 8:e.next=9;break;case 9:e.next=10;break;case 10:return g=(0,n.P)(s,(0,n._M)("userId","==",t)),e.next=11,(0,n.GG)(g);case 11:if((y=e.sent).empty){e.next=13;break}return y.size>1&&console.warn("getPlayerIdForUser: Found MULTIPLE (".concat(y.size,") players for userId ").concat(t,". Using the first one.")),v=y.docs[0].id,e.next=12,(0,n.BN)(u,{playerId:v},{merge:!0});case 12:return e.abrupt("return",v);case 13:return b=(0,o.Ak)(),w=r||"Spieler ".concat(b.slice(0,8),"..."),S=x(b,t,w),console.log("getPlayerIdForUserInternal: Erstelle neuen Player ".concat(b," f\xfcr userId ").concat(t,"...")),e.prev=14,(I=(0,i.writeBatch)(n.db)).set((0,n.H9)(s,b),S),I.set(u,{playerId:b},{merge:!0}),e.next=15,I.commit();case 15:return console.log("getPlayerIdForUserInternal: ✅ Player ".concat(b," erfolgreich erstellt f\xfcr userId ").concat(t)),e.abrupt("return",b);case 16:return e.prev=16,_=e.catch(14),console.error("getPlayerIdForUserInternal: ❌ Fehler beim Erstellen von Player ".concat(b," f\xfcr userId ").concat(t,":"),_),E=(0,n.P)(s,(0,n._M)("userId","==",t)),e.next=17,(0,n.GG)(E);case 17:if((T=e.sent).empty){e.next=19;break}return k=T.docs[0].id,console.log("getPlayerIdForUserInternal: \uD83D\uDD04 Fallback erfolgreich - gefundener Player ".concat(k," f\xfcr userId ").concat(t)),e.next=18,(0,n.BN)(u,{playerId:k},{merge:!0});case 18:return e.abrupt("return",k);case 19:return console.error("getPlayerIdForUserInternal: Fallback-Suche nach Erstellungsfehler war erfolglos."),e.abrupt("return",null);case 20:e.next=22;break;case 21:return e.prev=21,P=e.catch(1),console.error("getPlayerIdForUserInternal: General error processing userId ".concat(t,":"),P),e.abrupt("return",null);case 22:case"end":return e.stop()}},e,null,[[1,21],[14,16]])}));return function(t,r){return e.apply(this,arguments)}}(),T=function(){var e=m(f().mark(function e(t){var r,o,s,u,c,l,h,d,p,m;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!n.db||!t)){e.next=1;break}return console.error("getPlayerDocument: Ung\xfcltige Parameter (db, playerId)."),e.abrupt("return",null);case 1:return r=(0,n.H9)(n.db,a.eZ,t),o=null,e.prev=2,e.next=3,(0,i.getDocFromServer)(r);case 3:if(!(s=e.sent).exists()){e.next=4;break}(o=s.data()).id=s.id,e.next=5;break;case 4:return console.warn("getPlayerDocument: Kein Player-Dokument gefunden f\xfcr playerId ".concat(t,".")),e.abrupt("return",null);case 5:e.next=7;break;case 6:return e.prev=6,d=e.catch(2),console.error("getPlayerDocument: Fehler beim initialen Abrufen des Player-Dokuments f\xfcr playerId ".concat(t,":"),d),e.abrupt("return",null);case 7:if(!(o&&!o.userId)){e.next=17;break}return console.warn("getPlayerDocument: userId fehlt im Player-Dokument ".concat(t,". Versuche Fallback \xfcber users-Collection...")),e.prev=8,u=(0,i.collection)(n.db,a.sb),c=(0,n.P)(u,(0,n._M)("playerId","==",t)),e.next=9,(0,n.GG)(c);case 9:if((l=e.sent).empty){e.next=14;break}return l.size>1&&console.warn("getPlayerDocument: Mehrere User-Dokumente gefunden f\xfcr playerId ".concat(t,". Verwende das erste.")),h=l.docs[0].id,console.log("getPlayerDocument: Fallback erfolgreich. userId ".concat(h," f\xfcr playerId ").concat(t," gefunden.")),o.userId=h,e.prev=10,e.next=11,(0,i.updateDoc)(r,{userId:h,updatedAt:(0,n.O5)()});case 11:console.log("getPlayerDocument: Self-healing erfolgreich. userId im Player-Dokument ".concat(t," aktualisiert.")),e.next=13;break;case 12:e.prev=12,p=e.catch(10),console.error("getPlayerDocument: Fehler beim Self-healing (Aktualisieren der userId im Player-Dokument ".concat(t,"):"),p);case 13:e.next=15;break;case 14:console.error("getPlayerDocument: Fallback fehlgeschlagen. Kein User-Dokument gefunden mit playerId ".concat(t,"."));case 15:e.next=17;break;case 16:e.prev=16,m=e.catch(8),console.error("getPlayerDocument: Fehler beim Fallback-Versuch (Suche in users-Collection) f\xfcr playerId ".concat(t,":"),m);case 17:return e.abrupt("return",o);case 18:case"end":return e.stop()}},e,null,[[2,6],[8,16],[10,12]])}));return function(t){return e.apply(this,arguments)}}(),k=function(){var e=m(f().mark(function e(t,r){var o,s,u;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n._f.players){e.next=1;break}return console.warn("ensurePlayersExist: players collection not available (offline?). Returning empty array."),e.abrupt("return",[]);case 1:if(!(!t||0===t.length)){e.next=2;break}return e.abrupt("return",[]);case 2:return e.prev=3,s=t.filter(function(e){return"string"==typeof e&&""!==e.trim()}).map(function(){var e=m(f().mark(function e(t){var o,s,u,c,l,h,d,p,m,g;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,b(t);case 1:if(!(s=e.sent)){e.next=2;break}return e.abrupt("return",s);case 2:return u=(0,n.H9)(n.db,a.sb,t),e.next=3,(0,n.x7)(u);case 3:if(!((c=e.sent).exists()&&null!=(o=c.data())&&o.playerId)){e.next=10;break}return h=null==(l=c.data())?void 0:l.playerId,e.next=4,b(h);case 4:if(!(d=e.sent)){e.next=10;break}return e.prev=5,p=(0,n.H9)(n.db,"groups",r),e.next=6,(0,i.updateDoc)(p,{playerIds:(0,i.arrayRemove)(t)});case 6:return e.next=7,(0,i.updateDoc)(p,{playerIds:(0,i.arrayUnion)(h)});case 7:e.next=9;break;case 8:e.prev=8,m=e.catch(5),console.error("[ensurePlayersExist] ❌ Fehler bei Datenkorrektur f\xfcr Gruppe ".concat(r,":"),m);case 9:return e.abrupt("return",d);case 10:return e.abrupt("return",{id:t,displayName:"Unbekannter Spieler ".concat(t.slice(0,4),"..."),userId:null,isGuest:!1,createdAt:n.Dc.fromDate(new Date),updatedAt:n.Dc.fromDate(new Date),groupIds:[r],stats:{gamesPlayed:0,wins:0,totalScore:0},_isPlaceholder:!0});case 11:return e.prev=11,g=e.catch(0),console.error("[ensurePlayersExist] Fehler beim Laden/Korrigieren von ID ".concat(t,":"),g),e.abrupt("return",null);case 12:case"end":return e.stop()}},e,null,[[0,11],[5,8]])}));return function(t){return e.apply(this,arguments)}}()),e.next=4,Promise.all(s);case 4:return u=e.sent.filter(function(e){return null!==e}),e.abrupt("return",u);case 5:throw e.prev=5,console.error("[ensurePlayersExist] Schwerwiegender Fehler beim Laden der Mitgliederdetails:",e.catch(3)),Error("Mitgliederdetails konnten nicht sichergestellt werden.");case 6:case"end":return e.stop()}},e,null,[[3,5]])}));return function(t,r){return e.apply(this,arguments)}}(),_=function(){var e=m(f().mark(function e(t){var r,i,o,a,s,u;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n._f.groups){e.next=1;break}return console.warn("getGroupMembersSortedByGames: groups collection not available."),e.abrupt("return",[]);case 1:return e.prev=1,r=(0,n.H9)(n._f.groups,t),e.next=2,(0,n.x7)(r);case 2:if((i=e.sent).exists()){e.next=3;break}return console.warn("getGroupMembersSortedByGames: Group with id ".concat(t," not found.")),e.abrupt("return",[]);case 3:if(0!==(a=null!=(o=i.data())&&o.players?Object.keys(o.players):[]).length){e.next=4;break}return console.log("[getGroupMembersSortedByGames] No players found in group object for group ".concat(t,".")),e.abrupt("return",[]);case 4:return e.next=5,k(a,t);case 5:var c;return s=((function(e){if(Array.isArray(e))return d(e)})(c=e.sent)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(c)||h(c)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).sort(function(e,t){var r,n,i,o;return(null!=(r=null==(n=t.stats)?void 0:n.gamesPlayed)?r:0)-(null!=(i=null==(o=e.stats)?void 0:o.gamesPlayed)?i:0)}),e.abrupt("return",s);case 6:throw e.prev=6,u=e.catch(1),console.error("Fehler beim Laden und Sortieren der Mitglieder f\xfcr Gruppe ".concat(t,":"),u),Error("Mitglieder konnten nicht geladen oder sortiert werden.");case 7:case"end":return e.stop()}},e,null,[[1,6]])}));return function(t){return e.apply(this,arguments)}}(),P=function(){var e=m(f().mark(function e(t,r,o){var s,u,c,d,p,m,g,y,v,b,w,S,x;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.db){e.next=1;break}throw Error("Firestore ist nicht initialisiert.");case 1:if(!(!t||!r||!o)){e.next=2;break}throw console.error("syncDisplayNameAcrossCollections: Fehlende Parameter",{userId:t,playerId:r,displayName:o}),Error("F\xfcr die Synchronisation sind User-ID, Player-ID und DisplayName erforderlich.");case 2:return e.prev=2,s=[],u=(0,n.H9)(n.db,a.sb,t),c={displayName:o,lastUpdated:(0,n.O5)()},s.push((0,n.BN)(u,c,{merge:!0}).then(function(){}).catch(function(e){return console.error("Fehler beim Aktualisieren des User-Dokuments ".concat(t,":"),e)})),d=(0,n.H9)(n.db,a.eZ,r),p={displayName:o,updatedAt:(0,n.O5)()},s.push((0,n.BN)(d,p,{merge:!0}).then(function(){}).catch(function(e){return console.error("Fehler beim Aktualisieren des Player-Dokuments ".concat(r,":"),e)})),e.prev=3,e.next=4,(0,n.x7)(d);case 4:if(!(m=e.sent).exists()){e.next=13;break}if(!((y=(null==(g=m.data())?void 0:g.groupIds)||[]).length>0)){e.next=12;break}console.log("Aktualisiere DisplayName in ".concat(y.length," Gruppen-Dokumenten...")),v=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=h(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}(y),e.prev=5,w=f().mark(function e(){var t,a,u;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=b.value,a=(0,n.H9)(n.db,"groups",t),u=l({},"players.".concat(r,".displayName"),o),s.push((0,i.updateDoc)(a,u).then(function(){return console.log("DisplayName f\xfcr Player ".concat(r," in Gruppe ").concat(t," aktualisiert."))}).catch(function(e){return console.error("Fehler beim Aktualisieren des DisplayName in Gruppe ".concat(t,":"),e)}));case 1:case"end":return e.stop()}},e)}),v.s();case 6:if((b=v.n()).done){e.next=8;break}return e.delegateYield(w(),"t0",7);case 7:e.next=6;break;case 8:e.next=10;break;case 9:e.prev=9,S=e.catch(5),v.e(S);case 10:return e.prev=10,v.f(),e.finish(10);case 11:e.next=13;break;case 12:case 13:e.next=15;break;case 14:e.prev=14,console.error("Fehler beim Aktualisieren von Gruppen:",e.catch(3));case 15:return e.next=16,Promise.all(s);case 16:e.next=18;break;case 17:throw e.prev=17,console.error("Fehler bei der Synchronisation des DisplayName:",x=e.catch(2)),Error("DisplayName-Synchronisation fehlgeschlagen: ".concat(x instanceof Error?x.message:String(x)));case 18:case"end":return e.stop()}},e,null,[[2,17],[3,14],[5,9,10,11]])}));return function(t,r,n){return e.apply(this,arguments)}}(),A=function(){var e=m(f().mark(function e(t){var r,i,o,a,s,u,l;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!n._f.players||!t||0===t.length)){e.next=1;break}return e.abrupt("return",[]);case 1:for(i=0,r=[];i<t.length;i+=30)r.push(t.slice(i,i+30));o=[],a=0,s=r;case 2:if(!(a<s.length)){e.next=7;break}return u=s[a],e.prev=3,l=(0,n.P)(n._f.players,(0,n._M)("userId","in",u)),e.next=4,(0,n.GG)(l);case 4:e.sent.forEach(function(e){var t=e.data();"email"in t&&delete t.email,o.push(c(c({},t),{},{id:e.id}))}),e.next=6;break;case 5:e.prev=5,console.error("Fehler beim Abrufen der Spielerprofile f\xfcr Chunk:",e.catch(3));case 6:a++,e.next=2;break;case 7:return e.abrupt("return",o);case 8:case"end":return e.stop()}},e,null,[[3,5]])}));return function(t){return e.apply(this,arguments)}}(),O=function(){var e=m(f().mark(function e(t,r){var o,a,s,u,l;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!n._f.players||!t)){e.next=1;break}return console.error("updatePlayerDocument: Ung\xfcltige Parameter (collections.players, playerId)."),e.abrupt("return");case 1:o=0,a=["id","userId","isGuest","createdAt"];case 2:if(!(o<a.length)){e.next=4;break}if(!((s=a[o])in r)){e.next=3;break}throw console.error("updatePlayerDocument: Versuch, das gesch\xfctzte Feld '".concat(s,"' zu \xe4ndern, wurde blockiert.")),Error("Das Feld '".concat(s,"' kann nicht aktualisiert werden."));case 3:o++,e.next=2;break;case 4:return e.prev=4,u=(0,n.H9)(n._f.players,t),e.next=5,(0,i.updateDoc)(u,c(c({},r),{},{updatedAt:(0,n.O5)()}));case 5:e.next=7;break;case 6:throw e.prev=6,l=e.catch(4),console.error("Fehler beim Aktualisieren des Spieler-Dokuments ".concat(t,":"),l),l;case 7:case"end":return e.stop()}},e,null,[[4,6]])}));return function(t,r){return e.apply(this,arguments)}}()},1558:(e,t,r)=>{"use strict";r.d(t,{O:()=>i});var n=r(7876);function i(e){var t=e.children;return(0,n.jsx)(n.Fragment,{children:t})}},1923:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var n=r(4232),i={cm:!0,mm:!0,in:!0,px:!0,pt:!0,pc:!0,em:!0,ex:!0,ch:!0,rem:!0,vw:!0,vh:!0,vmin:!0,vmax:!0,"%":!0};function o(e){var t=function(e){if("number"==typeof e)return{value:e,unit:"px"};var t,r=(e.match(/^[0-9.]*/)||"").toString();t=r.includes(".")?parseFloat(r):parseInt(r,10);var n=(e.match(/[^0-9]*$/)||"").toString();return i[n]?{value:t,unit:n}:(console.warn("React Spinners: ".concat(e," is not a valid css value. Defaulting to ").concat(t,"px.")),{value:t,unit:"px"})}(e);return"".concat(t.value).concat(t.unit)}var a=function(){return(a=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},s=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)0>t.indexOf(n[i])&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r},u=function(e,t,r){var n="react-spinners-".concat(e,"-").concat(r);if("undefined"==typeof window||!window.document)return n;var i=document.createElement("style");document.head.appendChild(i);var o=i.sheet,a="\n    @keyframes ".concat(n," {\n      ").concat(t,"\n    }\n  ");return o&&o.insertRule(a,0),n}("ClipLoader","0% {transform: rotate(0deg) scale(1)} 50% {transform: rotate(180deg) scale(0.8)} 100% {transform: rotate(360deg) scale(1)}","clip");let c=function(e){var t=e.loading,r=e.color,i=void 0===r?"#000000":r,c=e.speedMultiplier,l=e.cssOverride,h=e.size,d=void 0===h?35:h,f=s(e,["loading","color","speedMultiplier","cssOverride","size"]),p=a({background:"transparent !important",width:o(d),height:o(d),borderRadius:"100%",border:"2px solid",borderTopColor:i,borderBottomColor:"transparent",borderLeftColor:i,borderRightColor:i,display:"inline-block",animation:"".concat(u," ").concat(.75/(void 0===c?1:c),"s 0s infinite linear"),animationFillMode:"both"},void 0===l?{}:l);return void 0===t||t?n.createElement("span",a({style:p},f)):null}},2009:(e,t,r)=>{"use strict";r.r(t),r.d(t,{AbstractUserDataWriter:()=>lc,AggregateField:()=>ch,AggregateQuerySnapshot:()=>cd,Bytes:()=>cf,CACHE_SIZE_UNLIMITED:()=>u6,CollectionReference:()=>uW,DocumentReference:()=>uK,DocumentSnapshot:()=>lb,FieldPath:()=>cp,FieldValue:()=>cg,Firestore:()=>u5,FirestoreError:()=>z,GeoPoint:()=>cy,LoadBundleTask:()=>u4,PersistentCacheIndexManager:()=>ha,Query:()=>u$,QueryCompositeFilterConstraint:()=>c0,QueryConstraint:()=>cQ,QueryDocumentSnapshot:()=>lS,QueryEndAtConstraint:()=>lt,QueryFieldFilterConstraint:()=>cX,QueryLimitConstraint:()=>c6,QueryOrderByConstraint:()=>c3,QuerySnapshot:()=>lx,QueryStartAtConstraint:()=>c7,SnapshotMetadata:()=>lv,Timestamp:()=>ex,Transaction:()=>l6,VectorValue:()=>cv,WriteBatch:()=>l2,_AutoId:()=>et,_ByteString:()=>t9,_DatabaseId:()=>rf,_DocumentKey:()=>eh,_EmptyAppCheckTokenProvider:()=>Z,_EmptyAuthCredentialsProvider:()=>$,_FieldPath:()=>el,_TestingHooks:()=>hm,_cast:()=>ev,_debugAssert:()=>V,_internalAggregationQueryToProtoRunAggregationQueryRequest:()=>hp,_internalQueryToProtoQueryTarget:()=>hf,_isBase64Available:()=>t7,_logWarn:()=>j,_validateIsNotUsedTogether:()=>ef,addDoc:()=>lL,aggregateFieldEqual:()=>lm,aggregateQuerySnapshotEqual:()=>lg,and:()=>c2,arrayRemove:()=>he,arrayUnion:()=>l9,average:()=>lf,clearIndexedDbPersistence:()=>ci,collection:()=>uJ,collectionGroup:()=>uQ,connectFirestoreEmulator:()=>uq,count:()=>lp,deleteAllPersistentCacheIndexes:()=>hl,deleteDoc:()=>lR,deleteField:()=>l8,disableNetwork:()=>cs,disablePersistentCacheIndexAutoCreation:()=>hc,doc:()=>uY,documentId:()=>cm,documentSnapshotFromJSON:()=>lw,enableIndexedDbPersistence:()=>ct,enableMultiTabIndexedDbPersistence:()=>cr,enableNetwork:()=>ca,enablePersistentCacheIndexAutoCreation:()=>hu,endAt:()=>ln,endBefore:()=>lr,ensureFirestoreConfigured:()=>u9,executeWrite:()=>lM,getAggregateFromServer:()=>lB,getCountFromServer:()=>lV,getDoc:()=>lT,getDocFromCache:()=>l_,getDocFromServer:()=>lP,getDocs:()=>lA,getDocsFromCache:()=>lO,getDocsFromServer:()=>lC,getFirestore:()=>u7,getPersistentCacheIndexManager:()=>hs,increment:()=>ht,initializeFirestore:()=>u8,limit:()=>c5,limitToLast:()=>c8,loadBundle:()=>cc,memoryEagerGarbageCollector:()=>lK,memoryLocalCache:()=>lJ,memoryLruGarbageCollector:()=>lW,namedQuery:()=>cl,onSnapshot:()=>lj,onSnapshotResume:()=>lF,onSnapshotsInSync:()=>lG,or:()=>c1,orderBy:()=>c4,persistentLocalCache:()=>lQ,persistentMultipleTabManager:()=>l0,persistentSingleTabManager:()=>lZ,query:()=>cY,queryEqual:()=>uZ,querySnapshotFromJSON:()=>lI,refEqual:()=>uX,runTransaction:()=>l5,serverTimestamp:()=>l7,setDoc:()=>lD,setIndexConfiguration:()=>hi,setLogLevel:()=>N,snapshotEqual:()=>lE,startAfter:()=>le,startAt:()=>c9,sum:()=>ld,terminate:()=>cu,updateDoc:()=>lN,vector:()=>hr,waitForPendingWrites:()=>co,where:()=>cZ,writeBatch:()=>hn});var n,i,o,a,s,u,c,l,h,d,f,p,m,g,y=r(6796),v=r(8308),b=r(6525),w=r(1139),S="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},x={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.B=Array(this.blockSize),this.o=this.h=0,this.s()}var t=function(){this.blockSize=-1};function r(){}function o(e,t,r){r||(r=0);var n=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)n[i]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(i=0;16>i;++i)n[i]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],i=e.g[2];var o=e.g[3],a=t+(o^r&(i^o))+n[0]+0xd76aa478|0;a=o+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[1]+0xe8c7b756|0,a=i+(r^(o=t+(a<<12|a>>>20))&(t^r))+n[2]+0x242070db|0,a=r+(t^(i=o+(a<<17|a>>>15))&(o^t))+n[3]+0xc1bdceee|0,a=t+(o^(r=i+(a<<22|a>>>10))&(i^o))+n[4]+0xf57c0faf|0,a=o+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[5]+0x4787c62a|0,a=i+(r^(o=t+(a<<12|a>>>20))&(t^r))+n[6]+0xa8304613|0,a=r+(t^(i=o+(a<<17|a>>>15))&(o^t))+n[7]+0xfd469501|0,a=t+(o^(r=i+(a<<22|a>>>10))&(i^o))+n[8]+0x698098d8|0,a=o+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[9]+0x8b44f7af|0,a=i+(r^(o=t+(a<<12|a>>>20))&(t^r))+n[10]+0xffff5bb1|0,a=r+(t^(i=o+(a<<17|a>>>15))&(o^t))+n[11]+0x895cd7be|0,a=t+(o^(r=i+(a<<22|a>>>10))&(i^o))+n[12]+0x6b901122|0,a=o+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[13]+0xfd987193|0,a=i+(r^(o=t+(a<<12|a>>>20))&(t^r))+n[14]+0xa679438e|0,a=r+(t^(i=o+(a<<17|a>>>15))&(o^t))+n[15]+0x49b40821|0,r=i+(a<<22|a>>>10),a=t+(i^o&(r^i))+n[1]+0xf61e2562|0,t=r+(a<<5|a>>>27),a=o+(r^i&(t^r))+n[6]+0xc040b340|0,o=t+(a<<9|a>>>23),a=i+(t^r&(o^t))+n[11]+0x265e5a51|0,i=o+(a<<14|a>>>18),a=r+(o^t&(i^o))+n[0]+0xe9b6c7aa|0,r=i+(a<<20|a>>>12),a=t+(i^o&(r^i))+n[5]+0xd62f105d|0,t=r+(a<<5|a>>>27),a=o+(r^i&(t^r))+n[10]+0x2441453|0,o=t+(a<<9|a>>>23),a=i+(t^r&(o^t))+n[15]+0xd8a1e681|0,i=o+(a<<14|a>>>18),a=r+(o^t&(i^o))+n[4]+0xe7d3fbc8|0,r=i+(a<<20|a>>>12),a=t+(i^o&(r^i))+n[9]+0x21e1cde6|0,t=r+(a<<5|a>>>27),a=o+(r^i&(t^r))+n[14]+0xc33707d6|0,o=t+(a<<9|a>>>23),a=i+(t^r&(o^t))+n[3]+0xf4d50d87|0,i=o+(a<<14|a>>>18),a=r+(o^t&(i^o))+n[8]+0x455a14ed|0,r=i+(a<<20|a>>>12),a=t+(i^o&(r^i))+n[13]+0xa9e3e905|0,t=r+(a<<5|a>>>27),a=o+(r^i&(t^r))+n[2]+0xfcefa3f8|0,o=t+(a<<9|a>>>23),a=i+(t^r&(o^t))+n[7]+0x676f02d9|0,i=o+(a<<14|a>>>18),a=r+(o^t&(i^o))+n[12]+0x8d2a4c8a|0,a=t+((r=i+(a<<20|a>>>12))^i^o)+n[5]+0xfffa3942|0,a=o+((t=r+(a<<4|a>>>28))^r^i)+n[8]+0x8771f681|0,a=i+((o=t+(a<<11|a>>>21))^t^r)+n[11]+0x6d9d6122|0,a=r+((i=o+(a<<16|a>>>16))^o^t)+n[14]+0xfde5380c|0,a=t+((r=i+(a<<23|a>>>9))^i^o)+n[1]+0xa4beea44|0,a=o+((t=r+(a<<4|a>>>28))^r^i)+n[4]+0x4bdecfa9|0,a=i+((o=t+(a<<11|a>>>21))^t^r)+n[7]+0xf6bb4b60|0,a=r+((i=o+(a<<16|a>>>16))^o^t)+n[10]+0xbebfbc70|0,a=t+((r=i+(a<<23|a>>>9))^i^o)+n[13]+0x289b7ec6|0,a=o+((t=r+(a<<4|a>>>28))^r^i)+n[0]+0xeaa127fa|0,a=i+((o=t+(a<<11|a>>>21))^t^r)+n[3]+0xd4ef3085|0,a=r+((i=o+(a<<16|a>>>16))^o^t)+n[6]+0x4881d05|0,a=t+((r=i+(a<<23|a>>>9))^i^o)+n[9]+0xd9d4d039|0,a=o+((t=r+(a<<4|a>>>28))^r^i)+n[12]+0xe6db99e5|0,a=i+((o=t+(a<<11|a>>>21))^t^r)+n[15]+0x1fa27cf8|0,a=r+((i=o+(a<<16|a>>>16))^o^t)+n[2]+0xc4ac5665|0,r=i+(a<<23|a>>>9),a=t+(i^(r|~o))+n[0]+0xf4292244|0,t=r+(a<<6|a>>>26),a=o+(r^(t|~i))+n[7]+0x432aff97|0,o=t+(a<<10|a>>>22),a=i+(t^(o|~r))+n[14]+0xab9423a7|0,i=o+(a<<15|a>>>17),a=r+(o^(i|~t))+n[5]+0xfc93a039|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~o))+n[12]+0x655b59c3|0,t=r+(a<<6|a>>>26),a=o+(r^(t|~i))+n[3]+0x8f0ccc92|0,o=t+(a<<10|a>>>22),a=i+(t^(o|~r))+n[10]+0xffeff47d|0,i=o+(a<<15|a>>>17),a=r+(o^(i|~t))+n[1]+0x85845dd1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~o))+n[8]+0x6fa87e4f|0,t=r+(a<<6|a>>>26),a=o+(r^(t|~i))+n[15]+0xfe2ce6e0|0,o=t+(a<<10|a>>>22),a=i+(t^(o|~r))+n[6]+0xa3014314|0,i=o+(a<<15|a>>>17),a=r+(o^(i|~t))+n[13]+0x4e0811a1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~o))+n[4]+0xf7537e82|0,t=r+(a<<6|a>>>26),a=o+(r^(t|~i))+n[11]+0xbd3af235|0,o=t+(a<<10|a>>>22),a=i+(t^(o|~r))+n[2]+0x2ad7d2bb|0,i=o+(a<<15|a>>>17),a=r+(o^(i|~t))+n[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+o|0}function a(e,t){this.h=t;for(var r=[],n=!0,i=e.length-1;0<=i;i--){var o=0|e[i];n&&o==t||(r[i]=o,n=!1)}this.g=r}r.prototype=t.prototype,e.D=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.C=function(e,r,n){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return t.prototype[r].apply(e,i)},e.prototype.s=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var r=t-this.blockSize,n=this.B,i=this.h,a=0;a<t;){if(0==i)for(;a<=r;)o(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(n[i++]=e.charCodeAt(a++),i==this.blockSize){o(this,n),i=0;break}}else for(;a<t;)if(n[i++]=e[a++],i==this.blockSize){o(this,n),i=0;break}}this.h=i,this.o+=t},e.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var r=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&r,r/=256;for(this.u(e),e=Array(16),t=r=0;4>t;++t)for(var n=0;32>n;n+=8)e[r++]=this.g[t]>>>n&255;return e};var s,u={};function c(e){var t;return -128<=e&&128>e?(t=function(e){return new a([0|e],0>e?-1:0)},Object.prototype.hasOwnProperty.call(u,e)?u[e]:u[e]=t(e)):new a([0|e],0>e?-1:0)}function l(e){if(isNaN(e)||!isFinite(e))return h;if(0>e)return g(l(-e));for(var t=[],r=1,n=0;e>=r;n++)t[n]=e/r|0,r*=0x100000000;return new a(t,0)}var h=c(0),d=c(1),f=c(0x1000000);function p(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function m(e){return -1==e.h}function g(e){for(var t=e.g.length,r=[],n=0;n<t;n++)r[n]=~e.g[n];return new a(r,~e.h).add(d)}function y(e,t){return e.add(g(t))}function v(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function b(e,t){this.g=e,this.h=t}function w(e,t){if(p(t))throw Error("division by zero");if(p(e))return new b(h,h);if(m(e))return t=w(g(e),t),new b(g(t.g),g(t.h));if(m(t))return t=w(e,g(t)),new b(g(t.g),t.h);if(30<e.g.length){if(m(e)||m(t))throw Error("slowDivide_ only works with positive integers.");for(var r=d,n=t;0>=n.l(e);)r=S(r),n=S(n);var i=I(r,1),o=I(n,1);for(n=I(n,2),r=I(r,2);!p(n);){var a=o.add(n);0>=a.l(e)&&(i=i.add(r),o=a),n=I(n,1),r=I(r,1)}return t=y(e,i.j(t)),new b(i,t)}for(i=h;0<=e.l(t);){for(n=48>=(n=Math.ceil(Math.log(r=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))?1:Math.pow(2,n-48),a=(o=l(r)).j(t);m(a)||0<a.l(e);)r-=n,a=(o=l(r)).j(t);p(o)&&(o=d),i=i.add(o),e=y(e,a)}return new b(i,e)}function S(e){for(var t=e.g.length+1,r=[],n=0;n<t;n++)r[n]=e.i(n)<<1|e.i(n-1)>>>31;return new a(r,e.h)}function I(e,t){var r=t>>5;t%=32;for(var n=e.g.length-r,i=[],o=0;o<n;o++)i[o]=0<t?e.i(o+r)>>>t|e.i(o+r+1)<<32-t:e.i(o+r);return new a(i,e.h)}(s=a.prototype).m=function(){if(m(this))return-g(this).m();for(var e=0,t=1,r=0;r<this.g.length;r++){var n=this.i(r);e+=(0<=n?n:0x100000000+n)*t,t*=0x100000000}return e},s.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(p(this))return"0";if(m(this))return"-"+g(this).toString(e);for(var t=l(Math.pow(e,6)),r=this,n="";;){var i=w(r,t).g,o=((0<(r=y(r,i.j(t))).g.length?r.g[0]:r.h)>>>0).toString(e);if(p(r=i))return o+n;for(;6>o.length;)o="0"+o;n=o+n}},s.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},s.l=function(e){return m(e=y(this,e))?-1:+!p(e)},s.abs=function(){return m(this)?g(this):this},s.add=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],n=0,i=0;i<=t;i++){var o=n+(65535&this.i(i))+(65535&e.i(i)),s=(o>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);n=s>>>16,o&=65535,s&=65535,r[i]=s<<16|o}return new a(r,-0x80000000&r[r.length-1]?-1:0)},s.j=function(e){if(p(this)||p(e))return h;if(m(this))return m(e)?g(this).j(g(e)):g(g(this).j(e));if(m(e))return g(this.j(g(e)));if(0>this.l(f)&&0>e.l(f))return l(this.m()*e.m());for(var t=this.g.length+e.g.length,r=[],n=0;n<2*t;n++)r[n]=0;for(n=0;n<this.g.length;n++)for(var i=0;i<e.g.length;i++){var o=this.i(n)>>>16,s=65535&this.i(n),u=e.i(i)>>>16,c=65535&e.i(i);r[2*n+2*i]+=s*c,v(r,2*n+2*i),r[2*n+2*i+1]+=o*c,v(r,2*n+2*i+1),r[2*n+2*i+1]+=s*u,v(r,2*n+2*i+1),r[2*n+2*i+2]+=o*u,v(r,2*n+2*i+2)}for(n=0;n<t;n++)r[n]=r[2*n+1]<<16|r[2*n];for(n=t;n<2*t;n++)r[n]=0;return new a(r,0)},s.A=function(e){return w(this,e).h},s.and=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],n=0;n<t;n++)r[n]=this.i(n)&e.i(n);return new a(r,this.h&e.h)},s.or=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],n=0;n<t;n++)r[n]=this.i(n)|e.i(n);return new a(r,this.h|e.h)},s.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],n=0;n<t;n++)r[n]=this.i(n)^e.i(n);return new a(r,this.h^e.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,i=x.Md5=e,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=l,a.fromString=function e(t,r){if(0==t.length)throw Error("number format error: empty string");if(2>(r=r||10)||36<r)throw Error("radix out of range: "+r);if("-"==t.charAt(0))return g(e(t.substring(1),r));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=l(Math.pow(r,8)),i=h,o=0;o<t.length;o+=8){var a=Math.min(8,t.length-o),s=parseInt(t.substring(o,o+a),r);8>a?(a=l(Math.pow(r,a)),i=i.j(a).add(l(s))):i=(i=i.j(n)).add(l(s))}return i},n=x.Integer=a}).apply(void 0!==S?S:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var I="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},E={};(function(){var e,t,r,n="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,r){return e==Array.prototype||e==Object.prototype||(e[t]=r.value),e},i=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof I&&I];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);!function(e,t){if(t)e:{var r=i;e=e.split(".");for(var o=0;o<e.length-1;o++){var a=e[o];if(!(a in r))break e;r=r[a]}(t=t(o=r[e=e[e.length-1]]))!=o&&null!=t&&n(r,e,{configurable:!0,writable:!0,value:t})}}("Array.prototype.values",function(e){return e||function(){var e,t,r,n,i;return e=this,t=function(e,t){return t},e instanceof String&&(e+=""),r=0,n=!1,(i={next:function(){if(!n&&r<e.length){var i=r++;return{value:t(i,e[i]),done:!1}}return n=!0,{done:!0,value:void 0}}})[Symbol.iterator]=function(){return i},i}});var f=f||{},p=this||self;function m(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function g(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function y(e,t,r){return e.call.apply(e.bind,arguments)}function v(e,t,r){if(!e)throw Error();if(2<arguments.length){var n=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,n),e.apply(t,r)}}return function(){return e.apply(t,arguments)}}function b(e,t,r){return(b=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:v).apply(null,arguments)}function w(e,t){var r=Array.prototype.slice.call(arguments,1);return function(){var t=r.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function S(e,t){function r(){}r.prototype=t.prototype,e.aa=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.Qb=function(e,r,n){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return t.prototype[r].apply(e,i)}}function x(e){let t=e.length;if(0<t){let r=Array(t);for(let n=0;n<t;n++)r[n]=e[n];return r}return[]}function T(e,t){for(let t=1;t<arguments.length;t++){let r=arguments[t];if(m(r)){let t=e.length||0,n=r.length||0;e.length=t+n;for(let i=0;i<n;i++)e[t+i]=r[i]}else e.push(r)}}class k{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}function _(e){return/^[\s\xa0]*$/.test(e)}function P(){var e=p.navigator;return e&&(e=e.userAgent)?e:""}function A(e){return A[" "](e),e}A[" "]=function(){};var O=-1!=P().indexOf("Gecko")&&(-1==P().toLowerCase().indexOf("webkit")||-1!=P().indexOf("Edge"))&&-1==P().indexOf("Trident")&&-1==P().indexOf("MSIE")&&-1==P().indexOf("Edge");function C(e,t,r){for(let n in e)t.call(r,e[n],n,e)}function D(e){let t={};for(let r in e)t[r]=e[r];return t}let N="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function R(e,t){let r,n;for(let t=1;t<arguments.length;t++){for(r in n=arguments[t])e[r]=n[r];for(let t=0;t<N.length;t++)r=N[t],Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}}class L{constructor(){this.h=this.g=null}add(e,t){let r=j.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}}var j=new k(()=>new F,e=>e.reset());class F{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let G,M=!1,U=new L,V=()=>{let e=p.Promise.resolve(void 0);G=()=>{e.then(B)}};var B=()=>{let e;for(var t;e=null,U.g&&(e=U.g,U.g=U.g.next,U.g||(U.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){p.setTimeout(()=>{throw e},0)}(e)}j.j(t),100>j.h&&(j.h++,t.next=j.g,j.g=t)}M=!1};function z(){this.s=this.s,this.C=this.C}function H(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}z.prototype.s=!1,z.prototype.ma=function(){this.s||(this.s=!0,this.N())},z.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},H.prototype.h=function(){this.defaultPrevented=!0};var q=function(){if(!p.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};p.addEventListener("test",e,t),p.removeEventListener("test",e,t)}catch(e){}return e}();function $(e,t){if(H.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var r=this.type=e.type,n=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(O){e:{try{A(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==r?t=e.fromElement:"mouseout"==r&&(t=e.toElement);this.relatedTarget=t,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:K[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&$.aa.h.call(this)}}S($,H);var K={2:"touch",3:"pen",4:"mouse"};$.prototype.h=function(){$.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var W="closure_listenable_"+(1e6*Math.random()|0),J=0;function Q(e,t,r,n,i){this.listener=e,this.proxy=null,this.src=t,this.type=r,this.capture=!!n,this.ha=i,this.key=++J,this.da=this.fa=!1}function Y(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function X(e){this.src=e,this.g={},this.h=0}function Z(e,t){var r=t.type;if(r in e.g){var n,i=e.g[r],o=Array.prototype.indexOf.call(i,t,void 0);(n=0<=o)&&Array.prototype.splice.call(i,o,1),n&&(Y(t),0==e.g[r].length&&(delete e.g[r],e.h--))}}function ee(e,t,r,n){for(var i=0;i<e.length;++i){var o=e[i];if(!o.da&&o.listener==t&&!!r==o.capture&&o.ha==n)return i}return -1}X.prototype.add=function(e,t,r,n,i){var o=e.toString();(e=this.g[o])||(e=this.g[o]=[],this.h++);var a=ee(e,t,n,i);return -1<a?(t=e[a],r||(t.fa=!1)):((t=new Q(t,this.src,o,!!n,i)).fa=r,e.push(t)),t};var et="closure_lm_"+(1e6*Math.random()|0),er={};function en(e,t,r,n,i,o){if(!t)throw Error("Invalid event type");var a=g(i)?!!i.capture:!!i,s=es(e);if(s||(e[et]=s=new X(e)),(r=s.add(t,r,n,a,o)).proxy)return r;if(n=function e(t){return ea.call(e.src,e.listener,t)},r.proxy=n,n.src=e,n.listener=r,e.addEventListener)q||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),n,i);else if(e.attachEvent)e.attachEvent(eo(t.toString()),n);else if(e.addListener&&e.removeListener)e.addListener(n);else throw Error("addEventListener and attachEvent are unavailable.");return r}function ei(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[W])Z(t.i,e);else{var r=e.type,n=e.proxy;t.removeEventListener?t.removeEventListener(r,n,e.capture):t.detachEvent?t.detachEvent(eo(r),n):t.addListener&&t.removeListener&&t.removeListener(n),(r=es(t))?(Z(r,e),0==r.h&&(r.src=null,t[et]=null)):Y(e)}}}function eo(e){return e in er?er[e]:er[e]="on"+e}function ea(e,t){if(e.da)e=!0;else{t=new $(t,this);var r=e.listener,n=e.ha||e.src;e.fa&&ei(e),e=r.call(n,t)}return e}function es(e){return(e=e[et])instanceof X?e:null}var eu="__closure_events_fn_"+(1e9*Math.random()>>>0);function ec(e){return"function"==typeof e?e:(e[eu]||(e[eu]=function(t){return e.handleEvent(t)}),e[eu])}function el(){z.call(this),this.i=new X(this),this.M=this,this.F=null}function eh(e,t){var r,n=e.F;if(n)for(r=[];n;n=n.F)r.push(n);if(e=e.M,n=t.type||t,"string"==typeof t)t=new H(t,e);else if(t instanceof H)t.target=t.target||e;else{var i=t;R(t=new H(n,e),i)}if(i=!0,r)for(var o=r.length-1;0<=o;o--){var a=t.g=r[o];i=ed(a,n,!0,t)&&i}if(i=ed(a=t.g=e,n,!0,t)&&i,i=ed(a,n,!1,t)&&i,r)for(o=0;o<r.length;o++)i=ed(a=t.g=r[o],n,!1,t)&&i}function ed(e,t,r,n){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,o=0;o<t.length;++o){var a=t[o];if(a&&!a.da&&a.capture==r){var s=a.listener,u=a.ha||a.src;a.fa&&Z(e.i,a),i=!1!==s.call(u,n)&&i}}return i&&!n.defaultPrevented}function ef(e,t,r){if("function"==typeof e)r&&(e=b(e,r));else if(e&&"function"==typeof e.handleEvent)e=b(e.handleEvent,e);else throw Error("Invalid listener argument");return 0x7fffffff<Number(t)?-1:p.setTimeout(e,t||0)}S(el,z),el.prototype[W]=!0,el.prototype.removeEventListener=function(e,t,r,n){!function e(t,r,n,i,o){if(Array.isArray(r))for(var a=0;a<r.length;a++)e(t,r[a],n,i,o);else(i=g(i)?!!i.capture:!!i,n=ec(n),t&&t[W])?(t=t.i,(r=String(r).toString())in t.g&&-1<(n=ee(a=t.g[r],n,i,o))&&(Y(a[n]),Array.prototype.splice.call(a,n,1),0==a.length&&(delete t.g[r],t.h--))):t&&(t=es(t))&&(r=t.g[r.toString()],t=-1,r&&(t=ee(r,n,i,o)),(n=-1<t?r[t]:null)&&ei(n))}(this,e,t,r,n)},el.prototype.N=function(){if(el.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var r=t.g[e],n=0;n<r.length;n++)Y(r[n]);delete t.g[e],t.h--}}this.F=null},el.prototype.K=function(e,t,r,n){return this.i.add(String(e),t,!1,r,n)},el.prototype.L=function(e,t,r,n){return this.i.add(String(e),t,!0,r,n)};class ep extends z{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=ef(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let r=t.h;t.h=null,t.m.apply(null,r)}(this)}N(){super.N(),this.g&&(p.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function em(e){z.call(this),this.h=e,this.g={}}S(em,z);var eg=[];function ey(e){C(e.g,function(e,t){this.g.hasOwnProperty(t)&&ei(e)},e),e.g={}}em.prototype.N=function(){em.aa.N.call(this),ey(this)},em.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ev=p.JSON.stringify,eb=p.JSON.parse,ew=class{stringify(e){return p.JSON.stringify(e,void 0)}parse(e){return p.JSON.parse(e,void 0)}};function eS(){}function ex(e){return e.h||(e.h=e.i())}function eI(){}eS.prototype.h=null;var eE={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function eT(){H.call(this,"d")}function ek(){H.call(this,"c")}S(eT,H),S(ek,H);var e_={},eP=null;function eA(){return eP=eP||new el}function eO(e){H.call(this,e_.La,e)}function eC(e){let t=eA();eh(t,new eO(t))}function eD(e,t){H.call(this,e_.STAT_EVENT,e),this.stat=t}function eN(e){let t=eA();eh(t,new eD(t,e))}function eR(e,t){H.call(this,e_.Ma,e),this.size=t}function eL(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return p.setTimeout(function(){e()},t)}function ej(){this.g=!0}function eF(e,t,r,n){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var r=JSON.parse(t);if(r){for(e=0;e<r.length;e++)if(Array.isArray(r[e])){var n=r[e];if(!(2>n.length)){var i=n[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var a=1;a<i.length;a++)i[a]=""}}}}return ev(r)}catch(e){return t}}(e,r)+(n?" "+n:"")})}e_.La="serverreachability",S(eO,H),e_.STAT_EVENT="statevent",S(eD,H),e_.Ma="timingevent",S(eR,H),ej.prototype.xa=function(){this.g=!1},ej.prototype.info=function(){};var eG={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},eM={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function eU(){}function eV(e,t,r,n){this.j=e,this.i=t,this.l=r,this.R=n||1,this.U=new em(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new eB}function eB(){this.i=null,this.g="",this.h=!1}S(eU,eS),eU.prototype.g=function(){return new XMLHttpRequest},eU.prototype.i=function(){return{}},t=new eU;var ez={},eH={};function eq(e,t,r){e.L=1,e.v=ta(tt(t)),e.m=r,e.P=!0,e$(e,null)}function e$(e,t){e.F=Date.now(),eW(e),e.A=tt(e.v);var r,n,i,o,a,s,u=e.A,c=e.R;Array.isArray(c)||(c=[String(c)]),tb(u.i,"t",c),e.C=0,u=e.j.J,e.h=new eB,e.g=t6(e.j,u?t:null,!e.m),0<e.O&&(e.M=new ep(b(e.Y,e,e.g),e.O)),t=e.U,u=e.g,c=e.ca;var l="readystatechange";Array.isArray(l)||(l&&(eg[0]=l.toString()),l=eg);for(var h=0;h<l.length;h++){var d=function e(t,r,n,i,o){if(i&&i.once)return function e(t,r,n,i,o){if(Array.isArray(r)){for(var a=0;a<r.length;a++)e(t,r[a],n,i,o);return null}return n=ec(n),t&&t[W]?t.L(r,n,g(i)?!!i.capture:!!i,o):en(t,r,n,!0,i,o)}(t,r,n,i,o);if(Array.isArray(r)){for(var a=0;a<r.length;a++)e(t,r[a],n,i,o);return null}return n=ec(n),t&&t[W]?t.K(r,n,g(i)?!!i.capture:!!i,o):en(t,r,n,!1,i,o)}(u,l[h],c||t.handleEvent,!1,t.h||t);if(!d)break;t.g[d.key]=d}t=e.H?D(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),eC(),r=e.i,n=e.u,i=e.A,o=e.l,a=e.R,s=e.m,r.info(function(){if(r.g)if(s)for(var e="",t=s.split("&"),u=0;u<t.length;u++){var c=t[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");e=2<=h.length&&"type"==h[1]?e+(l+"=")+c+"&":e+(l+"=redacted&")}}else e=null;else e=s;return"XMLHTTP REQ ("+o+") [attempt "+a+"]: "+n+"\n"+i+"\n"+e})}function eK(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function eW(e){e.S=Date.now()+e.I,eJ(e,e.I)}function eJ(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=eL(b(e.ba,e),t)}function eQ(e){e.B&&(p.clearTimeout(e.B),e.B=null)}function eY(e){0==e.j.G||e.J||t0(e.j,e)}function eX(e){eQ(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,ey(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function eZ(e,t){try{var r=e.j;if(0!=r.G&&(r.g==e||e4(r.h,e))){if(!e.K&&e4(r.h,e)&&3==r.G){try{var n=r.Da.g.parse(t)}catch(e){n=null}if(Array.isArray(n)&&3==n.length){var i=n;if(0==i[0]){e:if(!r.u){if(r.g)if(r.g.F+3e3<e.F)tZ(r),tz(r);else break e;tQ(r),eN(18)}}else r.za=i[1],0<r.za-r.T&&37500>i[2]&&r.F&&0==r.v&&!r.C&&(r.C=eL(b(r.Za,r),6e3));if(1>=e3(r.h)&&r.ca){try{r.ca()}catch(e){}r.ca=void 0}}else t2(r,11)}else if((e.K||r.g==e)&&tZ(r),!_(t))for(i=r.Da.g.parse(t),t=0;t<i.length;t++){let s=i[t];if(r.T=s[0],s=s[1],2==r.G)if("c"==s[0]){r.K=s[1],r.ia=s[2];let t=s[3];null!=t&&(r.la=t,r.j.info("VER="+r.la));let i=s[4];null!=i&&(r.Aa=i,r.j.info("SVER="+r.Aa));let u=s[5];null!=u&&"number"==typeof u&&0<u&&(r.L=n=1.5*u,r.j.info("backChannelRequestTimeoutMs_="+n)),n=r;let c=e.g;if(c){let e=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var o=n.h;o.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(o.j=o.l,o.g=new Set,o.h&&(e6(o,o.h),o.h=null))}if(n.D){let e=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(n.ya=e,to(n.I,n.D,e))}}if(r.G=3,r.l&&r.l.ua(),r.ba&&(r.R=Date.now()-e.F,r.j.info("Handshake RTT: "+r.R+"ms")),(n=r).qa=t4(n,n.J?n.ia:null,n.W),e.K){e5(n.h,e);var a=n.L;a&&(e.I=a),e.B&&(eQ(e),eW(e)),n.g=e}else tJ(n);0<r.i.length&&tq(r)}else"stop"!=s[0]&&"close"!=s[0]||t2(r,7);else 3==r.G&&("stop"==s[0]||"close"==s[0]?"stop"==s[0]?t2(r,7):tB(r):"noop"!=s[0]&&r.l&&r.l.ta(s),r.v=0)}}eC(4)}catch(e){}}eV.prototype.ca=function(e){e=e.target;let t=this.M;t&&3==tG(e)?t.j():this.Y(e)},eV.prototype.Y=function(e){try{if(e==this.g)e:{let v=tG(this.g);var t=this.g.Ba();let b=this.g.Z();if(!(3>v)&&(3!=v||this.g&&(this.h.h||this.g.oa()||tM(this.g)))){this.J||4!=v||7==t||(8==t||0>=b?eC(3):eC(2)),eQ(this);var r=this.g.Z();this.X=r;t:if(eK(this)){var n=tM(this.g);e="";var i=n.length,o=4==tG(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){eX(this),eY(this);var a="";break t}this.h.i=new p.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(n[t],{stream:!(o&&t==i-1)});n.length=0,this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==r,s=this.i,u=this.u,c=this.A,l=this.l,h=this.R,d=r,s.info(function(){return"XMLHTTP RESP ("+l+") [ attempt "+h+"]: "+u+"\n"+c+"\n"+v+" "+d}),this.o){if(this.T&&!this.K){t:{if(this.g){var s,u,c,l,h,d,f,m=this.g;if((f=m.g?m.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!_(f)){var g=f;break t}}g=null}if(r=g)eF(this.i,this.l,r,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,eZ(this,r);else{this.o=!1,this.s=3,eN(12),eX(this),eY(this);break e}}if(this.P){let e;for(r=!0;!this.J&&this.C<a.length;)if((e=function(e,t){var r=e.C,n=t.indexOf("\n",r);return -1==n?eH:isNaN(r=Number(t.substring(r,n)))?ez:(n+=1)+r>t.length?eH:(t=t.slice(n,n+r),e.C=n+r,t)}(this,a))==eH){4==v&&(this.s=4,eN(14),r=!1),eF(this.i,this.l,null,"[Incomplete Response]");break}else if(e==ez){this.s=4,eN(15),eF(this.i,this.l,a,"[Invalid Chunk]"),r=!1;break}else eF(this.i,this.l,e,null),eZ(this,e);if(eK(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=v||0!=a.length||this.h.h||(this.s=1,eN(16),r=!1),this.o=this.o&&r,r){if(0<a.length&&!this.W){this.W=!0;var y=this.j;y.g==this&&y.ba&&!y.M&&(y.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),tY(y),y.M=!0,eN(11))}}else eF(this.i,this.l,a,"[Invalid Chunked Response]"),eX(this),eY(this)}else eF(this.i,this.l,a,null),eZ(this,a);4==v&&eX(this),this.o&&!this.J&&(4==v?t0(this.j,this):(this.o=!1,eW(this)))}else(function(e){let t={};e=(e.g&&2<=tG(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let n=0;n<e.length;n++){if(_(e[n]))continue;var r=function(e){var t=1;e=e.split(":");let r=[];for(;0<t&&e.length;)r.push(e.shift()),t--;return e.length&&r.push(e.join(":")),r}(e[n]);let i=r[0];if("string"!=typeof(r=r[1]))continue;r=r.trim();let o=t[i]||[];t[i]=o,o.push(r)}var n=function(e){return e.join(", ")};for(let e in t)n.call(void 0,t[e],e,t)})(this.g),400==r&&0<a.indexOf("Unknown SID")?(this.s=3,eN(12)):(this.s=0,eN(13)),eX(this),eY(this)}}}catch(e){}finally{}},eV.prototype.cancel=function(){this.J=!0,eX(this)},eV.prototype.ba=function(){var e,t;this.B=null;let r=Date.now();0<=r-this.S?(e=this.i,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.L&&(eC(),eN(17)),eX(this),this.s=2,eY(this)):eJ(this,this.S-r)};var e0=class{constructor(e,t){this.g=e,this.map=t}};function e1(e){this.l=e||10,e=p.PerformanceNavigationTiming?0<(e=p.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(p.chrome&&p.chrome.loadTimes&&p.chrome.loadTimes()&&p.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function e2(e){return!!e.h||!!e.g&&e.g.size>=e.j}function e3(e){return e.h?1:e.g?e.g.size:0}function e4(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function e6(e,t){e.g?e.g.add(t):e.h=t}function e5(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function e8(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let r of e.g.values())t=t.concat(r.D);return t}return x(e.i)}function e7(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(m(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var r=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(m(e)||"string"==typeof e){var t=[];e=e.length;for(var r=0;r<e;r++)t.push(r);return t}for(let n in t=[],r=0,e)t[r++]=n;return t}}}(e),n=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(m(e)){for(var t=[],r=e.length,n=0;n<r;n++)t.push(e[n]);return t}for(n in t=[],r=0,e)t[r++]=e[n];return t}(e),i=n.length,o=0;o<i;o++)t.call(void 0,n[o],r&&r[o],e)}e1.prototype.cancel=function(){if(this.i=e8(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var e9=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function te(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof te){this.h=e.h,tr(this,e.j),this.o=e.o,this.g=e.g,tn(this,e.s),this.l=e.l;var t=e.i,r=new tm;r.i=t.i,t.g&&(r.g=new Map(t.g),r.h=t.h),ti(this,r),this.m=e.m}else e&&(t=String(e).match(e9))?(this.h=!1,tr(this,t[1]||"",!0),this.o=ts(t[2]||""),this.g=ts(t[3]||"",!0),tn(this,t[4]),this.l=ts(t[5]||"",!0),ti(this,t[6]||"",!0),this.m=ts(t[7]||"")):(this.h=!1,this.i=new tm(null,this.h))}function tt(e){return new te(e)}function tr(e,t,r){e.j=r?ts(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function tn(e,t){if(t){if(isNaN(t=Number(t))||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function ti(e,t,r){var n,i;t instanceof tm?(e.i=t,n=e.i,(i=e.h)&&!n.j&&(tg(n),n.i=null,n.g.forEach(function(e,t){var r=t.toLowerCase();t!=r&&(ty(this,t),tb(this,r,e))},n)),n.j=i):(r||(t=tu(t,tf)),e.i=new tm(t,e.h))}function to(e,t,r){e.i.set(t,r)}function ta(e){return to(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function ts(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function tu(e,t,r){return"string"==typeof e?(e=encodeURI(e).replace(t,tc),r&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function tc(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}te.prototype.toString=function(){var e=[],t=this.j;t&&e.push(tu(t,tl,!0),":");var r=this.g;return(r||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(tu(t,tl,!0),"@"),e.push(encodeURIComponent(String(r)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(r=this.s)&&e.push(":",String(r))),(r=this.l)&&(this.g&&"/"!=r.charAt(0)&&e.push("/"),e.push(tu(r,"/"==r.charAt(0)?td:th,!0))),(r=this.i.toString())&&e.push("?",r),(r=this.m)&&e.push("#",tu(r,tp)),e.join("")};var tl=/[#\/\?@]/g,th=/[#\?:]/g,td=/[#\?]/g,tf=/[#\?@]/g,tp=/#/g;function tm(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function tg(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var r=0;r<e.length;r++){var n=e[r].indexOf("="),i=null;if(0<=n){var o=e[r].substring(0,n);i=e[r].substring(n+1)}else o=e[r];t(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,r){e.add(decodeURIComponent(t.replace(/\+/g," ")),r)}))}function ty(e,t){tg(e),t=tw(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tv(e,t){return tg(e),t=tw(e,t),e.g.has(t)}function tb(e,t,r){ty(e,t),0<r.length&&(e.i=null,e.g.set(tw(e,t),x(r)),e.h+=r.length)}function tw(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function tS(e,t,r,n,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),n(r)}catch(e){}}function tx(){this.g=new ew}function tI(e){this.l=e.Ub||null,this.j=e.eb||!1}function tE(e,t){el.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function tT(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function tk(e){e.readyState=4,e.l=null,e.j=null,e.v=null,t_(e)}function t_(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tP(e){let t="";return C(e,function(e,r){t+=r,t+=":",t+=e,t+="\r\n"}),t}function tA(e,t,r){e:{for(n in r){var n=!1;break e}n=!0}n||(r=tP(r),"string"==typeof e?null!=r&&encodeURIComponent(String(r)):to(e,t,r))}function tO(e){el.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(r=tm.prototype).add=function(e,t){tg(this),this.i=null,e=tw(this,e);var r=this.g.get(e);return r||this.g.set(e,r=[]),r.push(t),this.h+=1,this},r.forEach=function(e,t){tg(this),this.g.forEach(function(r,n){r.forEach(function(r){e.call(t,r,n,this)},this)},this)},r.na=function(){tg(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),r=[];for(let n=0;n<t.length;n++){let i=e[n];for(let e=0;e<i.length;e++)r.push(t[n])}return r},r.V=function(e){tg(this);let t=[];if("string"==typeof e)tv(this,e)&&(t=t.concat(this.g.get(tw(this,e))));else{e=Array.from(this.g.values());for(let r=0;r<e.length;r++)t=t.concat(e[r])}return t},r.set=function(e,t){return tg(this),this.i=null,tv(this,e=tw(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},r.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var r=0;r<t.length;r++){var n=t[r];let o=encodeURIComponent(String(n)),a=this.V(n);for(n=0;n<a.length;n++){var i=o;""!==a[n]&&(i+="="+encodeURIComponent(String(a[n]))),e.push(i)}}return this.i=e.join("&")},S(tI,eS),tI.prototype.g=function(){return new tE(this.l,this.j)},tI.prototype.i=(e={},function(){return e}),S(tE,el),(r=tE.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,t_(this)},r.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||p).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,tk(this)),this.readyState=0},r.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,t_(this)),this.g&&(this.readyState=3,t_(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==p.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;tT(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},r.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tk(this):t_(this),3==this.readyState&&tT(this)}},r.Ra=function(e){this.g&&(this.response=this.responseText=e,tk(this))},r.Qa=function(e){this.g&&(this.response=e,tk(this))},r.ga=function(){this.g&&tk(this)},r.setRequestHeader=function(e,t){this.u.append(e,t)},r.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var r=t.next();!r.done;)e.push((r=r.value)[0]+": "+r[1]),r=t.next();return e.join("\r\n")},Object.defineProperty(tE.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),S(tO,el);var tC=/^https?$/i,tD=["POST","PUT"];function tN(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,tR(e),tj(e)}function tR(e){e.A||(e.A=!0,eh(e,"complete"),eh(e,"error"))}function tL(e){if(e.h&&void 0!==f&&(!e.v[1]||4!=tG(e)||2!=e.Z())){if(e.u&&4==tG(e))ef(e.Ea,0,e);else if(eh(e,"readystatechange"),4==tG(e)){e.h=!1;try{let a=e.Z();switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,r,n=!0;break;default:n=!1}if(!(t=n)){if(r=0===a){var i=String(e.D).match(e9)[1]||null;!i&&p.self&&p.self.location&&(i=p.self.location.protocol.slice(0,-1)),r=!tC.test(i?i.toLowerCase():"")}t=r}if(t)eh(e,"complete"),eh(e,"success");else{e.m=6;try{var o=2<tG(e)?e.g.statusText:""}catch(e){o=""}e.l=o+" ["+e.Z()+"]",tR(e)}}finally{tj(e)}}}}function tj(e,t){if(e.g){tF(e);let r=e.g,n=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||eh(e,"ready");try{r.onreadystatechange=n}catch(e){}}}function tF(e){e.I&&(p.clearTimeout(e.I),e.I=null)}function tG(e){return e.g?e.g.readyState:0}function tM(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tU(e,t,r){return r&&r.internalChannelParams&&r.internalChannelParams[e]||t}function tV(e){this.Aa=0,this.i=[],this.j=new ej,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=tU("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=tU("baseRetryDelayMs",5e3,e),this.cb=tU("retryDelaySeedMs",1e4,e),this.Wa=tU("forwardChannelMaxRetries",2,e),this.wa=tU("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new e1(e&&e.concurrentRequestLimit),this.Da=new tx,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function tB(e){if(tH(e),3==e.G){var t=e.U++,r=tt(e.I);if(to(r,"SID",e.K),to(r,"RID",t),to(r,"TYPE","terminate"),tK(e,r),(t=new eV(e,e.j,t)).L=2,t.v=ta(tt(r)),r=!1,p.navigator&&p.navigator.sendBeacon)try{r=p.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!r&&p.Image&&((new Image).src=t.v,r=!0),r||(t.g=t6(t.j,null),t.g.ea(t.v)),t.F=Date.now(),eW(t)}t3(e)}function tz(e){e.g&&(tY(e),e.g.cancel(),e.g=null)}function tH(e){tz(e),e.u&&(p.clearTimeout(e.u),e.u=null),tZ(e),e.h.cancel(),e.s&&("number"==typeof e.s&&p.clearTimeout(e.s),e.s=null)}function tq(e){if(!e2(e.h)&&!e.s){e.s=!0;var t=e.Ga;G||V(),M||(G(),M=!0),U.add(t,e),e.B=0}}function t$(e,t){var r;r=t?t.l:e.U++;let n=tt(e.I);to(n,"SID",e.K),to(n,"RID",r),to(n,"AID",e.T),tK(e,n),e.m&&e.o&&tA(n,e.m,e.o),r=new eV(e,e.j,r,e.B+1),null===e.m&&(r.H=e.o),t&&(e.i=t.D.concat(e.i)),t=tW(e,r,1e3),r.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),e6(e.h,r),eq(r,n,t)}function tK(e,t){e.H&&C(e.H,function(e,r){to(t,r,e)}),e.l&&e7({},function(e,r){to(t,r,e)})}function tW(e,t,r){r=Math.min(e.i.length,r);var n=e.l?b(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+r];-1==t?0<r?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let o=!0;for(let a=0;a<r;a++){let r=i[a].g,s=i[a].map;if(0>(r-=t))t=Math.max(0,i[a].g-100),o=!1;else try{!function(e,t,r){let n=r||"";try{e7(e,function(e,r){let i=e;g(e)&&(i=ev(e)),t.push(n+r+"="+encodeURIComponent(i))})}catch(e){throw t.push(n+"type="+encodeURIComponent("_badmap")),e}}(s,e,"req"+r+"_")}catch(e){n&&n(s)}}if(o){n=e.join("&");break e}}}return t.D=e=e.i.splice(0,r),n}function tJ(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;G||V(),M||(G(),M=!0),U.add(t,e),e.v=0}}function tQ(e){return!e.g&&!e.u&&!(3<=e.v)&&(e.Y++,e.u=eL(b(e.Fa,e),t1(e,e.v)),e.v++,!0)}function tY(e){null!=e.A&&(p.clearTimeout(e.A),e.A=null)}function tX(e){e.g=new eV(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=tt(e.qa);to(t,"RID","rpc"),to(t,"SID",e.K),to(t,"AID",e.T),to(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&to(t,"TO",e.ja),to(t,"TYPE","xmlhttp"),tK(e,t),e.m&&e.o&&tA(t,e.m,e.o),e.L&&(e.g.I=e.L);var r=e.g;e=e.ia,r.L=1,r.v=ta(tt(t)),r.m=null,r.P=!0,e$(r,e)}function tZ(e){null!=e.C&&(p.clearTimeout(e.C),e.C=null)}function t0(e,t){var r,n=null;if(e.g==t){tZ(e),tY(e),e.g=null;var i=2}else{if(!e4(e.h,t))return;n=t.D,e5(e.h,t),i=1}if(0!=e.G){if(t.o)if(1==i){n=t.m?t.m.length:0,t=Date.now()-t.F;var o=e.B;eh(i=eA(),new eR(i,n)),tq(e)}else tJ(e);else if(3==(o=t.s)||0==o&&0<t.X||!(1==i&&(r=t,!(e3(e.h)>=e.h.j-!!e.s)&&(e.s?(e.i=r.D.concat(e.i),!0):1!=e.G&&2!=e.G&&!(e.B>=(e.Va?0:e.Wa))&&(e.s=eL(b(e.Ga,e,r),t1(e,e.B)),e.B++,!0)))||2==i&&tQ(e)))switch(n&&0<n.length&&((t=e.h).i=t.i.concat(n)),o){case 1:t2(e,5);break;case 4:t2(e,10);break;case 3:t2(e,6);break;default:t2(e,2)}}}function t1(e,t){let r=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(r*=2),r*t}function t2(e,t){if(e.j.info("Error code "+t),2==t){var r=b(e.fb,e),n=e.Xa;let t=!n;n=new te(n||"//www.google.com/images/cleardot.gif"),p.location&&"http"==p.location.protocol||tr(n,"https"),ta(n),t?function(e,t){let r=new ej;if(p.Image){let n=new Image;n.onload=w(tS,r,"TestLoadImage: loaded",!0,t,n),n.onerror=w(tS,r,"TestLoadImage: error",!1,t,n),n.onabort=w(tS,r,"TestLoadImage: abort",!1,t,n),n.ontimeout=w(tS,r,"TestLoadImage: timeout",!1,t,n),p.setTimeout(function(){n.ontimeout&&n.ontimeout()},1e4),n.src=e}else t(!1)}(n.toString(),r):function(e,t){let r=new ej,n=new AbortController,i=setTimeout(()=>{n.abort(),tS(r,"TestPingServer: timeout",!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(i),e.ok?tS(r,"TestPingServer: ok",!0,t):tS(r,"TestPingServer: server error",!1,t)}).catch(()=>{clearTimeout(i),tS(r,"TestPingServer: error",!1,t)})}(n.toString(),r)}else eN(2);e.G=0,e.l&&e.l.sa(t),t3(e),tH(e)}function t3(e){if(e.G=0,e.ka=[],e.l){let t=e8(e.h);(0!=t.length||0!=e.i.length)&&(T(e.ka,t),T(e.ka,e.i),e.h.i.length=0,x(e.i),e.i.length=0),e.l.ra()}}function t4(e,t,r){var n=r instanceof te?tt(r):new te(r);if(""!=n.g)t&&(n.g=t+"."+n.g),tn(n,n.s);else{var i=p.location;n=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var o=new te(null);n&&tr(o,n),t&&(o.g=t),i&&tn(o,i),r&&(o.l=r),n=o}return r=e.D,t=e.ya,r&&t&&to(n,r,t),to(n,"VER",e.la),tK(e,n),n}function t6(e,t,r){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tO(e.Ca&&!e.pa?new tI({eb:r}):e.pa)).Ha(e.J),t}function t5(){}function t8(){}function t7(e,t){el.call(this),this.g=new tV(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!_(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!_(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new rt(this)}function t9(e){eT.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let r in t){e=r;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function re(){ek.call(this),this.status=1}function rt(e){this.g=e}(r=tO.prototype).Ha=function(e){this.J=e},r.ea=function(e,r,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);r=r?r.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():t.g(),this.v=this.o?ex(this.o):ex(t),this.g.onreadystatechange=b(this.Ea,this);try{this.B=!0,this.g.open(r,String(e),!0),this.B=!1}catch(e){tN(this,e);return}if(e=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var o in i)n.set(o,i[o]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())n.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[t,a]of(i=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),o=p.FormData&&e instanceof p.FormData,!(0<=Array.prototype.indexOf.call(tD,r,void 0))||i||o||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(t,a);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{tF(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){tN(this,e)}},r.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,eh(this,"complete"),eh(this,"abort"),tj(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tj(this,!0)),tO.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?tL(this):this.bb())},r.bb=function(){tL(this)},r.isActive=function(){return!!this.g},r.Z=function(){try{return 2<tG(this)?this.g.status:-1}catch(e){return -1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},r.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),eb(t)}},r.Ba=function(){return this.m},r.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(r=tV.prototype).la=8,r.G=1,r.connect=function(e,t,r,n){eN(0),this.W=e,this.H=t||{},r&&void 0!==n&&(this.H.OSID=r,this.H.OAID=n),this.F=this.X,this.I=t4(this,null,this.W),tq(this)},r.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;let i=new eV(this,this.j,e),o=this.o;if(this.S&&(o?R(o=D(o),this.S):o=this.S),null!==this.m||this.O||(i.H=o,o=null),this.P)e:{for(var t=0,r=0;r<this.i.length;r++){t:{var n=this.i[r];if("__data__"in n.map&&"string"==typeof(n=n.map.__data__)){n=n.length;break t}n=void 0}if(void 0===n)break;if(4096<(t+=n)){t=r;break e}if(4096===t||r===this.i.length-1){t=r+1;break e}}t=1e3}else t=1e3;t=tW(this,i,t),to(r=tt(this.I),"RID",e),to(r,"CVER",22),this.D&&to(r,"X-HTTP-Session-Id",this.D),tK(this,r),o&&(this.O?t="headers="+encodeURIComponent(String(tP(o)))+"&"+t:this.m&&tA(r,this.m,o)),e6(this.h,i),this.Ua&&to(r,"TYPE","init"),this.P?(to(r,"$req",t),to(r,"SID","null"),i.T=!0,eq(i,r,null)):eq(i,r,t),this.G=2}}else 3==this.G&&(e?t$(this,e):0==this.i.length||e2(this.h)||t$(this))},r.Fa=function(){if(this.u=null,tX(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=eL(b(this.ab,this),e)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,eN(10),tz(this),tX(this))},r.Za=function(){null!=this.C&&(this.C=null,tz(this),tQ(this),eN(19))},r.fb=function(e){e?(this.j.info("Successfully pinged google.com"),eN(2)):(this.j.info("Failed to ping google.com"),eN(1))},r.isActive=function(){return!!this.l&&this.l.isActive(this)},(r=t5.prototype).ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){},t8.prototype.g=function(e,t){return new t7(e,t)},S(t7,el),t7.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},t7.prototype.close=function(){tB(this.g)},t7.prototype.o=function(e){var t=this.g;if("string"==typeof e){var r={};r.__data__=e,e=r}else this.u&&((r={}).__data__=ev(e),e=r);t.i.push(new e0(t.Ya++,e)),3==t.G&&tq(t)},t7.prototype.N=function(){this.g.l=null,delete this.j,tB(this.g),delete this.g,t7.aa.N.call(this)},S(t9,eT),S(re,ek),S(rt,t5),rt.prototype.ua=function(){eh(this.g,"a")},rt.prototype.ta=function(e){eh(this.g,new t9(e))},rt.prototype.sa=function(e){eh(this.g,new re)},rt.prototype.ra=function(){eh(this.g,"b")},t8.prototype.createWebChannel=t8.prototype.g,t7.prototype.send=t7.prototype.o,t7.prototype.open=t7.prototype.m,t7.prototype.close=t7.prototype.close,d=E.createWebChannelTransport=function(){return new t8},h=E.getStatEventTarget=function(){return eA()},l=E.Event=e_,c=E.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},eG.NO_ERROR=0,eG.TIMEOUT=8,eG.HTTP_ERROR=6,u=E.ErrorCode=eG,eM.COMPLETE="complete",s=E.EventType=eM,eI.EventType=eE,eE.OPEN="a",eE.CLOSE="b",eE.ERROR="c",eE.MESSAGE="d",el.prototype.listen=el.prototype.K,a=E.WebChannel=eI,E.FetchXmlHttpFactory=tI,tO.prototype.listenOnce=tO.prototype.L,tO.prototype.getLastError=tO.prototype.Ka,tO.prototype.getLastErrorCode=tO.prototype.Ba,tO.prototype.getStatus=tO.prototype.Z,tO.prototype.getResponseJson=tO.prototype.Oa,tO.prototype.getResponseText=tO.prototype.oa,tO.prototype.send=tO.prototype.ea,tO.prototype.setWithCredentials=tO.prototype.Ha,o=E.XhrIo=tO}).apply(void 0!==I?I:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var T=r(5364),k=r(2909).hp;let _="@firebase/firestore",P="4.8.0";class A{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}A.UNAUTHENTICATED=new A(null),A.GOOGLE_CREDENTIALS=new A("google-credentials-uid"),A.FIRST_PARTY=new A("first-party-uid"),A.MOCK_USER=new A("mock-user");let O="11.10.0",C=new b.Vy("@firebase/firestore");function D(){return C.logLevel}function N(e){C.setLogLevel(e)}function R(e,...t){if(C.logLevel<=b.$b.DEBUG){let r=t.map(F);C.debug(`Firestore (${O}): ${e}`,...r)}}function L(e,...t){if(C.logLevel<=b.$b.ERROR){let r=t.map(F);C.error(`Firestore (${O}): ${e}`,...r)}}function j(e,...t){if(C.logLevel<=b.$b.WARN){let r=t.map(F);C.warn(`Firestore (${O}): ${e}`,...r)}}function F(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function G(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,M(e,n,r)}function M(e,t,r){let n=`FIRESTORE (${O}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{n+=" CONTEXT: "+JSON.stringify(r)}catch(e){n+=" CONTEXT: "+r}throw L(n),Error(n)}function U(e,t,r,n){let i="Unexpected state";"string"==typeof r?i=r:n=r,e||M(t,i,n)}function V(e,t){e||G(57014,t)}let B={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class z extends w.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class H{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class q{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class ${getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(A.UNAUTHENTICATED))}shutdown(){}}class K{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class W{constructor(e){this.t=e,this.currentUser=A.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){U(void 0===this.o,42304);let r=this.i,n=e=>this.i!==r?(r=this.i,t(e)):Promise.resolve(),i=new H;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new H,e.enqueueRetryable(()=>n(this.currentUser))};let o=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},a=e=>{R("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(R("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new H)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(R("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(U("string"==typeof t.accessToken,31837,{l:t}),new q(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return U(null===e||"string"==typeof e,2055,{h:e}),new A(e)}}class J{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=A.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Q{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new J(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(A.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Y{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class X{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,(0,y.xZ)(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){U(void 0===this.o,3512);let r=e=>{null!=e.error&&R("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let r=e.token!==this.m;return this.m=e.token,R("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>r(t))};let n=e=>{R("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?n(e):R("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Y(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(U("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new Y(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class Z{getToken(){return Promise.resolve(new Y(""))}invalidateToken(){}start(e,t){}shutdown(){}}function ee(){return new TextEncoder}class et{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let r=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(r);else for(let e=0;e<40;e++)r[e]=Math.floor(256*Math.random());return r}(40);for(let n=0;n<r.length;++n)t.length<20&&r[n]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(r[n]%62))}return t}}function er(e,t){return e<t?-1:+(e>t)}function en(e,t){let r=0;for(;r<e.length&&r<t.length;){let n=e.codePointAt(r),i=t.codePointAt(r);if(n!==i){if(n<128&&i<128)return er(n,i);{let o=ee(),a=function(e,t){for(let r=0;r<e.length&&r<t.length;++r)if(e[r]!==t[r])return er(e[r],t[r]);return er(e.length,t.length)}(o.encode(ei(e,r)),o.encode(ei(t,r)));return 0!==a?a:er(n,i)}}r+=n>65535?2:1}return er(e.length,t.length)}function ei(e,t){return e.codePointAt(t)>65535?e.substring(t,t+2):e.substring(t,t+1)}function eo(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}let ea="__name__";class es{constructor(e,t,r){void 0===t?t=0:t>e.length&&G(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&G(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===es.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof es?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=es.compareSegments(e.get(n),t.get(n));if(0!==r)return r}return er(e.length,t.length)}static compareSegments(e,t){let r=es.isNumericId(e),n=es.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?es.extractNumericId(e).compare(es.extractNumericId(t)):en(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return n.fromString(e.substring(4,e.length-2))}}class eu extends es{construct(e,t,r){return new eu(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new z(B.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new eu(t)}static emptyPath(){return new eu([])}}let ec=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class el extends es{construct(e,t,r){return new el(e,t,r)}static isValidIdentifier(e){return ec.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),el.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===ea}static keyField(){return new el([ea])}static fromServerFormat(e){let t=[],r="",n=0,i=()=>{if(0===r.length)throw new z(B.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;n<e.length;){let t=e[n];if("\\"===t){if(n+1===e.length)throw new z(B.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new z(B.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?o=!o:"."!==t||o?r+=t:i(),n++}if(i(),o)throw new z(B.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new el(t)}static emptyPath(){return new el([])}}class eh{constructor(e){this.path=e}static fromPath(e){return new eh(eu.fromString(e))}static fromName(e){return new eh(eu.fromString(e).popFirst(5))}static empty(){return new eh(eu.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===eu.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return eu.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new eh(new eu(e.slice()))}}function ed(e,t,r){if(!r)throw new z(B.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function ef(e,t,r,n){if(!0===t&&!0===n)throw new z(B.INVALID_ARGUMENT,`${e} and ${r} cannot be used together.`)}function ep(e){if(!eh.isDocumentKey(e))throw new z(B.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function em(e){if(eh.isDocumentKey(e))throw new z(B.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function eg(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function ey(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let r=(t=e).constructor?t.constructor.name:null;return r?`a custom ${r} object`:"an object"}}return"function"==typeof e?"a function":G(12329,{type:typeof e})}function ev(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new z(B.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let r=ey(e);throw new z(B.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${r}`)}}return e}function eb(e,t){if(t<=0)throw new z(B.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}function ew(e,t){let r={typeString:e};return t&&(r.value=t),r}function eS(e,t){let r;if(!eg(e))throw new z(B.INVALID_ARGUMENT,"JSON must be an object");for(let n in t)if(t[n]){let i=t[n].typeString,o="value"in t[n]?{value:t[n].value}:void 0;if(!(n in e)){r=`JSON missing required field: '${n}'`;break}let a=e[n];if(i&&typeof a!==i){r=`JSON field '${n}' must be a ${i}.`;break}if(void 0!==o&&a!==o.value){r=`Expected '${n}' field to equal '${o.value}'`;break}}if(r)throw new z(B.INVALID_ARGUMENT,r);return!0}class ex{static now(){return ex.fromMillis(Date.now())}static fromDate(e){return ex.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*1e6);return new ex(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new z(B.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new z(B.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?er(this.nanoseconds,e.nanoseconds):er(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ex._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(eS(e,ex._jsonSchema))return new ex(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ex._jsonSchemaVersion="firestore/timestamp/1.0",ex._jsonSchema={type:ew("string",ex._jsonSchemaVersion),seconds:ew("number"),nanoseconds:ew("number")};class eI{static fromTimestamp(e){return new eI(e)}static min(){return new eI(new ex(0,0))}static max(){return new eI(new ex(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class eE{constructor(e,t,r,n){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=n}}function eT(e){return e.fields.find(e=>2===e.kind)}function ek(e){return e.fields.filter(e=>2!==e.kind)}function e_(e,t){let r=er(e.collectionGroup,t.collectionGroup);if(0!==r)return r;for(let n=0;n<Math.min(e.fields.length,t.fields.length);++n)if(0!==(r=function(e,t){let r=el.comparator(e.fieldPath,t.fieldPath);return 0!==r?r:er(e.kind,t.kind)}(e.fields[n],t.fields[n])))return r;return er(e.fields.length,t.fields.length)}eE.UNKNOWN_ID=-1;class eP{constructor(e,t){this.fieldPath=e,this.kind=t}}class eA{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new eA(0,eD.min())}}function eO(e,t){let r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1;return new eD(eI.fromTimestamp(1e9===n?new ex(r+1,0):new ex(r,n)),eh.empty(),t)}function eC(e){return new eD(e.readTime,e.key,-1)}class eD{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new eD(eI.min(),eh.empty(),-1)}static max(){return new eD(eI.max(),eh.empty(),-1)}}function eN(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r||0!==(r=eh.comparator(e.documentKey,t.documentKey))?r:er(e.largestBatchId,t.largestBatchId)}let eR="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class eL{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function ej(e){if(e.code!==B.FAILED_PRECONDITION||e.message!==eR)throw e;R("LocalStore","Unexpectedly lost primary lease")}class eF{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&G(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new eF((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof eF?t:eF.resolve(t)}catch(e){return eF.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):eF.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):eF.reject(t)}static resolve(e){return new eF((t,r)=>{t(e)})}static reject(e){return new eF((t,r)=>{r(e)})}static waitFor(e){return new eF((t,r)=>{let n=0,i=0,o=!1;e.forEach(e=>{++n,e.next(()=>{++i,o&&i===n&&t()},e=>r(e))}),o=!0,i===n&&t()})}static or(e){let t=eF.resolve(!1);for(let r of e)t=t.next(e=>e?eF.resolve(e):r());return t}static forEach(e,t){let r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new eF((r,n)=>{let i=e.length,o=Array(i),a=0;for(let s=0;s<i;s++){let u=s;t(e[u]).next(e=>{o[u]=e,++a===i&&r(o)},e=>n(e))}})}static doWhile(e,t){return new eF((r,n)=>{let i=()=>{!0===e()?t().next(()=>{i()},n):r()};i()})}}let eG="SimpleDb";class eM{static open(e,t,r,n){try{return new eM(t,e.transaction(n,r))}catch(e){throw new ez(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new H,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new ez(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{let r=eW(t.target.error);this.S.reject(new ez(e,r))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(R(eG,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new eq(this.transaction.objectStore(e))}}class eU{static delete(e){return R(eG,"Removing database:",e),e$((0,w.mS)().indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!(0,w.zW)())return!1;if(eU.F())return!0;let e=(0,w.ZQ)(),t=eU.M(e),r=eV(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<r&&r<4.5)}static F(){var e;return void 0!==T&&"YES"===(null==(e=T.__PRIVATE_env)?void 0:e.O)}static N(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,r){this.name=e,this.version=t,this.B=r,this.L=null,12.2===eU.M((0,w.ZQ)())&&L("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async k(e){return this.db||(R(eG,"Opening database:",this.name),this.db=await new Promise((t,r)=>{let n=indexedDB.open(this.name,this.version);n.onsuccess=e=>{t(e.target.result)},n.onblocked=()=>{r(new ez(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},n.onerror=t=>{let n=t.target.error;"VersionError"===n.name?r(new z(B.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new z(B.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new ez(e,n))},n.onupgradeneeded=e=>{R(eG,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;if(null!==this.L&&this.L!==e.oldVersion)throw Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.L}, event.oldVersion=${e.oldVersion}, event.newVersion=${e.newVersion}, db.version=${t.version}`);this.B.q(t,n.transaction,e.oldVersion,this.version).next(()=>{R(eG,"Database upgrade to version "+this.version+" complete")})}}),this.db.addEventListener("close",e=>{let t=e.target;this.L=t.version},{passive:!0})),this.db.addEventListener("versionchange",e=>{var t;null===e.newVersion&&(j('Received "versionchange" event with newVersion===null; notifying the registered DatabaseDeletedListener, if any'),null==(t=this.databaseDeletedListener)||t.call(this))},{passive:!0}),this.db}setDatabaseDeletedListener(e){if(this.databaseDeletedListener)throw Error("setDatabaseDeletedListener() may only be called once, and it has already been called");this.databaseDeletedListener=e}async runTransaction(e,t,r,n){let i="readonly"===t,o=0;for(;;){++o;try{this.db=await this.k(e);let t=eM.open(this.db,e,i?"readonly":"readwrite",r),o=n(t).next(e=>(t.v(),e)).catch(e=>(t.abort(e),eF.reject(e))).toPromise();return o.catch(()=>{}),await t.D,o}catch(t){let e="FirebaseError"!==t.name&&o<3;if(R(eG,"Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function eV(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class eB{constructor(e){this.$=e,this.U=!1,this.K=null}get isDone(){return this.U}get W(){return this.K}set cursor(e){this.$=e}done(){this.U=!0}G(e){this.K=e}delete(){return e$(this.$.delete())}}class ez extends z{constructor(e,t){super(B.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function eH(e){return"IndexedDbTransactionError"===e.name}class eq{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(R(eG,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(R(eG,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),e$(r)}add(e){return R(eG,"ADD",this.store.name,e,e),e$(this.store.add(e))}get(e){return e$(this.store.get(e)).next(t=>(void 0===t&&(t=null),R(eG,"GET",this.store.name,e,t),t))}delete(e){return R(eG,"DELETE",this.store.name,e),e$(this.store.delete(e))}count(){return R(eG,"COUNT",this.store.name),e$(this.store.count())}j(e,t){let r=this.options(e,t),n=r.index?this.store.index(r.index):this.store;if("function"==typeof n.getAll){let e=n.getAll(r.range);return new eF((t,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(r),t=[];return this.J(e,(e,r)=>{t.push(r)}).next(()=>t)}}H(e,t){let r=this.store.getAll(e,null===t?void 0:t);return new eF((e,t)=>{r.onerror=e=>{t(e.target.error)},r.onsuccess=t=>{e(t.target.result)}})}Y(e,t){R(eG,"DELETE ALL",this.store.name);let r=this.options(e,t);r.Z=!1;let n=this.cursor(r);return this.J(n,(e,t,r)=>r.delete())}X(e,t){let r;t?r=e:(r={},t=e);let n=this.cursor(r);return this.J(n,t)}ee(e){let t=this.cursor({});return new eF((r,n)=>{t.onerror=e=>{n(eW(e.target.error))},t.onsuccess=t=>{let n=t.target.result;n?e(n.primaryKey,n.value).next(e=>{e?n.continue():r()}):r()}})}J(e,t){let r=[];return new eF((n,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void n();let o=new eB(i),a=t(i.primaryKey,i.value,o);if(a instanceof eF){let e=a.catch(e=>(o.done(),eF.reject(e)));r.push(e)}o.isDone?n():null===o.W?i.continue():i.continue(o.W)}}).next(()=>eF.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.Z?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function e$(e){return new eF((t,r)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{r(eW(e.target.error))}})}let eK=!1;function eW(e){let t=eU.M((0,w.ZQ)());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new z("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return eK||(eK=!0,setTimeout(()=>{throw e},0)),e}}return e}let eJ="IndexBackfiller";class eQ{constructor(e,t){this.asyncQueue=e,this.te=t,this.task=null}start(){this.ne(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}ne(e){R(eJ,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.te.re();R(eJ,`Documents written: ${e}`)}catch(e){eH(e)?R(eJ,"Ignoring IndexedDB error during index backfill: ",e):await ej(e)}await this.ne(6e4)})}}class eY{constructor(e,t){this.localStore=e,this.persistence=t}async re(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.ie(t,e))}ie(e,t){let r=new Set,n=t,i=!0;return eF.doWhile(()=>!0===i&&n>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!r.has(t))return R(eJ,`Processing collection: ${t}`),this.se(e,t,n).next(e=>{n-=e,r.add(t)});i=!1})).next(()=>t-n)}se(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(n=>this.localStore.localDocuments.getNextDocuments(e,t,n,r).next(r=>{let i=r.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.oe(n,r)).next(r=>(R(eJ,`Updating offset: ${r}`),this.localStore.indexManager.updateCollectionGroup(e,t,r))).next(()=>i.size)}))}oe(e,t){let r=e;return t.changes.forEach((e,t)=>{let n=eC(t);eN(n,r)>0&&(r=n)}),new eD(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class eX{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this._e(e),this.ae=e=>t.writeSequenceNumber(e))}_e(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ae&&this.ae(e),e}}function eZ(e){return null==e}function e0(e){return 0===e&&1/e==-1/0}function e1(e){return"number"==typeof e&&Number.isInteger(e)&&!e0(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function e2(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let r=t,n=e.length;for(let t=0;t<n;t++){let n=e.charAt(t);switch(n){case"\0":r+="\x01\x10";break;case"\x01":r+="\x01\x11";break;default:r+=n}}return r}(e.get(r),t);return t+"\x01\x01"}eX.ue=-1;function e3(e){let t=e.length;if(U(t>=2,64408,{path:e}),2===t)return U("\x01"===e.charAt(0)&&"\x01"===e.charAt(1),56145,{path:e}),eu.emptyPath();let r=t-2,n=[],i="";for(let o=0;o<t;){let t=e.indexOf("\x01",o);switch((t<0||t>r)&&G(50515,{path:e}),e.charAt(t+1)){case"\x01":let a,s=e.substring(o,t);0===i.length?a=s:(i+=s,a=i,i=""),n.push(a);break;case"\x10":i+=e.substring(o,t),i+="\0";break;case"\x11":i+=e.substring(o,t+1);break;default:G(61167,{path:e})}o=t+2}return new eu(n)}let e4="remoteDocuments",e6="owner",e5="owner",e8="mutationQueues",e7="mutations",e9="batchId",te="userMutationsIndex",tt=["userId","batchId"],tr={},tn="documentMutations",ti="remoteDocumentsV14",to=["prefixPath","collectionGroup","readTime","documentId"],ta="documentKeyIndex",ts=["prefixPath","collectionGroup","documentId"],tu="collectionGroupIndex",tc=["collectionGroup","readTime","prefixPath","documentId"],tl="remoteDocumentGlobal",th="remoteDocumentGlobalKey",td="targets",tf="queryTargetsIndex",tp=["canonicalId","targetId"],tm="targetDocuments",tg=["targetId","path"],ty="documentTargetsIndex",tv=["path","targetId"],tb="targetGlobalKey",tw="targetGlobal",tS="collectionParents",tx=["collectionId","parent"],tI="clientMetadata",tE="bundles",tT="namedQueries",tk="indexConfiguration",t_="collectionGroupIndex",tP="indexState",tA=["indexId","uid"],tO="sequenceNumberIndex",tC=["uid","sequenceNumber"],tD="indexEntries",tN=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],tR="documentKeyIndex",tL=["indexId","uid","orderedDocumentKey"],tj="documentOverlays",tF=["userId","collectionPath","documentId"],tG="collectionPathOverlayIndex",tM=["userId","collectionPath","largestBatchId"],tU="collectionGroupOverlayIndex",tV=["userId","collectionGroup","largestBatchId"],tB="globals",tz=[e8,e7,tn,e4,td,e6,tw,tm,tI,tl,tS,tE,tT],tH=[...tz,tj],tq=[e8,e7,tn,ti,td,e6,tw,tm,tI,tl,tS,tE,tT,tj],t$=[...tq,tk,tP,tD],tK=[...t$,tB];class tW extends eL{constructor(e,t){super(),this.ce=e,this.currentSequenceNumber=t}}function tJ(e,t){return eU.N(e.ce,t)}function tQ(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function tY(e,t){for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function tX(e,t){let r=[];for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.push(t(e[n],n,e));return r}function tZ(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class t0{constructor(e,t){this.comparator=e,this.root=t||t2.EMPTY}insert(e,t){return new t0(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,t2.BLACK,null,null))}remove(e){return new t0(this.comparator,this.root.remove(e,this.comparator).copy(null,null,t2.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new t1(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new t1(this.root,e,this.comparator,!1)}getReverseIterator(){return new t1(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new t1(this.root,e,this.comparator,!0)}}class t1{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class t2{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:t2.RED,this.left=null!=n?n:t2.EMPTY,this.right=null!=i?i:t2.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new t2(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return t2.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r,n=this;if(0>t(e,n.key))n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key)){if(n.right.isEmpty())return t2.EMPTY;r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,t2.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,t2.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw G(43730,{key:this.key,value:this.value});if(this.right.isRed())throw G(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw G(27949);return e+ +!this.isRed()}}t2.EMPTY=null,t2.RED=!0,t2.BLACK=!1,t2.EMPTY=new class{constructor(){this.size=0}get key(){throw G(57766)}get value(){throw G(16141)}get color(){throw G(16727)}get left(){throw G(29726)}get right(){throw G(36894)}copy(e,t,r,n,i){return this}insert(e,t,r){return new t2(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class t3{constructor(e){this.comparator=e,this.data=new t0(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new t4(this.data.getIterator())}getIteratorFrom(e){return new t4(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof t3)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new t3(this.comparator);return t.data=e,t}}class t4{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function t6(e){return e.hasNext()?e.getNext():void 0}class t5{constructor(e){this.fields=e,e.sort(el.comparator)}static empty(){return new t5([])}unionWith(e){let t=new t3(el.comparator);for(let e of this.fields)t=t.add(e);for(let r of e)t=t.add(r);return new t5(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return eo(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class t8 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function t7(){return"undefined"!=typeof atob}class t9{constructor(e){this.binaryString=e}static fromBase64String(e){return new t9(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new t8("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new t9(function(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return er(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}t9.EMPTY_BYTE_STRING=new t9("");let re=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function rt(e){if(U(!!e,39018),"string"==typeof e){let t=0,r=re.exec(e);if(U(!!r,46558,{timestamp:e}),r[1]){let e=r[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:rr(e.seconds),nanos:rr(e.nanos)}}function rr(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function rn(e){return"string"==typeof e?t9.fromBase64String(e):t9.fromUint8Array(e)}let ri="server_timestamp",ro="__type__",ra="__previous_value__",rs="__local_write_time__";function ru(e){var t,r;return(null==(r=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[ro])?void 0:r.stringValue)===ri}function rc(e){let t=e.mapValue.fields[ra];return ru(t)?rc(t):t}function rl(e){let t=rt(e.mapValue.fields[rs].timestampValue);return new ex(t.seconds,t.nanos)}class rh{constructor(e,t,r,n,i,o,a,s,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=s,this.useFetchStreams=u,this.isUsingEmulator=c}}let rd="(default)";class rf{constructor(e,t){this.projectId=e,this.database=t||rd}static empty(){return new rf("","")}get isDefaultDatabase(){return this.database===rd}isEqual(e){return e instanceof rf&&e.projectId===this.projectId&&e.database===this.database}}let rp="__type__",rm="__max__",rg={mapValue:{fields:{__type__:{stringValue:rm}}}},ry="__vector__",rv="value",rb={nullValue:"NULL_VALUE"};function rw(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ru(e)?4:rL(e)?0x1fffffffffffff:rN(e)?10:11:G(28295,{value:e})}function rS(e,t){if(e===t)return!0;let r=rw(e);if(r!==rw(t))return!1;switch(r){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return rl(e).isEqual(rl(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let n=rt(e.timestampValue),i=rt(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return rn(e.bytesValue).isEqual(rn(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return rr(e.geoPointValue.latitude)===rr(t.geoPointValue.latitude)&&rr(e.geoPointValue.longitude)===rr(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return rr(e.integerValue)===rr(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let r=rr(e.doubleValue),n=rr(t.doubleValue);return r===n?e0(r)===e0(n):isNaN(r)&&isNaN(n)}return!1;case 9:return eo(e.arrayValue.values||[],t.arrayValue.values||[],rS);case 10:case 11:let o=e.mapValue.fields||{},a=t.mapValue.fields||{};if(tQ(o)!==tQ(a))return!1;for(let e in o)if(o.hasOwnProperty(e)&&(void 0===a[e]||!rS(o[e],a[e])))return!1;return!0;default:return G(52216,{left:e})}}function rx(e,t){return void 0!==(e.values||[]).find(e=>rS(e,t))}function rI(e,t){if(e===t)return 0;let r=rw(e),n=rw(t);if(r!==n)return er(r,n);switch(r){case 0:case 0x1fffffffffffff:return 0;case 1:return er(e.booleanValue,t.booleanValue);case 2:let i=rr(e.integerValue||e.doubleValue),o=rr(t.integerValue||t.doubleValue);return i<o?-1:i>o?1:i===o?0:isNaN(i)?isNaN(o)?0:-1:1;case 3:return rE(e.timestampValue,t.timestampValue);case 4:return rE(rl(e),rl(t));case 5:return en(e.stringValue,t.stringValue);case 6:return function(e,t){let r=rn(e),n=rn(t);return r.compareTo(n)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){let r=e.split("/"),n=t.split("/");for(let e=0;e<r.length&&e<n.length;e++){let t=er(r[e],n[e]);if(0!==t)return t}return er(r.length,n.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){let r=er(rr(e.latitude),rr(t.latitude));return 0!==r?r:er(rr(e.longitude),rr(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return rT(e.arrayValue,t.arrayValue);case 10:return function(e,t){var r,n,i,o;let a=e.fields||{},s=t.fields||{},u=null==(r=a[rv])?void 0:r.arrayValue,c=null==(n=s[rv])?void 0:n.arrayValue,l=er((null==(i=null==u?void 0:u.values)?void 0:i.length)||0,(null==(o=null==c?void 0:c.values)?void 0:o.length)||0);return 0!==l?l:rT(u,c)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===rg.mapValue&&t===rg.mapValue)return 0;if(e===rg.mapValue)return 1;if(t===rg.mapValue)return -1;let r=e.fields||{},n=Object.keys(r),i=t.fields||{},o=Object.keys(i);n.sort(),o.sort();for(let e=0;e<n.length&&e<o.length;++e){let t=en(n[e],o[e]);if(0!==t)return t;let a=rI(r[n[e]],i[o[e]]);if(0!==a)return a}return er(n.length,o.length)}(e.mapValue,t.mapValue);default:throw G(23264,{le:r})}}function rE(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return er(e,t);let r=rt(e),n=rt(t),i=er(r.seconds,n.seconds);return 0!==i?i:er(r.nanos,n.nanos)}function rT(e,t){let r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){let t=rI(r[e],n[e]);if(t)return t}return er(r.length,n.length)}function rk(e){var t,r;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){let t=rt(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?rn(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,eh.fromName(t).toString()):"geoPointValue"in e?(r=e.geoPointValue,`geo(${r.latitude},${r.longitude})`):"arrayValue"in e?function(e){let t="[",r=!0;for(let n of e.values||[])r?r=!1:t+=",",t+=rk(n);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),r="{",n=!0;for(let i of t)n?n=!1:r+=",",r+=`${i}:${rk(e.fields[i])}`;return r+"}"}(e.mapValue):G(61005,{value:e})}function r_(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function rP(e){return!!e&&"integerValue"in e}function rA(e){return!!e&&"arrayValue"in e}function rO(e){return!!e&&"nullValue"in e}function rC(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function rD(e){return!!e&&"mapValue"in e}function rN(e){var t,r;return(null==(r=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[rp])?void 0:r.stringValue)===ry}function rR(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return tY(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=rR(r)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=rR(e.arrayValue.values[r]);return t}return Object.assign({},e)}function rL(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===rm}let rj={mapValue:{fields:{[rp]:{stringValue:ry},[rv]:{arrayValue:{}}}}};function rF(e,t){let r=rI(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function rG(e,t){let r=rI(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class rM{constructor(e){this.value=e}static empty(){return new rM({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(!rD(t=(t.mapValue.fields||{})[e.get(r)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=rR(t)}setAll(e){let t=el.emptyPath(),r={},n=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=i.popLast()}e?r[i.lastSegment()]=rR(e):n.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,r,n)}delete(e){let t=this.field(e.popLast());rD(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return rS(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];rD(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){for(let n of(tY(t,(t,r)=>e[t]=r),r))delete e[n]}clone(){return new rM(rR(this.value))}}class rU{constructor(e,t,r,n,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new rU(e,0,eI.min(),eI.min(),eI.min(),rM.empty(),0)}static newFoundDocument(e,t,r,n){return new rU(e,1,t,eI.min(),r,n,0)}static newNoDocument(e,t){return new rU(e,2,t,eI.min(),eI.min(),rM.empty(),0)}static newUnknownDocument(e,t){return new rU(e,3,t,eI.min(),eI.min(),rM.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(eI.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=rM.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=rM.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=eI.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof rU&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new rU(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class rV{constructor(e,t){this.position=e,this.inclusive=t}}function rB(e,t,r){let n=0;for(let i=0;i<e.position.length;i++){let o=t[i],a=e.position[i];if(n=o.field.isKeyField()?eh.comparator(eh.fromName(a.referenceValue),r.key):rI(a,r.data.field(o.field)),"desc"===o.dir&&(n*=-1),0!==n)break}return n}function rz(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!rS(e.position[r],t.position[r]))return!1;return!0}class rH{constructor(e,t="asc"){this.field=e,this.dir=t}}class rq{}class r$ extends rq{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new rZ(e,t,r):"array-contains"===t?new r3(e,r):"in"===t?new r4(e,r):"not-in"===t?new r6(e,r):"array-contains-any"===t?new r5(e,r):new r$(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new r0(e,r):new r1(e,r)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(rI(t,this.value)):null!==t&&rw(this.value)===rw(t)&&this.matchesComparison(rI(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return G(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class rK extends rq{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new rK(e,t)}matches(e){return rW(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.he||(this.he=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}}function rW(e){return"and"===e.op}function rJ(e){return"or"===e.op}function rQ(e){return rY(e)&&rW(e)}function rY(e){for(let t of e.filters)if(t instanceof rK)return!1;return!0}function rX(e,t){let r=e.filters.concat(t);return rK.create(r,e.op)}class rZ extends r${constructor(e,t,r){super(e,t,r),this.key=eh.fromName(r.referenceValue)}matches(e){let t=eh.comparator(e.key,this.key);return this.matchesComparison(t)}}class r0 extends r${constructor(e,t){super(e,"in",t),this.keys=r2("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class r1 extends r${constructor(e,t){super(e,"not-in",t),this.keys=r2("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function r2(e,t){var r;return((null==(r=t.arrayValue)?void 0:r.values)||[]).map(e=>eh.fromName(e.referenceValue))}class r3 extends r${constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return rA(t)&&rx(t.arrayValue,this.value)}}class r4 extends r${constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&rx(this.value.arrayValue,t)}}class r6 extends r${constructor(e,t){super(e,"not-in",t)}matches(e){if(rx(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!rx(this.value.arrayValue,t)}}class r5 extends r${constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!rA(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>rx(this.value.arrayValue,e))}}class r8{constructor(e,t=null,r=[],n=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=o,this.endAt=a,this.Pe=null}}function r7(e,t=null,r=[],n=[],i=null,o=null,a=null){return new r8(e,t,r,n,i,o,a)}function r9(e){if(null===e.Pe){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof r$)return t.field.canonicalString()+t.op.toString()+rk(t.value);if(rQ(t))return t.filters.map(t=>e(t)).join(",");{let r=t.filters.map(t=>e(t)).join(",");return`${t.op}(${r})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),eZ(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>rk(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>rk(e)).join(",")),e.Pe=t}return e.Pe}function ne(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var r,n;if(r=e.orderBy[i],n=t.orderBy[i],!(r.dir===n.dir&&r.field.isEqual(n.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!function e(t,r){return t instanceof r$?r instanceof r$&&t.op===r.op&&t.field.isEqual(r.field)&&rS(t.value,r.value):t instanceof rK?r instanceof rK&&t.op===r.op&&t.filters.length===r.filters.length&&t.filters.reduce((t,n,i)=>t&&e(n,r.filters[i]),!0):void G(19439)}(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!rz(e.startAt,t.startAt)&&rz(e.endAt,t.endAt)}function nt(e){return eh.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function nr(e,t){return e.filters.filter(e=>e instanceof r$&&e.field.isEqual(t))}function nn(e,t,r){let n=rb,i=!0;for(let r of nr(e,t)){let e=rb,t=!0;switch(r.op){case"<":case"<=":var o;e="nullValue"in(o=r.value)?rb:"booleanValue"in o?{booleanValue:!1}:"integerValue"in o||"doubleValue"in o?{doubleValue:NaN}:"timestampValue"in o?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in o?{stringValue:""}:"bytesValue"in o?{bytesValue:""}:"referenceValue"in o?r_(rf.empty(),eh.empty()):"geoPointValue"in o?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in o?{arrayValue:{}}:"mapValue"in o?rN(o)?rj:{mapValue:{}}:G(35942,{value:o});break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=rb}0>rF({value:n,inclusive:i},{value:e,inclusive:t})&&(n=e,i=t)}if(null!==r){for(let o=0;o<e.orderBy.length;++o)if(e.orderBy[o].field.isEqual(t)){let e=r.position[o];0>rF({value:n,inclusive:i},{value:e,inclusive:r.inclusive})&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function ni(e,t,r){let n=rg,i=!0;for(let r of nr(e,t)){let e=rg,t=!0;switch(r.op){case">=":case">":var o;e="nullValue"in(o=r.value)?{booleanValue:!1}:"booleanValue"in o?{doubleValue:NaN}:"integerValue"in o||"doubleValue"in o?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in o?{stringValue:""}:"stringValue"in o?{bytesValue:""}:"bytesValue"in o?r_(rf.empty(),eh.empty()):"referenceValue"in o?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in o?{arrayValue:{}}:"arrayValue"in o?rj:"mapValue"in o?rN(o)?{mapValue:{}}:rg:G(61959,{value:o}),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=rg}rG({value:n,inclusive:i},{value:e,inclusive:t})>0&&(n=e,i=t)}if(null!==r){for(let o=0;o<e.orderBy.length;++o)if(e.orderBy[o].field.isEqual(t)){let e=r.position[o];rG({value:n,inclusive:i},{value:e,inclusive:r.inclusive})>0&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}class no{constructor(e,t=null,r=[],n=[],i=null,o="F",a=null,s=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=s,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}}function na(e){return new no(e)}function ns(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function nu(e){return null!==e.collectionGroup}function nc(e){if(null===e.Te){let t;e.Te=[];let r=new Set;for(let t of e.explicitOrderBy)e.Te.push(t),r.add(t.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new t3(el.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{r.has(t.canonicalString())||t.isKeyField()||e.Te.push(new rH(t,n))}),r.has(el.keyField().canonicalString())||e.Te.push(new rH(el.keyField(),n))}return e.Te}function nl(e){return e.Ie||(e.Ie=nd(e,nc(e))),e.Ie}function nh(e){return e.de||(e.de=nd(e,e.explicitOrderBy)),e.de}function nd(e,t){if("F"===e.limitType)return r7(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new rH(e.field,t)});let r=e.endAt?new rV(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new rV(e.startAt.position,e.startAt.inclusive):null;return r7(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}function nf(e,t){let r=e.filters.concat([t]);return new no(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function np(e,t,r){return new no(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function nm(e,t){return ne(nl(e),nl(t))&&e.limitType===t.limitType}function ng(e){return`${r9(nl(e))}|lt:${e.limitType}`}function ny(e){var t;let r;return`Query(target=${r=(t=nl(e)).path.canonicalString(),null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof r$?`${t.field.canonicalString()} ${t.op} ${rk(t.value)}`:t instanceof rK?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),eZ(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(e=>rk(e)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(e=>rk(e)).join(",")),`Target(${r})`}; limitType=${e.limitType})`}function nv(e,t){return t.isFoundDocument()&&function(e,t){let r=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(r):eh.isDocumentKey(e.path)?e.path.isEqual(r):e.path.isImmediateParentOf(r)}(e,t)&&function(e,t){for(let r of nc(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}(e,t)&&function(e,t){for(let r of e.filters)if(!r.matches(t))return!1;return!0}(e,t)&&(!e.startAt||!!function(e,t,r){let n=rB(e,t,r);return e.inclusive?n<=0:n<0}(e.startAt,nc(e),t))&&(!e.endAt||!!function(e,t,r){let n=rB(e,t,r);return e.inclusive?n>=0:n>0}(e.endAt,nc(e),t))}function nb(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function nw(e){return(t,r)=>{let n=!1;for(let i of nc(e)){let e=function(e,t,r){let n=e.field.isKeyField()?eh.comparator(t.key,r.key):function(e,t,r){let n=t.data.field(e),i=r.data.field(e);return null!==n&&null!==i?rI(n,i):G(42886)}(e.field,t,r);switch(e.dir){case"asc":return n;case"desc":return -1*n;default:return G(19790,{direction:e.dir})}}(i,t,r);if(0!==e)return e;n=n||i.field.isKeyField()}return 0}}class nS{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r){for(let[t,n]of r)if(this.equalsFn(t,e))return n}}has(e){return void 0!==this.get(e)}set(e,t){let r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n)return this.inner[r]=[[e,t]],void this.innerSize++;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return void(n[r]=[e,t]);n.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){tY(this.inner,(t,r)=>{for(let[t,n]of r)e(t,n)})}isEmpty(){return tZ(this.inner)}size(){return this.innerSize}}let nx=new t0(eh.comparator),nI=new t0(eh.comparator);function nE(...e){let t=nI;for(let r of e)t=t.insert(r.key,r);return t}function nT(e){let t=nI;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function nk(){return new nS(e=>e.toString(),(e,t)=>e.isEqual(t))}let n_=new t0(eh.comparator),nP=new t3(eh.comparator);function nA(...e){let t=nP;for(let r of e)t=t.add(r);return t}let nO=new t3(er);function nC(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:e0(t)?"-0":t}}function nD(e){return{integerValue:""+e}}function nN(e,t){return e1(t)?nD(t):nC(e,t)}class nR{constructor(){this._=void 0}}function nL(e,t){return e instanceof nV?rP(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class nj extends nR{}class nF extends nR{constructor(e){super(),this.elements=e}}function nG(e,t){let r=nz(t);for(let t of e.elements)r.some(e=>rS(e,t))||r.push(t);return{arrayValue:{values:r}}}class nM extends nR{constructor(e){super(),this.elements=e}}function nU(e,t){let r=nz(t);for(let t of e.elements)r=r.filter(e=>!rS(e,t));return{arrayValue:{values:r}}}class nV extends nR{constructor(e,t){super(),this.serializer=e,this.Ee=t}}function nB(e){return rr(e.integerValue||e.doubleValue)}function nz(e){return rA(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class nH{constructor(e,t){this.field=e,this.transform=t}}class nq{constructor(e,t){this.version=e,this.transformResults=t}}class n${constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n$}static exists(e){return new n$(void 0,e)}static updateTime(e){return new n$(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function nK(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class nW{}function nJ(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new n3(e.key,n$.none()):new nX(e.key,e.data,n$.none());{let r=e.data,n=rM.empty(),i=new t3(el.comparator);for(let e of t.fields)if(!i.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),i=i.add(e)}return new nZ(e.key,n,new t5(i.toArray()),n$.none())}}function nQ(e,t,r,n){return e instanceof nX?function(e,t,r,n){if(!nK(e.precondition,t))return r;let i=e.value.clone(),o=n2(e.fieldTransforms,n,t);return i.setAll(o),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,r,n):e instanceof nZ?function(e,t,r,n){if(!nK(e.precondition,t))return r;let i=n2(e.fieldTransforms,n,t),o=t.data;return(o.setAll(n0(e)),o.setAll(i),t.convertToFoundDocument(t.version,o).setHasLocalMutations(),null===r)?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,r,n):nK(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}function nY(e,t){var r,n;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(r=e.fieldTransforms,n=t.fieldTransforms,!!(void 0===r&&void 0===n||!(!r||!n)&&eo(r,n,(e,t)=>{var r,n;return e.field.isEqual(t.field)&&(r=e.transform,n=t.transform,r instanceof nF&&n instanceof nF||r instanceof nM&&n instanceof nM?eo(r.elements,n.elements,rS):r instanceof nV&&n instanceof nV?rS(r.Ee,n.Ee):r instanceof nj&&n instanceof nj)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class nX extends nW{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class nZ extends nW{constructor(e,t,r,n,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function n0(e){let t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){let n=e.data.field(r);t.set(r,n)}}),t}function n1(e,t,r){let n=new Map;U(e.length===r.length,32656,{Ae:r.length,Re:e.length});for(let o=0;o<r.length;o++){var i;let a=e[o],s=a.transform,u=t.data.field(a.field);n.set(a.field,(i=r[o],s instanceof nF?nG(s,u):s instanceof nM?nU(s,u):i))}return n}function n2(e,t,r){let n=new Map;for(let i of e){let e=i.transform,o=r.data.field(i.field);n.set(i.field,e instanceof nj?function(e,t){let r={fields:{[ro]:{stringValue:ri},[rs]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&ru(t)&&(t=rc(t)),t&&(r.fields[ra]=t),{mapValue:r}}(t,o):e instanceof nF?nG(e,o):e instanceof nM?nU(e,o):function(e,t){let r=nL(e,t),n=nB(r)+nB(e.Ee);return rP(r)&&rP(e.Ee)?nD(n):nC(e.serializer,n)}(e,o))}return n}class n3 extends nW{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class n4 extends nW{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class n6{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let n=this.mutations[t];n.key.isEqual(e.key)&&function(e,t,r){e instanceof nX?function(e,t,r){let n=e.value.clone(),i=n1(e.fieldTransforms,t,r.transformResults);n.setAll(i),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()}(e,t,r):e instanceof nZ?function(e,t,r){if(!nK(e.precondition,t))return t.convertToUnknownDocument(r.version);let n=n1(e.fieldTransforms,t,r.transformResults),i=t.data;i.setAll(n0(e)),i.setAll(n),t.convertToFoundDocument(r.version,i).setHasCommittedMutations()}(e,t,r):t.convertToNoDocument(r.version).setHasCommittedMutations()}(n,e,r[t])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=nQ(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=nQ(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=nk();return this.mutations.forEach(n=>{let i=e.get(n.key),o=i.overlayedDocument,a=this.applyToLocalView(o,i.mutatedFields),s=nJ(o,a=t.has(n.key)?null:a);null!==s&&r.set(n.key,s),o.isValidDocument()||o.convertToNoDocument(eI.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),nA())}isEqual(e){return this.batchId===e.batchId&&eo(this.mutations,e.mutations,(e,t)=>nY(e,t))&&eo(this.baseMutations,e.baseMutations,(e,t)=>nY(e,t))}}class n5{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){U(e.mutations.length===r.length,58842,{Ve:e.mutations.length,me:r.length});let n=n_,i=e.mutations;for(let e=0;e<i.length;e++)n=n.insert(i[e].key,r[e].version);return new n5(e,t,r,n)}}class n8{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class n7{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}class n9{constructor(e,t){this.count=e,this.unchangedNames=t}}function ie(e){switch(e){case B.OK:return G(64938);case B.CANCELLED:case B.UNKNOWN:case B.DEADLINE_EXCEEDED:case B.RESOURCE_EXHAUSTED:case B.INTERNAL:case B.UNAVAILABLE:case B.UNAUTHENTICATED:return!1;case B.INVALID_ARGUMENT:case B.NOT_FOUND:case B.ALREADY_EXISTS:case B.PERMISSION_DENIED:case B.FAILED_PRECONDITION:case B.ABORTED:case B.OUT_OF_RANGE:case B.UNIMPLEMENTED:case B.DATA_LOSS:return!0;default:return G(15467,{code:e})}}function it(e){if(void 0===e)return L("GRPC error has no .code"),B.UNKNOWN;switch(e){case f.OK:return B.OK;case f.CANCELLED:return B.CANCELLED;case f.UNKNOWN:return B.UNKNOWN;case f.DEADLINE_EXCEEDED:return B.DEADLINE_EXCEEDED;case f.RESOURCE_EXHAUSTED:return B.RESOURCE_EXHAUSTED;case f.INTERNAL:return B.INTERNAL;case f.UNAVAILABLE:return B.UNAVAILABLE;case f.UNAUTHENTICATED:return B.UNAUTHENTICATED;case f.INVALID_ARGUMENT:return B.INVALID_ARGUMENT;case f.NOT_FOUND:return B.NOT_FOUND;case f.ALREADY_EXISTS:return B.ALREADY_EXISTS;case f.PERMISSION_DENIED:return B.PERMISSION_DENIED;case f.FAILED_PRECONDITION:return B.FAILED_PRECONDITION;case f.ABORTED:return B.ABORTED;case f.OUT_OF_RANGE:return B.OUT_OF_RANGE;case f.UNIMPLEMENTED:return B.UNIMPLEMENTED;case f.DATA_LOSS:return B.DATA_LOSS;default:return G(39323,{code:e})}}(p=f||(f={}))[p.OK=0]="OK",p[p.CANCELLED=1]="CANCELLED",p[p.UNKNOWN=2]="UNKNOWN",p[p.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",p[p.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",p[p.NOT_FOUND=5]="NOT_FOUND",p[p.ALREADY_EXISTS=6]="ALREADY_EXISTS",p[p.PERMISSION_DENIED=7]="PERMISSION_DENIED",p[p.UNAUTHENTICATED=16]="UNAUTHENTICATED",p[p.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",p[p.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",p[p.ABORTED=10]="ABORTED",p[p.OUT_OF_RANGE=11]="OUT_OF_RANGE",p[p.UNIMPLEMENTED=12]="UNIMPLEMENTED",p[p.INTERNAL=13]="INTERNAL",p[p.UNAVAILABLE=14]="UNAVAILABLE",p[p.DATA_LOSS=15]="DATA_LOSS";let ir=null,ii=new n([0xffffffff,0xffffffff],0);function io(e){let t=ee().encode(e),r=new i;return r.update(t),new Uint8Array(r.digest())}function ia(e){let t=new DataView(e.buffer),r=t.getUint32(0,!0),i=t.getUint32(4,!0),o=t.getUint32(8,!0),a=t.getUint32(12,!0);return[new n([r,i],0),new n([o,a],0)]}class is{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new iu(`Invalid padding: ${t}`);if(r<0||e.length>0&&0===this.hashCount)throw new iu(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new iu(`Invalid padding when bitmap length is 0: ${t}`);this.fe=8*e.length-t,this.ge=n.fromNumber(this.fe)}pe(e,t,r){let i=e.add(t.multiply(n.fromNumber(r)));return 1===i.compare(ii)&&(i=new n([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.fe)return!1;let[t,r]=ia(io(e));for(let e=0;e<this.hashCount;e++){let n=this.pe(t,r,e);if(!this.ye(n))return!1}return!0}static create(e,t,r){let n=new is(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return r.forEach(e=>n.insert(e)),n}insert(e){if(0===this.fe)return;let[t,r]=ia(io(e));for(let e=0;e<this.hashCount;e++){let n=this.pe(t,r,e);this.we(n)}}we(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class iu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ic{constructor(e,t,r,n,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let n=new Map;return n.set(e,il.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new ic(eI.min(),n,new t0(er),nx,nA())}}class il{constructor(e,t,r,n,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new il(r,t,nA(),nA(),nA())}}class ih{constructor(e,t,r,n){this.Se=e,this.removedTargetIds=t,this.key=r,this.be=n}}class id{constructor(e,t){this.targetId=e,this.De=t}}class ip{constructor(e,t,r=t9.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class im{constructor(){this.ve=0,this.Ce=iv(),this.Fe=t9.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return 0!==this.ve}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=nA(),t=nA(),r=nA();return this.Ce.forEach((n,i)=>{switch(i){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:G(38017,{changeType:i})}}),new il(this.Fe,this.Me,e,t,r)}ke(){this.xe=!1,this.Ce=iv()}qe(e,t){this.xe=!0,this.Ce=this.Ce.insert(e,t)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,U(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}}class ig{constructor(e){this.We=e,this.Ge=new Map,this.ze=nx,this.je=iy(),this.Je=iy(),this.He=new t0(er)}Ye(e){for(let t of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(t,e.be):this.Xe(t,e.key,e.be);for(let t of e.removedTargetIds)this.Xe(t,e.key,e.be)}et(e){this.forEachTarget(e,t=>{let r=this.tt(t);switch(e.state){case 0:this.nt(t)&&r.Be(e.resumeToken);break;case 1:r.Ue(),r.Oe||r.ke(),r.Be(e.resumeToken);break;case 2:r.Ue(),r.Oe||this.removeTarget(t);break;case 3:this.nt(t)&&(r.Ke(),r.Be(e.resumeToken));break;case 4:this.nt(t)&&(this.rt(t),r.Be(e.resumeToken));break;default:G(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ge.forEach((e,r)=>{this.nt(r)&&t(r)})}it(e){let t=e.targetId,r=e.De.count,n=this.st(t);if(n){let i=n.target;if(nt(i))if(0===r){let e=new eh(i.path);this.Xe(t,e,rU.newNoDocument(e,eI.min()))}else U(1===r,20013,{expectedCount:r});else{let n=this.ot(t);if(n!==r){let r=this._t(e),i=r?this.ut(r,e,n):1;0!==i&&(this.rt(t),this.He=this.He.insert(t,2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),null==ir||ir.ct(function(e,t,r,n,i){var o,a,s,u,c,l;let h={localCacheCount:e,existenceFilterCount:t.count,databaseId:r.database,projectId:r.projectId},d=t.unchangedNames;return d&&(h.bloomFilter={applied:0===i,hashCount:null!=(o=null==d?void 0:d.hashCount)?o:0,bitmapLength:null!=(u=null==(s=null==(a=null==d?void 0:d.bits)?void 0:a.bitmap)?void 0:s.length)?u:0,padding:null!=(l=null==(c=null==d?void 0:d.bits)?void 0:c.padding)?l:0,mightContain:e=>{var t;return null!=(t=null==n?void 0:n.mightContain(e))&&t}}),h}(n,e.De,this.We.lt(),r,i))}}}}_t(e){let t,r,n=e.De.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:i="",padding:o=0},hashCount:a=0}=n;try{t=rn(i).toUint8Array()}catch(e){if(e instanceof t8)return j("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{r=new is(t,o,a)}catch(e){return j(e instanceof iu?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===r.fe?null:r}ut(e,t,r){return 2*(t.De.count!==r-this.ht(e,t.targetId))}ht(e,t){let r=this.We.getRemoteKeysForTarget(t),n=0;return r.forEach(r=>{let i=this.We.lt(),o=`projects/${i.projectId}/databases/${i.database}/documents/${r.path.canonicalString()}`;e.mightContain(o)||(this.Xe(t,r,null),n++)}),n}Pt(e){let t=new Map;this.Ge.forEach((r,n)=>{let i=this.st(n);if(i){if(r.current&&nt(i.target)){let t=new eh(i.target.path);this.Tt(t).has(n)||this.It(n,t)||this.Xe(n,t,rU.newNoDocument(t,e))}r.Ne&&(t.set(n,r.Le()),r.ke())}});let r=nA();this.Je.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{let t=this.st(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.ze.forEach((t,r)=>r.setReadTime(e));let n=new ic(e,t,this.He,this.ze,r);return this.ze=nx,this.je=iy(),this.Je=iy(),this.He=new t0(er),n}Ze(e,t){if(!this.nt(e))return;let r=2*!!this.It(e,t.key);this.tt(e).qe(t.key,r),this.ze=this.ze.insert(t.key,t),this.je=this.je.insert(t.key,this.Tt(t.key).add(e)),this.Je=this.Je.insert(t.key,this.dt(t.key).add(e))}Xe(e,t,r){if(!this.nt(e))return;let n=this.tt(e);this.It(e,t)?n.qe(t,1):n.Qe(t),this.Je=this.Je.insert(t,this.dt(t).delete(e)),this.Je=this.Je.insert(t,this.dt(t).add(e)),r&&(this.ze=this.ze.insert(t,r))}removeTarget(e){this.Ge.delete(e)}ot(e){let t=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let t=this.Ge.get(e);return t||(t=new im,this.Ge.set(e,t)),t}dt(e){let t=this.Je.get(e);return t||(t=new t3(er),this.Je=this.Je.insert(e,t)),t}Tt(e){let t=this.je.get(e);return t||(t=new t3(er),this.je=this.je.insert(e,t)),t}nt(e){let t=null!==this.st(e);return t||R("WatchChangeAggregator","Detected inactive target",e),t}st(e){let t=this.Ge.get(e);return t&&t.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new im),this.We.getRemoteKeysForTarget(e).forEach(t=>{this.Xe(e,t,null)})}It(e,t){return this.We.getRemoteKeysForTarget(e).has(t)}}function iy(){return new t0(eh.comparator)}function iv(){return new t0(eh.comparator)}let ib={asc:"ASCENDING",desc:"DESCENDING"},iw={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},iS={and:"AND",or:"OR"};class ix{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function iI(e,t){return e.useProto3Json||eZ(t)?t:{value:t}}function iE(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function iT(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function ik(e){return U(!!e,49232),eI.fromTimestamp(function(e){let t=rt(e);return new ex(t.seconds,t.nanos)}(e))}function i_(e,t){return iP(e,t).canonicalString()}function iP(e,t){let r=new eu(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?r:r.child(t)}function iA(e){let t=eu.fromString(e);return U(i$(t),10190,{key:t.toString()}),t}function iO(e,t){return i_(e.databaseId,t.path)}function iC(e,t){let r=iA(t);if(r.get(1)!==e.databaseId.projectId)throw new z(B.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new z(B.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new eh(iL(r))}function iD(e,t){return i_(e.databaseId,t)}function iN(e){let t=iA(e);return 4===t.length?eu.emptyPath():iL(t)}function iR(e){return new eu(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function iL(e){return U(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function ij(e,t,r){return{name:iO(e,t),fields:r.value.mapValue.fields}}function iF(e,t,r){let n=iC(e,t.name),i=ik(t.updateTime),o=t.createTime?ik(t.createTime):eI.min(),a=new rM({mapValue:{fields:t.fields}}),s=rU.newFoundDocument(n,i,o,a);return r&&s.setHasCommittedMutations(),r?s.setHasCommittedMutations():s}function iG(e,t){var r;let n;if(t instanceof nX)n={update:ij(e,t.key,t.value)};else if(t instanceof n3)n={delete:iO(e,t.key)};else if(t instanceof nZ)n={update:ij(e,t.key,t.data),updateMask:function(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof n4))return G(16599,{Rt:t.type});n={verify:iO(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let r=t.transform;if(r instanceof nj)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(r instanceof nF)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:r.elements}};if(r instanceof nM)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:r.elements}};if(r instanceof nV)return{fieldPath:t.field.canonicalString(),increment:r.Ee};throw G(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(n.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:iE(e,r.updateTime.toTimestamp())}:void 0!==r.exists?{exists:r.exists}:G(27497)),n}function iM(e,t){var r;let n=t.currentDocument?void 0!==(r=t.currentDocument).updateTime?n$.updateTime(ik(r.updateTime)):void 0!==r.exists?n$.exists(r.exists):n$.none():n$.none(),i=t.updateTransforms?t.updateTransforms.map(t=>{let r;return r=null,"setToServerValue"in t?(U("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),r=new nj):"appendMissingElements"in t?r=new nF(t.appendMissingElements.values||[]):"removeAllFromArray"in t?r=new nM(t.removeAllFromArray.values||[]):"increment"in t?r=new nV(e,t.increment):G(16584,{proto:t}),new nH(el.fromServerFormat(t.fieldPath),r)}):[];if(t.update){t.update.name;let r=iC(e,t.update.name),o=new rM({mapValue:{fields:t.update.fields}});return t.updateMask?new nZ(r,o,new t5((t.updateMask.fieldPaths||[]).map(e=>el.fromServerFormat(e))),n,i):new nX(r,o,n,i)}return t.delete?new n3(iC(e,t.delete),n):t.verify?new n4(iC(e,t.verify),n):G(1463,{proto:t})}function iU(e,t){return{documents:[iD(e,t.path)]}}function iV(e,t){var r,n;let i,o={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(i=a,o.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=a.popLast(),o.structuredQuery.from=[{collectionId:a.lastSegment()}]),o.parent=iD(e,i);let s=function(e){if(0!==e.length)return function e(t){return t instanceof r$?function(e){if("=="===e.op){if(rC(e.value))return{unaryFilter:{field:iH(e.field),op:"IS_NAN"}};if(rO(e.value))return{unaryFilter:{field:iH(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(rC(e.value))return{unaryFilter:{field:iH(e.field),op:"IS_NOT_NAN"}};if(rO(e.value))return{unaryFilter:{field:iH(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:iH(e.field),op:iw[e.op],value:e.value}}}(t):t instanceof rK?function(t){let r=t.getFilters().map(t=>e(t));return 1===r.length?r[0]:{compositeFilter:{op:iS[t.op],filters:r}}}(t):G(54877,{filter:t})}(rK.create(e,"and"))}(t.filters);s&&(o.structuredQuery.where=s);let u=function(e){if(0!==e.length)return e.map(e=>({field:iH(e.field),direction:ib[e.dir]}))}(t.orderBy);u&&(o.structuredQuery.orderBy=u);let c=iI(e,t.limit);return null!==c&&(o.structuredQuery.limit=c),t.startAt&&(o.structuredQuery.startAt={before:(r=t.startAt).inclusive,values:r.position}),t.endAt&&(o.structuredQuery.endAt={before:!(n=t.endAt).inclusive,values:n.position}),{Vt:o,parent:i}}function iB(e,t,r,n){let{Vt:i,parent:o}=iV(e,t),a={},s=[],u=0;return r.forEach(e=>{let t=n?e.alias:"aggregate_"+u++;a[t]=e.alias,"count"===e.aggregateType?s.push({alias:t,count:{}}):"avg"===e.aggregateType?s.push({alias:t,avg:{field:iH(e.fieldPath)}}):"sum"===e.aggregateType&&s.push({alias:t,sum:{field:iH(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:s,structuredQuery:i.structuredQuery},parent:i.parent},ft:a,parent:o}}function iz(e){var t;let r,n=iN(e.parent),i=e.structuredQuery,o=i.from?i.from.length:0,a=null;if(o>0){U(1===o,65062);let e=i.from[0];e.allDescendants?a=e.collectionId:n=n.child(e.collectionId)}let s=[];i.where&&(s=function(e){let t=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=iq(e.unaryFilter.field);return r$.create(t,"==",{doubleValue:NaN});case"IS_NULL":let r=iq(e.unaryFilter.field);return r$.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let n=iq(e.unaryFilter.field);return r$.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=iq(e.unaryFilter.field);return r$.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return G(61313);default:return G(60726)}}(t):void 0!==t.fieldFilter?r$.create(iq(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return G(58110);default:return G(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?rK.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return G(1026)}}(t.compositeFilter.op)):G(30097,{filter:t})}(e);return t instanceof rK&&rQ(t)?t.getFilters():[t]}(i.where));let u=[];i.orderBy&&(u=i.orderBy.map(e=>new rH(iq(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let c=null;i.limit&&(c=eZ(r="object"==typeof(t=i.limit)?t.value:t)?null:r);let l=null;i.startAt&&(l=function(e){let t=!!e.before;return new rV(e.values||[],t)}(i.startAt));let h=null;return i.endAt&&(h=function(e){let t=!e.before;return new rV(e.values||[],t)}(i.endAt)),new no(n,a,u,s,c,"F",l,h)}function iH(e){return{fieldPath:e.canonicalString()}}function iq(e){return el.fromServerFormat(e.fieldPath)}function i$(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class iK{constructor(e,t,r,n,i=eI.min(),o=eI.min(),a=t9.EMPTY_BYTE_STRING,s=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=s}withSequenceNumber(e){return new iK(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new iK(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new iK(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new iK(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class iW{constructor(e){this.gt=e}}function iJ(e,t){let r=t.key,n={prefixPath:r.getCollectionPath().popLast().toArray(),collectionGroup:r.collectionGroup,documentId:r.path.lastSegment(),readTime:iQ(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var i;n.document={name:iO(i=e.gt,t.key),fields:t.data.value.mapValue.fields,updateTime:iE(i,t.version.toTimestamp()),createTime:iE(i,t.createTime.toTimestamp())}}else if(t.isNoDocument())n.noDocument={path:r.path.toArray(),readTime:iY(t.version)};else{if(!t.isUnknownDocument())return G(57904,{document:t});n.unknownDocument={path:r.path.toArray(),version:iY(t.version)}}return n}function iQ(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function iY(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function iX(e){let t=new ex(e.seconds,e.nanoseconds);return eI.fromTimestamp(t)}function iZ(e,t){let r=(t.baseMutations||[]).map(t=>iM(e.gt,t));for(let e=0;e<t.mutations.length-1;++e){let r=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(r.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let n=t.mutations.map(t=>iM(e.gt,t)),i=ex.fromMillis(t.localWriteTimeMs);return new n6(t.batchId,i,r,n)}function i0(e){let t=iX(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?iX(e.lastLimboFreeSnapshotVersion):eI.min();return new iK(void 0!==e.query.documents?function(e){let t=e.documents.length;return U(1===t,1966,{count:t}),nl(na(iN(e.documents[0])))}(e.query):nl(iz(e.query)),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,r,t9.fromBase64String(e.resumeToken))}function i1(e,t){let r,n=iY(t.snapshotVersion),i=iY(t.lastLimboFreeSnapshotVersion);r=nt(t.target)?iU(e.gt,t.target):iV(e.gt,t.target).Vt;let o=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:r9(t.target),readTime:n,resumeToken:o,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function i2(e){let t=iz({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?np(t,t.limit,"L"):t}function i3(e,t){return new n8(t.largestBatchId,iM(e.gt,t.overlayMutation))}function i4(e,t){let r=t.path.lastSegment();return[e,e2(t.path.popLast()),r]}function i6(e,t,r,n){return{indexId:e,uid:t,sequenceNumber:r,readTime:iY(n.readTime),documentKey:e2(n.documentKey.path),largestBatchId:n.largestBatchId}}class i5{getBundleMetadata(e,t){return tJ(e,tE).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:iX(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return tJ(e,tE).put({bundleId:t.id,createTime:iY(ik(t.createTime)),version:t.version})}getNamedQuery(e,t){return tJ(e,tT).get(t).next(e=>{if(e)return{name:e.name,query:i2(e.bundledQuery),readTime:iX(e.readTime)}})}saveNamedQuery(e,t){return tJ(e,tT).put({name:t.name,readTime:iY(ik(t.readTime)),bundledQuery:t.bundledQuery})}}class i8{constructor(e,t){this.serializer=e,this.userId=t}static yt(e,t){return new i8(e,t.uid||"")}getOverlay(e,t){return tJ(e,tj).get(i4(this.userId,t)).next(e=>e?i3(this.serializer,e):null)}getOverlays(e,t){let r=nk();return eF.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){let n=[];return r.forEach((r,i)=>{let o=new n8(t,i);n.push(this.wt(e,o))}),eF.waitFor(n)}removeOverlaysForBatchId(e,t,r){let n=new Set;t.forEach(e=>n.add(e2(e.getCollectionPath())));let i=[];return n.forEach(t=>{let n=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,r+1],!1,!0);i.push(tJ(e,tj).Y(tG,n))}),eF.waitFor(i)}getOverlaysForCollection(e,t,r){let n=nk(),i=e2(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return tJ(e,tj).j(tG,o).next(e=>{for(let t of e){let e=i3(this.serializer,t);n.set(e.getKey(),e)}return n})}getOverlaysForCollectionGroup(e,t,r,n){let i,o=nk(),a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return tJ(e,tj).X({index:tU,range:a},(e,t,r)=>{let a=i3(this.serializer,t);o.size()<n||a.largestBatchId===i?(o.set(a.getKey(),a),i=a.largestBatchId):r.done()}).next(()=>o)}wt(e,t){return tJ(e,tj).put(function(e,t,r){let[n,i,o]=i4(t,r.mutation.key);return{userId:t,collectionPath:i,documentId:o,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:iG(e.gt,r.mutation)}}(this.serializer,this.userId,t))}}class i7{St(e){return tJ(e,tB)}getSessionToken(e){return this.St(e).get("sessionToken").next(e=>{let t=null==e?void 0:e.value;return t?t9.fromUint8Array(t):t9.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.St(e).put({name:"sessionToken",value:t.toUint8Array()})}}class i9{constructor(){}bt(e,t){this.Dt(e,t),t.vt()}Dt(e,t){if("nullValue"in e)this.Ct(t,5);else if("booleanValue"in e)this.Ct(t,10),t.Ft(+!!e.booleanValue);else if("integerValue"in e)this.Ct(t,15),t.Ft(rr(e.integerValue));else if("doubleValue"in e){let r=rr(e.doubleValue);isNaN(r)?this.Ct(t,13):(this.Ct(t,15),e0(r)?t.Ft(0):t.Ft(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ct(t,20),"string"==typeof r&&(r=rt(r)),t.Mt(`${r.seconds||""}`),t.Ft(r.nanos||0)}else if("stringValue"in e)this.xt(e.stringValue,t),this.Ot(t);else if("bytesValue"in e)this.Ct(t,30),t.Nt(rn(e.bytesValue)),this.Ot(t);else if("referenceValue"in e)this.Bt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ct(t,45),t.Ft(r.latitude||0),t.Ft(r.longitude||0)}else"mapValue"in e?rL(e)?this.Ct(t,Number.MAX_SAFE_INTEGER):rN(e)?this.Lt(e.mapValue,t):(this.kt(e.mapValue,t),this.Ot(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Ot(t)):G(19022,{Qt:e})}xt(e,t){this.Ct(t,25),this.$t(e,t)}$t(e,t){t.Mt(e)}kt(e,t){let r=e.fields||{};for(let e of(this.Ct(t,55),Object.keys(r)))this.xt(e,t),this.Dt(r[e],t)}Lt(e,t){var r,n;let i=e.fields||{};this.Ct(t,53);let o=(null==(n=null==(r=i[rv].arrayValue)?void 0:r.values)?void 0:n.length)||0;this.Ct(t,15),t.Ft(rr(o)),this.xt(rv,t),this.Dt(i[rv],t)}qt(e,t){let r=e.values||[];for(let e of(this.Ct(t,50),r))this.Dt(e,t)}Bt(e,t){this.Ct(t,37),eh.fromName(e).path.forEach(e=>{this.Ct(t,60),this.$t(e,t)})}Ct(e,t){e.Ft(t)}Ot(e){e.Ft(2)}}function oe(e){return Math.ceil((64-function(e){let t=0;for(let r=0;r<8;++r){let n=function(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}(255&e[r]);if(t+=n,8!==n)break}return t}(e))/8)}i9.Ut=new i9;class ot{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Kt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Wt(r.value),r=t.next();this.Gt()}zt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.jt(r.value),r=t.next();this.Jt()}Ht(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Wt(e);else if(e<2048)this.Wt(960|e>>>6),this.Wt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Wt(480|e>>>12),this.Wt(128|63&e>>>6),this.Wt(128|63&e);else{let e=t.codePointAt(0);this.Wt(240|e>>>18),this.Wt(128|63&e>>>12),this.Wt(128|63&e>>>6),this.Wt(128|63&e)}}this.Gt()}Yt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.jt(e);else if(e<2048)this.jt(960|e>>>6),this.jt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.jt(480|e>>>12),this.jt(128|63&e>>>6),this.jt(128|63&e);else{let e=t.codePointAt(0);this.jt(240|e>>>18),this.jt(128|63&e>>>12),this.jt(128|63&e>>>6),this.jt(128|63&e)}}this.Jt()}Zt(e){let t=this.Xt(e),r=oe(t);this.en(1+r),this.buffer[this.position++]=255&r;for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=255&t[e]}tn(e){let t=this.Xt(e),r=oe(t);this.en(1+r),this.buffer[this.position++]=~(255&r);for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}nn(){this.rn(255),this.rn(255)}sn(){this._n(255),this._n(255)}reset(){this.position=0}seed(e){this.en(e.length),this.buffer.set(e,this.position),this.position+=e.length}an(){return this.buffer.slice(0,this.position)}Xt(e){let t=function(e){let t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),r=!!(128&t[0]);t[0]^=r?255:128;for(let e=1;e<t.length;++e)t[e]^=255*!!r;return t}Wt(e){let t=255&e;0===t?(this.rn(0),this.rn(255)):255===t?(this.rn(255),this.rn(0)):this.rn(t)}jt(e){let t=255&e;0===t?(this._n(0),this._n(255)):255===t?(this._n(255),this._n(0)):this._n(e)}Gt(){this.rn(0),this.rn(1)}Jt(){this._n(0),this._n(1)}rn(e){this.en(1),this.buffer[this.position++]=e}_n(e){this.en(1),this.buffer[this.position++]=~e}en(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let n=new Uint8Array(r);n.set(this.buffer),this.buffer=n}}class or{constructor(e){this.un=e}Nt(e){this.un.Kt(e)}Mt(e){this.un.Ht(e)}Ft(e){this.un.Zt(e)}vt(){this.un.nn()}}class on{constructor(e){this.un=e}Nt(e){this.un.zt(e)}Mt(e){this.un.Yt(e)}Ft(e){this.un.tn(e)}vt(){this.un.sn()}}class oi{constructor(){this.un=new ot,this.cn=new or(this.un),this.ln=new on(this.un)}seed(e){this.un.seed(e)}hn(e){return 0===e?this.cn:this.ln}an(){return this.un.an()}reset(){this.un.reset()}}class oo{constructor(e,t,r,n){this.Pn=e,this.Tn=t,this.In=r,this.dn=n}En(){let e=this.dn.length,t=0===e||255===this.dn[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.dn,0),t!==e?r.set([0],this.dn.length):++r[r.length-1],new oo(this.Pn,this.Tn,this.In,r)}An(e,t,r){return{indexId:this.Pn,uid:e,arrayValue:ou(this.In),directionalValue:ou(this.dn),orderedDocumentKey:ou(t),documentKey:r.path.toArray()}}Rn(e,t,r){let n=this.An(e,t,r);return[n.indexId,n.uid,n.arrayValue,n.directionalValue,n.orderedDocumentKey,n.documentKey]}}function oa(e,t){let r=e.Pn-t.Pn;return 0!==r||0!==(r=os(e.In,t.In))||0!==(r=os(e.dn,t.dn))?r:eh.comparator(e.Tn,t.Tn)}function os(e,t){for(let r=0;r<e.length&&r<t.length;++r){let n=e[r]-t[r];if(0!==n)return n}return e.length-t.length}function ou(e){return(0,w.Ov)()?function(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}(e):e}function oc(e){return"string"!=typeof e?e:function(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(e)}class ol{constructor(e){for(let t of(this.Vn=new t3((e,t)=>el.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.mn=e.orderBy,this.fn=[],e.filters))t.isInequality()?this.Vn=this.Vn.add(t):this.fn.push(t)}get gn(){return this.Vn.size>1}pn(e){if(U(e.collectionGroup===this.collectionId,49279),this.gn)return!1;let t=eT(e);if(void 0!==t&&!this.yn(t))return!1;let r=ek(e),n=new Set,i=0,o=0;for(;i<r.length&&this.yn(r[i]);++i)n=n.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Vn.size>0){let e=this.Vn.getIterator().getNext();if(!n.has(e.field.canonicalString())){let t=r[i];if(!this.wn(e,t)||!this.Sn(this.mn[o++],t))return!1}++i}for(;i<r.length;++i){let e=r[i];if(o>=this.mn.length||!this.Sn(this.mn[o++],e))return!1}return!0}bn(){if(this.gn)return null;let e=new t3(el.comparator),t=[];for(let r of this.fn)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new eP(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new eP(r.field,0))}for(let r of this.mn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new eP(r.field,+("asc"!==r.dir))));return new eE(eE.UNKNOWN_ID,this.collectionId,t,eA.empty())}yn(e){for(let t of this.fn)if(this.wn(t,e))return!0;return!1}wn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let r="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===r}Sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function oh(e){return e instanceof r$}function od(e){return e instanceof rK&&rQ(e)}function of(e){return oh(e)||od(e)||function(e){if(e instanceof rK&&rJ(e)){for(let t of e.getFilters())if(!oh(t)&&!od(t))return!1;return!0}return!1}(e)}function op(e,t){return U(e instanceof r$||e instanceof rK,38388),U(t instanceof r$||t instanceof rK,25473),og(e instanceof r$?t instanceof r$?rK.create([e,t],"and"):om(e,t):t instanceof r$?om(t,e):function(e,t){if(U(e.filters.length>0&&t.filters.length>0,48005),rW(e)&&rW(t))return rX(e,t.getFilters());let r=rJ(e)?e:t,n=rJ(e)?t:e,i=r.filters.map(e=>op(e,n));return rK.create(i,"or")}(e,t))}function om(e,t){if(rW(t))return rX(t,e.getFilters());{let r=t.filters.map(t=>op(e,t));return rK.create(r,"or")}}function og(e){if(U(e instanceof r$||e instanceof rK,11850),e instanceof r$)return e;let t=e.getFilters();if(1===t.length)return og(t[0]);if(rY(e))return e;let r=t.map(e=>og(e)),n=[];return r.forEach(t=>{t instanceof r$?n.push(t):t instanceof rK&&(t.op===e.op?n.push(...t.filters):n.push(t))}),1===n.length?n[0]:rK.create(n,e.op)}class oy{constructor(){this.Dn=new ov}addToCollectionParentIndex(e,t){return this.Dn.add(t),eF.resolve()}getCollectionParents(e,t){return eF.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return eF.resolve()}deleteFieldIndex(e,t){return eF.resolve()}deleteAllFieldIndexes(e){return eF.resolve()}createTargetIndexes(e,t){return eF.resolve()}getDocumentsMatchingTarget(e,t){return eF.resolve(null)}getIndexType(e,t){return eF.resolve(0)}getFieldIndexes(e,t){return eF.resolve([])}getNextCollectionGroupToUpdate(e){return eF.resolve(null)}getMinOffset(e,t){return eF.resolve(eD.min())}getMinOffsetFromCollectionGroup(e,t){return eF.resolve(eD.min())}updateCollectionGroup(e,t,r){return eF.resolve()}updateIndexEntries(e,t){return eF.resolve()}}class ov{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new t3(eu.comparator),i=!n.has(r);return this.index[t]=n.add(r),i}has(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new t3(eu.comparator)).toArray()}}let ob="IndexedDbIndexManager",ow=new Uint8Array(0);class oS{constructor(e,t){this.databaseId=t,this.vn=new ov,this.Cn=new nS(e=>r9(e),(e,t)=>ne(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){let r=t.lastSegment(),n=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});let i={collectionId:r,parent:e2(n)};return tJ(e,tS).put(i)}return eF.resolve()}getCollectionParents(e,t){let r=[],n=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return tJ(e,tS).j(n).next(e=>{for(let n of e){if(n.collectionId!==t)break;r.push(e3(n.parent))}return r})}addFieldIndex(e,t){let r=tJ(e,tk),n={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete n.indexId;let i=r.add(n);if(t.indexState){let r=tJ(e,tP);return i.next(e=>{r.put(i6(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let r=tJ(e,tk),n=tJ(e,tP),i=tJ(e,tD);return r.delete(t.indexId).next(()=>n.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=tJ(e,tk),r=tJ(e,tD),n=tJ(e,tP);return t.Y().next(()=>r.Y()).next(()=>n.Y())}createTargetIndexes(e,t){return eF.forEach(this.Fn(t),t=>this.getIndexType(e,t).next(r=>{if(0===r||1===r){let r=new ol(t).bn();if(null!=r)return this.addFieldIndex(e,r)}}))}getDocumentsMatchingTarget(e,t){let r=tJ(e,tD),n=!0,i=new Map;return eF.forEach(this.Fn(t),t=>this.Mn(e,t).next(e=>{n&&(n=!!e),i.set(t,e)})).next(()=>{if(n){let e=nA(),n=[];return eF.forEach(i,(i,o)=>{R(ob,`Using index id=${i.indexId}|cg=${i.collectionGroup}|f=${i.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${r9(t)}`);let a=function(e,t){let r=eT(t);if(void 0===r)return null;for(let t of nr(e,r.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(o,i),s=function(e,t){let r=new Map;for(let n of ek(t))for(let t of nr(e,n.fieldPath))switch(t.op){case"==":case"in":r.set(n.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return r.set(n.fieldPath.canonicalString(),t.value),Array.from(r.values())}return null}(o,i),u=function(e,t){let r=[],n=!0;for(let i of ek(t)){let t=0===i.kind?nn(e,i.fieldPath,e.startAt):ni(e,i.fieldPath,e.startAt);r.push(t.value),n&&(n=t.inclusive)}return new rV(r,n)}(o,i),c=function(e,t){let r=[],n=!0;for(let i of ek(t)){let t=0===i.kind?ni(e,i.fieldPath,e.endAt):nn(e,i.fieldPath,e.endAt);r.push(t.value),n&&(n=t.inclusive)}return new rV(r,n)}(o,i),l=this.xn(i,o,u),h=this.xn(i,o,c),d=this.On(i,o,s),f=this.Nn(i.indexId,a,l,u.inclusive,h,c.inclusive,d);return eF.forEach(f,i=>r.H(i,t.limit).next(t=>{t.forEach(t=>{let r=eh.fromSegments(t.documentKey);e.has(r)||(e=e.add(r),n.push(r))})}))}).next(()=>n)}return eF.resolve(null)})}Fn(e){let t=this.Cn.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(U(t instanceof r$||t instanceof rK,34018),t instanceof r$)return t;if(1===t.filters.length)return e(t.filters[0]);let r=t.filters.map(t=>e(t)),n=rK.create(r,t.op);return of(n=og(n))?n:(U(n instanceof rK,64498),U(rW(n),40251),U(n.filters.length>1,57927),n.filters.reduce((e,t)=>op(e,t)))}(function e(t){var r,n;if(U(t instanceof r$||t instanceof rK,20012),t instanceof r$){if(t instanceof r4){let e=(null==(n=null==(r=t.value.arrayValue)?void 0:r.values)?void 0:n.map(e=>r$.create(t.field,"==",e)))||[];return rK.create(e,"or")}return t}let i=t.filters.map(t=>e(t));return rK.create(i,t.op)}(e));return U(of(t),7391),oh(t)||od(t)?[t]:t.getFilters()})(rK.create(e.filters,"and")).map(t=>r7(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.Cn.set(e,t)),t}Nn(e,t,r,n,i,o,a){let s=(null!=t?t.length:1)*Math.max(r.length,i.length),u=s/(null!=t?t.length:1),c=[];for(let l=0;l<s;++l){let s=t?this.Bn(t[l/u]):ow,h=this.Ln(e,s,r[l%u],n),d=this.kn(e,s,i[l%u],o),f=a.map(t=>this.Ln(e,s,t,!0));c.push(...this.createRange(h,d,f))}return c}Ln(e,t,r,n){let i=new oo(e,eh.empty(),t,r);return n?i:i.En()}kn(e,t,r,n){let i=new oo(e,eh.empty(),t,r);return n?i.En():i}Mn(e,t){let r=new ol(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(let n of e)r.pn(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let r=2,n=this.Fn(t);return eF.forEach(n,t=>this.Mn(e,t).next(e=>{e?0!==r&&e.fields.length<function(e){let t=new t3(el.comparator),r=!1;for(let n of e.filters)for(let e of n.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?r=!0:t=t.add(e.field));for(let r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+ +!!r}(t)&&(r=1):r=0})).next(()=>null!==t.limit&&n.length>1&&2===r?1:r)}qn(e,t){let r=new oi;for(let n of ek(e)){let e=t.data.field(n.fieldPath);if(null==e)return null;let i=r.hn(n.kind);i9.Ut.bt(e,i)}return r.an()}Bn(e){let t=new oi;return i9.Ut.bt(e,t.hn(0)),t.an()}Qn(e,t){let r=new oi;return i9.Ut.bt(r_(this.databaseId,t),r.hn(function(e){let t=ek(e);return 0===t.length?0:t[t.length-1].kind}(e))),r.an()}On(e,t,r){if(null===r)return[];let n=[];n.push(new oi);let i=0;for(let o of ek(e)){let e=r[i++];for(let r of n)if(this.$n(t,o.fieldPath)&&rA(e))n=this.Un(n,o,e);else{let t=r.hn(o.kind);i9.Ut.bt(e,t)}}return this.Kn(n)}xn(e,t,r){return this.On(e,t,r.position)}Kn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].an();return t}Un(e,t,r){let n=[...e],i=[];for(let e of r.arrayValue.values||[])for(let r of n){let n=new oi;n.seed(r.an()),i9.Ut.bt(e,n.hn(t.kind)),i.push(n)}return i}$n(e,t){return!!e.filters.find(e=>e instanceof r$&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let r=tJ(e,tk),n=tJ(e,tP);return(t?r.j(t_,IDBKeyRange.bound(t,t)):r.j()).next(e=>{let t=[];return eF.forEach(e,e=>n.get([e.indexId,this.uid]).next(r=>{t.push(function(e,t){let r=t?new eA(t.sequenceNumber,new eD(iX(t.readTime),new eh(e3(t.documentKey)),t.largestBatchId)):eA.empty(),n=e.fields.map(([e,t])=>new eP(el.fromServerFormat(e),t));return new eE(e.indexId,e.collectionGroup,n,r)}(e,r))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let r=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==r?r:er(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,r){let n=tJ(e,tk),i=tJ(e,tP);return this.Wn(e).next(e=>n.j(t_,IDBKeyRange.bound(t,t)).next(t=>eF.forEach(t,t=>i.put(i6(t.indexId,this.uid,e,r)))))}updateIndexEntries(e,t){let r=new Map;return eF.forEach(t,(t,n)=>{let i=r.get(t.collectionGroup);return(i?eF.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(r.set(t.collectionGroup,i),eF.forEach(i,r=>this.Gn(e,t,r).next(t=>{let i=this.zn(n,r);return t.isEqual(i)?eF.resolve():this.jn(e,n,r,t,i)}))))})}Jn(e,t,r,n){return tJ(e,tD).put(n.An(this.uid,this.Qn(r,t.key),t.key))}Hn(e,t,r,n){return tJ(e,tD).delete(n.Rn(this.uid,this.Qn(r,t.key),t.key))}Gn(e,t,r){let n=tJ(e,tD),i=new t3(oa);return n.X({index:tR,range:IDBKeyRange.only([r.indexId,this.uid,ou(this.Qn(r,t))])},(e,n)=>{i=i.add(new oo(r.indexId,t,oc(n.arrayValue),oc(n.directionalValue)))}).next(()=>i)}zn(e,t){let r=new t3(oa),n=this.qn(t,e);if(null==n)return r;let i=eT(t);if(null!=i){let o=e.data.field(i.fieldPath);if(rA(o))for(let i of o.arrayValue.values||[])r=r.add(new oo(t.indexId,e.key,this.Bn(i),n))}else r=r.add(new oo(t.indexId,e.key,ow,n));return r}jn(e,t,r,n,i){R(ob,"Updating index entries for document '%s'",t.key);let o=[];return function(e,t,r,n,i){let o=e.getIterator(),a=t.getIterator(),s=t6(o),u=t6(a);for(;s||u;){let e=!1,t=!1;if(s&&u){let n=r(s,u);n<0?t=!0:n>0&&(e=!0)}else null!=s?t=!0:e=!0;e?(n(u),u=t6(a)):t?(i(s),s=t6(o)):(s=t6(o),u=t6(a))}}(n,i,oa,n=>{o.push(this.Jn(e,t,r,n))},n=>{o.push(this.Hn(e,t,r,n))}),eF.waitFor(o)}Wn(e){let t=1;return tJ(e,tP).X({index:tO,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,r,n)=>{n.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((e,t)=>oa(e,t)).filter((e,t,r)=>!t||0!==oa(e,r[t-1]));let n=[];for(let i of(n.push(e),r)){let r=oa(i,e),o=oa(i,t);if(0===r)n[0]=e.En();else if(r>0&&o<0)n.push(i),n.push(i.En());else if(o>0)break}n.push(t);let i=[];for(let e=0;e<n.length;e+=2){if(this.Yn(n[e],n[e+1]))return[];let t=n[e].Rn(this.uid,ow,eh.empty()),r=n[e+1].Rn(this.uid,ow,eh.empty());i.push(IDBKeyRange.bound(t,r))}return i}Yn(e,t){return oa(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(ox)}getMinOffset(e,t){return eF.mapArray(this.Fn(t),t=>this.Mn(e,t).next(e=>e||G(44426))).next(ox)}}function ox(e){U(0!==e.length,28825);let t=e[0].indexState.offset,r=t.largestBatchId;for(let n=1;n<e.length;n++){let i=e[n].indexState.offset;0>eN(i,t)&&(t=i),r<i.largestBatchId&&(r=i.largestBatchId)}return new eD(t.readTime,t.documentKey,r)}let oI={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class oE{static withCacheSize(e){return new oE(e,oE.DEFAULT_COLLECTION_PERCENTILE,oE.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}function oT(e,t,r){let n=e.store(e7),i=e.store(tn),o=[],a=IDBKeyRange.only(r.batchId),s=0,u=n.X({range:a},(e,t,r)=>(s++,r.delete()));o.push(u.next(()=>{U(1===s,47070,{batchId:r.batchId})}));let c=[];for(let e of r.mutations){var l,h;let n=(l=e.key.path,h=r.batchId,[t,e2(l),h]);o.push(i.delete(n)),c.push(e.key)}return eF.waitFor(o).next(()=>c)}function ok(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw G(14731);t=e.noDocument}return JSON.stringify(t).length}oE.DEFAULT_COLLECTION_PERCENTILE=10,oE.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,oE.DEFAULT=new oE(0x2800000,oE.DEFAULT_COLLECTION_PERCENTILE,oE.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),oE.DISABLED=new oE(-1,0,0);class o_{constructor(e,t,r,n){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=n,this.Zn={}}static yt(e,t,r,n){return U(""!==e.uid,64387),new o_(e.isAuthenticated()?e.uid:"",t,r,n)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return oA(e).X({index:te,range:r},(e,r,n)=>{t=!1,n.done()}).next(()=>t)}addMutationBatch(e,t,r,n){let i=tJ(e,tn),o=oA(e);return o.add({}).next(a=>{U("number"==typeof a,49019);let s=new n6(a,t,r,n),u=function(e,t,r){let n=r.baseMutations.map(t=>iG(e.gt,t)),i=r.mutations.map(t=>iG(e.gt,t));return{userId:t,batchId:r.batchId,localWriteTimeMs:r.localWriteTime.toMillis(),baseMutations:n,mutations:i}}(this.serializer,this.userId,s),c=[],l=new t3((e,t)=>er(e.canonicalString(),t.canonicalString()));for(let e of n){var h,d;let t=(h=this.userId,d=e.key.path,[h,e2(d),a]);l=l.add(e.key.path.popLast()),c.push(o.put(u)),c.push(i.put(t,tr))}return l.forEach(t=>{c.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Zn[a]=s.keys()}),eF.waitFor(c).next(()=>s)})}lookupMutationBatch(e,t){return oA(e).get(t).next(e=>e?(U(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),iZ(this.serializer,e)):null)}Xn(e,t){return this.Zn[t]?eF.resolve(this.Zn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let r=e.keys();return this.Zn[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]),i=null;return oA(e).X({index:te,range:n},(e,t,n)=>{t.userId===this.userId&&(U(t.batchId>=r,47524,{er:r}),i=iZ(this.serializer,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return oA(e).X({index:te,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return oA(e).j(te,t).next(e=>e.map(e=>iZ(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=[this.userId,e2(t.path)],n=IDBKeyRange.lowerBound(r),i=[];return tJ(e,tn).X({range:n},(r,n,o)=>{let[a,s,u]=r,c=e3(s);if(a===this.userId&&t.path.isEqual(c))return oA(e).get(u).next(e=>{if(!e)throw G(61480,{tr:r,batchId:u});U(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:u}),i.push(iZ(this.serializer,e))});o.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new t3(er),n=[];return t.forEach(t=>{let i=[this.userId,e2(t.path)],o=IDBKeyRange.lowerBound(i),a=tJ(e,tn).X({range:o},(e,n,i)=>{let[o,a,s]=e,u=e3(a);o===this.userId&&t.path.isEqual(u)?r=r.add(s):i.done()});n.push(a)}),eF.waitFor(n).next(()=>this.nr(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=[this.userId,e2(r)],o=IDBKeyRange.lowerBound(i),a=new t3(er);return tJ(e,tn).X({range:o},(e,t,i)=>{let[o,s,u]=e,c=e3(s);o===this.userId&&r.isPrefixOf(c)?c.length===n&&(a=a.add(u)):i.done()}).next(()=>this.nr(e,a))}nr(e,t){let r=[],n=[];return t.forEach(t=>{n.push(oA(e).get(t).next(e=>{if(null===e)throw G(35274,{batchId:t});U(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),r.push(iZ(this.serializer,e))}))}),eF.waitFor(n).next(()=>r)}removeMutationBatch(e,t){return oT(e.ce,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.rr(t.batchId)}),eF.forEach(r,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}rr(e){delete this.Zn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return eF.resolve();let r=IDBKeyRange.lowerBound([this.userId]),n=[];return tJ(e,tn).X({range:r},(e,t,r)=>{if(e[0]===this.userId){let t=e3(e[1]);n.push(t)}else r.done()}).next(()=>{U(0===n.length,56720,{ir:n.map(e=>e.canonicalString())})})})}containsKey(e,t){return oP(e,this.userId,t)}sr(e){return tJ(e,e8).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function oP(e,t,r){let n=[t,e2(r.path)],i=n[1],o=IDBKeyRange.lowerBound(n),a=!1;return tJ(e,tn).X({range:o,Z:!0},(e,r,n)=>{let[o,s,u]=e;o===t&&s===i&&(a=!0),n.done()}).next(()=>a)}function oA(e){return tJ(e,e7)}class oO{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new oO(0)}static ur(){return new oO(-1)}}class oC{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.cr(e).next(t=>{let r=new oO(t.highestTargetId);return t.highestTargetId=r.next(),this.lr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.cr(e).next(e=>eI.fromTimestamp(new ex(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.cr(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.cr(e).next(n=>(n.highestListenSequenceNumber=t,r&&(n.lastRemoteSnapshotVersion=r.toTimestamp()),t>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t),this.lr(e,n)))}addTargetData(e,t){return this.hr(e,t).next(()=>this.cr(e).next(r=>(r.targetCount+=1,this.Pr(t,r),this.lr(e,r))))}updateTargetData(e,t){return this.hr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>tJ(e,td).delete(t.targetId)).next(()=>this.cr(e)).next(t=>(U(t.targetCount>0,8065),t.targetCount-=1,this.lr(e,t)))}removeTargets(e,t,r){let n=0,i=[];return tJ(e,td).X((o,a)=>{let s=i0(a);s.sequenceNumber<=t&&null===r.get(s.targetId)&&(n++,i.push(this.removeTargetData(e,s)))}).next(()=>eF.waitFor(i)).next(()=>n)}forEachTarget(e,t){return tJ(e,td).X((e,r)=>{t(i0(r))})}cr(e){return tJ(e,tw).get(tb).next(e=>(U(null!==e,2888),e))}lr(e,t){return tJ(e,tw).put(tb,t)}hr(e,t){return tJ(e,td).put(i1(this.serializer,t))}Pr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.cr(e).next(e=>e.targetCount)}getTargetData(e,t){let r=r9(t),n=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),i=null;return tJ(e,td).X({range:n,index:tf},(e,r,n)=>{let o=i0(r);ne(t,o.target)&&(i=o,n.done())}).next(()=>i)}addMatchingKeys(e,t,r){let n=[],i=oD(e);return t.forEach(t=>{let o=e2(t.path);n.push(i.put({targetId:r,path:o})),n.push(this.referenceDelegate.addReference(e,r,t))}),eF.waitFor(n)}removeMatchingKeys(e,t,r){let n=oD(e);return eF.forEach(t,t=>{let i=e2(t.path);return eF.waitFor([n.delete([r,i]),this.referenceDelegate.removeReference(e,r,t)])})}removeMatchingKeysForTargetId(e,t){let r=oD(e),n=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(n)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),n=oD(e),i=nA();return n.X({range:r,Z:!0},(e,t,r)=>{let n=new eh(e3(e[1]));i=i.add(n)}).next(()=>i)}containsKey(e,t){let r=e2(t.path),n=IDBKeyRange.bound([r],[r+"\0"],!1,!0),i=0;return oD(e).X({index:ty,Z:!0,range:n},([e,t],r,n)=>{0!==e&&(i++,n.done())}).next(()=>i>0)}Et(e,t){return tJ(e,td).get(t).next(e=>e?i0(e):null)}}function oD(e){return tJ(e,tm)}let oN="LruGarbageCollector";function oR([e,t],[r,n]){let i=er(e,r);return 0===i?er(t,n):i}class oL{constructor(e){this.Tr=e,this.buffer=new t3(oR),this.Ir=0}dr(){return++this.Ir}Er(e){let t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>oR(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class oj{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Ar=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return null!==this.Ar}Rr(e){R(oN,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Ar=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){eH(e)?R(oN,"Ignoring IndexedDB error during garbage collection: ",e):await ej(e)}await this.Rr(3e5)})}}class oF{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return eF.resolve(eX.ue);let r=new oL(t);return this.Vr.forEachTarget(e,e=>r.Er(e.sequenceNumber)).next(()=>this.Vr.gr(e,e=>r.Er(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(R("LruGarbageCollector","Garbage collection skipped; disabled"),eF.resolve(oI)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(R("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),oI):this.pr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let r,n,i,o,a,s,u,c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(R("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,o=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,a=Date.now(),this.removeTargets(e,r,t))).next(t=>(i=t,s=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(u=Date.now(),D()<=b.$b.DEBUG&&R("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-c}ms
	Determined least recently used ${n} in `+(a-o)+"ms\n"+`	Removed ${i} targets in `+(s-a)+"ms\n"+`	Removed ${e} documents in `+(u-s)+"ms\n"+`Total Duration: ${u-c}ms`),eF.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:i,documentsRemoved:e})))}}class oG{constructor(e,t){this.db=e,this.garbageCollector=new oF(this,t)}mr(e){let t=this.yr(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}yr(e){let t=0;return this.gr(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}gr(e,t){return this.wr(e,(e,r)=>t(r))}addReference(e,t,r){return oM(e,r)}removeReference(e,t,r){return oM(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return oM(e,t)}Sr(e,t){let r;return r=!1,tJ(e,e8).ee(n=>oP(e,n,t).next(e=>(e&&(r=!0),eF.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),n=[],i=0;return this.wr(e,(o,a)=>{if(a<=t){let t=this.Sr(e,o).next(t=>{if(!t)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,eI.min()),oD(e).delete([0,e2(o.path)])))});n.push(t)}}).next(()=>eF.waitFor(n)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return oM(e,t)}wr(e,t){let r=oD(e),n,i=eX.ue;return r.X({index:ty},([e,r],{path:o,sequenceNumber:a})=>{0===e?(i!==eX.ue&&t(new eh(e3(n)),i),i=a,n=o):i=eX.ue}).next(()=>{i!==eX.ue&&t(new eh(e3(n)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function oM(e,t){var r;return oD(e).put((r=e.currentSequenceNumber,{targetId:0,path:e2(t.path),sequenceNumber:r}))}class oU{constructor(){this.changes=new nS(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,rU.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return void 0!==r?eF.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class oV{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return tJ(e,ti).put(r)}removeEntry(e,t,r){return tJ(e,ti).delete(function(e,t){let r=e.path.toArray();return[r.slice(0,r.length-2),r[r.length-2],iQ(t),r[r.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.br(e,r)))}getEntry(e,t){let r=rU.newInvalidDocument(t);return tJ(e,ti).X({index:ta,range:IDBKeyRange.only(oz(t))},(e,n)=>{r=this.Dr(t,n)}).next(()=>r)}vr(e,t){let r={size:0,document:rU.newInvalidDocument(t)};return tJ(e,ti).X({index:ta,range:IDBKeyRange.only(oz(t))},(e,n)=>{r={document:this.Dr(t,n),size:ok(n)}}).next(()=>r)}getEntries(e,t){let r=nx;return this.Cr(e,t,(e,t)=>{let n=this.Dr(e,t);r=r.insert(e,n)}).next(()=>r)}Fr(e,t){let r=nx,n=new t0(eh.comparator);return this.Cr(e,t,(e,t)=>{let i=this.Dr(e,t);r=r.insert(e,i),n=n.insert(e,ok(t))}).next(()=>({documents:r,Mr:n}))}Cr(e,t,r){if(t.isEmpty())return eF.resolve();let n=new t3(oq);t.forEach(e=>n=n.add(e));let i=IDBKeyRange.bound(oz(n.first()),oz(n.last())),o=n.getIterator(),a=o.getNext();return tJ(e,ti).X({index:ta,range:i},(e,t,n)=>{let i=eh.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>oq(a,i);)r(a,null),a=o.getNext();a&&a.isEqual(i)&&(r(a,t),a=o.hasNext()?o.getNext():null),a?n.G(oz(a)):n.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,n,i){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),iQ(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],s=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return tJ(e,ti).j(IDBKeyRange.bound(a,s,!0)).next(e=>{null==i||i.incrementDocumentReadCount(e.length);let r=nx;for(let i of e){let e=this.Dr(eh.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(nv(t,e)||n.has(e.key))&&(r=r.insert(e.key,e))}return r})}getAllFromCollectionGroup(e,t,r,n){let i=nx,o=oH(t,r),a=oH(t,eD.max());return tJ(e,ti).X({index:tu,range:IDBKeyRange.bound(o,a,!0)},(e,t,r)=>{let o=this.Dr(eh.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(o.key,o)).size===n&&r.done()}).next(()=>i)}newChangeBuffer(e){return new oB(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return tJ(e,tl).get(th).next(e=>(U(!!e,20021),e))}br(e,t){return tJ(e,tl).put(th,t)}Dr(e,t){if(t){let e=function(e,t){let r;if(t.document)r=iF(e.gt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=eh.fromSegments(t.noDocument.path),n=iX(t.noDocument.readTime);r=rU.newNoDocument(e,n),t.hasCommittedMutations&&r.setHasCommittedMutations()}else{if(!t.unknownDocument)return G(56709);{let e=eh.fromSegments(t.unknownDocument.path),n=iX(t.unknownDocument.version);r=rU.newUnknownDocument(e,n)}}return t.readTime&&r.setReadTime(function(e){let t=new ex(e[0],e[1]);return eI.fromTimestamp(t)}(t.readTime)),r}(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(eI.min())))return e}return rU.newInvalidDocument(e)}}class oB extends oU{constructor(e,t){super(),this.Or=e,this.trackRemovals=t,this.Nr=new nS(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],r=0,n=new t3((e,t)=>er(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,o)=>{let a=this.Nr.get(i);if(t.push(this.Or.removeEntry(e,i,a.readTime)),o.isValidDocument()){let s=iJ(this.Or.serializer,o);n=n.add(i.path.popLast());let u=ok(s);r+=u-a.size,t.push(this.Or.addEntry(e,i,s))}else if(r-=a.size,this.trackRemovals){let r=iJ(this.Or.serializer,o.convertToNoDocument(eI.min()));t.push(this.Or.addEntry(e,i,r))}}),n.forEach(r=>{t.push(this.Or.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.Or.updateMetadata(e,r)),eF.waitFor(t)}getFromCache(e,t){return this.Or.vr(e,t).next(e=>(this.Nr.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Or.Fr(e,t).next(({documents:e,Mr:t})=>(t.forEach((t,r)=>{this.Nr.set(t,{size:r,readTime:e.get(t).readTime})}),e))}}function oz(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function oH(e,t){let r=t.documentKey.path.toArray();return[e,iQ(t.readTime),r.slice(0,r.length-2),r.length>0?r[r.length-1]:""]}function oq(e,t){let r=e.path.toArray(),n=t.path.toArray(),i=0;for(let e=0;e<r.length-2&&e<n.length-2;++e)if(i=er(r[e],n[e]))return i;return(i=er(r.length,n.length))||(i=er(r[r.length-2],n[n.length-2]))||er(r[r.length-1],n[n.length-1])}class o${constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class oK{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&nQ(r.mutation,e,t5.empty(),ex.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,nA()).next(()=>t))}getLocalViewOfDocuments(e,t,r=nA()){let n=nk();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=nE();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let r=nk();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,nA()))}populateOverlays(e,t,r){let n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let i=nx,o=nk(),a=nk();return t.forEach((e,t)=>{let a=r.get(t.key);n.has(t.key)&&(void 0===a||a.mutation instanceof nZ)?i=i.insert(t.key,t):void 0!==a?(o.set(t.key,a.mutation.getFieldMask()),nQ(a.mutation,t,a.mutation.getFieldMask(),ex.now())):o.set(t.key,t5.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>o.set(e,t)),t.forEach((e,t)=>{var r;return a.set(e,new o$(t,null!=(r=o.get(e))?r:null))}),a))}recalculateAndSaveOverlays(e,t){let r=nk(),n=new t0((e,t)=>e-t),i=nA();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let o=t.get(e);if(null===o)return;let a=r.get(e)||t5.empty();a=i.applyToLocalView(o,a),r.set(e,a);let s=(n.get(i.batchId)||nA()).add(e);n=n.insert(i.batchId,s)})}).next(()=>{let o=[],a=n.getReverseIterator();for(;a.hasNext();){let n=a.getNext(),s=n.key,u=n.value,c=nk();u.forEach(e=>{if(!i.has(e)){let n=nJ(t.get(e),r.get(e));null!==n&&c.set(e,n),i=i.add(e)}}),o.push(this.documentOverlayCache.saveOverlays(e,s,c))}return eF.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return eh.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):nu(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(i=>{let o=n-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-i.size):eF.resolve(nk()),a=-1,s=i;return o.next(t=>eF.forEach(t,(t,r)=>(a<r.largestBatchId&&(a=r.largestBatchId),i.get(t)?eF.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{s=s.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,s,t,nA())).next(e=>({batchId:a,changes:nT(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new eh(t)).next(e=>{let t=nE();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){let i=t.collectionGroup,o=nE();return this.indexManager.getCollectionParents(e,i).next(a=>eF.forEach(a,a=>{let s=new no(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,s,r,n).next(e=>{e.forEach((e,t)=>{o=o.insert(e,t)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,n))).next(e=>{i.forEach((t,r)=>{let n=r.getKey();null===e.get(n)&&(e=e.insert(n,rU.newInvalidDocument(n)))});let r=nE();return e.forEach((e,n)=>{let o=i.get(e);void 0!==o&&nQ(o.mutation,n,t5.empty(),ex.now()),nv(t,n)&&(r=r.insert(e,n))}),r})}}class oW{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return eF.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,{id:t.id,version:t.version,createTime:ik(t.createTime)}),eF.resolve()}getNamedQuery(e,t){return eF.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,{name:t.name,query:i2(t.bundledQuery),readTime:ik(t.readTime)}),eF.resolve()}}class oJ{constructor(){this.overlays=new t0(eh.comparator),this.kr=new Map}getOverlay(e,t){return eF.resolve(this.overlays.get(t))}getOverlays(e,t){let r=nk();return eF.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.wt(e,t,n)}),eF.resolve()}removeOverlaysForBatchId(e,t,r){let n=this.kr.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.kr.delete(r)),eF.resolve()}getOverlaysForCollection(e,t,r){let n=nk(),i=t.length+1,o=new eh(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let e=a.getNext().value,o=e.getKey();if(!t.isPrefixOf(o.path))break;o.path.length===i&&e.largestBatchId>r&&n.set(e.getKey(),e)}return eF.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let i=new t0((e,t)=>e-t),o=this.overlays.getIterator();for(;o.hasNext();){let e=o.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=i.get(e.largestBatchId);null===t&&(t=nk(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=nk(),s=i.getIterator();for(;s.hasNext()&&(s.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=n)););return eF.resolve(a)}wt(e,t,r){let n=this.overlays.get(r.key);if(null!==n){let e=this.kr.get(n.largestBatchId).delete(r.key);this.kr.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new n8(t,r));let i=this.kr.get(t);void 0===i&&(i=nA(),this.kr.set(t,i)),this.kr.set(t,i.add(r.key))}}class oQ{constructor(){this.sessionToken=t9.EMPTY_BYTE_STRING}getSessionToken(e){return eF.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,eF.resolve()}}class oY{constructor(){this.qr=new t3(oX.Qr),this.$r=new t3(oX.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){let r=new oX(e,t);this.qr=this.qr.add(r),this.$r=this.$r.add(r)}Kr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Wr(new oX(e,t))}Gr(e,t){e.forEach(e=>this.removeReference(e,t))}zr(e){let t=new eh(new eu([])),r=new oX(t,e),n=new oX(t,e+1),i=[];return this.$r.forEachInRange([r,n],e=>{this.Wr(e),i.push(e.key)}),i}jr(){this.qr.forEach(e=>this.Wr(e))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){let t=new eh(new eu([])),r=new oX(t,e),n=new oX(t,e+1),i=nA();return this.$r.forEachInRange([r,n],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new oX(e,0),r=this.qr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class oX{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return eh.comparator(e.key,t.key)||er(e.Hr,t.Hr)}static Ur(e,t){return er(e.Hr,t.Hr)||eh.comparator(e.key,t.key)}}class oZ{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new t3(oX.Qr)}checkEmpty(e){return eF.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){let i=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new n6(i,t,r,n);for(let t of(this.mutationQueue.push(o),n))this.Yr=this.Yr.add(new oX(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return eF.resolve(o)}lookupMutationBatch(e,t){return eF.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let r=this.Xr(t+1),n=r<0?0:r;return eF.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return eF.resolve(0===this.mutationQueue.length?-1:this.er-1)}getAllMutationBatches(e){return eF.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new oX(t,0),n=new oX(t,Number.POSITIVE_INFINITY),i=[];return this.Yr.forEachInRange([r,n],e=>{let t=this.Zr(e.Hr);i.push(t)}),eF.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new t3(er);return t.forEach(e=>{let t=new oX(e,0),n=new oX(e,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([t,n],e=>{r=r.add(e.Hr)})}),eF.resolve(this.ei(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=r;eh.isDocumentKey(i)||(i=i.child(""));let o=new oX(new eh(i),0),a=new t3(er);return this.Yr.forEachWhile(e=>{let t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.Hr)),!0)},o),eF.resolve(this.ei(a))}ei(e){let t=[];return e.forEach(e=>{let r=this.Zr(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){U(0===this.ti(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.Yr;return eF.forEach(t.mutations,n=>{let i=new oX(n.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.Yr=r})}rr(e){}containsKey(e,t){let r=new oX(t,0),n=this.Yr.firstAfterOrEqual(r);return eF.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,eF.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class o0{constructor(e){this.ni=e,this.docs=new t0(eh.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,n=this.docs.get(r),i=n?n.size:0,o=this.ni(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return eF.resolve(r?r.document.mutableCopy():rU.newInvalidDocument(t))}getEntries(e,t){let r=nx;return t.forEach(e=>{let t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():rU.newInvalidDocument(e))}),eF.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let i=nx,o=t.path,a=new eh(o.child("__id-9223372036854775808__")),s=this.docs.getIteratorFrom(a);for(;s.hasNext();){let{key:e,value:{document:a}}=s.getNext();if(!o.isPrefixOf(e.path))break;e.path.length>o.length+1||0>=eN(eC(a),r)||(n.has(a.key)||nv(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return eF.resolve(i)}getAllFromCollectionGroup(e,t,r,n){G(9500)}ri(e,t){return eF.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new o1(this)}getSize(e){return eF.resolve(this.size)}}class o1 extends oU{constructor(e){super(),this.Or=e}applyChanges(e){let t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.Or.addEntry(e,n)):this.Or.removeEntry(r)}),eF.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}}class o2{constructor(e){this.persistence=e,this.ii=new nS(e=>r9(e),ne),this.lastRemoteSnapshotVersion=eI.min(),this.highestTargetId=0,this.si=0,this.oi=new oY,this.targetCount=0,this._i=oO.ar()}forEachTarget(e,t){return this.ii.forEach((e,r)=>t(r)),eF.resolve()}getLastRemoteSnapshotVersion(e){return eF.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return eF.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),eF.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.si&&(this.si=t),eF.resolve()}hr(e){this.ii.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this._i=new oO(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,eF.resolve()}updateTargetData(e,t){return this.hr(t),eF.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,eF.resolve()}removeTargets(e,t,r){let n=0,i=[];return this.ii.forEach((o,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.ii.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),n++)}),eF.waitFor(i).next(()=>n)}getTargetCount(e){return eF.resolve(this.targetCount)}getTargetData(e,t){let r=this.ii.get(t)||null;return eF.resolve(r)}addMatchingKeys(e,t,r){return this.oi.Kr(t,r),eF.resolve()}removeMatchingKeys(e,t,r){this.oi.Gr(t,r);let n=this.persistence.referenceDelegate,i=[];return n&&t.forEach(t=>{i.push(n.markPotentiallyOrphaned(e,t))}),eF.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),eF.resolve()}getMatchingKeysForTargetId(e,t){let r=this.oi.Jr(t);return eF.resolve(r)}containsKey(e,t){return eF.resolve(this.oi.containsKey(t))}}class o3{constructor(e,t){this.ai={},this.overlays={},this.ui=new eX(0),this.ci=!1,this.ci=!0,this.li=new oQ,this.referenceDelegate=e(this),this.hi=new o2(this),this.indexManager=new oy,this.remoteDocumentCache=new o0(e=>this.referenceDelegate.Pi(e)),this.serializer=new iW(t),this.Ti=new oW(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new oJ,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ai[e.toKey()];return r||(r=new oZ(t,this.referenceDelegate),this.ai[e.toKey()]=r),r}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,r){R("MemoryPersistence","Starting transaction:",e);let n=new o4(this.ui.next());return this.referenceDelegate.Ii(),r(n).next(e=>this.referenceDelegate.di(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}Ei(e,t){return eF.or(Object.values(this.ai).map(r=>()=>r.containsKey(e,t)))}}class o4 extends eL{constructor(e){super(),this.currentSequenceNumber=e}}class o6{constructor(e){this.persistence=e,this.Ai=new oY,this.Ri=null}static Vi(e){return new o6(e)}get mi(){if(this.Ri)return this.Ri;throw G(60996)}addReference(e,t,r){return this.Ai.addReference(r,t),this.mi.delete(r.toString()),eF.resolve()}removeReference(e,t,r){return this.Ai.removeReference(r,t),this.mi.add(r.toString()),eF.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),eF.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach(e=>this.mi.add(e.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.mi.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}Ii(){this.Ri=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return eF.forEach(this.mi,r=>{let n=eh.fromPath(r);return this.fi(e,n).next(e=>{e||t.removeEntry(n,eI.min())})}).next(()=>(this.Ri=null,t.apply(e)))}updateLimboDocument(e,t){return this.fi(e,t).next(e=>{e?this.mi.delete(t.toString()):this.mi.add(t.toString())})}Pi(e){return 0}fi(e,t){return eF.or([()=>eF.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class o5{constructor(e,t){this.persistence=e,this.gi=new nS(e=>e2(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new oF(this,t)}static Vi(e,t){return new o5(e,t)}Ii(){}di(e){return eF.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){let t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}yr(e){let t=0;return this.gr(e,e=>{t++}).next(()=>t)}gr(e,t){return eF.forEach(this.gi,(r,n)=>this.Sr(e,r,n).next(e=>e?eF.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,n=this.persistence.getRemoteDocumentCache(),i=n.newChangeBuffer();return n.ri(e,n=>this.Sr(e,n,t).next(e=>{e||(r++,i.removeEntry(n,eI.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),eF.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),eF.resolve()}removeReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),eF.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),eF.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(rw(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let r=rc(t);return r?16+e(r):16;case 5:return 2*t.stringValue.length;case 6:return rn(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,r)=>t+e(r),0);case 10:case 11:var n;let i;return n=t.mapValue,i=0,tY(n.fields,(t,r)=>{i+=t.length+e(r)}),i;default:throw G(13486,{value:t})}}(e.data.value)),t}Sr(e,t,r){return eF.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.gi.get(t);return eF.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class o8{constructor(e){this.serializer=e}q(e,t,r,n){let i=new eM("createOrUpgrade",t);r<1&&n>=1&&(e.createObjectStore(e6),e.createObjectStore(e8,{keyPath:"userId"}),e.createObjectStore(e7,{keyPath:e9,autoIncrement:!0}).createIndex(te,tt,{unique:!0}),e.createObjectStore(tn),o7(e),e.createObjectStore(e4));let o=eF.resolve();return r<3&&n>=3&&(0!==r&&(e.deleteObjectStore(tm),e.deleteObjectStore(td),e.deleteObjectStore(tw),o7(e)),o=o.next(()=>(function(e){let t=e.store(tw),r={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:eI.min().toTimestamp(),targetCount:0};return t.put(tb,r)})(i))),r<4&&n>=4&&(0!==r&&(o=o.next(()=>i.store(e7).j().next(t=>{e.deleteObjectStore(e7),e.createObjectStore(e7,{keyPath:e9,autoIncrement:!0}).createIndex(te,tt,{unique:!0});let r=i.store(e7),n=t.map(e=>r.put(e));return eF.waitFor(n)}))),o=o.next(()=>{e.createObjectStore(tI,{keyPath:"clientId"})})),r<5&&n>=5&&(o=o.next(()=>this.pi(i))),r<6&&n>=6&&(o=o.next(()=>(e.createObjectStore(tl),this.yi(i)))),r<7&&n>=7&&(o=o.next(()=>this.wi(i))),r<8&&n>=8&&(o=o.next(()=>this.Si(e,i))),r<9&&n>=9&&(o=o.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),r<10&&n>=10&&(o=o.next(()=>this.bi(i))),r<11&&n>=11&&(o=o.next(()=>{e.createObjectStore(tE,{keyPath:"bundleId"}),e.createObjectStore(tT,{keyPath:"name"})})),r<12&&n>=12&&(o=o.next(()=>{let t=e.createObjectStore(tj,{keyPath:tF});t.createIndex(tG,tM,{unique:!1}),t.createIndex(tU,tV,{unique:!1})})),r<13&&n>=13&&(o=o.next(()=>(function(e){let t=e.createObjectStore(ti,{keyPath:to});t.createIndex(ta,ts),t.createIndex(tu,tc)})(e)).next(()=>this.Di(e,i)).next(()=>e.deleteObjectStore(e4))),r<14&&n>=14&&(o=o.next(()=>this.Ci(e,i))),r<15&&n>=15&&(o=o.next(()=>{e.createObjectStore(tk,{keyPath:"indexId",autoIncrement:!0}).createIndex(t_,"collectionGroup",{unique:!1}),e.createObjectStore(tP,{keyPath:tA}).createIndex(tO,tC,{unique:!1}),e.createObjectStore(tD,{keyPath:tN}).createIndex(tR,tL,{unique:!1})})),r<16&&n>=16&&(o=o.next(()=>{t.objectStore(tP).clear()}).next(()=>{t.objectStore(tD).clear()})),r<17&&n>=17&&(o=o.next(()=>{e.createObjectStore(tB,{keyPath:"name"})})),r<18&&n>=18&&(0,w.Ov)()&&(o=o.next(()=>{t.objectStore(tP).clear()}).next(()=>{t.objectStore(tD).clear()})),o}yi(e){let t=0;return e.store(e4).X((e,r)=>{t+=ok(r)}).next(()=>{let r={byteSize:t};return e.store(tl).put(th,r)})}pi(e){let t=e.store(e8),r=e.store(e7);return t.j().next(t=>eF.forEach(t,t=>{let n=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return r.j(te,n).next(r=>eF.forEach(r,r=>{U(r.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:r.batchId});let n=iZ(this.serializer,r);return oT(e,t.userId,n).next(()=>{})}))}))}wi(e){let t=e.store(tm),r=e.store(e4);return e.store(tw).get(tb).next(e=>{let n=[];return r.X((r,i)=>{let o=new eu(r),a=[0,e2(o)];n.push(t.get(a).next(r=>r?eF.resolve():t.put({targetId:0,path:e2(o),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>eF.waitFor(n))})}Si(e,t){e.createObjectStore(tS,{keyPath:tx});let r=t.store(tS),n=new ov,i=e=>{if(n.add(e)){let t=e.lastSegment(),n=e.popLast();return r.put({collectionId:t,parent:e2(n)})}};return t.store(e4).X({Z:!0},(e,t)=>i(new eu(e).popLast())).next(()=>t.store(tn).X({Z:!0},([e,t,r],n)=>i(e3(t).popLast())))}bi(e){let t=e.store(td);return t.X((e,r)=>{let n=i0(r),i=i1(this.serializer,n);return t.put(i)})}Di(e,t){let r=t.store(e4),n=[];return r.X((e,r)=>{let i=t.store(ti),o=(r.document?new eh(eu.fromString(r.document.name).popFirst(5)):r.noDocument?eh.fromSegments(r.noDocument.path):r.unknownDocument?eh.fromSegments(r.unknownDocument.path):G(36783)).path.toArray(),a={prefixPath:o.slice(0,o.length-2),collectionGroup:o[o.length-2],documentId:o[o.length-1],readTime:r.readTime||[0,0],unknownDocument:r.unknownDocument,noDocument:r.noDocument,document:r.document,hasCommittedMutations:!!r.hasCommittedMutations};n.push(i.put(a))}).next(()=>eF.waitFor(n))}Ci(e,t){let r=t.store(e7),n=new oV(this.serializer),i=new o3(o6.Vi,this.serializer.gt);return r.j().next(e=>{let r=new Map;return e.forEach(e=>{var t;let n=null!=(t=r.get(e.userId))?t:nA();iZ(this.serializer,e).keys().forEach(e=>n=n.add(e)),r.set(e.userId,n)}),eF.forEach(r,(e,r)=>{let o=new A(r),a=i8.yt(this.serializer,o),s=i.getIndexManager(o);return new oK(n,o_.yt(o,this.serializer,s,i.referenceDelegate),a,s).recalculateAndSaveOverlaysForDocumentKeys(new tW(t,eX.ue),e).next()})})}}function o7(e){e.createObjectStore(tm,{keyPath:tg}).createIndex(ty,tv,{unique:!0}),e.createObjectStore(td,{keyPath:"targetId"}).createIndex(tf,tp,{unique:!0}),e.createObjectStore(tw)}let o9="IndexedDbPersistence",ae="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",at="main";class ar{constructor(e,t,r,n,i,o,a,s,u,c,l=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Fi=i,this.window=o,this.document=a,this.Mi=u,this.xi=c,this.Oi=l,this.ui=null,this.ci=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ni=null,this.inForeground=!1,this.Bi=null,this.Li=null,this.ki=Number.NEGATIVE_INFINITY,this.qi=e=>Promise.resolve(),!ar.C())throw new z(B.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new oG(this,n),this.Qi=t+at,this.serializer=new iW(s),this.$i=new eU(this.Qi,this.Oi,new o8(this.serializer)),this.li=new i7,this.hi=new oC(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new oV(this.serializer),this.Ti=new i5,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,!1===c&&L(o9,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ki().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new z(B.FAILED_PRECONDITION,ae);return this.Wi(),this.Gi(),this.zi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.hi.getHighestSequenceNumber(e))}).then(e=>{this.ui=new eX(e,this.Mi)}).then(()=>{this.ci=!0}).catch(e=>(this.$i&&this.$i.close(),Promise.reject(e)))}ji(e){return this.qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.$i.setDatabaseDeletedListener(e)}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Fi.enqueueAndForget(async()=>{this.started&&await this.Ki()}))}Ki(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>tJ(e,tI).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Ji(e).next(e=>{e||(this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)))})}).next(()=>this.Hi(e)).next(t=>this.isPrimary&&!t?this.Yi(e).next(()=>!1):!!t&&this.Zi(e).next(()=>!0))).catch(e=>{if(eH(e))return R(o9,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return R(o9,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Fi.enqueueRetryable(()=>this.qi(e)),this.isPrimary=e})}Ji(e){return tJ(e,e6).get(e5).next(e=>eF.resolve(this.Xi(e)))}es(e){return tJ(e,tI).delete(this.clientId)}async ts(){if(this.isPrimary&&!this.ns(this.ki,18e5)){this.ki=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=tJ(e,tI);return t.j().next(e=>{let r=this.rs(e,18e5),n=e.filter(e=>-1===r.indexOf(e));return eF.forEach(n,e=>t.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.Ui)for(let t of e)this.Ui.removeItem(this.ss(t.clientId))}}zi(){this.Li=this.Fi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ki().then(()=>this.ts()).then(()=>this.zi()))}Xi(e){return!!e&&e.ownerId===this.clientId}Hi(e){return this.xi?eF.resolve(!0):tJ(e,e6).get(e5).next(t=>{if(null!==t&&this.ns(t.leaseTimestampMs,5e3)&&!this._s(t.ownerId)){if(this.Xi(t)&&this.networkEnabled)return!0;if(!this.Xi(t)){if(!t.allowTabSynchronization)throw new z(B.FAILED_PRECONDITION,ae);return!1}}return!(!this.networkEnabled||!this.inForeground)||tJ(e,tI).j().next(e=>void 0===this.rs(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,r=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(t||r&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&R(o9,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.ci=!1,this.us(),this.Li&&(this.Li.cancel(),this.Li=null),this.cs(),this.ls(),await this.$i.runTransaction("shutdown","readwrite",[e6,tI],e=>{let t=new tW(e,eX.ue);return this.Yi(t).next(()=>this.es(t))}),this.$i.close(),this.hs()}rs(e,t){return e.filter(e=>this.ns(e.updateTimeMs,t)&&!this._s(e.clientId))}Ps(){return this.runTransaction("getActiveClients","readonly",e=>tJ(e,tI).j().next(e=>this.rs(e,18e5).map(e=>e.clientId)))}get started(){return this.ci}getGlobalsCache(){return this.li}getMutationQueue(e,t){return o_.yt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new oS(e,this.serializer.gt.databaseId)}getDocumentOverlayCache(e){return i8.yt(this.serializer,e)}getBundleCache(){return this.Ti}runTransaction(e,t,r){var n;let i;R(o9,"Starting transaction:",e);let o=18===(n=this.Oi)||17===n?tK:16===n||15===n?t$:14===n||13===n?tq:12===n?tH:11===n?tz:void G(60245);return this.$i.runTransaction(e,"readonly"===t?"readonly":"readwrite",o,n=>(i=new tW(n,this.ui?this.ui.next():eX.ue),"readwrite-primary"===t?this.Ji(i).next(e=>!!e||this.Hi(i)).next(t=>{if(!t)throw L(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)),new z(B.FAILED_PRECONDITION,eR);return r(i)}).next(e=>this.Zi(i).next(()=>e)):this.Ts(i).next(()=>r(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}Ts(e){return tJ(e,e6).get(e5).next(e=>{if(null!==e&&this.ns(e.leaseTimestampMs,5e3)&&!this._s(e.ownerId)&&!this.Xi(e)&&!(this.xi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new z(B.FAILED_PRECONDITION,ae)})}Zi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return tJ(e,e6).put(e5,t)}static C(){return eU.C()}Yi(e){let t=tJ(e,e6);return t.get(e5).next(e=>this.Xi(e)?(R(o9,"Releasing primary lease."),t.delete(e5)):eF.resolve())}ns(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(L(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Wi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Bi=()=>{this.Fi.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Ki()))},this.document.addEventListener("visibilitychange",this.Bi),this.inForeground="visible"===this.document.visibilityState)}cs(){this.Bi&&(this.document.removeEventListener("visibilitychange",this.Bi),this.Bi=null)}Gi(){var e;"function"==typeof(null==(e=this.window)?void 0:e.addEventListener)&&(this.Ni=()=>{this.us();let e=/(?:Version|Mobile)\/1[456]/;(0,w.nr)()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Fi.enterRestrictedMode(!0),this.Fi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ni))}ls(){this.Ni&&(this.window.removeEventListener("pagehide",this.Ni),this.Ni=null)}_s(e){var t;try{let r=null!==(null==(t=this.Ui)?void 0:t.getItem(this.ss(e)));return R(o9,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(e){return L(o9,"Failed to get zombied client id.",e),!1}}us(){if(this.Ui)try{this.Ui.setItem(this.ss(this.clientId),String(Date.now()))}catch(e){L("Failed to set zombie client id.",e)}}hs(){if(this.Ui)try{this.Ui.removeItem(this.ss(this.clientId))}catch(e){}}ss(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function an(e,t){let r=e.projectId;return e.isDefaultDatabase||(r+="."+e.database),"firestore/"+t+"/"+r+"/"}class ai{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.Is=r,this.ds=n}static Es(e,t){let r=nA(),n=nA();for(let e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new ai(e,t.fromCache,r,n)}}class ao{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class aa{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=(0,w.nr)()?8:eV((0,w.ZQ)())>0?6:4}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,r,n){let i={result:null};return this.ps(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ys(e,t,n,r).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let r=new ao;return this.ws(e,t,r).next(n=>{if(i.result=n,this.Rs)return this.Ss(e,t,r,n.size)})}).next(()=>i.result)}Ss(e,t,r,n){return r.documentReadCount<this.Vs?(D()<=b.$b.DEBUG&&R("QueryEngine","SDK will not create cache indexes for query:",ny(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),eF.resolve()):(D()<=b.$b.DEBUG&&R("QueryEngine","Query:",ny(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.fs*n?(D()<=b.$b.DEBUG&&R("QueryEngine","The SDK decides to create cache indexes for query:",ny(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,nl(t))):eF.resolve())}ps(e,t){if(ns(t))return eF.resolve(null);let r=nl(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(r=nl(t=np(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{let i=nA(...n);return this.gs.getDocuments(e,i).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{let o=this.bs(t,n);return this.Ds(t,o,i,r.readTime)?this.ps(e,np(t,null,"F")):this.vs(e,o,t,r)}))})))}ys(e,t,r,n){return ns(t)||n.isEqual(eI.min())?eF.resolve(null):this.gs.getDocuments(e,r).next(i=>{let o=this.bs(t,i);return this.Ds(t,o,r,n)?eF.resolve(null):(D()<=b.$b.DEBUG&&R("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),ny(t)),this.vs(e,o,t,eO(n,-1)).next(e=>e))})}bs(e,t){let r=new t3(nw(e));return t.forEach((t,n)=>{nv(e,n)&&(r=r.add(n))}),r}Ds(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(n)>0)}ws(e,t,r){return D()<=b.$b.DEBUG&&R("QueryEngine","Using full collection scan to execute query:",ny(t)),this.gs.getDocumentsMatchingQuery(e,t,eD.min(),r)}vs(e,t,r,n){return this.gs.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let as="LocalStore";class au{constructor(e,t,r,n){this.persistence=e,this.Cs=t,this.serializer=n,this.Fs=new t0(er),this.Ms=new nS(e=>r9(e),ne),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(r)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new oK(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Fs))}}async function ac(e,t){return await e.persistence.runTransaction("Handle user change","readonly",r=>{let n;return e.mutationQueue.getAllMutationBatches(r).next(i=>(n=i,e.Ns(t),e.mutationQueue.getAllMutationBatches(r))).next(t=>{let i=[],o=[],a=nA();for(let e of n)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(o.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(r,a).next(e=>({Bs:e,removedBatchIds:i,addedBatchIds:o}))})})}function al(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.hi.getLastRemoteSnapshotVersion(t))}function ah(e,t,r){let n=nA(),i=nA();return r.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=nx;return r.forEach((r,o)=>{let a=e.get(r);o.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(r)),o.isNoDocument()&&o.version.isEqual(eI.min())?(t.removeEntry(r,o.readTime),n=n.insert(r,o)):!a.isValidDocument()||o.version.compareTo(a.version)>0||0===o.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(o),n=n.insert(r,o)):R(as,"Ignoring outdated watch update for ",r,". Current version:",a.version," Watch version:",o.version)}),{Ls:n,ks:i}})}function ad(e,t){return e.persistence.runTransaction("Allocate target","readwrite",r=>{let n;return e.hi.getTargetData(r,t).next(i=>i?(n=i,eF.resolve(n)):e.hi.allocateTargetId(r).next(i=>(n=new iK(t,i,"TargetPurposeListen",r.currentSequenceNumber),e.hi.addTargetData(r,n).next(()=>n))))}).then(r=>{let n=e.Fs.get(r.targetId);return(null===n||r.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(e.Fs=e.Fs.insert(r.targetId,r),e.Ms.set(t,r.targetId)),r})}async function af(e,t,r){let n=e.Fs.get(t);try{r||await e.persistence.runTransaction("Release target",r?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,n))}catch(e){if(!eH(e))throw e;R(as,`Failed to update sequence numbers for target ${t}: ${e}`)}e.Fs=e.Fs.remove(t),e.Ms.delete(n.target)}function ap(e,t,r){let n=eI.min(),i=nA();return e.persistence.runTransaction("Execute query","readwrite",o=>(function(e,t,r){let n=e.Ms.get(r);return void 0!==n?eF.resolve(e.Fs.get(n)):e.hi.getTargetData(t,r)})(e,o,nl(t)).next(t=>{if(t)return n=t.lastLimboFreeSnapshotVersion,e.hi.getMatchingKeysForTargetId(o,t.targetId).next(e=>{i=e})}).next(()=>e.Cs.getDocumentsMatchingQuery(o,t,r?n:eI.min(),r?i:nA())).next(r=>(ay(e,nb(t),r),{documents:r,qs:i})))}function am(e,t){let r=e.hi,n=e.Fs.get(t);return n?Promise.resolve(n.target):e.persistence.runTransaction("Get target data","readonly",e=>r.Et(e,t).next(e=>e?e.target:null))}function ag(e,t){let r=e.xs.get(t)||eI.min();return e.persistence.runTransaction("Get new document changes","readonly",n=>e.Os.getAllFromCollectionGroup(n,t,eO(r,-1),Number.MAX_SAFE_INTEGER)).then(r=>(ay(e,t,r),r))}function ay(e,t,r){let n=e.xs.get(t)||eI.min();r.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.xs.set(t,n)}async function av(e,t,r,n){let i=nA(),o=nx;for(let e of r){let r=t.Qs(e.metadata.name);e.document&&(i=i.add(r));let n=t.$s(e);n.setReadTime(t.Us(e.metadata.readTime)),o=o.insert(r,n)}let a=e.Os.newChangeBuffer({trackRemovals:!0}),s=await ad(e,nl(na(eu.fromString(`__bundle__/docs/${n}`))));return e.persistence.runTransaction("Apply bundle documents","readwrite",t=>ah(t,a,o).next(e=>(a.apply(t),e)).next(r=>e.hi.removeMatchingKeysForTargetId(t,s.targetId).next(()=>e.hi.addMatchingKeys(t,i,s.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(t,r.Ls,r.ks)).next(()=>r.Ls)))}async function ab(e,t,r=nA()){let n=await ad(e,nl(i2(t.bundledQuery)));return e.persistence.runTransaction("Save named query","readwrite",i=>{let o=ik(t.readTime);if(n.snapshotVersion.compareTo(o)>=0)return e.Ti.saveNamedQuery(i,t);let a=n.withResumeToken(t9.EMPTY_BYTE_STRING,o);return e.Fs=e.Fs.insert(a.targetId,a),e.hi.updateTargetData(i,a).next(()=>e.hi.removeMatchingKeysForTargetId(i,n.targetId)).next(()=>e.hi.addMatchingKeys(i,r,n.targetId)).next(()=>e.Ti.saveNamedQuery(i,t))})}let aw="firestore_clients";function aS(e,t){return`${aw}_${e}_${t}`}let ax="firestore_mutations";function aI(e,t,r){let n=`${ax}_${e}_${r}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}let aE="firestore_targets";function aT(e,t){return`${aE}_${e}_${t}`}let ak="SharedClientState";class a_{constructor(e,t,r,n){this.user=e,this.batchId=t,this.state=r,this.error=n}static Ks(e,t,r){let n=JSON.parse(r),i,o="object"==typeof n&&-1!==["pending","acknowledged","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return o&&n.error&&(o="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new z(n.error.code,n.error.message)),o?new a_(e,t,n.state,i):(L(ak,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class aP{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ks(e,t){let r=JSON.parse(t),n,i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(n=new z(r.error.code,r.error.message)),i?new aP(e,r.state,n):(L(ak,`Failed to parse target state for ID '${e}': ${t}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class aA{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ks(e,t){let r=JSON.parse(t),n="object"==typeof r&&r.activeTargetIds instanceof Array,i=nO;for(let e=0;n&&e<r.activeTargetIds.length;++e)n=e1(r.activeTargetIds[e]),i=i.add(r.activeTargetIds[e]);return n?new aA(e,i):(L(ak,`Failed to parse client data for instance '${e}': ${t}`),null)}}class aO{constructor(e,t){this.clientId=e,this.onlineState=t}static Ks(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new aO(t.clientId,t.onlineState):(L(ak,`Failed to parse online state: ${e}`),null)}}class aC{constructor(){this.activeTargetIds=nO}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class aD{constructor(e,t,r,n,i){var o,a,s;this.window=e,this.Fi=t,this.persistenceKey=r,this.js=n,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Js=this.Hs.bind(this),this.Ys=new t0(er),this.started=!1,this.Zs=[];let u=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Xs=aS(this.persistenceKey,this.js),this.eo=(o=this.persistenceKey,`firestore_sequence_number_${o}`),this.Ys=this.Ys.insert(this.js,new aC),this.no=RegExp(`^${aw}_${u}_([^_]*)$`),this.ro=RegExp(`^${ax}_${u}_(\\d+)(?:_(.*))?$`),this.io=RegExp(`^${aE}_${u}_(\\d+)$`),this.so=(a=this.persistenceKey,`firestore_online_state_${a}`),this.oo=(s=this.persistenceKey,`firestore_bundle_loaded_v2_${s}`),this.window.addEventListener("storage",this.Js)}static C(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.Ps())){if(e===this.js)continue;let t=this.getItem(aS(this.persistenceKey,e));if(t){let r=aA.Ks(e,t);r&&(this.Ys=this.Ys.insert(r.clientId,r))}}this._o();let e=this.storage.getItem(this.so);if(e){let t=this.ao(e);t&&this.uo(t)}for(let e of this.Zs)this.Hs(e);this.Zs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.eo,JSON.stringify(e))}getAllActiveQueryTargets(){return this.co(this.Ys)}isActiveQueryTarget(e){let t=!1;return this.Ys.forEach((r,n)=>{n.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.lo(e,"pending")}updateMutationState(e,t,r){this.lo(e,t,r),this.ho(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(aT(this.persistenceKey,e));if(t){let n=aP.Ks(e,t);n&&(r=n.state)}}return t&&this.Po.Gs(e),this._o(),r}removeLocalQueryTarget(e){this.Po.zs(e),this._o()}isLocalQueryTarget(e){return this.Po.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(aT(this.persistenceKey,e))}updateQueryState(e,t,r){this.To(e,t,r)}handleUserChange(e,t,r){t.forEach(e=>{this.ho(e)}),this.currentUser=e,r.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.Io(e)}notifyBundleLoaded(e){this.Eo(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Js),this.removeItem(this.Xs),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return R(ak,"READ",e,t),t}setItem(e,t){R(ak,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){R(ak,"REMOVE",e),this.storage.removeItem(e)}Hs(e){if(e.storageArea===this.storage){if(R(ak,"EVENT",e.key,e.newValue),e.key===this.Xs)return void L("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Fi.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.no.test(e.key)){if(null==e.newValue){let t=this.Ao(e.key);return this.Ro(t,null)}{let t=this.Vo(e.key,e.newValue);if(t)return this.Ro(t.clientId,t)}}else if(this.ro.test(e.key)){if(null!==e.newValue){let t=this.mo(e.key,e.newValue);if(t)return this.fo(t)}}else if(this.io.test(e.key)){if(null!==e.newValue){let t=this.po(e.key,e.newValue);if(t)return this.yo(t)}}else if(e.key===this.so){if(null!==e.newValue){let t=this.ao(e.newValue);if(t)return this.uo(t)}}else if(e.key===this.eo){let t=function(e){let t=eX.ue;if(null!=e)try{let r=JSON.parse(e);U("number"==typeof r,30636,{wo:e}),t=r}catch(e){L(ak,"Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==eX.ue&&this.sequenceNumberHandler(t)}else if(e.key===this.oo){let t=this.So(e.newValue);await Promise.all(t.map(e=>this.syncEngine.bo(e)))}}}else this.Zs.push(e)})}}get Po(){return this.Ys.get(this.js)}_o(){this.setItem(this.Xs,this.Po.Ws())}lo(e,t,r){let n=new a_(this.currentUser,e,t,r),i=aI(this.persistenceKey,this.currentUser,e);this.setItem(i,n.Ws())}ho(e){let t=aI(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Io(e){let t={clientId:this.js,onlineState:e};this.storage.setItem(this.so,JSON.stringify(t))}To(e,t,r){let n=aT(this.persistenceKey,e),i=new aP(e,t,r);this.setItem(n,i.Ws())}Eo(e){let t=JSON.stringify(Array.from(e));this.setItem(this.oo,t)}Ao(e){let t=this.no.exec(e);return t?t[1]:null}Vo(e,t){let r=this.Ao(e);return aA.Ks(r,t)}mo(e,t){let r=this.ro.exec(e),n=Number(r[1]),i=void 0!==r[2]?r[2]:null;return a_.Ks(new A(i),n,t)}po(e,t){let r=Number(this.io.exec(e)[1]);return aP.Ks(r,t)}ao(e){return aO.Ks(e)}So(e){return JSON.parse(e)}async fo(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Do(e.batchId,e.state,e.error);R(ak,`Ignoring mutation for non-active user ${e.user.uid}`)}yo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Ro(e,t){let r=t?this.Ys.insert(e,t):this.Ys.remove(e),n=this.co(this.Ys),i=this.co(r),o=[],a=[];return i.forEach(e=>{n.has(e)||o.push(e)}),n.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.Co(o,a).then(()=>{this.Ys=r})}uo(e){this.Ys.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}co(e){let t=nO;return e.forEach((e,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}class aN{constructor(){this.Fo=new aC,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,r){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new aC,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class aR{xo(e){}shutdown(){}}let aL="ConnectivityMonitor";class aj{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){for(let e of(R(aL,"Network connectivity changed: AVAILABLE"),this.ko))e(0)}Lo(){for(let e of(R(aL,"Network connectivity changed: UNAVAILABLE"),this.ko))e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let aF=null;function aG(){return null===aF?aF=0x10000000+Math.round(0x80000000*Math.random()):aF++,"0x"+aF.toString(16)}let aM="RestConnection",aU={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class aV{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${r}/databases/${n}`,this.Ko=this.databaseId.database===rd?`project_id=${r}`:`project_id=${r}&database_id=${n}`}Wo(e,t,r,n,i){let o=aG(),a=this.Go(e,t.toUriEncodedString());R(aM,`Sending RPC '${e}' ${o}:`,a,r);let s={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(s,n,i);let{host:u}=new URL(a),c=(0,w.zJ)(u);return this.jo(e,a,s,r,c).then(t=>(R(aM,`Received RPC '${e}' ${o}: `,t),t),t=>{throw j(aM,`RPC '${e}' ${o} failed with error: `,t,"url: ",a,"request:",r),t})}Jo(e,t,r,n,i,o){return this.Wo(e,t,r,n,i)}zo(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+O,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,r)=>e[r]=t),r&&r.headers.forEach((t,r)=>e[r]=t)}Go(e,t){let r=aU[e];return`${this.$o}/v1/${t}:${r}`}terminate(){}}class aB{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}}let az="WebChannelConnection";class aH extends aV{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,r,n,i){let a=aG();return new Promise((i,c)=>{let l=new o;l.setWithCredentials(!0),l.listenOnce(s.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case u.NO_ERROR:let t=l.getResponseJson();R(az,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(t)),i(t);break;case u.TIMEOUT:R(az,`RPC '${e}' ${a} timed out`),c(new z(B.DEADLINE_EXCEEDED,"Request time out"));break;case u.HTTP_ERROR:let r=l.getStatus();if(R(az,`RPC '${e}' ${a} failed with status:`,r,"response text:",l.getResponseText()),r>0){let e=l.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=null==e?void 0:e.error;if(t&&t.status&&t.message){let e=function(e){let t=e.toLowerCase().replace(/_/g,"-");return Object.values(B).indexOf(t)>=0?t:B.UNKNOWN}(t.status);c(new z(e,t.message))}else c(new z(B.UNKNOWN,"Server responded with status "+l.getStatus()))}else c(new z(B.UNAVAILABLE,"Connection failed."));break;default:G(9055,{c_:e,streamId:a,l_:l.getLastErrorCode(),h_:l.getLastError()})}}finally{R(az,`RPC '${e}' ${a} completed.`)}});let h=JSON.stringify(n);R(az,`RPC '${e}' ${a} sending request:`,n),l.send(t,"POST",h,r,15)})}P_(e,t,r){let n=aG(),i=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=d(),s=h(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},p=this.longPollingOptions.timeoutSeconds;void 0!==p&&(u.longPollingTimeout=Math.round(1e3*p)),this.useFetchStreams&&(u.useFetchStreams=!0),this.zo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;let m=i.join("");R(az,`Creating RPC '${e}' stream ${n}: ${m}`,u);let g=o.createWebChannel(m,u);this.T_(g);let y=!1,v=!1,b=new aB({Ho:t=>{v?R(az,`Not sending because RPC '${e}' stream ${n} is closed:`,t):(y||(R(az,`Opening RPC '${e}' stream ${n} transport.`),g.open(),y=!0),R(az,`RPC '${e}' stream ${n} sending:`,t),g.send(t))},Yo:()=>g.close()}),w=(e,t,r)=>{e.listen(t,e=>{try{r(e)}catch(e){setTimeout(()=>{throw e},0)}})};return w(g,a.EventType.OPEN,()=>{v||(R(az,`RPC '${e}' stream ${n} transport opened.`),b.s_())}),w(g,a.EventType.CLOSE,()=>{v||(v=!0,R(az,`RPC '${e}' stream ${n} transport closed`),b.__(),this.I_(g))}),w(g,a.EventType.ERROR,t=>{v||(v=!0,j(az,`RPC '${e}' stream ${n} transport errored. Name:`,t.name,"Message:",t.message),b.__(new z(B.UNAVAILABLE,"The operation could not be completed")))}),w(g,a.EventType.MESSAGE,t=>{var r;if(!v){let i=t.data[0];U(!!i,16349);let o=(null==i?void 0:i.error)||(null==(r=i[0])?void 0:r.error);if(o){R(az,`RPC '${e}' stream ${n} received error:`,o);let t=o.status,r=function(e){let t=f[e];if(void 0!==t)return it(t)}(t),i=o.message;void 0===r&&(r=B.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),v=!0,b.__(new z(r,i)),g.close()}else R(az,`RPC '${e}' stream ${n} received:`,i),b.a_(i)}}),w(s,l.STAT_EVENT,t=>{t.stat===c.PROXY?R(az,`RPC '${e}' stream ${n} detected buffering proxy`):t.stat===c.NOPROXY&&R(az,`RPC '${e}' stream ${n} detected no buffering proxy`)}),setTimeout(()=>{b.o_()},0),b}terminate(){this.u_.forEach(e=>e.close()),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter(t=>t===e)}}function aq(){return"undefined"!=typeof window?window:null}function a$(){return"undefined"!=typeof document?document:null}function aK(e){return new ix(e,!0)}class aW{constructor(e,t,r=1e3,n=1.5,i=6e4){this.Fi=e,this.timerId=t,this.d_=r,this.E_=n,this.A_=i,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();let t=Math.floor(this.R_+this.p_()),r=Math.max(0,Date.now()-this.m_),n=Math.max(0,t-r);n>0&&R("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,n,()=>(this.m_=Date.now(),e())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){null!==this.V_&&(this.V_.skipDelay(),this.V_=null)}cancel(){null!==this.V_&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}}let aJ="PersistentStream";class aQ{constructor(e,t,r,n,i,o,a,s){this.Fi=e,this.w_=r,this.S_=n,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=s,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new aW(e,t)}M_(){return 1===this.state||5===this.state||this.x_()}x_(){return 2===this.state||3===this.state}start(){this.C_=0,4!==this.state?this.auth():this.O_()}async stop(){this.M_()&&await this.close(0)}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&null===this.D_&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(e){this.q_(),this.stream.send(e)}async L_(){if(this.x_())return this.close(0)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,4!==e?this.F_.reset():t&&t.code===B.RESOURCE_EXHAUSTED?(L(t.toString()),L("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):t&&t.code===B.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.n_(t)}U_(){}auth(){this.state=1;let e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.b_===t&&this.W_(e,r)},t=>{e(()=>{let e=new z(B.UNKNOWN,"Fetching auth token failed: "+t.message);return this.G_(e)})})}W_(e,t){let r=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.e_(()=>{r(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(e=>{r(()=>this.G_(e))}),this.stream.onMessage(e=>{r(()=>1==++this.C_?this.j_(e):this.onNext(e))})}O_(){this.state=5,this.F_.g_(async()=>{this.state=0,this.start()})}G_(e){return R(aJ,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget(()=>this.b_===e?t():(R(aJ,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class aY extends aQ{constructor(e,t,r,n,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,o),this.serializer=i}z_(e,t){return this.connection.P_("Listen",e,t)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();let t=function(e,t){let r;if("targetChange"in t){var n,i;t.targetChange;let o="NO_CHANGE"===(n=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===n?1:"REMOVE"===n?2:"CURRENT"===n?3:"RESET"===n?4:G(39313,{state:n}),a=t.targetChange.targetIds||[],s=(i=t.targetChange.resumeToken,e.useProto3Json?(U(void 0===i||"string"==typeof i,58123),t9.fromBase64String(i||"")):(U(void 0===i||i instanceof k||i instanceof Uint8Array,16193),t9.fromUint8Array(i||new Uint8Array))),u=t.targetChange.cause;r=new ip(o,a,s,u&&new z(void 0===u.code?B.UNKNOWN:it(u.code),u.message||"")||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let i=iC(e,n.document.name),o=ik(n.document.updateTime),a=n.document.createTime?ik(n.document.createTime):eI.min(),s=new rM({mapValue:{fields:n.document.fields}}),u=rU.newFoundDocument(i,o,a,s);r=new ih(n.targetIds||[],n.removedTargetIds||[],u.key,u)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let i=iC(e,n.document),o=n.readTime?ik(n.readTime):eI.min(),a=rU.newNoDocument(i,o);r=new ih([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let i=iC(e,n.document);r=new ih([],n.removedTargetIds||[],i,null)}else{if(!("filter"in t))return G(11601,{At:t});{t.filter;let e=t.filter;e.targetId;let{count:n=0,unchangedNames:i}=e,o=new n9(n,i);r=new id(e.targetId,o)}}return r}(this.serializer,e),r=function(e){if(!("targetChange"in e))return eI.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?eI.min():t.readTime?ik(t.readTime):eI.min()}(e);return this.listener.J_(t,r)}H_(e){let t={};t.database=iR(this.serializer),t.addTarget=function(e,t){let r,n=t.target;if((r=nt(n)?{documents:iU(e,n)}:{query:iV(e,n).Vt}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=iT(e,t.resumeToken);let n=iI(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(eI.min())>0){r.readTime=iE(e,t.snapshotVersion.toTimestamp());let n=iI(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}(this.serializer,e);let r=function(e,t){let r=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return G(28987,{purpose:e})}}(t.purpose);return null==r?null:{"goog-listen-tags":r}}(this.serializer,e);r&&(t.labels=r),this.k_(t)}Y_(e){let t={};t.database=iR(this.serializer),t.removeTarget=e,this.k_(t)}}class aX extends aQ{constructor(e,t,r,n,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,o),this.serializer=i}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,t){return this.connection.P_("Write",e,t)}j_(e){return U(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,U(!e.writeResults||0===e.writeResults.length,55816),this.listener.ea()}onNext(e){var t,r;U(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();let n=(t=e.writeResults,r=e.commitTime,t&&t.length>0?(U(void 0!==r,14353),t.map(e=>{let t;return(t=e.updateTime?ik(e.updateTime):ik(r)).isEqual(eI.min())&&(t=ik(r)),new nq(t,e.transformResults||[])})):[]),i=ik(e.commitTime);return this.listener.ta(i,n)}na(){let e={};e.database=iR(this.serializer),this.k_(e)}X_(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>iG(this.serializer,e))};this.k_(t)}}class aZ{}class a0 extends aZ{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.ra=!1}ia(){if(this.ra)throw new z(B.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,n){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Wo(e,iP(t,r),n,i,o)).catch(e=>{throw"FirebaseError"===e.name?(e.code===B.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new z(B.UNKNOWN,e.toString())})}Jo(e,t,r,n,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Jo(e,iP(t,r),n,o,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===B.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new z(B.UNKNOWN,e.toString())})}terminate(){this.ra=!0,this.connection.terminate()}}class a1{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){0===this.sa&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(e){"Online"===this.state?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,"Online"===e&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(L(t),this._a=!1):R("OnlineStateTracker",t)}ha(){null!==this.oa&&(this.oa.cancel(),this.oa=null)}}let a2="RemoteStore";class a3{constructor(e,t,r,n,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=i,this.Ea.xo(e=>{r.enqueueAndForget(async()=>{sr(this)&&(R(a2,"Restarting streams for network reachability change."),await async function(e){e.Ia.add(4),await a6(e),e.Aa.set("Unknown"),e.Ia.delete(4),await a4(e)}(this))})}),this.Aa=new a1(r,n)}}async function a4(e){if(sr(e))for(let t of e.da)await t(!0)}async function a6(e){for(let t of e.da)await t(!1)}function a5(e,t){e.Ta.has(t.targetId)||(e.Ta.set(t.targetId,t),st(e)?se(e):sv(e).x_()&&a7(e,t))}function a8(e,t){let r=sv(e);e.Ta.delete(t),r.x_()&&a9(e,t),0===e.Ta.size&&(r.x_()?r.B_():sr(e)&&e.Aa.set("Unknown"))}function a7(e,t){if(e.Ra.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(eI.min())>0){let r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}sv(e).H_(t)}function a9(e,t){e.Ra.$e(t),sv(e).Y_(t)}function se(e){e.Ra=new ig({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>e.Ta.get(t)||null,lt:()=>e.datastore.serializer.databaseId}),sv(e).start(),e.Aa.aa()}function st(e){return sr(e)&&!sv(e).M_()&&e.Ta.size>0}function sr(e){return 0===e.Ia.size}async function sn(e){e.Aa.set("Online")}async function si(e){e.Ta.forEach((t,r)=>{a7(e,t)})}async function so(e,t){e.Ra=void 0,st(e)?(e.Aa.la(t),se(e)):e.Aa.set("Unknown")}async function sa(e,t,r){if(e.Aa.set("Online"),t instanceof ip&&2===t.state&&t.cause)try{await async function(e,t){let r=t.cause;for(let n of t.targetIds)e.Ta.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.Ta.delete(n),e.Ra.removeTarget(n))}(e,t)}catch(r){R(a2,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await ss(e,r)}else if(t instanceof ih?e.Ra.Ye(t):t instanceof id?e.Ra.it(t):e.Ra.et(t),!r.isEqual(eI.min()))try{let t=await al(e.localStore);r.compareTo(t)>=0&&await function(e,t){let r=e.Ra.Pt(t);return r.targetChanges.forEach((r,n)=>{if(r.resumeToken.approximateByteSize()>0){let i=e.Ta.get(n);i&&e.Ta.set(n,i.withResumeToken(r.resumeToken,t))}}),r.targetMismatches.forEach((t,r)=>{let n=e.Ta.get(t);if(!n)return;e.Ta.set(t,n.withResumeToken(t9.EMPTY_BYTE_STRING,n.snapshotVersion)),a9(e,t);let i=new iK(n.target,t,r,n.sequenceNumber);a7(e,i)}),e.remoteSyncer.applyRemoteEvent(r)}(e,r)}catch(t){R(a2,"Failed to raise snapshot:",t),await ss(e,t)}}async function ss(e,t,r){if(!eH(t))throw t;e.Ia.add(1),await a6(e),e.Aa.set("Offline"),r||(r=()=>al(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{R(a2,"Retrying IndexedDB access"),await r(),e.Ia.delete(1),await a4(e)})}function su(e,t){return t().catch(r=>ss(e,r,t))}async function sc(e){var t;let r=sb(e),n=e.Pa.length>0?e.Pa[e.Pa.length-1].batchId:-1;for(;sr(t=e)&&t.Pa.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}(e.localStore,n);if(null===t){0===e.Pa.length&&r.B_();break}n=t.batchId,function(e,t){e.Pa.push(t);let r=sb(e);r.x_()&&r.Z_&&r.X_(t.mutations)}(e,t)}catch(t){await ss(e,t)}sl(e)&&sh(e)}function sl(e){return sr(e)&&!sb(e).M_()&&e.Pa.length>0}function sh(e){sb(e).start()}async function sd(e){sb(e).na()}async function sf(e){let t=sb(e);for(let r of e.Pa)t.X_(r.mutations)}async function sp(e,t,r){let n=e.Pa.shift(),i=n5.from(n,t,r);await su(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await sc(e)}async function sm(e,t){t&&sb(e).Z_&&await async function(e,t){var r;if(ie(r=t.code)&&r!==B.ABORTED){let r=e.Pa.shift();sb(e).N_(),await su(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,t)),await sc(e)}}(e,t),sl(e)&&sh(e)}async function sg(e,t){e.asyncQueue.verifyOperationInProgress(),R(a2,"RemoteStore received new credentials");let r=sr(e);e.Ia.add(3),await a6(e),r&&e.Aa.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ia.delete(3),await a4(e)}async function sy(e,t){t?(e.Ia.delete(2),await a4(e)):t||(e.Ia.add(2),await a6(e),e.Aa.set("Unknown"))}function sv(e){var t,r,n;return e.Va||(t=e.datastore,r=e.asyncQueue,n={Zo:sn.bind(null,e),e_:si.bind(null,e),n_:so.bind(null,e),J_:sa.bind(null,e)},t.ia(),e.Va=new aY(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.da.push(async t=>{t?(e.Va.N_(),st(e)?se(e):e.Aa.set("Unknown")):(await e.Va.stop(),e.Ra=void 0)})),e.Va}function sb(e){var t,r,n;return e.ma||(t=e.datastore,r=e.asyncQueue,n={Zo:()=>Promise.resolve(),e_:sd.bind(null,e),n_:sm.bind(null,e),ea:sf.bind(null,e),ta:sp.bind(null,e)},t.ia(),e.ma=new aX(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.da.push(async t=>{t?(e.ma.N_(),await sc(e)):(await e.ma.stop(),e.Pa.length>0&&(R(a2,`Stopping write stream with ${e.Pa.length} pending writes`),e.Pa=[]))})),e.ma}class sw{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new H,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){let o=new sw(e,t,Date.now()+r,n,i);return o.start(r),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new z(B.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function sS(e,t){if(L("AsyncQueue",`${t}: ${e}`),eH(e))return new z(B.UNAVAILABLE,`${t}: ${e}`);throw e}class sx{static emptySet(e){return new sx(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||eh.comparator(t.key,r.key):(e,t)=>eh.comparator(e.key,t.key),this.keyedMap=nE(),this.sortedSet=new t0(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof sx)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let r=new sx;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class sI{constructor(){this.fa=new t0(eh.comparator)}track(e){let t=e.doc.key,r=this.fa.get(t);r?0!==e.type&&3===r.type?this.fa=this.fa.insert(t,e):3===e.type&&1!==r.type?this.fa=this.fa.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.fa=this.fa.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.fa=this.fa.remove(t):1===e.type&&2===r.type?this.fa=this.fa.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):G(63341,{At:e,ga:r}):this.fa=this.fa.insert(t,e)}pa(){let e=[];return this.fa.inorderTraversal((t,r)=>{e.push(r)}),e}}class sE{constructor(e,t,r,n,i,o,a,s,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,n,i){let o=[];return t.forEach(e=>{o.push({type:0,doc:e})}),new sE(e,t,sx.emptySet(t),o,r,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&nm(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class sT{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(e=>e.ba())}}class sk{constructor(){this.queries=s_(),this.onlineState="Unknown",this.Da=new Set}terminate(){!function(e,t){let r=e.queries;e.queries=s_(),r.forEach((e,r)=>{for(let e of r.wa)e.onError(t)})}(this,new z(B.ABORTED,"Firestore shutting down"))}}function s_(){return new nS(e=>ng(e),nm)}async function sP(e,t){let r=3,n=t.query,i=e.queries.get(n);i?!i.Sa()&&t.ba()&&(r=2):(i=new sT,r=+!t.ba());try{switch(r){case 0:i.ya=await e.onListen(n,!0);break;case 1:i.ya=await e.onListen(n,!1);break;case 2:await e.onFirstRemoteStoreListen(n)}}catch(r){let e=sS(r,`Initialization of query '${ny(t.query)}' failed`);return void t.onError(e)}e.queries.set(n,i),i.wa.push(t),t.va(e.onlineState),i.ya&&t.Ca(i.ya)&&sD(e)}async function sA(e,t){let r=t.query,n=3,i=e.queries.get(r);if(i){let e=i.wa.indexOf(t);e>=0&&(i.wa.splice(e,1),0===i.wa.length?n=+!t.ba():!i.Sa()&&t.ba()&&(n=2))}switch(n){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}}function sO(e,t){let r=!1;for(let n of t){let t=n.query,i=e.queries.get(t);if(i){for(let e of i.wa)e.Ca(n)&&(r=!0);i.ya=n}}r&&sD(e)}function sC(e,t,r){let n=e.queries.get(t);if(n)for(let e of n.wa)e.onError(r);e.queries.delete(t)}function sD(e){e.Da.forEach(e=>{e.next()})}(g=m||(m={})).Fa="default",g.Cache="cache";class sN{constructor(e,t,r){this.query=e,this.Ma=t,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=r||{}}Ca(e){if(!this.options.includeMetadataChanges){let t=[];for(let r of e.docChanges)3!==r.type&&t.push(r);e=new sE(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),t=!0):this.Ba(e,this.onlineState)&&(this.La(e),t=!0),this.Oa=e,t}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let t=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),t=!0),t}Ba(e,t){return!(e.fromCache&&this.ba())||(!this.options.ka||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Na(e){if(e.docChanges.length>0)return!0;let t=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}La(e){e=sE.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==m.Cache}}class sR{constructor(e,t){this.qa=e,this.byteLength=t}Qa(){return"metadata"in this.qa}}class sL{constructor(e){this.serializer=e}Qs(e){return iC(this.serializer,e)}$s(e){return e.metadata.exists?iF(this.serializer,e.document,!1):rU.newNoDocument(this.Qs(e.metadata.name),this.Us(e.metadata.readTime))}Us(e){return ik(e)}}class sj{constructor(e,t){this.$a=e,this.serializer=t,this.Ua=[],this.Ka=[],this.collectionGroups=new Set,this.progress=sF(e)}get queries(){return this.Ua}get documents(){return this.Ka}Wa(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.qa.namedQuery)this.Ua.push(e.qa.namedQuery);else if(e.qa.documentMetadata){this.Ka.push({metadata:e.qa.documentMetadata}),e.qa.documentMetadata.exists||++t;let r=eu.fromString(e.qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.qa.document&&(this.Ka[this.Ka.length-1].document=e.qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Ga(e){let t=new Map,r=new sL(this.serializer);for(let n of e)if(n.metadata.queries){let e=r.Qs(n.metadata.name);for(let r of n.metadata.queries){let n=(t.get(r)||nA()).add(e);t.set(r,n)}}return t}async za(e){let t=await av(e,new sL(this.serializer),this.Ka,this.$a.id),r=this.Ga(this.documents);for(let t of this.Ua)await ab(e,t,r.get(t.name));return this.progress.taskState="Success",{progress:this.progress,ja:this.collectionGroups,Ja:t}}}function sF(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class sG{constructor(e){this.key=e}}class sM{constructor(e){this.key=e}}class sU{constructor(e,t){this.query=e,this.Ha=t,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=nA(),this.mutatedKeys=nA(),this.Xa=nw(e),this.eu=new sx(this.Xa)}get tu(){return this.Ha}nu(e,t){let r=t?t.ru:new sI,n=t?t.eu:this.eu,i=t?t.mutatedKeys:this.mutatedKeys,o=n,a=!1,s="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,u="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{let c=n.get(e),l=nv(this.query,t)?t:null,h=!!c&&this.mutatedKeys.has(c.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations),f=!1;c&&l?c.data.isEqual(l.data)?h!==d&&(r.track({type:3,doc:l}),f=!0):this.iu(c,l)||(r.track({type:2,doc:l}),f=!0,(s&&this.Xa(l,s)>0||u&&0>this.Xa(l,u))&&(a=!0)):!c&&l?(r.track({type:0,doc:l}),f=!0):c&&!l&&(r.track({type:1,doc:c}),f=!0,(s||u)&&(a=!0)),f&&(l?(o=o.add(l),i=d?i.add(e):i.delete(e)):(o=o.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;o.size>this.query.limit;){let e="F"===this.query.limitType?o.last():o.first();o=o.delete(e.key),i=i.delete(e.key),r.track({type:1,doc:e})}return{eu:o,ru:r,Ds:a,mutatedKeys:i}}iu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){let i=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;let o=e.ru.pa();o.sort((e,t)=>(function(e,t){let r=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return G(20277,{At:e})}};return r(e)-r(t)})(e.type,t.type)||this.Xa(e.doc,t.doc)),this.su(r),n=null!=n&&n;let a=t&&!n?this.ou():[],s=0===this.Za.size&&this.current&&!n?1:0,u=s!==this.Ya;return(this.Ya=s,0!==o.length||u)?{snapshot:new sE(this.query,e.eu,i,o,e.mutatedKeys,0===s,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),_u:a}:{_u:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({eu:this.eu,ru:new sI,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach(e=>this.Ha=this.Ha.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ha=this.Ha.delete(e)),this.current=e.current)}ou(){if(!this.current)return[];let e=this.Za;this.Za=nA(),this.eu.forEach(e=>{this.au(e.key)&&(this.Za=this.Za.add(e.key))});let t=[];return e.forEach(e=>{this.Za.has(e)||t.push(new sM(e))}),this.Za.forEach(r=>{e.has(r)||t.push(new sG(r))}),t}uu(e){this.Ha=e.qs,this.Za=nA();let t=this.nu(e.documents);return this.applyChanges(t,!0)}cu(){return sE.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,0===this.Ya,this.hasCachedResults)}}let sV="SyncEngine";class sB{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class sz{constructor(e){this.key=e,this.lu=!1}}class sH{constructor(e,t,r,n,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.hu={},this.Pu=new nS(e=>ng(e),nm),this.Tu=new Map,this.Iu=new Set,this.du=new t0(eh.comparator),this.Eu=new Map,this.Au=new oY,this.Ru={},this.Vu=new Map,this.mu=oO.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return!0===this.fu}}async function sq(e,t,r=!0){let n,i=ud(e),o=i.Pu.get(t);return o?(i.sharedClientState.addLocalQueryTarget(o.targetId),n=o.view.cu()):n=await sK(i,t,r,!0),n}async function s$(e,t){let r=ud(e);await sK(r,t,!0,!1)}async function sK(e,t,r,n){let i,o=await ad(e.localStore,nl(t)),a=o.targetId,s=e.sharedClientState.addLocalQueryTarget(a,r);return n&&(i=await sW(e,t,a,"current"===s,o.resumeToken)),e.isPrimaryClient&&r&&a5(e.remoteStore,o),i}async function sW(e,t,r,n,i){e.gu=(t,r,n)=>(async function(e,t,r,n){let i=t.view.nu(r);i.Ds&&(i=await ap(e.localStore,t.query,!1).then(({documents:e})=>t.view.nu(e,i)));let o=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),s=t.view.applyChanges(i,e.isPrimaryClient,o,a);return s7(e,t.targetId,s._u),s.snapshot})(e,t,r,n);let o=await ap(e.localStore,t,!0),a=new sU(t,o.qs),s=a.nu(o.documents),u=il.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,i),c=a.applyChanges(s,e.isPrimaryClient,u);s7(e,r,c._u);let l=new sB(t,r,a);return e.Pu.set(t,l),e.Tu.has(r)?e.Tu.get(r).push(t):e.Tu.set(r,[t]),c.snapshot}async function sJ(e,t,r){let n=e.Pu.get(t),i=e.Tu.get(n.targetId);if(i.length>1)return e.Tu.set(n.targetId,i.filter(e=>!nm(e,t))),void e.Pu.delete(t);e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)||await af(e.localStore,n.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(n.targetId),r&&a8(e.remoteStore,n.targetId),s5(e,n.targetId)}).catch(ej)):(s5(e,n.targetId),await af(e.localStore,n.targetId,!0))}async function sQ(e,t){let r=e.Pu.get(t),n=e.Tu.get(r.targetId);e.isPrimaryClient&&1===n.length&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),a8(e.remoteStore,r.targetId))}async function sY(e,t,r){let n=uf(e);try{var i;let e,o=await function(e,t){let r,n,i=ex.now(),o=t.reduce((e,t)=>e.add(t.key),nA());return e.persistence.runTransaction("Locally write mutations","readwrite",a=>{let s=nx,u=nA();return e.Os.getEntries(a,o).next(e=>{(s=e).forEach((e,t)=>{t.isValidDocument()||(u=u.add(e))})}).next(()=>e.localDocuments.getOverlayedDocuments(a,s)).next(n=>{r=n;let o=[];for(let e of t){let t=function(e,t){let r=null;for(let n of e.fieldTransforms){let e=t.data.field(n.field),i=nL(n.transform,e||null);null!=i&&(null===r&&(r=rM.empty()),r.set(n.field,i))}return r||null}(e,r.get(e.key).overlayedDocument);null!=t&&o.push(new nZ(e.key,t,function e(t){let r=[];return tY(t.fields,(t,n)=>{let i=new el([t]);if(rD(n)){let t=e(n.mapValue).fields;if(0===t.length)r.push(i);else for(let e of t)r.push(i.child(e))}else r.push(i)}),new t5(r)}(t.value.mapValue),n$.exists(!0)))}return e.mutationQueue.addMutationBatch(a,i,o,t)}).next(t=>{n=t;let i=t.applyToLocalDocumentSet(r,u);return e.documentOverlayCache.saveOverlays(a,t.batchId,i)})}).then(()=>({batchId:n.batchId,changes:nT(r)}))}(n.localStore,t);n.sharedClientState.addPendingMutation(o.batchId),i=o.batchId,(e=n.Ru[n.currentUser.toKey()])||(e=new t0(er)),e=e.insert(i,r),n.Ru[n.currentUser.toKey()]=e,await ue(n,o.changes),await sc(n.remoteStore)}catch(t){let e=sS(t,"Failed to persist write");r.reject(e)}}async function sX(e,t){try{let r=await function(e,t){let r=t.snapshotVersion,n=e.Fs;return e.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{let o=e.Os.newChangeBuffer({trackRemovals:!0});n=e.Fs;let a=[];t.targetChanges.forEach((o,s)=>{var u;let c=n.get(s);if(!c)return;a.push(e.hi.removeMatchingKeys(i,o.removedDocuments,s).next(()=>e.hi.addMatchingKeys(i,o.addedDocuments,s)));let l=c.withSequenceNumber(i.currentSequenceNumber);null!==t.targetMismatches.get(s)?l=l.withResumeToken(t9.EMPTY_BYTE_STRING,eI.min()).withLastLimboFreeSnapshotVersion(eI.min()):o.resumeToken.approximateByteSize()>0&&(l=l.withResumeToken(o.resumeToken,r)),n=n.insert(s,l),u=l,(0===c.resumeToken.approximateByteSize()||u.snapshotVersion.toMicroseconds()-c.snapshotVersion.toMicroseconds()>=3e8||o.addedDocuments.size+o.modifiedDocuments.size+o.removedDocuments.size>0)&&a.push(e.hi.updateTargetData(i,l))});let s=nx,u=nA();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&a.push(e.persistence.referenceDelegate.updateLimboDocument(i,r))}),a.push(ah(i,o,t.documentUpdates).next(e=>{s=e.Ls,u=e.ks})),!r.isEqual(eI.min())){let t=e.hi.getLastRemoteSnapshotVersion(i).next(t=>e.hi.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(t)}return eF.waitFor(a).next(()=>o.apply(i)).next(()=>e.localDocuments.getLocalViewOfDocuments(i,s,u)).next(()=>s)}).then(t=>(e.Fs=n,t))}(e.localStore,t);t.targetChanges.forEach((t,r)=>{let n=e.Eu.get(r);n&&(U(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?n.lu=!0:t.modifiedDocuments.size>0?U(n.lu,14607):t.removedDocuments.size>0&&(U(n.lu,42227),n.lu=!1))}),await ue(e,r,t)}catch(e){await ej(e)}}function sZ(e,t,r){var n;if(e.isPrimaryClient&&0===r||!e.isPrimaryClient&&1===r){let r,i=[];e.Pu.forEach((e,r)=>{let n=r.view.va(t);n.snapshot&&i.push(n.snapshot)}),(n=e.eventManager).onlineState=t,r=!1,n.queries.forEach((e,n)=>{for(let e of n.wa)e.va(t)&&(r=!0)}),r&&sD(n),i.length&&e.hu.J_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function s0(e,t,r){e.sharedClientState.updateQueryState(t,"rejected",r);let n=e.Eu.get(t),i=n&&n.key;if(i){let r=new t0(eh.comparator);r=r.insert(i,rU.newNoDocument(i,eI.min()));let n=nA().add(i),o=new ic(eI.min(),new Map,new t0(er),r,n);await sX(e,o),e.du=e.du.remove(i),e.Eu.delete(t),s9(e)}else await af(e.localStore,t,!1).then(()=>s5(e,t,r)).catch(ej)}async function s1(e,t){var r;let n=t.batch.batchId;try{let i=await (r=e.localStore,r.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let n=t.batch.keys(),i=r.Os.newChangeBuffer({trackRemovals:!0});return(function(e,t,r,n){let i=r.batch,o=i.keys(),a=eF.resolve();return o.forEach(e=>{a=a.next(()=>n.getEntry(t,e)).next(t=>{let o=r.docVersions.get(e);U(null!==o,48541),0>t.version.compareTo(o)&&(i.applyToRemoteDocument(t,r),t.isValidDocument()&&(t.setReadTime(r.commitVersion),n.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))})(r,e,t,i).next(()=>i.apply(e)).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=nA();for(let r=0;r<e.mutationResults.length;++r)e.mutationResults[r].transformResults.length>0&&(t=t.add(e.batch.mutations[r].key));return t}(t))).next(()=>r.localDocuments.getDocuments(e,n))}));s6(e,n,null),s4(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),await ue(e,i)}catch(e){await ej(e)}}async function s2(e,t,r){var n;try{let i=await (n=e.localStore,n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(U(null!==t,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))}));s6(e,t,r),s4(e,t),e.sharedClientState.updateMutationState(t,"rejected",r),await ue(e,i)}catch(e){await ej(e)}}async function s3(e,t){var r;sr(e.remoteStore)||R(sV,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=await (r=e.localStore).persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>r.mutationQueue.getHighestUnacknowledgedBatchId(e));if(-1===n)return void t.resolve();let i=e.Vu.get(n)||[];i.push(t),e.Vu.set(n,i)}catch(r){let e=sS(r,"Initialization of waitForPendingWrites() operation failed");t.reject(e)}}function s4(e,t){(e.Vu.get(t)||[]).forEach(e=>{e.resolve()}),e.Vu.delete(t)}function s6(e,t,r){let n=e.Ru[e.currentUser.toKey()];if(n){let i=n.get(t);i&&(r?i.reject(r):i.resolve(),n=n.remove(t)),e.Ru[e.currentUser.toKey()]=n}}function s5(e,t,r=null){for(let n of(e.sharedClientState.removeLocalQueryTarget(t),e.Tu.get(t)))e.Pu.delete(n),r&&e.hu.pu(n,r);e.Tu.delete(t),e.isPrimaryClient&&e.Au.zr(t).forEach(t=>{e.Au.containsKey(t)||s8(e,t)})}function s8(e,t){e.Iu.delete(t.path.canonicalString());let r=e.du.get(t);null!==r&&(a8(e.remoteStore,r),e.du=e.du.remove(t),e.Eu.delete(r),s9(e))}function s7(e,t,r){for(let n of r)n instanceof sG?(e.Au.addReference(n.key,t),function(e,t){let r=t.key,n=r.path.canonicalString();e.du.get(r)||e.Iu.has(n)||(R(sV,"New document in limbo: "+r),e.Iu.add(n),s9(e))}(e,n)):n instanceof sM?(R(sV,"Document no longer in limbo: "+n.key),e.Au.removeReference(n.key,t),e.Au.containsKey(n.key)||s8(e,n.key)):G(19791,{yu:n})}function s9(e){for(;e.Iu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){let t=e.Iu.values().next().value;e.Iu.delete(t);let r=new eh(eu.fromString(t)),n=e.mu.next();e.Eu.set(n,new sz(r)),e.du=e.du.insert(r,n),a5(e.remoteStore,new iK(nl(na(r.path)),n,"TargetPurposeLimboResolution",eX.ue))}}async function ue(e,t,r){let n=[],i=[],o=[];e.Pu.isEmpty()||(e.Pu.forEach((a,s)=>{o.push(e.gu(s,t,r).then(t=>{var o;if((t||r)&&e.isPrimaryClient){let n=t?!t.fromCache:null==(o=null==r?void 0:r.targetChanges.get(s.targetId))?void 0:o.current;e.sharedClientState.updateQueryState(s.targetId,n?"current":"not-current")}if(t){n.push(t);let e=ai.Es(s.targetId,t);i.push(e)}}))}),await Promise.all(o),e.hu.J_(n),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>eF.forEach(t,t=>eF.forEach(t.Is,n=>e.persistence.referenceDelegate.addReference(r,t.targetId,n)).next(()=>eF.forEach(t.ds,n=>e.persistence.referenceDelegate.removeReference(r,t.targetId,n)))))}catch(e){if(!eH(e))throw e;R(as,"Failed to update sequence numbers: "+e)}for(let r of t){let t=r.targetId;if(!r.fromCache){let r=e.Fs.get(t),n=r.snapshotVersion,i=r.withLastLimboFreeSnapshotVersion(n);e.Fs=e.Fs.insert(t,i)}}}(e.localStore,i))}async function ut(e,t){if(!e.currentUser.isEqual(t)){R(sV,"User change. New user:",t.toKey());let r=await ac(e.localStore,t);e.currentUser=t,e.Vu.forEach(e=>{e.forEach(e=>{e.reject(new z(B.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Vu.clear(),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await ue(e,r.Bs)}}function ur(e,t){let r=e.Eu.get(t);if(r&&r.lu)return nA().add(r.key);{let r=nA(),n=e.Tu.get(t);if(!n)return r;for(let t of n){let n=e.Pu.get(t);r=r.unionWith(n.view.tu)}return r}}async function un(e,t){let r=await ap(e.localStore,t.query,!0),n=t.view.uu(r);return e.isPrimaryClient&&s7(e,t.targetId,n._u),n}async function ui(e,t){return ag(e.localStore,t).then(t=>ue(e,t))}async function uo(e,t,r,n){var i;let o=await function(e,t){let r=e.mutationQueue;return e.persistence.runTransaction("Lookup mutation documents","readonly",n=>r.Xn(n,t).next(t=>t?e.localDocuments.getDocuments(n,t):eF.resolve(null)))}(e.localStore,t);null!==o?("pending"===r?await sc(e.remoteStore):"acknowledged"===r||"rejected"===r?(s6(e,t,n||null),s4(e,t),i=e.localStore,i.mutationQueue.rr(t)):G(6720,"Unknown batchState",{wu:r}),await ue(e,o)):R(sV,"Cannot apply mutation batch with id: "+t)}async function ua(e,t){if(ud(e),uf(e),!0===t&&!0!==e.fu){let t=e.sharedClientState.getAllActiveQueryTargets(),r=await us(e,t.toArray());for(let t of(e.fu=!0,await sy(e.remoteStore,!0),r))a5(e.remoteStore,t)}else if(!1===t&&!1!==e.fu){let t=[],r=Promise.resolve();e.Tu.forEach((n,i)=>{e.sharedClientState.isLocalQueryTarget(i)?t.push(i):r=r.then(()=>(s5(e,i),af(e.localStore,i,!0))),a8(e.remoteStore,i)}),await r,await us(e,t),e.Eu.forEach((t,r)=>{a8(e.remoteStore,r)}),e.Au.jr(),e.Eu=new Map,e.du=new t0(eh.comparator),e.fu=!1,await sy(e.remoteStore,!1)}}async function us(e,t,r){let n=[],i=[];for(let r of t){let t,o=e.Tu.get(r);if(o&&0!==o.length)for(let r of(t=await ad(e.localStore,nl(o[0])),o)){let t=e.Pu.get(r),n=await un(e,t);n.snapshot&&i.push(n.snapshot)}else{let n=await am(e.localStore,r);t=await ad(e.localStore,n),await sW(e,uu(n),r,!1,t.resumeToken)}n.push(t)}return e.hu.J_(i),n}function uu(e){var t,r,n,i,o;return t=e.path,r=e.collectionGroup,n=e.orderBy,i=e.filters,o=e.limit,new no(t,r,n,i,o,"F",e.startAt,e.endAt)}function uc(e){return e.localStore.persistence.Ps()}async function ul(e,t,r,n){if(e.fu)return void R(sV,"Ignoring unexpected query state notification.");let i=e.Tu.get(t);if(i&&i.length>0)switch(r){case"current":case"not-current":{let n=await ag(e.localStore,nb(i[0])),o=ic.createSynthesizedRemoteEventForCurrentChange(t,"current"===r,t9.EMPTY_BYTE_STRING);await ue(e,n,o);break}case"rejected":await af(e.localStore,t,!0),s5(e,t,n);break;default:G(64155,r)}}async function uh(e,t,r){let n=ud(e);if(n.fu){for(let e of t){if(n.Tu.has(e)&&n.sharedClientState.isActiveQueryTarget(e)){R(sV,"Adding an already active target "+e);continue}let t=await am(n.localStore,e),r=await ad(n.localStore,t);await sW(n,uu(t),r.targetId,!1,r.resumeToken),a5(n.remoteStore,r)}for(let e of r)n.Tu.has(e)&&await af(n.localStore,e,!1).then(()=>{a8(n.remoteStore,e),s5(n,e)}).catch(ej)}}function ud(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=sX.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=ur.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=s0.bind(null,e),e.hu.J_=sO.bind(null,e.eventManager),e.hu.pu=sC.bind(null,e.eventManager),e}function uf(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=s1.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=s2.bind(null,e),e}class up{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=aK(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Du(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Cu(e,this.localStore),this.indexBackfillerScheduler=this.Fu(e,this.localStore)}Cu(e,t){return null}Fu(e,t){return null}vu(e){var t,r;return t=this.persistence,r=new aa,new au(t,r,e.initialUser,this.serializer)}Du(e){return new o3(o6.Vi,this.serializer)}bu(e){return new aN}async terminate(){var e,t;null==(e=this.gcScheduler)||e.stop(),null==(t=this.indexBackfillerScheduler)||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}up.provider={build:()=>new up};class um extends up{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){return U(this.persistence.referenceDelegate instanceof o5,46915),new oj(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Du(e){let t=void 0!==this.cacheSizeBytes?oE.withCacheSize(this.cacheSizeBytes):oE.DEFAULT;return new o3(e=>o5.Vi(e,t),this.serializer)}}class ug extends up{constructor(e,t,r){super(),this.Mu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Mu.initialize(this,e),await uf(this.Mu.syncEngine),await sc(this.Mu.remoteStore),await this.persistence.ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){var t,r;return t=this.persistence,r=new aa,new au(t,r,e.initialUser,this.serializer)}Cu(e,t){return new oj(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Fu(e,t){let r=new eY(t,this.persistence);return new eQ(e.asyncQueue,r)}Du(e){let t=an(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?oE.withCacheSize(this.cacheSizeBytes):oE.DEFAULT;return new ar(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,aq(),a$(),this.serializer,this.sharedClientState,!!this.forceOwnership)}bu(e){return new aN}}class uy extends ug{constructor(e,t){super(e,t,!1),this.Mu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.Mu.syncEngine;this.sharedClientState instanceof aD&&(this.sharedClientState.syncEngine={Do:uo.bind(null,t),vo:ul.bind(null,t),Co:uh.bind(null,t),Ps:uc.bind(null,t),bo:ui.bind(null,t)},await this.sharedClientState.start()),await this.persistence.ji(async e=>{await ua(this.Mu.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}bu(e){let t=aq();if(!aD.C(t))throw new z(B.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=an(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new aD(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class uv{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>sZ(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=ut.bind(null,this.syncEngine),await sy(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new sk}createDatastore(e){var t;let r=aK(e.databaseInfo.databaseId),n=new aH(e.databaseInfo);return t=e.authCredentials,new a0(t,e.appCheckCredentials,n,r)}createRemoteStore(e){var t,r;return t=this.localStore,r=this.datastore,new a3(t,r,e.asyncQueue,e=>sZ(this.syncEngine,e,0),aj.C()?new aj:new aR)}createSyncEngine(e,t){return function(e,t,r,n,i,o,a){let s=new sH(e,t,r,n,i,o);return a&&(s.fu=!0),s}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){R(a2,"RemoteStore shutting down."),e.Ia.add(5),await a6(e),e.Ea.shutdown(),e.Aa.set("Unknown")}(this.remoteStore),null==(e=this.datastore)||e.terminate(),null==(t=this.eventManager)||t.terminate()}}function ub(e,t=10240){let r=0;return{async read(){if(r<e.byteLength){let n={value:e.slice(r,r+t),done:!1};return r+=t,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}uv.provider={build:()=>new uv};class uw{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):L("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class uS{constructor(e,t){this.Nu=e,this.serializer=t,this.metadata=new H,this.buffer=new Uint8Array,this.Bu=new TextDecoder("utf-8"),this.Lu().then(e=>{e&&e.Qa()?this.metadata.resolve(e.qa.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(null==e?void 0:e.qa)}`))},e=>this.metadata.reject(e))}close(){return this.Nu.cancel()}async getMetadata(){return this.metadata.promise}async Su(){return await this.getMetadata(),this.Lu()}async Lu(){let e=await this.ku();if(null===e)return null;let t=this.Bu.decode(e),r=Number(t);return isNaN(r)&&this.qu(`length string (${t}) is not valid number`),new sR(JSON.parse(await this.Qu(r)),e.length+r)}$u(){return this.buffer.findIndex(e=>123===e)}async ku(){for(;0>this.$u()&&!await this.Uu(););if(0===this.buffer.length)return null;let e=this.$u();e<0&&this.qu("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Qu(e){for(;this.buffer.length<e;)await this.Uu()&&this.qu("Reached the end of bundle when more is expected.");let t=this.Bu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}qu(e){throw this.Nu.cancel(),Error(`Invalid bundle format: ${e}`)}async Uu(){let e=await this.Nu.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class ux{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.Su();if(!r||!r.Qa())throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(null==r?void 0:r.qa)}`);this.metadata=r;do null!==(r=this.Su())&&this.elements.push(r);while(null!==r)}getMetadata(){return this.metadata}Ku(){return this.elements}Su(){if(this.cursor===this.bundleData.length)return null;let e=this.ku();return new sR(JSON.parse(this.Qu(e)),e)}Qu(e){if(this.cursor+e>this.bundleData.length)throw new z(B.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}ku(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if("{"===this.bundleData[t]){if(t===e)throw Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw Error("Reached the end of bundle when more is expected.")}}class uI{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new z(B.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await async function(e,t){let r={documents:t.map(t=>iO(e.serializer,t))},n=await e.Jo("BatchGetDocuments",e.serializer.databaseId,eu.emptyPath(),r,t.length),i=new Map;n.forEach(t=>{var r;let n=(r=e.serializer,"found"in t?function(e,t){U(!!t.found,43571),t.found.name,t.found.updateTime;let r=iC(e,t.found.name),n=ik(t.found.updateTime),i=t.found.createTime?ik(t.found.createTime):eI.min(),o=new rM({mapValue:{fields:t.found.fields}});return rU.newFoundDocument(r,n,i,o)}(r,t):"missing"in t?function(e,t){U(!!t.missing,3894),U(!!t.readTime,22933);let r=iC(e,t.missing),n=ik(t.readTime);return rU.newNoDocument(r,n)}(r,t):G(7234,{result:t}));i.set(n.key.toString(),n)});let o=[];return t.forEach(e=>{let t=i.get(e.toString());U(!!t,55234,{key:e}),o.push(t)}),o}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new n3(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let r=eh.fromPath(t);this.mutations.push(new n4(r,this.precondition(r)))}),await async function(e,t){let r={writes:t.map(t=>iG(e.serializer,t))};await e.Wo("Commit",e.serializer.databaseId,eu.emptyPath(),r)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw G(50498,{Wu:e.constructor.name});t=eI.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new z(B.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(eI.min())?n$.exists(!1):n$.updateTime(t):n$.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(eI.min()))throw new z(B.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return n$.updateTime(t)}return n$.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class uE{constructor(e,t,r,n,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=n,this.deferred=i,this.Gu=r.maxAttempts,this.F_=new aW(this.asyncQueue,"transaction_retry")}zu(){this.Gu-=1,this.ju()}ju(){this.F_.g_(async()=>{let e=new uI(this.datastore),t=this.Ju(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Hu(e)}))}).catch(e=>{this.Hu(e)})})}Ju(e){try{let t=this.updateFunction(e);return!eZ(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Hu(e){this.Gu>0&&this.Yu(e)?(this.Gu-=1,this.asyncQueue.enqueueAndForget(()=>(this.ju(),Promise.resolve()))):this.deferred.reject(e)}Yu(e){if("FirebaseError"===e.name){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!ie(t)}return!1}}let uT="FirestoreClient";class uk{constructor(e,t,r,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=n,this.user=A.UNAUTHENTICATED,this.clientId=et.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async e=>{R(uT,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(R(uT,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new H;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){let t=sS(r,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function u_(e,t){e.asyncQueue.verifyOperationInProgress(),R(uT,"Initializing OfflineComponentProvider");let r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await ac(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>{j("Terminating Firestore due to IndexedDb database deletion"),e.terminate().then(()=>{R("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(e=>{j("Terminating Firestore due to IndexedDb database deletion failed",e)})}),e._offlineComponents=t}async function uP(e,t){e.asyncQueue.verifyOperationInProgress();let r=await uA(e);R(uT,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>sg(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>sg(t.remoteStore,r)),e._onlineComponents=t}async function uA(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){R(uT,"Using user provided OfflineComponentProvider");try{await u_(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===B.FAILED_PRECONDITION||t.code===B.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;j("Error using user provided cache. Falling back to memory cache: "+t),await u_(e,new up)}}else R(uT,"Using default OfflineComponentProvider"),await u_(e,new um(void 0));return e._offlineComponents}async function uO(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(R(uT,"Using user provided OnlineComponentProvider"),await uP(e,e._uninitializedComponentsProvider._online)):(R(uT,"Using default OnlineComponentProvider"),await uP(e,new uv))),e._onlineComponents}function uC(e){return uA(e).then(e=>e.persistence)}function uD(e){return uA(e).then(e=>e.localStore)}function uN(e){return uO(e).then(e=>e.remoteStore)}function uR(e){return uO(e).then(e=>e.syncEngine)}function uL(e){return uO(e).then(e=>e.datastore)}async function uj(e){let t=await uO(e),r=t.eventManager;return r.onListen=sq.bind(null,t.syncEngine),r.onUnlisten=sJ.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=s$.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=sQ.bind(null,t.syncEngine),r}function uF(e,t,r={}){let n=new H;return e.asyncQueue.enqueueAndForget(async()=>(function(e,t,r,n,i){let o=new uw({next:s=>{o.Ou(),t.enqueueAndForget(()=>sA(e,a));let u=s.docs.has(r);!u&&s.fromCache?i.reject(new z(B.UNAVAILABLE,"Failed to get document because the client is offline.")):u&&s.fromCache&&n&&"server"===n.source?i.reject(new z(B.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),a=new sN(na(r.path),o,{includeMetadataChanges:!0,ka:!0});return sP(e,a)})(await uj(e),e.asyncQueue,t,r,n)),n.promise}function uG(e,t,r={}){let n=new H;return e.asyncQueue.enqueueAndForget(async()=>(function(e,t,r,n,i){let o=new uw({next:r=>{o.Ou(),t.enqueueAndForget(()=>sA(e,a)),r.fromCache&&"server"===n.source?i.reject(new z(B.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(r)},error:e=>i.reject(e)}),a=new sN(r,o,{includeMetadataChanges:!0,ka:!0});return sP(e,a)})(await uj(e),e.asyncQueue,t,r,n)),n.promise}function uM(e,t){return new ux(e,t)}function uU(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let uV=new Map,uB="firestore.googleapis.com";class uz{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new z(B.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=uB,this.ssl=!0}else this.host=e.host,this.ssl=null==(t=e.ssl)||t;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new z(B.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}ef("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=uU(null!=(r=e.experimentalLongPollingOptions)?r:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new z(B.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new z(B.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new z(B.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,r;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,r=e.experimentalLongPollingOptions,t.timeoutSeconds===r.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class uH{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new uz({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new z(B.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new z(B.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new uz(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new $;switch(e.type){case"firstParty":return new Q(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new z(B.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let t=uV.get(e);t&&(R("ComponentProvider","Removing Datastore"),uV.delete(e),t.terminate())}(this),Promise.resolve()}}function uq(e,t,r,n={}){var i;e=ev(e,uH);let o=(0,w.zJ)(t),a=e._getSettings(),s=Object.assign(Object.assign({},a),{emulatorOptions:e._getEmulatorOptions()}),u=`${t}:${r}`;o&&((0,w.gE)(`https://${u}`),(0,w.P1)("Firestore",!0)),a.host!==uB&&a.host!==u&&j("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let c=Object.assign(Object.assign({},a),{host:u,ssl:o,emulatorOptions:n});if(!(0,w.bD)(c,s)&&(e._setSettings(c),n.mockUserToken)){let t,r;if("string"==typeof n.mockUserToken)t=n.mockUserToken,r=A.MOCK_USER;else{t=(0,w.Fy)(n.mockUserToken,null==(i=e._app)?void 0:i.options.projectId);let o=n.mockUserToken.sub||n.mockUserToken.user_id;if(!o)throw new z(B.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");r=new A(o)}e._authCredentials=new K(new q(t,r))}}class u${constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new u$(this.firestore,e,this._query)}}class uK{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new uW(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new uK(this.firestore,e,this._key)}toJSON(){return{type:uK._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(eS(t,uK._jsonSchema))return new uK(e,r||null,new eh(eu.fromString(t.referencePath)))}}uK._jsonSchemaVersion="firestore/documentReference/1.0",uK._jsonSchema={type:ew("string",uK._jsonSchemaVersion),referencePath:ew("string")};class uW extends u${constructor(e,t,r){super(e,t,na(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new uK(this.firestore,null,new eh(e))}withConverter(e){return new uW(this.firestore,e,this._path)}}function uJ(e,t,...r){if(e=(0,w.Ku)(e),ed("collection","path",t),e instanceof uH){let n=eu.fromString(t,...r);return em(n),new uW(e,null,n)}{if(!(e instanceof uK||e instanceof uW))throw new z(B.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(eu.fromString(t,...r));return em(n),new uW(e.firestore,null,n)}}function uQ(e,t){if(e=ev(e,uH),ed("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new z(B.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new u$(e,null,new no(eu.emptyPath(),t))}function uY(e,t,...r){if(e=(0,w.Ku)(e),1==arguments.length&&(t=et.newId()),ed("doc","path",t),e instanceof uH){let n=eu.fromString(t,...r);return ep(n),new uK(e,null,new eh(n))}{if(!(e instanceof uK||e instanceof uW))throw new z(B.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(eu.fromString(t,...r));return ep(n),new uK(e.firestore,e instanceof uW?e.converter:null,new eh(n))}}function uX(e,t){return e=(0,w.Ku)(e),t=(0,w.Ku)(t),(e instanceof uK||e instanceof uW)&&(t instanceof uK||t instanceof uW)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function uZ(e,t){return e=(0,w.Ku)(e),t=(0,w.Ku)(t),e instanceof u$&&t instanceof u$&&e.firestore===t.firestore&&nm(e._query,t._query)&&e.converter===t.converter}let u0="AsyncQueue";class u1{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new aW(this,"async_queue_retry"),this.oc=()=>{let e=a$();e&&R(u0,"Visibility state changed to "+e.visibilityState),this.F_.y_()},this._c=e;let t=a$();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;let t=a$();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise(()=>{});let t=new H;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Zu.push(e),this.cc()))}async cc(){if(0!==this.Zu.length){try{await this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!eH(e))throw e;R(u0,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}}uc(e){let t=this._c.then(()=>(this.nc=!0,e().catch(e=>{throw this.tc=e,this.nc=!1,L("INTERNAL UNHANDLED ERROR: ",u2(e)),e}).then(e=>(this.nc=!1,e))));return this._c=t,t}enqueueAfterDelay(e,t,r){this.ac(),this.sc.indexOf(e)>-1&&(t=0);let n=sw.createAndSchedule(this,e,t,r,e=>this.lc(e));return this.ec.push(n),n}ac(){this.tc&&G(47125,{hc:u2(this.tc)})}verifyOperationInProgress(){}async Pc(){let e;do e=this._c,await e;while(e!==this._c)}Tc(e){for(let t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then(()=>{for(let t of(this.ec.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.ec))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Pc()})}dc(e){this.sc.push(e)}lc(e){let t=this.ec.indexOf(e);this.ec.splice(t,1)}}function u2(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}function u3(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class u4{constructor(){this._progressObserver={},this._taskCompletionResolver=new H,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}let u6=-1;class u5 extends uH{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new u1,this._persistenceKey=(null==n?void 0:n.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new u1(e),this._firestoreClient=void 0,await e}}}function u8(e,t,r){r||(r=rd);let n=(0,y.j6)(e,"firestore");if(n.isInitialized(r)){let e=n.getImmediate({identifier:r}),i=n.getOptions(r);if((0,w.bD)(i,t))return e;throw new z(B.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&void 0!==t.localCache)throw new z(B.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==t.cacheSizeBytes&&-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new z(B.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return t.host&&(0,w.zJ)(t.host)&&(0,w.gE)(t.host),n.initialize({options:t,instanceIdentifier:r})}function u7(e,t){let r="object"==typeof e?e:(0,y.Sx)(),n="string"==typeof e?e:t||rd,i=(0,y.j6)(r,"firestore").getImmediate({identifier:n});if(!i._initialized){let e=(0,w.yU)("firestore");e&&uq(i,...e)}return i}function u9(e){if(e._terminated)throw new z(B.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||ce(e),e._firestoreClient}function ce(e){var t,r,n,i,o;let a=e._freezeSettings(),s=(i=e._databaseId,o=(null==(t=e._app)?void 0:t.options.appId)||"",new rh(i,o,e._persistenceKey,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,uU(a.experimentalLongPollingOptions),a.useFetchStreams,a.isUsingEmulator));e._componentsProvider||(null==(r=a.localCache)?void 0:r._offlineComponentProvider)&&(null==(n=a.localCache)?void 0:n._onlineComponentProvider)&&(e._componentsProvider={_offline:a.localCache._offlineComponentProvider,_online:a.localCache._onlineComponentProvider}),e._firestoreClient=new uk(e._authCredentials,e._appCheckCredentials,e._queue,s,e._componentsProvider&&function(e){let t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}function ct(e,t){j("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=e._freezeSettings();return cn(e,uv.provider,{build:e=>new ug(e,r.cacheSizeBytes,null==t?void 0:t.forceOwnership)}),Promise.resolve()}async function cr(e){j("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=e._freezeSettings();cn(e,uv.provider,{build:e=>new uy(e,t.cacheSizeBytes)})}function cn(e,t,r){if((e=ev(e,u5))._firestoreClient||e._terminated)throw new z(B.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new z(B.FAILED_PRECONDITION,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:r},ce(e)}function ci(e){if(e._initialized&&!e._terminated)throw new z(B.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new H;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!eU.C())return Promise.resolve();await eU.delete(e+at)}(an(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}function co(e){var t=u9(e=ev(e,u5));let r=new H;return t.asyncQueue.enqueueAndForget(async()=>s3(await uR(t),r)),r.promise}function ca(e){var t;return(t=u9(e=ev(e,u5))).asyncQueue.enqueue(async()=>{let e=await uC(t),r=await uN(t);return e.setNetworkEnabled(!0),r.Ia.delete(0),a4(r)})}function cs(e){var t;return(t=u9(e=ev(e,u5))).asyncQueue.enqueue(async()=>{let e=await uC(t),r=await uN(t);return e.setNetworkEnabled(!1),async function(e){e.Ia.add(0),await a6(e),e.Aa.set("Offline")}(r)})}function cu(e){return(0,y.Us)(e.app,"firestore",e._databaseId.database),e._delete()}function cc(e,t){let r=u9(e=ev(e,u5)),n=new u4;return function(e,t,r,n){var i;let o=(i=aK(t),new uS(function(e,t){if(e instanceof Uint8Array)return ub(e,void 0);if(e instanceof ArrayBuffer)return ub(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof r?ee().encode(r):r),i));e.asyncQueue.enqueueAndForget(async()=>{var t;(async function(e,t,r){try{var n;let i=await t.getMetadata();if(await function(e,t){let r=ik(t.createTime);return e.persistence.runTransaction("hasNewerBundle","readonly",r=>e.Ti.getBundleMetadata(r,t.id)).then(e=>!!e&&e.createTime.compareTo(r)>=0)}(e.localStore,i))return await t.close(),r._completeWith({taskState:"Success",documentsLoaded:i.totalDocuments,bytesLoaded:i.totalBytes,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes}),Promise.resolve(new Set);r._updateProgress(sF(i));let o=new sj(i,t.serializer),a=await t.Su();for(;a;){let e=await o.Wa(a);e&&r._updateProgress(e),a=await t.Su()}let s=await o.za(e.localStore);return await ue(e,s.Ja,void 0),await (n=e.localStore,n.persistence.runTransaction("Save bundle","readwrite",e=>n.Ti.saveBundleMetadata(e,i))),r._completeWith(s.progress),Promise.resolve(s.ja)}catch(e){return j(sV,`Loading bundle failed with ${e}`),r._failWith(e),Promise.resolve(new Set)}})(t=await uR(e),o,n).then(e=>{t.sharedClientState.notifyBundleLoaded(e)})})}(r,e._databaseId,t,n),n}function cl(e,t){var r;return(r=u9(e=ev(e,u5)),r.asyncQueue.enqueue(async()=>{var e;return e=await uD(r),e.persistence.runTransaction("Get named query","readonly",r=>e.Ti.getNamedQuery(r,t))})).then(t=>t?new u$(e,null,t.query):null)}class ch{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class cd{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}class cf{constructor(e){this._byteString=e}static fromBase64String(e){try{return new cf(t9.fromBase64String(e))}catch(e){throw new z(B.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new cf(t9.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:cf._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(eS(e,cf._jsonSchema))return cf.fromBase64String(e.bytes)}}cf._jsonSchemaVersion="firestore/bytes/1.0",cf._jsonSchema={type:ew("string",cf._jsonSchemaVersion),bytes:ew("string")};class cp{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new z(B.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new el(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function cm(){return new cp(ea)}class cg{constructor(e){this._methodName=e}}class cy{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new z(B.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new z(B.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return er(this._lat,e._lat)||er(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:cy._jsonSchemaVersion}}static fromJSON(e){if(eS(e,cy._jsonSchema))return new cy(e.latitude,e.longitude)}}cy._jsonSchemaVersion="firestore/geoPoint/1.0",cy._jsonSchema={type:ew("string",cy._jsonSchemaVersion),latitude:ew("number"),longitude:ew("number")};class cv{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}(this._values,e._values)}toJSON(){return{type:cv._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(eS(e,cv._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new cv(e.vectorValues);throw new z(B.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}cv._jsonSchemaVersion="firestore/vectorValue/1.0",cv._jsonSchema={type:ew("string",cv._jsonSchemaVersion),vectorValues:ew("object")};let cb=/^__.*__$/;class cw{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new nZ(e,this.data,this.fieldMask,t,this.fieldTransforms):new nX(e,this.data,t,this.fieldTransforms)}}class cS{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new nZ(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function cx(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw G(40011,{Ec:e})}}class cI{constructor(e,t,r,n,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this.Ac(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new cI(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var t;let r=null==(t=this.path)?void 0:t.child(e),n=this.Rc({path:r,mc:!1});return n.fc(e),n}gc(e){var t;let r=null==(t=this.path)?void 0:t.child(e),n=this.Rc({path:r,mc:!1});return n.Ac(),n}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return cz(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(0===e.length)throw this.wc("Document fields must not be empty");if(cx(this.Ec)&&cb.test(e))throw this.wc('Document fields cannot begin and end with "__"')}}class cE{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||aK(e)}Dc(e,t,r,n=!1){return new cI({Ec:e,methodName:t,bc:r,path:el.emptyPath(),mc:!1,Sc:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function cT(e){let t=e._freezeSettings(),r=aK(e._databaseId);return new cE(e._databaseId,!!t.ignoreUndefinedProperties,r)}function ck(e,t,r,n,i,o={}){let a,s,u=e.Dc(o.merge||o.mergeFields?2:0,t,r,i);cM("Data must be an object, but it was:",u,n);let c=cF(n,u);if(o.merge)a=new t5(u.fieldMask),s=u.fieldTransforms;else if(o.mergeFields){let e=[];for(let n of o.mergeFields){let i=cU(t,n,r);if(!u.contains(i))throw new z(B.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);cH(e,i)||e.push(i)}a=new t5(e),s=u.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,s=u.fieldTransforms;return new cw(new rM(c),a,s)}class c_ extends cg{_toFieldTransform(e){if(2!==e.Ec)throw 1===e.Ec?e.wc(`${this._methodName}() can only appear at the top level of your update data`):e.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof c_}}function cP(e,t,r){return new cI({Ec:3,bc:t.settings.bc,methodName:e._methodName,mc:r},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class cA extends cg{_toFieldTransform(e){return new nH(e.path,new nj)}isEqual(e){return e instanceof cA}}class cO extends cg{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){let t=cP(this,e,!0),r=new nF(this.vc.map(e=>cj(e,t)));return new nH(e.path,r)}isEqual(e){return e instanceof cO&&(0,w.bD)(this.vc,e.vc)}}class cC extends cg{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){let t=cP(this,e,!0),r=new nM(this.vc.map(e=>cj(e,t)));return new nH(e.path,r)}isEqual(e){return e instanceof cC&&(0,w.bD)(this.vc,e.vc)}}class cD extends cg{constructor(e,t){super(e),this.Cc=t}_toFieldTransform(e){let t=new nV(e.serializer,nN(e.serializer,this.Cc));return new nH(e.path,t)}isEqual(e){return e instanceof cD&&this.Cc===e.Cc}}function cN(e,t,r,n){let i=e.Dc(1,t,r);cM("Data must be an object, but it was:",i,n);let o=[],a=rM.empty();return tY(n,(e,n)=>{let s=cB(t,e,r);n=(0,w.Ku)(n);let u=i.gc(s);if(n instanceof c_)o.push(s);else{let e=cj(n,u);null!=e&&(o.push(s),a.set(s,e))}}),new cS(a,new t5(o),i.fieldTransforms)}function cR(e,t,r,n,i,o){let a=e.Dc(1,t,r),s=[cU(t,n,r)],u=[i];if(o.length%2!=0)throw new z(B.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<o.length;e+=2)s.push(cU(t,o[e])),u.push(o[e+1]);let c=[],l=rM.empty();for(let e=s.length-1;e>=0;--e)if(!cH(c,s[e])){let t=s[e],r=u[e];r=(0,w.Ku)(r);let n=a.gc(t);if(r instanceof c_)c.push(t);else{let e=cj(r,n);null!=e&&(c.push(t),l.set(t,e))}}return new cS(l,new t5(c),a.fieldTransforms)}function cL(e,t,r,n=!1){return cj(r,e.Dc(n?4:3,t))}function cj(e,t){if(cG(e=(0,w.Ku)(e)))return cM("Unsupported field value:",t,e),cF(e,t);if(e instanceof cg)return function(e,t){if(!cx(t.Ec))throw t.wc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.wc(`${e._methodName}() is not currently supported inside arrays`);let r=e._toFieldTransform(t);r&&t.fieldTransforms.push(r)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.mc&&4!==t.Ec)throw t.wc("Nested arrays are not supported");let r=[],n=0;for(let i of e){let e=cj(i,t.yc(n));null==e&&(e={nullValue:"NULL_VALUE"}),r.push(e),n++}return{arrayValue:{values:r}}}return function(e,t){if(null===(e=(0,w.Ku)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return nN(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let r=ex.fromDate(e);return{timestampValue:iE(t.serializer,r)}}if(e instanceof ex){let r=new ex(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:iE(t.serializer,r)}}if(e instanceof cy)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof cf)return{bytesValue:iT(t.serializer,e._byteString)};if(e instanceof uK){let r=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(r))throw t.wc(`Document reference is for database ${n.projectId}/${n.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:i_(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof cv)return{mapValue:{fields:{[rp]:{stringValue:ry},[rv]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.wc("VectorValues must only contain numeric values.");return nC(t.serializer,e)})}}}}};throw t.wc(`Unsupported field value: ${ey(e)}`)}(e,t)}function cF(e,t){let r={};return tZ(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):tY(e,(e,n)=>{let i=cj(n,t.Vc(e));null!=i&&(r[e]=i)}),{mapValue:{fields:r}}}function cG(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ex||e instanceof cy||e instanceof cf||e instanceof uK||e instanceof cg||e instanceof cv)}function cM(e,t,r){if(!cG(r)||!eg(r)){let n=ey(r);throw"an object"===n?t.wc(e+" a custom object"):t.wc(e+" "+n)}}function cU(e,t,r){if((t=(0,w.Ku)(t))instanceof cp)return t._internalPath;if("string"==typeof t)return cB(e,t);throw cz("Field path arguments must be of type string or ",e,!1,void 0,r)}let cV=RegExp("[~\\*/\\[\\]]");function cB(e,t,r){if(t.search(cV)>=0)throw cz(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new cp(...t.split("."))._internalPath}catch(n){throw cz(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function cz(e,t,r,n,i){let o=n&&!n.isEmpty(),a=void 0!==i,s=`Function ${t}() called with invalid data`;r&&(s+=" (via `toFirestore()`)"),s+=". ";let u="";return(o||a)&&(u+=" (found",o&&(u+=` in field ${n}`),a&&(u+=` in document ${i}`),u+=")"),new z(B.INVALID_ARGUMENT,s+e+u)}function cH(e,t){return e.some(e=>e.isEqual(t))}class cq{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new uK(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new c$(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(cK("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class c$ extends cq{data(){return super.data()}}function cK(e,t){return"string"==typeof t?cB(e,t):t instanceof cp?t._internalPath:t._delegate._internalPath}function cW(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new z(B.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class cJ{}class cQ extends cJ{}function cY(e,t,...r){let n=[];for(let i of(t instanceof cJ&&n.push(t),function(e){let t=e.filter(e=>e instanceof c0).length,r=e.filter(e=>e instanceof cX).length;if(t>1||t>0&&r>0)throw new z(B.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n=n.concat(r)),n))e=i._apply(e);return e}class cX extends cQ{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new cX(e,t,r)}_apply(e){let t=this._parse(e);return ls(e._query,t),new u$(e.firestore,e.converter,nf(e._query,t))}_parse(e){let t=cT(e.firestore);return function(e,t,r,n,i,o,a){let s;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new z(B.INVALID_ARGUMENT,`Invalid Query. You can't perform '${o}' queries on documentId().`);if("in"===o||"not-in"===o){la(a,o);let t=[];for(let r of a)t.push(lo(n,e,r));s={arrayValue:{values:t}}}else s=lo(n,e,a)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||la(a,o),s=cL(r,t,a,"in"===o||"not-in"===o);return r$.create(i,o,s)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function cZ(e,t,r){let n=cK("where",e);return cX._create(n,t,r)}class c0 extends cJ{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new c0(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:rK.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let r=e;for(let e of t.getFlattenedFilters())ls(r,e),r=nf(r,e)}(e._query,t),new u$(e.firestore,e.converter,nf(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function c1(...e){return e.forEach(e=>lu("or",e)),c0._create("or",e)}function c2(...e){return e.forEach(e=>lu("and",e)),c0._create("and",e)}class c3 extends cQ{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new c3(e,t)}_apply(e){let t=function(e,t,r){if(null!==e.startAt)throw new z(B.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new z(B.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new rH(t,r)}(e._query,this._field,this._direction);return new u$(e.firestore,e.converter,function(e,t){let r=e.explicitOrderBy.concat([t]);return new no(e.path,e.collectionGroup,r,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function c4(e,t="asc"){let r=cK("orderBy",e);return c3._create(r,t)}class c6 extends cQ{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new c6(e,t,r)}_apply(e){return new u$(e.firestore,e.converter,np(e._query,this._limit,this._limitType))}}function c5(e){return eb("limit",e),c6._create("limit",e,"F")}function c8(e){return eb("limitToLast",e),c6._create("limitToLast",e,"L")}class c7 extends cQ{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new c7(e,t,r)}_apply(e){var t;let r=li(e,this.type,this._docOrFields,this._inclusive);return new u$(e.firestore,e.converter,(t=e._query,new no(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,r,t.endAt)))}}function c9(...e){return c7._create("startAt",e,!0)}function le(...e){return c7._create("startAfter",e,!1)}class lt extends cQ{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new lt(e,t,r)}_apply(e){var t;let r=li(e,this.type,this._docOrFields,this._inclusive);return new u$(e.firestore,e.converter,(t=e._query,new no(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,r)))}}function lr(...e){return lt._create("endBefore",e,!1)}function ln(...e){return lt._create("endAt",e,!0)}function li(e,t,r,n){if(r[0]=(0,w.Ku)(r[0]),r[0]instanceof cq)return function(e,t,r,n,i){if(!n)throw new z(B.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${r}().`);let o=[];for(let r of nc(e))if(r.field.isKeyField())o.push(r_(t,n.key));else{let e=n.data.field(r.field);if(ru(e))throw new z(B.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+r.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=r.field.canonicalString();throw new z(B.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}o.push(e)}return new rV(o,i)}(e._query,e.firestore._databaseId,t,r[0]._document,n);{let i=cT(e.firestore);return function(e,t,r,n,i,o){let a=e.explicitOrderBy;if(i.length>a.length)throw new z(B.INVALID_ARGUMENT,`Too many arguments provided to ${n}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let s=[];for(let o=0;o<i.length;o++){let u=i[o];if(a[o].field.isKeyField()){if("string"!=typeof u)throw new z(B.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${n}(), but got a ${typeof u}`);if(!nu(e)&&-1!==u.indexOf("/"))throw new z(B.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${n}() must be a plain document ID, but '${u}' contains a slash.`);let r=e.path.child(eu.fromString(u));if(!eh.isDocumentKey(r))throw new z(B.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${n}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);let i=new eh(r);s.push(r_(t,i))}else{let e=cL(r,n,u);s.push(e)}}return new rV(s,o)}(e._query,e.firestore._databaseId,i,t,r,n)}}function lo(e,t,r){if("string"==typeof(r=(0,w.Ku)(r))){if(""===r)throw new z(B.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!nu(t)&&-1!==r.indexOf("/"))throw new z(B.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);let n=t.path.child(eu.fromString(r));if(!eh.isDocumentKey(n))throw new z(B.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return r_(e,new eh(n))}if(r instanceof uK)return r_(e,r._key);throw new z(B.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ey(r)}.`)}function la(e,t){if(!Array.isArray(e)||0===e.length)throw new z(B.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function ls(e,t){let r=function(e,t){for(let r of e)for(let e of r.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==r)throw r===t.op?new z(B.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new z(B.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}function lu(e,t){if(!(t instanceof cX||t instanceof c0))throw new z(B.INVALID_ARGUMENT,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class lc{convertValue(e,t="none"){switch(rw(e)){case 0:return null;case 1:return e.booleanValue;case 2:return rr(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(rn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw G(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return tY(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){var t,r,n;return new cv(null==(n=null==(r=null==(t=e.fields)?void 0:t[rv].arrayValue)?void 0:r.values)?void 0:n.map(e=>rr(e.doubleValue)))}convertGeoPoint(e){return new cy(rr(e.latitude),rr(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=rc(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(rl(e));default:return null}}convertTimestamp(e){let t=rt(e);return new ex(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=eu.fromString(e);U(i$(r),9688,{name:e});let n=new rf(r.get(1),r.get(3)),i=new eh(r.popFirst(5));return n.isEqual(t)||L(`Document ${i} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function ll(e,t,r){return e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t}class lh extends lc{constructor(e){super(),this.firestore=e}convertBytes(e){return new cf(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new uK(this.firestore,null,t)}}function ld(e){return new ch("sum",cU("sum",e))}function lf(e){return new ch("avg",cU("average",e))}function lp(){return new ch("count")}function lm(e,t){var r,n;return e instanceof ch&&t instanceof ch&&e.aggregateType===t.aggregateType&&(null==(r=e._internalFieldPath)?void 0:r.canonicalString())===(null==(n=t._internalFieldPath)?void 0:n.canonicalString())}function lg(e,t){return uZ(e.query,t.query)&&(0,w.bD)(e.data(),t.data())}let ly="NOT SUPPORTED";class lv{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class lb extends cq{constructor(e,t,r,n,i,o){super(e,t,r,n,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new lS(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(cK("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new z(B.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=lb._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),this._firestore,this.ref.path,t.bundle="NOT SUPPORTED"),t}}function lw(e,t,r){if(eS(t,lb._jsonSchema)){var n;if(t.bundle===ly)throw new z(B.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=aK(e._databaseId),o=(n=t.bundle,new ux(n,i)),a=o.Ku(),s=new sj(o.getMetadata(),i);for(let e of a)s.Wa(e);let u=s.documents;if(1!==u.length)throw new z(B.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${u.length} documents.`);let c=iF(i,u[0].document),l=new eh(eu.fromString(t.bundleName));return new lb(e,new lh(e),l,c,new lv(!1,!1),r||null)}}lb._jsonSchemaVersion="firestore/documentSnapshot/1.0",lb._jsonSchema={type:ew("string",lb._jsonSchemaVersion),bundleSource:ew("string","DocumentSnapshot"),bundleName:ew("string"),bundle:ew("string")};class lS extends lb{data(e={}){return super.data(e)}}class lx{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new lv(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new lS(this._firestore,this._userDataWriter,r.key,r,new lv(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new z(B.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{let n=new lS(e._firestore,e._userDataWriter,r.doc.key,r.doc,new lv(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let n=new lS(e._firestore,e._userDataWriter,t.doc.key,t.doc,new lv(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,o=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(o=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return G(61501,{type:e})}}(t.type),doc:n,oldIndex:i,newIndex:o}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new z(B.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=lx._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=et.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],n=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),r.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),n.push(e.ref.path))}),this._firestore,this.query._query,e.bundleName,e.bundle="NOT SUPPORTED",e}}function lI(e,t,r){if(eS(t,lx._jsonSchema)){var n;if(t.bundle===ly)throw new z(B.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=aK(e._databaseId),o=(n=t.bundle,new ux(n,i)),a=o.Ku(),s=new sj(o.getMetadata(),i);for(let e of a)s.Wa(e);if(1!==s.queries.length)throw new z(B.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${s.queries.length} queries.`);let u=i2(s.queries[0].bundledQuery),c=s.documents,l=new sx;c.map(e=>{let t=iF(i,e.document);l=l.add(t)});let h=sE.fromInitialDocuments(u,l,nA(),!1,!1),d=new u$(e,r||null,u);return new lx(e,new lh(e),d,h)}}function lE(e,t){return e instanceof lb&&t instanceof lb?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof lx&&t instanceof lx&&e._firestore===t._firestore&&uZ(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function lT(e){e=ev(e,uK);let t=ev(e.firestore,u5);return uF(u9(t),e._key).then(r=>lU(t,e,r))}lx._jsonSchemaVersion="firestore/querySnapshot/1.0",lx._jsonSchema={type:ew("string",lx._jsonSchemaVersion),bundleSource:ew("string","QuerySnapshot"),bundleName:ew("string"),bundle:ew("string")};class lk extends lc{constructor(e){super(),this.firestore=e}convertBytes(e){return new cf(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new uK(this.firestore,null,t)}}function l_(e){e=ev(e,uK);let t=ev(e.firestore,u5),r=u9(t),n=new lk(t);return(function(e,t){let r=new H;return e.asyncQueue.enqueueAndForget(async()=>(async function(e,t,r){try{let n=await e.persistence.runTransaction("read document","readonly",r=>e.localDocuments.getDocument(r,t));n.isFoundDocument()?r.resolve(n):n.isNoDocument()?r.resolve(null):r.reject(new z(B.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(n){let e=sS(n,`Failed to get document '${t} from cache`);r.reject(e)}})(await uD(e),t,r)),r.promise})(r,e._key).then(r=>new lb(t,n,e._key,r,new lv(null!==r&&r.hasLocalMutations,!0),e.converter))}function lP(e){e=ev(e,uK);let t=ev(e.firestore,u5);return uF(u9(t),e._key,{source:"server"}).then(r=>lU(t,e,r))}function lA(e){e=ev(e,u$);let t=ev(e.firestore,u5),r=u9(t),n=new lk(t);return cW(e._query),uG(r,e._query).then(r=>new lx(t,n,e,r))}function lO(e){e=ev(e,u$);let t=ev(e.firestore,u5),r=u9(t),n=new lk(t);return(function(e,t){let r=new H;return e.asyncQueue.enqueueAndForget(async()=>(async function(e,t,r){try{let n=await ap(e,t,!0),i=new sU(t,n.qs),o=i.nu(n.documents),a=i.applyChanges(o,!1);r.resolve(a.snapshot)}catch(n){let e=sS(n,`Failed to execute query '${t} against cache`);r.reject(e)}})(await uD(e),t,r)),r.promise})(r,e._query).then(r=>new lx(t,n,e,r))}function lC(e){e=ev(e,u$);let t=ev(e.firestore,u5),r=u9(t),n=new lk(t);return uG(r,e._query,{source:"server"}).then(r=>new lx(t,n,e,r))}function lD(e,t,r){e=ev(e,uK);let n=ev(e.firestore,u5),i=ll(e.converter,t,r);return lM(n,[ck(cT(n),"setDoc",e._key,i,null!==e.converter,r).toMutation(e._key,n$.none())])}function lN(e,t,r,...n){e=ev(e,uK);let i=ev(e.firestore,u5),o=cT(i);return lM(i,[("string"==typeof(t=(0,w.Ku)(t))||t instanceof cp?cR(o,"updateDoc",e._key,t,r,n):cN(o,"updateDoc",e._key,t)).toMutation(e._key,n$.exists(!0))])}function lR(e){return lM(ev(e.firestore,u5),[new n3(e._key,n$.none())])}function lL(e,t){let r=ev(e.firestore,u5),n=uY(e),i=ll(e.converter,t);return lM(r,[ck(cT(e.firestore),"addDoc",n._key,i,null!==e.converter,{}).toMutation(n._key,n$.exists(!1))]).then(()=>n)}function lj(e,...t){let r,n,i;e=(0,w.Ku)(e);let o={includeMetadataChanges:!1,source:"default"},a=0;"object"!=typeof t[0]||u3(t[a])||(o=t[a++]);let s={includeMetadataChanges:o.includeMetadataChanges,source:o.source};if(u3(t[a])){let e=t[a];t[a]=null==(u=e.next)?void 0:u.bind(e),t[a+1]=null==(c=e.error)?void 0:c.bind(e),t[a+2]=null==(l=e.complete)?void 0:l.bind(e)}if(e instanceof uK)n=ev(e.firestore,u5),i=na(e._key.path),r={next:r=>{t[a]&&t[a](lU(n,e,r))},error:t[a+1],complete:t[a+2]};else{let o=ev(e,u$);n=ev(o.firestore,u5),i=o._query;let s=new lk(n);r={next:e=>{t[a]&&t[a](new lx(n,s,o,e))},error:t[a+1],complete:t[a+2]},cW(e._query)}var u,c,l,h=u9(n),d=i;let f=new uw(r),p=new sN(d,f,s);return h.asyncQueue.enqueueAndForget(async()=>sP(await uj(h),p)),()=>{f.Ou(),h.asyncQueue.enqueueAndForget(async()=>sA(await uj(h),p))}}function lF(e,t,...r){var n,i,o,a,s,u;let c=(0,w.Ku)(e),l=function(e){let t={bundle:"",bundleName:"",bundleSource:""};for(let r of["bundle","bundleName","bundleSource"]){if(!(r in e)){t.error=`snapshotJson missing required field: ${r}`;break}let n=e[r];if("string"!=typeof n){t.error=`snapshotJson field '${r}' must be a string.`;break}if(0===n.length){t.error=`snapshotJson field '${r}' cannot be an empty string.`;break}"bundle"===r?t.bundle=n:"bundleName"===r?t.bundleName=n:"bundleSource"===r&&(t.bundleSource=n)}return t}(t);if(l.error)throw new z(B.INVALID_ARGUMENT,l.error);let h,d=0;if("object"!=typeof r[0]||u3(r[d])||(h=r[d++]),"QuerySnapshot"===l.bundleSource){let e,t,a=null;if("object"==typeof r[d]&&u3(r[d])){let e=r[d++];a={next:e.next,error:e.error,complete:e.complete}}else a={next:r[d++],error:r[d++],complete:r[d++]};return n=h,i=a,o=r[d],t=!1,cc(c,l.bundle).then(()=>cl(c,l.bundleName)).then(r=>{r&&!t&&(o&&r.withConverter(o),e=lj(r,n||{},i))}).catch(e=>(i.error&&i.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}if("DocumentSnapshot"===l.bundleSource){let e,t,n=null;if("object"==typeof r[d]&&u3(r[d])){let e=r[d++];n={next:e.next,error:e.error,complete:e.complete}}else n={next:r[d++],error:r[d++],complete:r[d++]};return a=h,s=n,u=r[d],t=!1,cc(c,l.bundle).then(()=>{t||(e=lj(new uK(c,u||null,eh.fromPath(l.bundleName)),a||{},s))}).catch(e=>(s.error&&s.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}throw new z(B.INVALID_ARGUMENT,`unsupported bundle source: ${l.bundleSource}`)}function lG(e,t){return function(e,t){let r=new uw(t);return e.asyncQueue.enqueueAndForget(async()=>{var t;return t=await uj(e),void(t.Da.add(r),r.next())}),()=>{r.Ou(),e.asyncQueue.enqueueAndForget(async()=>{var t;return t=await uj(e),void t.Da.delete(r)})}}(u9(e=ev(e,u5)),u3(t)?t:{next:t})}function lM(e,t){var r=u9(e);let n=new H;return r.asyncQueue.enqueueAndForget(async()=>sY(await uR(r),t,n)),n.promise}function lU(e,t,r){let n=r.docs.get(t._key),i=new lk(e);return new lb(e,i,t._key,n,new lv(r.hasPendingWrites,r.fromCache),t.converter)}function lV(e){return lB(e,{count:lp()})}function lB(e,t){let r=ev(e.firestore,u5),n=u9(r),i=tX(t,(e,t)=>new n7(t,e.aggregateType,e._internalFieldPath));return(function(e,t,r){let n=new H;return e.asyncQueue.enqueueAndForget(async()=>{try{let i=await uL(e);n.resolve(async function(e,t,r){var n;let{request:i,ft:o,parent:a}=iB(e.serializer,nh(t),r);e.connection.Qo||delete i.parent;let s=(await e.Jo("RunAggregationQuery",e.serializer.databaseId,a,i,1)).filter(e=>!!e.result);U(1===s.length,64727);let u=null==(n=s[0].result)?void 0:n.aggregateFields;return Object.keys(u).reduce((e,t)=>(e[o[t]]=u[t],e),{})}(i,t,r))}catch(e){n.reject(e)}}),n.promise})(n,e._query,i).then(t=>new cd(e,new lk(r),t))}class lz{constructor(e){this.kind="memory",this._onlineComponentProvider=uv.provider,(null==e?void 0:e.garbageCollector)?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider={build:()=>new um(void 0)}}toJSON(){return{kind:this.kind}}}class lH{constructor(e){let t;this.kind="persistent",(null==e?void 0:e.tabManager)?(e.tabManager._initialize(e),t=e.tabManager):(t=lZ(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class lq{constructor(){this.kind="memoryEager",this._offlineComponentProvider=up.provider}toJSON(){return{kind:this.kind}}}class l${constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new um(e)}}toJSON(){return{kind:this.kind}}}function lK(){return new lq}function lW(e){return new l$(null==e?void 0:e.cacheSizeBytes)}function lJ(e){return new lz(e)}function lQ(e){return new lH(e)}class lY{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=uv.provider,this._offlineComponentProvider={build:t=>new ug(t,null==e?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class lX{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=uv.provider,this._offlineComponentProvider={build:t=>new uy(t,null==e?void 0:e.cacheSizeBytes)}}}function lZ(e){return new lY(null==e?void 0:e.forceOwnership)}function l0(){return new lX}let l1={maxAttempts:5};class l2{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=cT(e)}set(e,t,r){this._verifyNotCommitted();let n=l3(e,this._firestore),i=ll(n.converter,t,r),o=ck(this._dataReader,"WriteBatch.set",n._key,i,null!==n.converter,r);return this._mutations.push(o.toMutation(n._key,n$.none())),this}update(e,t,r,...n){let i;this._verifyNotCommitted();let o=l3(e,this._firestore);return i="string"==typeof(t=(0,w.Ku)(t))||t instanceof cp?cR(this._dataReader,"WriteBatch.update",o._key,t,r,n):cN(this._dataReader,"WriteBatch.update",o._key,t),this._mutations.push(i.toMutation(o._key,n$.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=l3(e,this._firestore);return this._mutations=this._mutations.concat(new n3(t._key,n$.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new z(B.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function l3(e,t){if((e=(0,w.Ku)(e)).firestore!==t)throw new z(B.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class l4{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=cT(e)}get(e){let t=l3(e,this._firestore),r=new lh(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return G(24041);let n=e[0];if(n.isFoundDocument())return new cq(this._firestore,r,n.key,n,t.converter);if(n.isNoDocument())return new cq(this._firestore,r,t._key,null,t.converter);throw G(18433,{doc:n})})}set(e,t,r){let n=l3(e,this._firestore),i=ll(n.converter,t,r),o=ck(this._dataReader,"Transaction.set",n._key,i,null!==n.converter,r);return this._transaction.set(n._key,o),this}update(e,t,r,...n){let i,o=l3(e,this._firestore);return i="string"==typeof(t=(0,w.Ku)(t))||t instanceof cp?cR(this._dataReader,"Transaction.update",o._key,t,r,n):cN(this._dataReader,"Transaction.update",o._key,t),this._transaction.update(o._key,i),this}delete(e){let t=l3(e,this._firestore);return this._transaction.delete(t._key),this}}class l6 extends l4{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=l3(e,this._firestore),r=new lk(this._firestore);return super.get(e).then(e=>new lb(this._firestore,r,t._key,e._document,new lv(!1,!1),t.converter))}}function l5(e,t,r){e=ev(e,u5);let n=Object.assign(Object.assign({},l1),r);if(n.maxAttempts<1)throw new z(B.INVALID_ARGUMENT,"Max attempts must be at least 1");return function(e,t,r){let n=new H;return e.asyncQueue.enqueueAndForget(async()=>{let i=await uL(e);new uE(e.asyncQueue,i,r,t,n).zu()}),n.promise}(u9(e),r=>t(new l6(e,r)),n)}function l8(){return new c_("deleteField")}function l7(){return new cA("serverTimestamp")}function l9(...e){return new cO("arrayUnion",e)}function he(...e){return new cC("arrayRemove",e)}function ht(e){return new cD("increment",e)}function hr(e){return new cv(e)}function hn(e){return u9(e=ev(e,u5)),new l2(e,t=>lM(e,t))}function hi(e,t){let r=u9(e=ev(e,u5));if(!r._uninitializedComponentsProvider||"memory"===r._uninitializedComponentsProvider._offline.kind)return j("Cannot enable indexes when persistence is disabled"),Promise.resolve();let n=function(e){let t="string"==typeof e?function(e){try{return JSON.parse(e)}catch(e){throw new z(B.INVALID_ARGUMENT,"Failed to parse JSON: "+(null==e?void 0:e.message))}}(e):e,r=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=ho(e,"collectionGroup"),n=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=cB("setIndexConfiguration",ho(t,"fieldPath"));"CONTAINS"===t.arrayConfig?n.push(new eP(e,2)):"ASCENDING"===t.order?n.push(new eP(e,0)):"DESCENDING"===t.order&&n.push(new eP(e,1))}r.push(new eE(eE.UNKNOWN_ID,t,n,eA.empty()))}return r}(t);return r.asyncQueue.enqueue(async()=>(async function(e,t){let r=e.indexManager,n=[];return e.persistence.runTransaction("Configure indexes","readwrite",e=>r.getFieldIndexes(e).next(i=>(function(e,t,r,n,i){t=[...t],(e=[...e]).sort(r),t.sort(r);let o=e.length,a=t.length,s=0,u=0;for(;s<a&&u<o;){let o=r(e[u],t[s]);o<0?i(e[u++]):o>0?n(t[s++]):(s++,u++)}for(;s<a;)n(t[s++]);for(;u<o;)i(e[u++])})(i,t,e_,t=>{n.push(r.addFieldIndex(e,t))},t=>{n.push(r.deleteFieldIndex(e,t))})).next(()=>eF.waitFor(n)))})(await uD(r),n))}function ho(e,t){if("string"!=typeof e[t])throw new z(B.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}class ha{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function hs(e){var t;e=ev(e,u5);let r=hd.get(e);if(r)return r;if("persistent"!==(null==(t=u9(e)._uninitializedComponentsProvider)?void 0:t._offline.kind))return null;let n=new ha(e);return hd.set(e,n),n}function hu(e){hh(e,!0)}function hc(e){hh(e,!1)}function hl(e){var t;(t=u9(e._firestore)).asyncQueue.enqueue(async()=>(function(e){let t=e.indexManager;return e.persistence.runTransaction("Delete All Indexes","readwrite",e=>t.deleteAllFieldIndexes(e))})(await uD(t))).then(e=>R("deleting all persistent cache indexes succeeded")).catch(e=>j("deleting all persistent cache indexes failed",e))}function hh(e,t){var r;(r=u9(e._firestore),r.asyncQueue.enqueue(async()=>{var e;return e=await uD(r),void(e.Cs.Rs=t)})).then(e=>R(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>j(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}let hd=new WeakMap;function hf(e){var t;let r=null==(t=u9(ev(e.firestore,u5))._onlineComponents)?void 0:t.datastore.serializer;return void 0===r?null:iV(r,nl(e._query)).Vt}function hp(e,t){var r;let n=tX(t,(e,t)=>new n7(t,e.aggregateType,e._internalFieldPath)),i=null==(r=u9(ev(e.firestore,u5))._onlineComponents)?void 0:r.datastore.serializer;return void 0===i?null:iB(i,nh(e._query),n,!0).request}class hm{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return hg.instance.onExistenceFilterMismatch(e)}}class hg{constructor(){this.Fc=new Map}static get instance(){return hy||function(e){if(ir)throw Error("a TestingHooksSpi instance is already set");ir=e}(hy=new hg),hy}ct(e){this.Fc.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),r=this.Fc;return r.set(t,e),()=>r.delete(t)}}let hy=null;!function(e,t=!0){O=y.MF,(0,y.om)(new v.uA("firestore",(e,{instanceIdentifier:r,options:n})=>{let i=e.getProvider("app").getImmediate(),o=new u5(new W(e.getProvider("auth-internal")),new X(i,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new z(B.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new rf(e.options.projectId,t)}(i,r),i);return n=Object.assign({useFetchStreams:t},n),o._setSettings(n),o},"PUBLIC").setMultipleInstances(!0)),(0,y.KO)(_,P,void 0),(0,y.KO)(_,P,"esm2017")}()},2205:(e,t,r)=>{"use strict";r.d(t,{B:()=>n});let n="undefined"!=typeof window},2219:(e,t,r)=>{"use strict";r.d(t,{ce:()=>i,eZ:()=>o,sb:()=>n});var n="users",i="groups",o="players"},2322:(e,t,r)=>{"use strict";r.d(t,{Q5:()=>E});var n=r(8106),i=r(4319),o=r(950),a=r(5230),s=r(1223),u=r(2009),c=r(5519),l=r(132),h=r(4609),d=r(3649),f=r(2219),p=r(1411);function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e){return function(e){if(Array.isArray(e))return y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return y(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return y(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach(function(t){var n,i,o;n=e,i=t,o=r[t],(i=function(e){var t=function(e,t){if("object"!==m(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==m(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===m(t)?t:String(t)}(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function w(){w=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(t,r,n,o){var a,s,u,c,l=Object.create((r&&r.prototype instanceof y?r:y).prototype);return i(l,"_invoke",{value:(a=t,s=n,u=new A(o||[]),c=d,function(t,r){if(c===f)throw Error("Generator is already running");if(c===p){if("throw"===t)throw r;return{value:e,done:!0}}for(u.method=t,u.arg=r;;){var n=u.delegate;if(n){var i=function t(r,n){var i=n.method,o=r.iterator[i];if(o===e)return n.delegate=null,"throw"===i&&r.iterator.return&&(n.method="return",n.arg=e,t(r,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+i+"' method")),g;var a=h(o,r.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,g;var s=a.arg;return s?s.done?(n[r.resultName]=s.value,n.next=r.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):s:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,g)}(n,u);if(i){if(i===g)continue;return i}}if("next"===u.method)u.sent=u._sent=u.arg;else if("throw"===u.method){if(c===d)throw c=p,u.arg;u.dispatchException(u.arg)}else"return"===u.method&&u.abrupt("return",u.arg);c=f;var o=h(a,s,u);if("normal"===o.type){if(c=u.done?p:"suspendedYield",o.arg===g)continue;return{value:o.arg,done:u.done}}"throw"===o.type&&(c=p,u.method="throw",u.arg=o.arg)}})}),l}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var d="suspendedStart",f="executing",p="completed",g={};function y(){}function v(){}function b(){}var S={};c(S,a,function(){return this});var x=Object.getPrototypeOf,I=x&&x(x(O([])));I&&I!==r&&n.call(I,a)&&(S=I);var E=b.prototype=y.prototype=Object.create(S);function T(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function k(e,t){var r;i(this,"_invoke",{value:function(i,o){function a(){return new t(function(r,a){!function r(i,o,a,s){var u=h(e[i],e,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==m(l)&&n.call(l,"__await")?t.resolve(l.__await).then(function(e){r("next",e,a,s)},function(e){r("throw",e,a,s)}):t.resolve(l).then(function(e){c.value=e,a(c)},function(e){return r("throw",e,a,s)})}s(u.arg)}(i,o,r,a)})}return r=r?r.then(a,a):a()}})}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function O(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw TypeError(m(t)+" is not iterable")}return v.prototype=b,i(E,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:v,configurable:!0}),v.displayName=c(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c(e,u,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},T(k.prototype),c(k.prototype,s,function(){return this}),t.AsyncIterator=k,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new k(l(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},T(E),c(E,u,"Generator"),c(E,a,function(){return this}),c(E,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function S(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(n,i)}function x(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){S(o,n,i,a,s,"next",e)}function s(e){S(o,n,i,a,s,"throw",e)}a(void 0)})}}var I={currentGroupId:null,currentGroup:null,userGroups:[],status:"idle",error:null,_currentGroupListenerUnsubscribe:null,lastSettingsUpdateTimestamp:null,updateCurrentGroupScoreSettings:function(){var e=x(w().mark(function e(t,r){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}(),updateCurrentGroupStrokeSettings:function(){var e=x(w().mark(function e(t,r){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}(),updateCurrentGroupFarbeSettings:function(){var e=x(w().mark(function e(t,r){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}(),updateCurrentGroupCardStyle:function(){var e=x(w().mark(function e(t,r){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}()},E=(0,n.v)()((0,i.lt)((0,i.Zr)(function(e,t){var r,n,i,m,y,v,S,E,T,k,_,P;return b(b({},I),{},{_cleanupCurrentGroupListener:function(){var r=t()._currentGroupListenerUnsubscribe;r&&(r(),e({_currentGroupListenerUnsubscribe:null},!1,"cleanupListener"))},setCurrentGroup:function(r){var n,i=o.useAuthStore.getState();if(i.isLoggingOut)return void console.log("GROUP_STORE: Skipping setCurrentGroup during logout process");t()._cleanupCurrentGroupListener(),e({currentGroup:r},!1,"setCurrentGroup");var s=null==(n=i.user)?void 0:n.uid;s&&"authenticated"===i.status&&!i.isLoggingOut?(0,a.kQ)(s,{lastActiveGroupId:(null==r?void 0:r.id)||null}).catch(function(e){console.warn("GROUP_STORE: Failed to update lastActiveGroupId to ".concat((null==r?void 0:r.id)||"null"," for user ").concat(s," (maybe during logout?):"),e)}):console.log("GROUP_STORE: Skipping update of lastActiveGroupId for group ".concat((null==r?void 0:r.id)||"null"," because user is not authenticated or is logging out."))},setUserGroups:function(t){return e({userGroups:t.map(function(e){var t;return b(b({},e),{},{farbeSettings:null!=(t=e.farbeSettings)?t:l.FT})})},!1,"setUserGroups")},loadUserGroups:(r=x(w().mark(function t(r){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e({status:"idle",userGroups:[],error:"Deprecated function called"},!1,"loadUserGroups");case 1:case"end":return t.stop()}},t)})),function(e){return r.apply(this,arguments)}),loadUserGroupsByPlayerId:(n=x(w().mark(function r(n){var i,u,c,h,d;return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n){r.next=1;break}return e({userGroups:[],status:"error",error:"Player-ID fehlt."},!1,"loadGroupsByPlayerIdError"),r.abrupt("return");case 1:return e({status:"loading",error:null},!1,"loadGroupsByPlayerIdStart"),r.prev=2,r.next=3,(0,s.getUserGroupsByPlayerId)(n);case 3:i=r.sent.map(function(e){var t;return b(b({},e),{},{farbeSettings:null!=(t=e.farbeSettings)?t:l.FT})}),c=(u=t().currentGroup)&&i.some(function(e){return e.id===u.id}),e({userGroups:i,currentGroup:c?u:null,status:"success",error:null},!1,"loadGroupsByPlayerIdSuccess"),u&&!c&&(d=null==(h=o.useAuthStore.getState().user)?void 0:h.uid)&&(0,a.kQ)(d,{lastActiveGroupId:null}).catch(function(e){console.error("GROUP_STORE: Failed to clear lastActiveGroupId after current group became invalid:",e)}),r.next=5;break;case 4:r.prev=4,r.catch(2),e({status:"error",error:"Fehler beim Laden der Gruppen.",userGroups:[]},!1,"loadGroupsByPlayerIdFail");case 5:case"end":return r.stop()}},r,null,[[2,4]])})),function(e){return n.apply(this,arguments)}),fetchCurrentGroup:(i=x(w().mark(function r(n){var i,o;return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return e({status:"loading",error:null},!1,"fetchCurrentGroupStart"),r.prev=1,r.next=2,(0,s.getGroupById)(n);case 2:i=r.sent,t().setCurrentGroup(i),i||e({status:"error",error:"Gruppe nicht gefunden"},!1,"fetchCurrentGroupNotFound"),r.next=4;break;case 3:r.prev=3,e({status:"error",error:(o=r.catch(1))instanceof Error?o.message:"Fehler beim Laden der Gruppe",currentGroup:null},!1,"fetchCurrentGroupFail");case 4:case"end":return r.stop()}},r,null,[[1,3]])})),function(e){return i.apply(this,arguments)}),updateGroup:(m=x(w().mark(function r(n,i){var o,a,s,l,p,m,g=arguments;return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(o=!(g.length>2)||void 0===g[2]||g[2],a=d.useUIStore.getState(),n){r.next=1;break}return console.error("GROUP_STORE: updateGroup called without groupId."),a.showNotification({message:"Fehler: Gruppen-ID fehlt.",type:"error"}),r.abrupt("return");case 1:return s=(0,u.doc)(c.db,f.ce,n),r.prev=2,r.next=3,(0,u.updateDoc)(s,b(b({},i),{},{updatedAt:(0,u.serverTimestamp)()}));case 3:l=t(),e((0,h.jM)(l,function(e){e.currentGroup&&e.currentGroup.id===n&&(e.currentGroup=b(b(b({},e.currentGroup),i),{},{updatedAt:u.Timestamp.now()}));var t=e.userGroups.findIndex(function(e){return e.id===n});-1!==t&&(e.userGroups[t]=b(b(b({},e.userGroups[t]),i),{},{updatedAt:u.Timestamp.now()})),e.lastSettingsUpdateTimestamp=Date.now()})),o&&a.showNotification({message:"Gruppeneinstellungen gespeichert.",type:"success"}),r.next=6;break;case 4:if(r.prev=4,m=r.catch(2),console.error("GROUP_STORE: Error updating group ".concat(n,":"),m),!(m instanceof Error&&m.message.includes("No document to update"))){r.next=5;break}return console.warn("GROUP_STORE: Group ".concat(n," does not exist, silently ignoring update.")),r.abrupt("return");case 5:p="Fehler beim Speichern der Gruppeneinstellungen.",m instanceof Error&&(p+=": ".concat(m.message)),a.showNotification({message:p,type:"error"}),e({error:p},!1,"updateGroupError");case 6:case"end":return r.stop()}},r,null,[[2,4]])})),function(e,t){return m.apply(this,arguments)}),updateCurrentGroupFarbeSettings:(y=x(w().mark(function t(r,n){var i,o;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e({status:"loading"},!1,"updateCurrentGroupFarbeSettingsStart"),t.prev=1,i=(0,u.doc)(c.db,"groups",r),t.next=2,(0,u.updateDoc)(i,{farbeSettings:n,updatedAt:(0,u.serverTimestamp)()});case 2:e(function(e){return(0,h.jM)(e,function(e){e.currentGroup&&e.currentGroup.id===r&&(e.currentGroup.farbeSettings=n,e.currentGroup.updatedAt=u.Timestamp.now());var t=e.userGroups.findIndex(function(e){return e.id===r});-1!==t&&(e.userGroups[t].farbeSettings=n,e.userGroups[t].updatedAt=u.Timestamp.now()),e.status="idle"})},!1,"updateCurrentGroupFarbeSettingsSuccess"),t.next=5;break;case 3:if(t.prev=3,!((o=t.catch(1))instanceof Error&&o.message.includes("No document to update"))){t.next=4;break}return console.warn("GROUP_STORE: Group ".concat(r," does not exist, silently ignoring farbeSettings update.")),e({status:"idle"},!1,"updateCurrentGroupFarbeSettingsIgnored"),t.abrupt("return");case 4:throw e({status:"error",error:"Fehler beim Speichern der Farbeinstellungen."},!1,"updateCurrentGroupFarbeSettingsError"),o;case 5:case"end":return t.stop()}},t,null,[[1,3]])})),function(e,t){return y.apply(this,arguments)}),updateCurrentGroupScoreSettings:(v=x(w().mark(function t(r,n){var i,o;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e({status:"loading"},!1,"updateCurrentGroupScoreSettingsStart"),t.prev=1,i=(0,u.doc)(c.db,"groups",r),t.next=2,(0,u.updateDoc)(i,{scoreSettings:n,updatedAt:(0,u.serverTimestamp)()});case 2:e(function(e){return(0,h.jM)(e,function(e){e.currentGroup&&e.currentGroup.id===r&&(e.currentGroup.scoreSettings=n,e.currentGroup.updatedAt=u.Timestamp.now());var t=e.userGroups.findIndex(function(e){return e.id===r});-1!==t&&(e.userGroups[t].scoreSettings=n,e.userGroups[t].updatedAt=u.Timestamp.now()),e.status="idle"})},!1,"updateCurrentGroupScoreSettingsSuccess"),t.next=5;break;case 3:if(t.prev=3,!((o=t.catch(1))instanceof Error&&o.message.includes("No document to update"))){t.next=4;break}return console.warn("GROUP_STORE: Group ".concat(r," does not exist, silently ignoring scoreSettings update.")),e({status:"idle"},!1,"updateCurrentGroupScoreSettingsIgnored"),t.abrupt("return");case 4:throw e({status:"error",error:"Fehler beim Speichern der Punkteeinstellungen."},!1,"updateCurrentGroupScoreSettingsError"),o;case 5:case"end":return t.stop()}},t,null,[[1,3]])})),function(e,t){return v.apply(this,arguments)}),updateCurrentGroupStrokeSettings:(S=x(w().mark(function t(r,n){var i,o;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e({status:"loading"},!1,"updateCurrentGroupStrokeSettingsStart"),t.prev=1,i=(0,u.doc)(c.db,"groups",r),t.next=2,(0,u.updateDoc)(i,{strokeSettings:n,updatedAt:(0,u.serverTimestamp)()});case 2:e(function(e){return(0,h.jM)(e,function(e){e.currentGroup&&e.currentGroup.id===r&&(e.currentGroup.strokeSettings=n,e.currentGroup.updatedAt=u.Timestamp.now());var t=e.userGroups.findIndex(function(e){return e.id===r});-1!==t&&(e.userGroups[t].strokeSettings=n,e.userGroups[t].updatedAt=u.Timestamp.now()),e.status="idle"})},!1,"updateCurrentGroupStrokeSettingsSuccess"),t.next=5;break;case 3:if(t.prev=3,!((o=t.catch(1))instanceof Error&&o.message.includes("No document to update"))){t.next=4;break}return console.warn("GROUP_STORE: Group ".concat(r," does not exist, silently ignoring strokeSettings update.")),e({status:"idle"},!1,"updateCurrentGroupStrokeSettingsIgnored"),t.abrupt("return");case 4:throw e({status:"error",error:"Fehler beim Speichern der Stricheinstellungen."},!1,"updateCurrentGroupStrokeSettingsError"),o;case 5:case"end":return t.stop()}},t,null,[[1,3]])})),function(e,t){return S.apply(this,arguments)}),updateCurrentGroupCardStyle:(E=x(w().mark(function r(n,i){var o,a;return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(t().isCurrentUserAdmin(n)){r.next=1;break}throw Error("Nur Admins k\xf6nnen den Kartensatz \xe4ndern.");case 1:return o=(0,u.doc)(c.db,"groups",n),r.prev=2,r.next=3,(0,u.updateDoc)(o,{cardStyle:i});case 3:e(function(e){return{currentGroup:e.currentGroup?b(b({},e.currentGroup),{},{cardStyle:i}):null}}),r.next=6;break;case 4:if(r.prev=4,!((a=r.catch(2))instanceof Error&&a.message.includes("No document to update"))){r.next=5;break}return console.warn("GROUP_STORE: Group ".concat(n," does not exist, silently ignoring cardStyle update.")),r.abrupt("return");case 5:throw a;case 6:case"end":return r.stop()}},r,null,[[2,4]])})),function(e,t){return E.apply(this,arguments)}),updateGroupInList:function(t,r){e(function(e){var n=e.userGroups.findIndex(function(e){return e.id===t});if(-1===n)return{};var i,o,a,s=g(e.userGroups),u=b(b(b({},s[n]),r),{},{players:null!=(i=r.players)?i:s[n].players,farbeSettings:null!=(o=null!=(a=r.farbeSettings)?a:s[n].farbeSettings)?o:l.FT});return s[n]=u,{userGroups:s}},!1,"updateGroupInList")},addUserGroup:function(r){var n=t().userGroups;if(!n.some(function(e){return e.id===r.id})){var i,o=b(b({},r),{},{farbeSettings:null!=(i=r.farbeSettings)?i:l.FT,players:r.players});e({userGroups:[].concat(g(n),[o])},!1,"addUserGroup")}},updateMemberRole:(T=x(w().mark(function r(n,i){var o,a,s,l,m,g,y,v;return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(o=t().currentGroup,d.useUIStore.getState().showNotification,console.log("[updateMemberRole] Attempting to change role for playerId: ".concat(n," to ").concat(i)),!(!o||!n)){r.next=1;break}throw console.error("[updateMemberRole] Failed: Current group missing (".concat(!o,") or playerId missing (").concat(!n,").")),Error("Ung\xfcltige IDs f\xfcr Gruppen- oder Spieleroperation.");case 1:return a=o.id,console.log("[updateMemberRole] Target Group ID: ".concat(a)),e({status:"loading"},!1,"updateMemberRoleStart"),r.prev=2,console.log("[updateMemberRole] Calling getPlayerDocument for playerId: ".concat(n)),r.next=3,(0,p.getPlayerDocument)(n);case 3:if(s=r.sent,console.log("[updateMemberRole] Result from getPlayerDocument for ".concat(n,":"),s),!(!s||!s.userId)){r.next=4;break}throw console.error("[updateMemberRole] Failed: Player document not found (".concat(!s,") or userId missing (").concat(!(null!=s&&s.userId),") for playerId ").concat(n,".")),Error("Benutzerinformationen f\xfcr das Mitglied konnten nicht gefunden werden.");case 4:return l=s.userId,console.log("[updateMemberRole] Found targetUserId: ".concat(l," for playerId: ").concat(n)),m=(0,u.doc)(c.db,f.ce,a),g="admin"===i?{adminIds:(0,u.arrayUnion)(l)}:{adminIds:(0,u.arrayRemove)(l)},console.log("[updateMemberRole] Updating Firestore group ".concat(a," with:"),g),r.next=5,(0,u.updateDoc)(m,g);case 5:console.log("[updateMemberRole] Firestore update successful for group ".concat(a,".")),e(function(e){return(0,h.jM)(e,function(e){e.currentGroup&&("admin"===i?e.currentGroup.adminIds.includes(l)||e.currentGroup.adminIds.push(l):(e.currentGroup.adminIds.length,e.currentGroup.adminIds=e.currentGroup.adminIds.filter(function(e){return e!==l}),e.currentGroup.adminIds.length)),e.status="success",e.error=null})},!1,"updateMemberRoleSuccess"),r.next=8;break;case 6:if(r.prev=6,v=r.catch(2),console.error("GROUP_STORE: Failed to update role for playerId ".concat(n," to ").concat(i," in group ").concat(a,":"),v),!(v instanceof Error&&v.message.includes("No document to update"))){r.next=7;break}return console.warn("GROUP_STORE: Group ".concat(a," does not exist, silently ignoring role update for playerId ").concat(n,".")),e({status:"idle",error:null},!1,"updateMemberRoleIgnored"),r.abrupt("return");case 7:throw e({status:"error",error:y=v instanceof Error?v.message:"Rollen\xe4nderung fehlgeschlagen."},!1,"updateMemberRoleError"),Error(y);case 8:case"end":return r.stop()}},r,null,[[2,6]])})),function(e,t){return T.apply(this,arguments)}),setError:function(t){return e({status:"error",error:t},!1,"setError")},clearError:function(){return e({error:null},!1,"clearError")},resetGroupStore:function(){t()._cleanupCurrentGroupListener(),e(I)},loadGroup:(k=x(w().mark(function e(t){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),function(e){return k.apply(this,arguments)}),leaveGroup:(_=x(w().mark(function e(t,r){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),function(e,t){return _.apply(this,arguments)}),subscribeToGroup:function(e){},unsubscribeFromGroup:function(){},setCurrentGroupId:function(t){return e({currentGroupId:t})},clearGroupState:function(){return e(b({},I))},isCurrentUserAdmin:function(e){var r=t().currentGroup,n=o.useAuthStore.getState().user,i=null!=e?e:null==r?void 0:r.id;return!!n&&!!r&&r.id===i&&Array.isArray(r.adminIds)&&r.adminIds.includes(n.uid)},updateCurrentGroupJassSettings:(P=x(w().mark(function r(n,i){var o,a,s,p,m,g;return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(o=d.useUIStore.getState(),n){r.next=1;break}return console.error("GROUP_STORE: updateCurrentGroupJassSettings called without groupId."),o.showNotification({message:"Fehler: Gruppen-ID f\xfcr Jass-Einstellungen fehlt.",type:"error"}),r.abrupt("return");case 1:return a=(0,u.doc)(c.db,f.ce,n),r.prev=2,s={scoreSettings:i.scoreSettings,strokeSettings:i.strokeSettings,"farbeSettings.values":i.farbeSettingsValues,"farbeSettings.cardStyle":i.cardStyle,updatedAt:(0,u.serverTimestamp)()},r.next=3,(0,u.updateDoc)(a,s);case 3:p=t(),e((0,h.jM)(p,function(e){e.currentGroup&&e.currentGroup.id===n&&(e.currentGroup=b(b({},e.currentGroup),{},{scoreSettings:i.scoreSettings,strokeSettings:i.strokeSettings,farbeSettings:b(b({},e.currentGroup.farbeSettings||l.FT),{},{values:i.farbeSettingsValues,cardStyle:i.cardStyle}),updatedAt:u.Timestamp.now()}));var t=e.userGroups.findIndex(function(e){return e.id===n});-1!==t&&(e.userGroups[t]=b(b({},e.userGroups[t]),{},{scoreSettings:i.scoreSettings,strokeSettings:i.strokeSettings,farbeSettings:b(b({},e.userGroups[t].farbeSettings||l.FT),{},{values:i.farbeSettingsValues,cardStyle:i.cardStyle}),updatedAt:u.Timestamp.now()})),e.lastSettingsUpdateTimestamp=Date.now()})),o.showNotification({message:"Jass-Einstellungen erfolgreich aktualisiert.",type:"success"}),r.next=6;break;case 4:if(r.prev=4,console.error("GROUP_STORE: Fehler beim Aktualisieren der Jass-Einstellungen f\xfcr Gruppe",n,g=r.catch(2)),!(g instanceof Error&&g.message.includes("No document to update"))){r.next=5;break}return console.warn("GROUP_STORE: Group ".concat(n," does not exist, silently ignoring Jass-Einstellungen update.")),r.abrupt("return");case 5:m="Fehler beim Aktualisieren der Jass-Einstellungen.",g instanceof Error&&(m+=": ".concat(g.message)),o.showNotification({message:m,type:"error"}),e({error:m},!1,"updateJassSettingsError");case 6:case"end":return r.stop()}},r,null,[[2,4]])})),function(e,t){return P.apply(this,arguments)})})},{name:"jass-group-storage",storage:(0,i.KU)(function(){return localStorage}),partialize:function(e){return{currentGroupId:e.currentGroupId,userGroups:e.userGroups.map(function(e){return{id:e.id,name:e.name,description:e.description,createdAt:e.createdAt,createdBy:e.createdBy,updatedAt:e.updatedAt,playerIds:e.playerIds,adminIds:e.adminIds,isPublic:e.isPublic,logoUrl:e.logoUrl,farbeSettings:e.farbeSettings,scoreSettings:e.scoreSettings,strokeSettings:e.strokeSettings,cardStyle:e.cardStyle}})}},onRehydrateStorage:function(){return function(e,t){if(t){null==e||e.resetGroupStore();return}null==e||e.currentGroupId}},version:1,migrate:function(e,t){return 0===t?(console.log("Migrating GroupStore from version 0 to 1..."),{currentGroupId:e.currentGroupId,userGroups:(e.userGroups||[]).map(function(e){return{id:e.id,name:e.name,description:e.description,createdBy:e.createdBy,createdAt:e.createdAt,updatedAt:e.updatedAt,playerIds:e.playerIds,adminIds:e.adminIds,isPublic:e.isPublic,logoUrl:e.logoUrl,farbeSettings:e.farbeSettings,scoreSettings:e.scoreSettings,strokeSettings:e.strokeSettings,memberUserIds:[]}})}):(console.log("GroupStore: No migration needed for version ".concat(t,".")),e)}}),{name:"GroupStore"}))},2604:(e,t,r)=>{"use strict";r.d(t,{g:()=>function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=a({removeEmptyArrays:!1,removeEmptyObjects:!1,replaceNaNWith:0,fixDuplicateFields:!0},r);if(null==t)return null;if("number"==typeof t&&isNaN(t))return o.replaceNaNWith;if("object"!==i(t)||t instanceof n.Timestamp||t instanceof n.FieldValue||t&&"object"===i(t)&&("_methodName"in t||"_seconds"in t&&"_nanoseconds"in t)||t instanceof Date)return t;if(Array.isArray(t)){var s=t.map(function(t){return e(t,o)}).filter(function(e){return!(o.removeEmptyArrays&&Array.isArray(e)&&0===e.length)}).filter(function(e){return!(o.removeEmptyObjects&&"object"===i(e)&&null!==e&&!Array.isArray(e)&&0===Object.keys(e).length)});return o.removeEmptyArrays&&0===s.length?null:s}var u={};if(o.fixDuplicateFields&&"weisPoints"in t&&"roundHistory"in t&&Array.isArray(t.roundHistory)){var c=a({},t);c.roundHistory&&Array.isArray(c.roundHistory)&&(c.roundHistory=c.roundHistory.map(function(e){if(e&&"object"===i(e)&&!Array.isArray(e)){var t=a({},e);return"weisPoints"in t&&(t._savedWeisPoints=t.weisPoints),t}return e})),t=c}for(var l in t)if(Object.prototype.hasOwnProperty.call(t,l)){var h=e(t[l],o);if(o.removeEmptyArrays&&Array.isArray(h)&&0===h.length||o.removeEmptyObjects&&"object"===i(h)&&null!==h&&!Array.isArray(h)&&0===Object.keys(h).length)continue;u[l]=h}return o.removeEmptyObjects&&0===Object.keys(u).length?null:u}});var n=r(2009);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach(function(t){var n,o,a;n=e,o=t,a=r[t],(o=function(e){var t=function(e,t){if("object"!==i(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==i(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===i(t)?t:String(t)}(o))in n?Object.defineProperty(n,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[o]=a}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}},2704:(e,t,r)=>{"use strict";let n,i;r.d(t,{P2:()=>p});let o=(e,t)=>t.some(t=>e instanceof t),a=new WeakMap,s=new WeakMap,u=new WeakMap,c=new WeakMap,l=new WeakMap,h={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return s.get(e);if("objectStoreNames"===t)return e.objectStoreNames||u.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return d(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function d(e){if(e instanceof IDBRequest){let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",o)},i=()=>{t(d(e.result)),n()},o=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",o)});return t.then(t=>{t instanceof IDBCursor&&a.set(t,e)}).catch(()=>{}),l.set(t,e),t}if(c.has(e))return c.get(e);let t=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(f(this),t),d(a.get(this))}:function(...t){return d(e.apply(f(this),t))}:function(t,...r){let n=e.call(f(this),t,...r);return u.set(n,t.sort?t.sort():[t]),d(n)};return(e instanceof IDBTransaction&&function(e){if(s.has(e))return;let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=()=>{t(),n()},o=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)});s.set(e,t)}(e),o(e,n||(n=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(e,h):e}(e);return t!==e&&(c.set(e,t),l.set(t,e)),t}let f=e=>l.get(e);function p(e,t,{blocked:r,upgrade:n,blocking:i,terminated:o}={}){let a=indexedDB.open(e,t),s=d(a);return n&&a.addEventListener("upgradeneeded",e=>{n(d(a.result),e.oldVersion,e.newVersion,d(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),s.then(e=>{o&&e.addEventListener("close",()=>o()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),s}let m=["get","getKey","getAll","getAllKeys","count"],g=["put","add","delete","clear"],y=new Map;function v(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(y.get(t))return y.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,i=g.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||m.includes(r)))return;let o=async function(e,...t){let o=this.transaction(e,i?"readwrite":"readonly"),a=o.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),i&&o.done]))[0]};return y.set(t,o),o}h=(e=>({...e,get:(t,r,n)=>v(t,r)||e.get(t,r,n),has:(t,r)=>!!v(t,r)||e.has(t,r)}))(h)},2909:(e,t,r)=>{"use strict";var n=r(1370),i=r(7247),o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,s.prototype),t}function s(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return l(e)}return u(e,t,r)}function u(e,t,r){if("string"==typeof e){var n=e,i=t;if(("string"!=typeof i||""===i)&&(i="utf8"),!s.isEncoding(i))throw TypeError("Unknown encoding: "+i);var o=0|p(n,i),u=a(o),c=u.write(n,i);return c!==o&&(u=u.slice(0,c)),u}if(ArrayBuffer.isView(e)){var l=e;if(A(l,Uint8Array)){var m=new Uint8Array(l);return d(m.buffer,m.byteOffset,m.byteLength)}return h(l)}if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(A(e,ArrayBuffer)||e&&A(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(A(e,SharedArrayBuffer)||e&&A(e.buffer,SharedArrayBuffer)))return d(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var g=e.valueOf&&e.valueOf();if(null!=g&&g!==e)return s.from(g,t,r);var y=function(e){if(s.isBuffer(e)){var t=0|f(e.length),r=a(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?a(0):h(e):"Buffer"===e.type&&Array.isArray(e.data)?h(e.data):void 0}(e);if(y)return y;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return s.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function c(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function l(e){return c(e),a(e<0?0:0|f(e))}function h(e){for(var t=e.length<0?0:0|f(e.length),r=a(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function d(e,t,r){var n;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),s.prototype),n}function f(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function p(e,t){if(s.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||A(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return k(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return _(e).length;default:if(i)return n?-1:k(e).length;t=(""+t).toLowerCase(),i=!0}}function m(e,t,r){var i,o,a,s=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=O[e[o]];return i}(this,t,r);case"utf8":case"utf-8":return b(this,t,r);case"ascii":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}(this,t,r);case"latin1":case"binary":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}(this,t,r);case"base64":return i=this,o=t,a=r,0===o&&a===i.length?n.fromByteArray(i):n.fromByteArray(i.slice(o,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length-1;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}(this,t,r);default:if(s)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),s=!0}}function g(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function y(e,t,r,n,i){var o;if(0===e.length)return -1;if("string"==typeof r?(n=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),(o=r*=1)!=o&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length)if(i)return -1;else r=e.length-1;else if(r<0)if(!i)return -1;else r=0;if("string"==typeof t&&(t=s.from(t,n)),s.isBuffer(t))return 0===t.length?-1:v(e,t,r,n,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,r);else return Uint8Array.prototype.lastIndexOf.call(e,t,r);return v(e,[t],r,n,i)}throw TypeError("val must be string, number or Buffer")}function v(e,t,r,n,i){var o,a=1,s=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return -1;a=2,s/=2,u/=2,r/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var l=-1;for(o=r;o<s;o++)if(c(e,o)===c(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*a}else -1!==l&&(o-=o-l),l=-1}else for(r+u>s&&(r=s-u),o=r;o>=0;o--){for(var h=!0,d=0;d<u;d++)if(c(e,o+d)!==c(t,d)){h=!1;break}if(h)return o}return -1}function b(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,a,s,u,c=e[i],l=null,h=c>239?4:c>223?3:c>191?2:1;if(i+h<=r)switch(h){case 1:c<128&&(l=c);break;case 2:(192&(o=e[i+1]))==128&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=e[i+1],a=e[i+2],(192&o)==128&&(192&a)==128&&(u=(15&c)<<12|(63&o)<<6|63&a)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],(192&o)==128&&(192&a)==128&&(192&s)==128&&(u=(15&c)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&u<1114112&&(l=u)}null===l?(l=65533,h=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=h}var d=n,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var p="",m=0;m<f;)p+=String.fromCharCode.apply(String,d.slice(m,m+=4096));return p}function w(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function S(e,t,r,n,i,o){if(!s.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw RangeError('"value" argument is out of bounds');if(r+n>e.length)throw RangeError("Index out of range")}function x(e,t,r,n,i,o){if(r+n>e.length||r<0)throw RangeError("Index out of range")}function I(e,t,r,n,o){return t*=1,r>>>=0,o||x(e,t,r,4,34028234663852886e22,-34028234663852886e22),i.write(e,t,r,n,23,4),r+4}function E(e,t,r,n,o){return t*=1,r>>>=0,o||x(e,t,r,8,17976931348623157e292,-17976931348623157e292),i.write(e,t,r,n,52,8),r+8}t.hp=s,t.IS=50,s.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),s.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}}),s.poolSize=8192,s.from=function(e,t,r){return u(e,t,r)},Object.setPrototypeOf(s.prototype,Uint8Array.prototype),Object.setPrototypeOf(s,Uint8Array),s.alloc=function(e,t,r){return(c(e),e<=0)?a(e):void 0!==t?"string"==typeof r?a(e).fill(t,r):a(e).fill(t):a(e)},s.allocUnsafe=function(e){return l(e)},s.allocUnsafeSlow=function(e){return l(e)},s.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==s.prototype},s.compare=function(e,t){if(A(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),A(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),!s.isBuffer(e)||!s.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:+(n<r)},s.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return s.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;var r,n=s.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var o=e[r];if(A(o,Uint8Array))i+o.length>n.length?s.from(o).copy(n,i):Uint8Array.prototype.set.call(n,o,i);else if(s.isBuffer(o))o.copy(n,i);else throw TypeError('"list" argument must be an Array of Buffers');i+=o.length}return n},s.byteLength=p,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},s.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},s.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},s.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?b(this,0,e):m.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(e){if(!s.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===s.compare(this,e)},s.prototype.inspect=function(){var e="",r=t.IS;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},o&&(s.prototype[o]=s.prototype.inspect),s.prototype.compare=function(e,t,r,n,i){if(A(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),!s.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var o=i-n,a=r-t,u=Math.min(o,a),c=this.slice(n,i),l=e.slice(t,r),h=0;h<u;++h)if(c[h]!==l[h]){o=c[h],a=l[h];break}return o<a?-1:+(a<o)},s.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},s.prototype.indexOf=function(e,t,r){return y(this,e,t,r,!0)},s.prototype.lastIndexOf=function(e,t,r){return y(this,e,t,r,!1)},s.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,o,a,s,u,c,l,h,d=this.length-t;if((void 0===r||r>d)&&(r=d),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var f=!1;;)switch(n){case"hex":return function(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;n>o/2&&(n=o/2);for(var a=0;a<n;++a){var s,u=parseInt(t.substr(2*a,2),16);if((s=u)!=s)break;e[r+a]=u}return a}(this,e,t,r);case"utf8":case"utf-8":return i=t,o=r,P(k(e,this.length-i),this,i,o);case"ascii":case"latin1":case"binary":return a=t,s=r,P(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(e),this,a,s);case"base64":return u=t,c=r,P(_(e),this,u,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return l=t,h=r,P(function(e,t){for(var r,n,i=[],o=0;o<e.length&&!((t-=2)<0);++o)n=(r=e.charCodeAt(o))>>8,i.push(r%256),i.push(n);return i}(e,this.length-l),this,l,h);default:if(f)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),f=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},s.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,s.prototype),n},s.prototype.readUintLE=s.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},s.prototype.readUintBE=s.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},s.prototype.readUint8=s.prototype.readUInt8=function(e,t){return e>>>=0,t||w(e,1,this.length),this[e]},s.prototype.readUint16LE=s.prototype.readUInt16LE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]|this[e+1]<<8},s.prototype.readUint16BE=s.prototype.readUInt16BE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]<<8|this[e+1]},s.prototype.readUint32LE=s.prototype.readUInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},s.prototype.readUint32BE=s.prototype.readUInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},s.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},s.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},s.prototype.readInt8=function(e,t){return(e>>>=0,t||w(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},s.prototype.readInt16LE=function(e,t){e>>>=0,t||w(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?0xffff0000|r:r},s.prototype.readInt16BE=function(e,t){e>>>=0,t||w(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?0xffff0000|r:r},s.prototype.readInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},s.prototype.readInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},s.prototype.readFloatLE=function(e,t){return e>>>=0,t||w(e,4,this.length),i.read(this,e,!0,23,4)},s.prototype.readFloatBE=function(e,t){return e>>>=0,t||w(e,4,this.length),i.read(this,e,!1,23,4)},s.prototype.readDoubleLE=function(e,t){return e>>>=0,t||w(e,8,this.length),i.read(this,e,!0,52,8)},s.prototype.readDoubleBE=function(e,t){return e>>>=0,t||w(e,8,this.length),i.read(this,e,!1,52,8)},s.prototype.writeUintLE=s.prototype.writeUIntLE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;S(this,e,t,r,i,0)}var o=1,a=0;for(this[t]=255&e;++a<r&&(o*=256);)this[t+a]=e/o&255;return t+r},s.prototype.writeUintBE=s.prototype.writeUIntBE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;S(this,e,t,r,i,0)}var o=r-1,a=1;for(this[t+o]=255&e;--o>=0&&(a*=256);)this[t+o]=e/a&255;return t+r},s.prototype.writeUint8=s.prototype.writeUInt8=function(e,t,r){return e*=1,t>>>=0,r||S(this,e,t,1,255,0),this[t]=255&e,t+1},s.prototype.writeUint16LE=s.prototype.writeUInt16LE=function(e,t,r){return e*=1,t>>>=0,r||S(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeUint16BE=s.prototype.writeUInt16BE=function(e,t,r){return e*=1,t>>>=0,r||S(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeUint32LE=s.prototype.writeUInt32LE=function(e,t,r){return e*=1,t>>>=0,r||S(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},s.prototype.writeUint32BE=s.prototype.writeUInt32BE=function(e,t,r){return e*=1,t>>>=0,r||S(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeIntLE=function(e,t,r,n){if(e*=1,t>>>=0,!n){var i=Math.pow(2,8*r-1);S(this,e,t,r,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<r&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a|0)-s&255;return t+r},s.prototype.writeIntBE=function(e,t,r,n){if(e*=1,t>>>=0,!n){var i=Math.pow(2,8*r-1);S(this,e,t,r,i-1,-i)}var o=r-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a|0)-s&255;return t+r},s.prototype.writeInt8=function(e,t,r){return e*=1,t>>>=0,r||S(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},s.prototype.writeInt16LE=function(e,t,r){return e*=1,t>>>=0,r||S(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeInt16BE=function(e,t,r){return e*=1,t>>>=0,r||S(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeInt32LE=function(e,t,r){return e*=1,t>>>=0,r||S(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},s.prototype.writeInt32BE=function(e,t,r){return e*=1,t>>>=0,r||S(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeFloatLE=function(e,t,r){return I(this,e,t,!0,r)},s.prototype.writeFloatBE=function(e,t,r){return I(this,e,t,!1,r)},s.prototype.writeDoubleLE=function(e,t,r){return E(this,e,t,!0,r)},s.prototype.writeDoubleBE=function(e,t,r){return E(this,e,t,!1,r)},s.prototype.copy=function(e,t,r,n){if(!s.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),i},s.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!s.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===e.length){var i,o=e.charCodeAt(0);("utf8"===n&&o<128||"latin1"===n)&&(e=o)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var a=s.isBuffer(e)?e:s.from(e,n),u=a.length;if(0===u)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=a[i%u]}return this};var T=/[^+/0-9A-Za-z-_]/g;function k(e,t){t=t||1/0;for(var r,n=e.length,i=null,o=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319||a+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return o}function _(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(T,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function P(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length)&&!(i>=e.length);++i)t[i+r]=e[i];return i}function A(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var O=function(){for(var e="0123456789abcdef",t=Array(256),r=0;r<16;++r)for(var n=16*r,i=0;i<16;++i)t[n+i]=e[r]+e[i];return t}()},3021:()=>{},3042:(e,t,r)=>{"use strict";r.d(t,{h:()=>s});var n=r(4232),i=r(3786),o=r(5519);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function s(){var e,t=function(e){if(Array.isArray(e))return e}(e=(0,n.useState)({user:null,isLoading:!0,error:null}))||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],u=!0,c=!1;try{o=(r=r.call(e)).next,!1;for(;!(u=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,2)||function(e,t){if(e){if("string"==typeof e)return a(e,2);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}}(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),r=t[0],s=t[1];return(0,n.useEffect)(function(){var e=(0,i.xI)(o.xv),t=(0,i.hg)(e,function(e){s({user:e,isLoading:!1,error:null})},function(e){console.error("Auth error:",e),s({user:null,isLoading:!1,error:e})});return function(){return t()}},[]),r}},3177:(e,t,r)=>{"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(){i=function(){return t};var e,t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function h(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(e){h=function(e,t,r){return e[t]=r}}function d(t,r,n,i){var o,s,u,c,l=Object.create((r&&r.prototype instanceof v?r:v).prototype);return a(l,"_invoke",{value:(o=t,s=n,u=new A(i||[]),c=p,function(t,r){if(c===m)throw Error("Generator is already running");if(c===g){if("throw"===t)throw r;return{value:e,done:!0}}for(u.method=t,u.arg=r;;){var n=u.delegate;if(n){var i=function t(r,n){var i=n.method,o=r.iterator[i];if(o===e)return n.delegate=null,"throw"===i&&r.iterator.return&&(n.method="return",n.arg=e,t(r,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+i+"' method")),y;var a=f(o,r.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,y;var s=a.arg;return s?s.done?(n[r.resultName]=s.value,n.next=r.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):s:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,y)}(n,u);if(i){if(i===y)continue;return i}}if("next"===u.method)u.sent=u._sent=u.arg;else if("throw"===u.method){if(c===p)throw c=g,u.arg;u.dispatchException(u.arg)}else"return"===u.method&&u.abrupt("return",u.arg);c=m;var a=f(o,s,u);if("normal"===a.type){if(c=u.done?g:"suspendedYield",a.arg===y)continue;return{value:a.arg,done:u.done}}"throw"===a.type&&(c=g,u.method="throw",u.arg=a.arg)}})}),l}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var p="suspendedStart",m="executing",g="completed",y={};function v(){}function b(){}function w(){}var S={};h(S,u,function(){return this});var x=Object.getPrototypeOf,I=x&&x(x(O([])));I&&I!==r&&o.call(I,u)&&(S=I);var E=w.prototype=v.prototype=Object.create(S);function T(e){["next","throw","return"].forEach(function(t){h(e,t,function(e){return this._invoke(t,e)})})}function k(e,t){var r;a(this,"_invoke",{value:function(i,a){function s(){return new t(function(r,s){!function r(i,a,s,u){var c=f(e[i],e,a);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==n(h)&&o.call(h,"__await")?t.resolve(h.__await).then(function(e){r("next",e,s,u)},function(e){r("throw",e,s,u)}):t.resolve(h).then(function(e){l.value=e,s(l)},function(e){return r("throw",e,s,u)})}u(c.arg)}(i,a,r,s)})}return r=r?r.then(s,s):s()}})}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function O(t){if(t||""===t){var r=t[u];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function r(){for(;++i<t.length;)if(o.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw TypeError(n(t)+" is not iterable")}return b.prototype=w,a(E,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:b,configurable:!0}),b.displayName=h(w,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,h(e,l,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},T(k.prototype),h(k.prototype,c,function(){return this}),t.AsyncIterator=k,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new k(d(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},T(E),h(E,l,"Generator"),h(E,u,function(){return this}),h(E,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var u=o.call(a,"catchLoc"),c=o.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function o(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(n,i)}function a(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var a=e.apply(t,r);function s(e){o(a,n,i,s,u,"next",e)}function u(e){o(a,n,i,s,u,"throw",e)}s(void 0)})}}r.d(t,{LP:()=>p,dd:()=>f,eW:()=>h});function s(e,t,r){return(t=u(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e){var t=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!==n(i))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===n(t)?t:String(t)}var c=function(){var e,t,r,n,o,c,l,h,d,f,p,m;return p=function e(){if(!(this instanceof e))throw TypeError("Cannot call a class as a function");s(this,"dbName","JasstafelOfflineDB"),s(this,"dbVersion",1),s(this,"db",null)},m=[{key:"init",value:(e=a(i().mark(function e(){var t=this;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,r){var n=indexedDB.open(t.dbName,t.dbVersion);n.onerror=function(){return r(n.error)},n.onsuccess=function(){t.db=n.result,e()},n.onupgradeneeded=function(e){var t=e.target.result;if(!t.objectStoreNames.contains("syncQueue")){var r=t.createObjectStore("syncQueue",{keyPath:"id"});r.createIndex("timestamp","timestamp"),r.createIndex("type","type"),r.createIndex("attempts","attempts")}if(!t.objectStoreNames.contains("offlineGames")){var n=t.createObjectStore("offlineGames",{keyPath:"id"});n.createIndex("sessionId","sessionId"),n.createIndex("timestamp","timestamp"),n.createIndex("synced","synced")}t.objectStoreNames.contains("gameSettings")||t.createObjectStore("gameSettings",{keyPath:"sessionId"}).createIndex("timestamp","timestamp")}}));case 1:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)})},{key:"addToSyncQueue",value:(t=a(i().mark(function e(t){var r=this;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.db){e.next=1;break}throw Error("DB not initialized");case 1:return e.abrupt("return",new Promise(function(e,n){var i=r.db.transaction(["syncQueue"],"readwrite").objectStore("syncQueue").add(t);i.onerror=function(){return n(i.error)},i.onsuccess=function(){console.log("[OfflineDB] ✅ Sync item added to queue: ".concat(t.id)),e()}}));case 2:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"getPendingSyncItems",value:(r=a(i().mark(function e(){var t=this;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.db){e.next=1;break}throw Error("DB not initialized");case 1:return e.abrupt("return",new Promise(function(e,r){var n=t.db.transaction(["syncQueue"],"readonly").objectStore("syncQueue").index("timestamp").getAll();n.onerror=function(){return r(n.error)},n.onsuccess=function(){var t=n.result;t.sort(function(e,t){return e.attempts!==t.attempts?e.attempts-t.attempts:t.timestamp-e.timestamp}),e(t)}}));case 2:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"removeSyncItem",value:(n=a(i().mark(function e(t){var r=this;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.db){e.next=1;break}throw Error("DB not initialized");case 1:return e.abrupt("return",new Promise(function(e,n){var i=r.db.transaction(["syncQueue"],"readwrite").objectStore("syncQueue").delete(t);i.onerror=function(){return n(i.error)},i.onsuccess=function(){console.log("[OfflineDB] ✅ Sync item removed from queue: ".concat(t)),e()}}));case 2:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"updateSyncItem",value:(o=a(i().mark(function e(t){var r=this;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.db){e.next=1;break}throw Error("DB not initialized");case 1:return e.abrupt("return",new Promise(function(e,n){var i=r.db.transaction(["syncQueue"],"readwrite").objectStore("syncQueue").put(t);i.onerror=function(){return n(i.error)},i.onsuccess=function(){console.log("[OfflineDB] ✅ Sync item updated: ".concat(t.id," (attempts: ").concat(t.attempts,")")),e()}}));case 2:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"saveOfflineGame",value:(c=a(i().mark(function e(t){var r=this;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.db){e.next=1;break}throw Error("DB not initialized");case 1:return e.abrupt("return",new Promise(function(e,n){var i=r.db.transaction(["offlineGames"],"readwrite").objectStore("offlineGames").put(t);i.onerror=function(){return n(i.error)},i.onsuccess=function(){console.log("[OfflineDB] ✅ Offline game saved: ".concat(t.id)),e()}}));case 2:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"getOfflineGames",value:(l=a(i().mark(function e(t){var r=this;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.db){e.next=1;break}throw Error("DB not initialized");case 1:return e.abrupt("return",new Promise(function(e,n){var i,o=r.db.transaction(["offlineGames"],"readonly").objectStore("offlineGames");(i=t?o.index("sessionId").getAll(t):o.getAll()).onerror=function(){return n(i.error)},i.onsuccess=function(){return e(i.result)}}));case 2:case"end":return e.stop()}},e,this)})),function(e){return l.apply(this,arguments)})},{key:"clearSyncedGames",value:(h=a(i().mark(function e(){var t=this;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.db){e.next=1;break}throw Error("DB not initialized");case 1:return e.abrupt("return",new Promise(function(e,r){var n=t.db.transaction(["offlineGames"],"readwrite").objectStore("offlineGames").index("synced").openCursor();n.onerror=function(){return r(n.error)},n.onsuccess=function(t){var r=t.target.result;r?(r.value.synced&&r.delete(),r.continue()):(console.log("[OfflineDB] ✅ Synced games cleared"),e())}}));case 2:case"end":return e.stop()}},e,this)})),function(){return h.apply(this,arguments)})},{key:"saveGameSettings",value:(d=a(i().mark(function e(t,r){var n=this;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.db){e.next=1;break}throw Error("DB not initialized");case 1:return e.abrupt("return",new Promise(function(e,i){var o=n.db.transaction(["gameSettings"],"readwrite").objectStore("gameSettings"),a={sessionId:t,settings:r,timestamp:Date.now()},s=o.put(a);s.onerror=function(){return i(s.error)},s.onsuccess=function(){console.log("[OfflineDB] ✅ Game settings saved for session: ".concat(t)),e()}}));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return d.apply(this,arguments)})},{key:"getGameSettings",value:(f=a(i().mark(function e(t){var r=this;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.db){e.next=1;break}throw Error("DB not initialized");case 1:return e.abrupt("return",new Promise(function(e,n){var i=r.db.transaction(["gameSettings"],"readonly").objectStore("gameSettings").get(t);i.onerror=function(){return n(i.error)},i.onsuccess=function(){var t=i.result;e(t?t.settings:null)}}));case 2:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})}],function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,u(n.key),n)}}(p.prototype,m),Object.defineProperty(p,"prototype",{writable:!1}),p}(),l=null,h=function(){var e=a(i().mark(function e(){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(l){e.next=1;break}return l=new c,e.next=1,l.init();case 1:return e.abrupt("return",l);case 2:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),d=function(){var e=a(i().mark(function e(){var t,r,n,o,a;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,console.log("\uD83D\uDD27 [IndexedDB Recovery] Starte Reparatur korrupter IndexedDB..."),t=["keyval-store","firebase-installations-store","firebase-messaging-store","firebaseLocalStorageDb","firebase-app-check-store","jassguru-app-store","_defaultdb"],r=i().mark(function e(){var t,r;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=o[n],e.prev=1,console.log("\uD83D\uDDD1️ [IndexedDB Recovery] L\xf6sche Datenbank: ".concat(t)),e.next=2,new Promise(function(e,r){var n=indexedDB.deleteDatabase(t);n.onsuccess=function(){console.log("✅ [IndexedDB Recovery] ".concat(t," erfolgreich gel\xf6scht")),e()},n.onerror=function(){console.log("⚠️ [IndexedDB Recovery] ".concat(t," nicht gefunden (OK)")),e()},n.onblocked=function(){console.log("\uD83D\uDD04 [IndexedDB Recovery] ".concat(t," blockiert, warte...")),setTimeout(function(){return e()},1e3)}});case 2:e.next=4;break;case 3:e.prev=3,r=e.catch(1),console.log("⚠️ [IndexedDB Recovery] Fehler bei ".concat(t,":"),r);case 4:case"end":return e.stop()}},e,null,[[1,3]])}),n=0,o=t;case 1:if(!(n<o.length)){e.next=3;break}return e.delegateYield(r(),"t0",2);case 2:n++,e.next=1;break;case 3:Object.keys(localStorage).filter(function(e){return e.includes("zustand")||e.includes("jassguru")||e.includes("firebase")||e.includes("tutorial")||e.includes("auth")}).forEach(function(e){try{localStorage.removeItem(e),console.log("\uD83D\uDDD1️ [IndexedDB Recovery] LocalStorage Key gel\xf6scht: ".concat(e))}catch(e){console.log("⚠️ [IndexedDB Recovery] Fehler bei LocalStorage:",e)}}),console.log("✅ [IndexedDB Recovery] IndexedDB Reparatur abgeschlossen"),e.next=5;break;case 4:throw e.prev=4,console.error("❌ [IndexedDB Recovery] Kritischer Fehler bei DB-Reparatur:",a=e.catch(0)),a;case 5:case"end":return e.stop()}},e,null,[[0,4]])}));return function(){return e.apply(this,arguments)}}(),f=function(){var e=a(i().mark(function e(){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,d();case 1:setTimeout(function(){console.log("\uD83D\uDD04 [IndexedDB Recovery] Lade Seite neu..."),window.location.reload()},1e3),e.next=3;break;case 2:e.prev=2,console.error("❌ [IndexedDB Recovery] Fehler bei Korruptions-Behandlung:",e.catch(0)),setTimeout(function(){window.location.href=window.location.href},2e3);case 3:case"end":return e.stop()}},e,null,[[0,2]])}));return function(){return e.apply(this,arguments)}}(),p=function(e){if(!e)return!1;var t=e.message||e.toString();return t.includes("refusing to open IndexedDB")||t.includes("potential corruption")||t.includes("lastClosedDbVersion")||"VersionError"===e.name&&t.includes("database")}},3355:(e,t,r)=>{"use strict";let n;function i(e){return null!==e&&"object"==typeof e&&"function"==typeof e.start}function o(e){let t=[{},{}];return e?.values.forEach((e,r)=>{t[0][r]=e.get(),t[1][r]=e.getVelocity()}),t}function a(e,t,r,n){if("function"==typeof t){let[i,a]=o(n);t=t(void 0!==r?r:e.custom,i,a)}if("string"==typeof t&&(t=e.variants&&e.variants[t]),"function"==typeof t){let[i,a]=o(n);t=t(void 0!==r?r:e.custom,i,a)}return t}function s(e,t,r){let n=e.getProps();return a(n,t,void 0!==r?r:n.custom,e)}function u(e,t){return e?.[t]??e?.default??e}r.d(t,{P:()=>o_});let c=e=>e,l={},h=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],d={value:null,addProjectionMetrics:null};function f(e,t){let r=!1,n=!0,i={delta:0,timestamp:0,isProcessing:!1},o=()=>r=!0,a=h.reduce((e,r)=>(e[r]=function(e,t){let r=new Set,n=new Set,i=!1,o=!1,a=new WeakSet,s={delta:0,timestamp:0,isProcessing:!1},u=0;function c(t){a.has(t)&&(l.schedule(t),e()),u++,t(s)}let l={schedule:(e,t=!1,o=!1)=>{let s=o&&i?r:n;return t&&a.add(e),s.has(e)||s.add(e),e},cancel:e=>{n.delete(e),a.delete(e)},process:e=>{if(s=e,i){o=!0;return}i=!0,[r,n]=[n,r],r.forEach(c),t&&d.value&&d.value.frameloop[t].push(u),u=0,r.clear(),i=!1,o&&(o=!1,l.process(e))}};return l}(o,t?r:void 0),e),{}),{setup:s,read:u,resolveKeyframes:c,preUpdate:f,update:p,preRender:m,render:g,postRender:y}=a,v=()=>{let o=l.useManualTiming?i.timestamp:performance.now();r=!1,l.useManualTiming||(i.delta=n?1e3/60:Math.max(Math.min(o-i.timestamp,40),1)),i.timestamp=o,i.isProcessing=!0,s.process(i),u.process(i),c.process(i),f.process(i),p.process(i),m.process(i),g.process(i),y.process(i),i.isProcessing=!1,r&&t&&(n=!1,e(v))},b=()=>{r=!0,n=!0,i.isProcessing||e(v)};return{schedule:h.reduce((e,t)=>{let n=a[t];return e[t]=(e,t=!1,i=!1)=>(r||b(),n.schedule(e,t,i)),e},{}),cancel:e=>{for(let t=0;t<h.length;t++)a[h[t]].cancel(e)},state:i,steps:a}}let{schedule:p,cancel:m,state:g,steps:y}=f("undefined"!=typeof requestAnimationFrame?requestAnimationFrame:c,!0),v=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],b=new Set(v),w=new Set(["width","height","top","left","right","bottom",...v]);function S(e,t){-1===e.indexOf(t)&&e.push(t)}function x(e,t){let r=e.indexOf(t);r>-1&&e.splice(r,1)}class I{constructor(){this.subscriptions=[]}add(e){return S(this.subscriptions,e),()=>x(this.subscriptions,e)}notify(e,t,r){let n=this.subscriptions.length;if(n)if(1===n)this.subscriptions[0](e,t,r);else for(let i=0;i<n;i++){let n=this.subscriptions[i];n&&n(e,t,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function E(){n=void 0}let T={now:()=>(void 0===n&&T.set(g.isProcessing||l.useManualTiming?g.timestamp:performance.now()),n),set:e=>{n=e,queueMicrotask(E)}},k=e=>!isNaN(parseFloat(e)),_={current:void 0};class P{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=(e,t=!0)=>{let r=T.now();if(this.updatedAt!==r&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(e),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(let e of this.dependents)e.dirty();t&&this.events.renderRequest?.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=T.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=k(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new I);let r=this.events[e].add(t);return"change"===e?()=>{r(),p.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(let e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e,t=!0){t&&this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e,t)}setWithVelocity(e,t,r){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-r}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return _.current&&_.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){var e;let t=T.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||t-this.updatedAt>30)return 0;let r=Math.min(this.updatedAt-this.prevUpdatedAt,30);return e=parseFloat(this.current)-parseFloat(this.prevFrameValue),r?1e3/r*e:0}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function A(e,t){return new P(e,t)}let O=e=>Array.isArray(e),C=e=>!!(e&&e.getVelocity);function D(e,t){let r=e.getValue("willChange");if(C(r)&&r.add)return r.add(t);if(!r&&l.WillChange){let r=new l.WillChange("auto");e.addValue("willChange",r),r.add(t)}}let N=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),R="data-"+N("framerAppearId"),L=(e,t)=>r=>t(e(r)),j=(...e)=>e.reduce(L),F=(e,t,r)=>r>t?t:r<e?e:r,G=e=>1e3*e,M=e=>e/1e3,U={layout:0,mainThread:0,waapi:0},V=()=>{},B=()=>{},z=e=>t=>"string"==typeof t&&t.startsWith(e),H=z("--"),q=z("var(--"),$=e=>!!q(e)&&K.test(e.split("/*")[0].trim()),K=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,W={test:e=>"number"==typeof e,parse:parseFloat,transform:e=>e},J={...W,transform:e=>F(0,1,e)},Q={...W,default:1},Y=e=>Math.round(1e5*e)/1e5,X=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu,Z=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,ee=(e,t)=>r=>!!("string"==typeof r&&Z.test(r)&&r.startsWith(e)||t&&null!=r&&Object.prototype.hasOwnProperty.call(r,t)),et=(e,t,r)=>n=>{if("string"!=typeof n)return n;let[i,o,a,s]=n.match(X);return{[e]:parseFloat(i),[t]:parseFloat(o),[r]:parseFloat(a),alpha:void 0!==s?parseFloat(s):1}},er=e=>F(0,255,e),en={...W,transform:e=>Math.round(er(e))},ei={test:ee("rgb","red"),parse:et("red","green","blue"),transform:({red:e,green:t,blue:r,alpha:n=1})=>"rgba("+en.transform(e)+", "+en.transform(t)+", "+en.transform(r)+", "+Y(J.transform(n))+")"},eo={test:ee("#"),parse:function(e){let t="",r="",n="",i="";return e.length>5?(t=e.substring(1,3),r=e.substring(3,5),n=e.substring(5,7),i=e.substring(7,9)):(t=e.substring(1,2),r=e.substring(2,3),n=e.substring(3,4),i=e.substring(4,5),t+=t,r+=r,n+=n,i+=i),{red:parseInt(t,16),green:parseInt(r,16),blue:parseInt(n,16),alpha:i?parseInt(i,16)/255:1}},transform:ei.transform},ea=e=>({test:t=>"string"==typeof t&&t.endsWith(e)&&1===t.split(" ").length,parse:parseFloat,transform:t=>`${t}${e}`}),es=ea("deg"),eu=ea("%"),ec=ea("px"),el=ea("vh"),eh=ea("vw"),ed={...eu,parse:e=>eu.parse(e)/100,transform:e=>eu.transform(100*e)},ef={test:ee("hsl","hue"),parse:et("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:r,alpha:n=1})=>"hsla("+Math.round(e)+", "+eu.transform(Y(t))+", "+eu.transform(Y(r))+", "+Y(J.transform(n))+")"},ep={test:e=>ei.test(e)||eo.test(e)||ef.test(e),parse:e=>ei.test(e)?ei.parse(e):ef.test(e)?ef.parse(e):eo.parse(e),transform:e=>"string"==typeof e?e:e.hasOwnProperty("red")?ei.transform(e):ef.transform(e),getAnimatableNone:e=>{let t=ep.parse(e);return t.alpha=0,ep.transform(t)}},em=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu,eg="number",ey="color",ev=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function eb(e){let t=e.toString(),r=[],n={color:[],number:[],var:[]},i=[],o=0,a=t.replace(ev,e=>(ep.test(e)?(n.color.push(o),i.push(ey),r.push(ep.parse(e))):e.startsWith("var(")?(n.var.push(o),i.push("var"),r.push(e)):(n.number.push(o),i.push(eg),r.push(parseFloat(e))),++o,"${}")).split("${}");return{values:r,split:a,indexes:n,types:i}}function ew(e){return eb(e).values}function eS(e){let{split:t,types:r}=eb(e),n=t.length;return e=>{let i="";for(let o=0;o<n;o++)if(i+=t[o],void 0!==e[o]){let t=r[o];t===eg?i+=Y(e[o]):t===ey?i+=ep.transform(e[o]):i+=e[o]}return i}}let ex=e=>"number"==typeof e?0:ep.test(e)?ep.getAnimatableNone(e):e,eI={test:function(e){return isNaN(e)&&"string"==typeof e&&(e.match(X)?.length||0)+(e.match(em)?.length||0)>0},parse:ew,createTransformer:eS,getAnimatableNone:function(e){let t=ew(e);return eS(e)(t.map(ex))}};function eE(e,t,r){return(r<0&&(r+=1),r>1&&(r-=1),r<1/6)?e+(t-e)*6*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function eT(e,t){return r=>r>0?t:e}let ek=(e,t,r)=>e+(t-e)*r,e_=(e,t,r)=>{let n=e*e,i=r*(t*t-n)+n;return i<0?0:Math.sqrt(i)},eP=[eo,ei,ef],eA=e=>eP.find(t=>t.test(e));function eO(e){let t=eA(e);if(V(!!t,`'${e}' is not an animatable color. Use the equivalent color code instead.`,"color-not-animatable"),!t)return!1;let r=t.parse(e);return t===ef&&(r=function({hue:e,saturation:t,lightness:r,alpha:n}){e/=360,r/=100;let i=0,o=0,a=0;if(t/=100){let n=r<.5?r*(1+t):r+t-r*t,s=2*r-n;i=eE(s,n,e+1/3),o=eE(s,n,e),a=eE(s,n,e-1/3)}else i=o=a=r;return{red:Math.round(255*i),green:Math.round(255*o),blue:Math.round(255*a),alpha:n}}(r)),r}let eC=(e,t)=>{let r=eO(e),n=eO(t);if(!r||!n)return eT(e,t);let i={...r};return e=>(i.red=e_(r.red,n.red,e),i.green=e_(r.green,n.green,e),i.blue=e_(r.blue,n.blue,e),i.alpha=ek(r.alpha,n.alpha,e),ei.transform(i))},eD=new Set(["none","hidden"]);function eN(e,t){return r=>ek(e,t,r)}function eR(e){return"number"==typeof e?eN:"string"==typeof e?$(e)?eT:ep.test(e)?eC:eF:Array.isArray(e)?eL:"object"==typeof e?ep.test(e)?eC:ej:eT}function eL(e,t){let r=[...e],n=r.length,i=e.map((e,r)=>eR(e)(e,t[r]));return e=>{for(let t=0;t<n;t++)r[t]=i[t](e);return r}}function ej(e,t){let r={...e,...t},n={};for(let i in r)void 0!==e[i]&&void 0!==t[i]&&(n[i]=eR(e[i])(e[i],t[i]));return e=>{for(let t in n)r[t]=n[t](e);return r}}let eF=(e,t)=>{let r=eI.createTransformer(t),n=eb(e),i=eb(t);return n.indexes.var.length===i.indexes.var.length&&n.indexes.color.length===i.indexes.color.length&&n.indexes.number.length>=i.indexes.number.length?eD.has(e)&&!i.values.length||eD.has(t)&&!n.values.length?function(e,t){return eD.has(e)?r=>r<=0?e:t:r=>r>=1?t:e}(e,t):j(eL(function(e,t){let r=[],n={color:0,var:0,number:0};for(let i=0;i<t.values.length;i++){let o=t.types[i],a=e.indexes[o][n[o]],s=e.values[a]??0;r[i]=s,n[o]++}return r}(n,i),i.values),r):(V(!0,`Complex values '${e}' and '${t}' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition.`,"complex-values-different"),eT(e,t))};function eG(e,t,r){return"number"==typeof e&&"number"==typeof t&&"number"==typeof r?ek(e,t,r):eR(e)(e,t)}let eM=e=>{let t=({timestamp:t})=>e(t);return{start:(e=!0)=>p.update(t,e),stop:()=>m(t),now:()=>g.isProcessing?g.timestamp:T.now()}},eU=(e,t,r=10)=>{let n="",i=Math.max(Math.round(t/r),2);for(let t=0;t<i;t++)n+=Math.round(1e4*e(t/(i-1)))/1e4+", ";return`linear(${n.substring(0,n.length-2)})`};function eV(e){let t=0,r=e.next(t);for(;!r.done&&t<2e4;)t+=50,r=e.next(t);return t>=2e4?1/0:t}function eB(e,t,r){var n,i;let o=Math.max(t-5,0);return n=r-e(o),(i=t-o)?1e3/i*n:0}let ez={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1};function eH(e,t){return e*Math.sqrt(1-t*t)}let eq=["duration","bounce"],e$=["stiffness","damping","mass"];function eK(e,t){return t.some(t=>void 0!==e[t])}function eW(e=ez.visualDuration,t=ez.bounce){let r,n="object"!=typeof e?{visualDuration:e,keyframes:[0,1],bounce:t}:e,{restSpeed:i,restDelta:o}=n,a=n.keyframes[0],s=n.keyframes[n.keyframes.length-1],u={done:!1,value:a},{stiffness:c,damping:l,mass:h,duration:d,velocity:f,isResolvedFromDuration:p}=function(e){let t={velocity:ez.velocity,stiffness:ez.stiffness,damping:ez.damping,mass:ez.mass,isResolvedFromDuration:!1,...e};if(!eK(e,e$)&&eK(e,eq))if(e.visualDuration){let r=2*Math.PI/(1.2*e.visualDuration),n=r*r,i=2*F(.05,1,1-(e.bounce||0))*Math.sqrt(n);t={...t,mass:ez.mass,stiffness:n,damping:i}}else{let r=function({duration:e=ez.duration,bounce:t=ez.bounce,velocity:r=ez.velocity,mass:n=ez.mass}){let i,o;V(e<=G(ez.maxDuration),"Spring duration must be 10 seconds or less","spring-duration-limit");let a=1-t;a=F(ez.minDamping,ez.maxDamping,a),e=F(ez.minDuration,ez.maxDuration,M(e)),a<1?(i=t=>{let n=t*a,i=n*e;return .001-(n-r)/eH(t,a)*Math.exp(-i)},o=t=>{let n=t*a*e,o=Math.pow(a,2)*Math.pow(t,2)*e,s=Math.exp(-n),u=eH(Math.pow(t,2),a);return(n*r+r-o)*s*(-i(t)+.001>0?-1:1)/u}):(i=t=>-.001+Math.exp(-t*e)*((t-r)*e+1),o=t=>e*e*(r-t)*Math.exp(-t*e));let s=function(e,t,r){let n=r;for(let r=1;r<12;r++)n-=e(n)/t(n);return n}(i,o,5/e);if(e=G(e),isNaN(s))return{stiffness:ez.stiffness,damping:ez.damping,duration:e};{let t=Math.pow(s,2)*n;return{stiffness:t,damping:2*a*Math.sqrt(n*t),duration:e}}}(e);(t={...t,...r,mass:ez.mass}).isResolvedFromDuration=!0}return t}({...n,velocity:-M(n.velocity||0)}),m=f||0,g=l/(2*Math.sqrt(c*h)),y=s-a,v=M(Math.sqrt(c/h)),b=5>Math.abs(y);if(i||(i=b?ez.restSpeed.granular:ez.restSpeed.default),o||(o=b?ez.restDelta.granular:ez.restDelta.default),g<1){let e=eH(v,g);r=t=>s-Math.exp(-g*v*t)*((m+g*v*y)/e*Math.sin(e*t)+y*Math.cos(e*t))}else if(1===g)r=e=>s-Math.exp(-v*e)*(y+(m+v*y)*e);else{let e=v*Math.sqrt(g*g-1);r=t=>{let r=Math.exp(-g*v*t),n=Math.min(e*t,300);return s-r*((m+g*v*y)*Math.sinh(n)+e*y*Math.cosh(n))/e}}let w={calculatedDuration:p&&d||null,next:e=>{let t=r(e);if(p)u.done=e>=d;else{let n=0===e?m:0;g<1&&(n=0===e?G(m):eB(r,e,t));let a=Math.abs(s-t)<=o;u.done=Math.abs(n)<=i&&a}return u.value=u.done?s:t,u},toString:()=>{let e=Math.min(eV(w),2e4),t=eU(t=>w.next(e*t).value,e,30);return e+"ms "+t},toTransition:()=>{}};return w}function eJ({keyframes:e,velocity:t=0,power:r=.8,timeConstant:n=325,bounceDamping:i=10,bounceStiffness:o=500,modifyTarget:a,min:s,max:u,restDelta:c=.5,restSpeed:l}){let h,d,f=e[0],p={done:!1,value:f},m=e=>void 0!==s&&e<s||void 0!==u&&e>u,g=e=>void 0===s?u:void 0===u||Math.abs(s-e)<Math.abs(u-e)?s:u,y=r*t,v=f+y,b=void 0===a?v:a(v);b!==v&&(y=b-f);let w=e=>-y*Math.exp(-e/n),S=e=>b+w(e),x=e=>{let t=w(e),r=S(e);p.done=Math.abs(t)<=c,p.value=p.done?b:r},I=e=>{m(p.value)&&(h=e,d=eW({keyframes:[p.value,g(p.value)],velocity:eB(S,e,p.value),damping:i,stiffness:o,restDelta:c,restSpeed:l}))};return I(0),{calculatedDuration:null,next:e=>{let t=!1;return(d||void 0!==h||(t=!0,x(e),I(e)),void 0!==h&&e>=h)?d.next(e-h):(t||x(e),p)}}}eW.applyToOptions=e=>{let t=function(e,t=100,r){let n=r({...e,keyframes:[0,t]}),i=Math.min(eV(n),2e4);return{type:"keyframes",ease:e=>n.next(i*e).value/t,duration:M(i)}}(e,100,eW);return e.ease=t.ease,e.duration=G(t.duration),e.type="keyframes",e};let eQ=(e,t,r)=>(((1-3*r+3*t)*e+(3*r-6*t))*e+3*t)*e;function eY(e,t,r,n){if(e===t&&r===n)return c;let i=t=>(function(e,t,r,n,i){let o,a,s=0;do(o=eQ(a=t+(r-t)/2,n,i)-e)>0?r=a:t=a;while(Math.abs(o)>1e-7&&++s<12);return a})(t,0,1,e,r);return e=>0===e||1===e?e:eQ(i(e),t,n)}let eX=eY(.42,0,1,1),eZ=eY(0,0,.58,1),e0=eY(.42,0,.58,1),e1=e=>Array.isArray(e)&&"number"!=typeof e[0],e2=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,e3=e=>t=>1-e(1-t),e4=eY(.33,1.53,.69,.99),e6=e3(e4),e5=e2(e6),e8=e=>(e*=2)<1?.5*e6(e):.5*(2-Math.pow(2,-10*(e-1))),e7=e=>1-Math.sin(Math.acos(e)),e9=e3(e7),te=e2(e7),tt=e=>Array.isArray(e)&&"number"==typeof e[0],tr={linear:c,easeIn:eX,easeInOut:e0,easeOut:eZ,circIn:e7,circInOut:te,circOut:e9,backIn:e6,backInOut:e5,backOut:e4,anticipate:e8},tn=e=>"string"==typeof e,ti=e=>{if(tt(e)){B(4===e.length,"Cubic bezier arrays must contain four numerical values.","cubic-bezier-length");let[t,r,n,i]=e;return eY(t,r,n,i)}return tn(e)?(B(void 0!==tr[e],`Invalid easing type '${e}'`,"invalid-easing-type"),tr[e]):e},to=(e,t,r)=>{let n=t-e;return 0===n?1:(r-e)/n};function ta({duration:e=300,keyframes:t,times:r,ease:n="easeInOut"}){var i;let o=e1(n)?n.map(ti):ti(n),a={done:!1,value:t[0]},s=function(e,t,{clamp:r=!0,ease:n,mixer:i}={}){let o=e.length;if(B(o===t.length,"Both input and output ranges must be the same length","range-length"),1===o)return()=>t[0];if(2===o&&t[0]===t[1])return()=>t[1];let a=e[0]===e[1];e[0]>e[o-1]&&(e=[...e].reverse(),t=[...t].reverse());let s=function(e,t,r){let n=[],i=r||l.mix||eG,o=e.length-1;for(let r=0;r<o;r++){let o=i(e[r],e[r+1]);t&&(o=j(Array.isArray(t)?t[r]||c:t,o)),n.push(o)}return n}(t,n,i),u=s.length,h=r=>{if(a&&r<e[0])return t[0];let n=0;if(u>1)for(;n<e.length-2&&!(r<e[n+1]);n++);let i=to(e[n],e[n+1],r);return s[n](i)};return r?t=>h(F(e[0],e[o-1],t)):h}((i=r&&r.length===t.length?r:function(e){let t=[0];return!function(e,t){let r=e[e.length-1];for(let n=1;n<=t;n++){let i=to(0,t,n);e.push(ek(r,1,i))}}(t,e.length-1),t}(t),i.map(t=>t*e)),t,{ease:Array.isArray(o)?o:t.map(()=>o||e0).splice(0,t.length-1)});return{calculatedDuration:e,next:t=>(a.value=s(t),a.done=t>=e,a)}}let ts=e=>null!==e;function tu(e,{repeat:t,repeatType:r="loop"},n,i=1){let o=e.filter(ts),a=i<0||t&&"loop"!==r&&t%2==1?0:o.length-1;return a&&void 0!==n?n:o[a]}let tc={decay:eJ,inertia:eJ,tween:ta,keyframes:ta,spring:eW};function tl(e){"string"==typeof e.type&&(e.type=tc[e.type])}class th{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}let td=e=>e/100;class tf extends th{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{let{motionValue:e}=this.options;e&&e.updatedAt!==T.now()&&this.tick(T.now()),this.isStopped=!0,"idle"!==this.state&&(this.teardown(),this.options.onStop?.())},U.mainThread++,this.options=e,this.initAnimation(),this.play(),!1===e.autoplay&&this.pause()}initAnimation(){let{options:e}=this;tl(e);let{type:t=ta,repeat:r=0,repeatDelay:n=0,repeatType:i,velocity:o=0}=e,{keyframes:a}=e,s=t||ta;s!==ta&&"number"!=typeof a[0]&&(this.mixKeyframes=j(td,eG(a[0],a[1])),a=[0,100]);let u=s({...e,keyframes:a});"mirror"===i&&(this.mirroredGenerator=s({...e,keyframes:[...a].reverse(),velocity:-o})),null===u.calculatedDuration&&(u.calculatedDuration=eV(u));let{calculatedDuration:c}=u;this.calculatedDuration=c,this.resolvedDuration=c+n,this.totalDuration=this.resolvedDuration*(r+1)-n,this.generator=u}updateTime(e){let t=Math.round(e-this.startTime)*this.playbackSpeed;null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=t}tick(e,t=!1){let{generator:r,totalDuration:n,mixKeyframes:i,mirroredGenerator:o,resolvedDuration:a,calculatedDuration:s}=this;if(null===this.startTime)return r.next(0);let{delay:u=0,keyframes:c,repeat:l,repeatType:h,repeatDelay:d,type:f,onUpdate:p,finalKeyframe:m}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-n/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);let g=this.currentTime-u*(this.playbackSpeed>=0?1:-1),y=this.playbackSpeed>=0?g<0:g>n;this.currentTime=Math.max(g,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=n);let v=this.currentTime,b=r;if(l){let e=Math.min(this.currentTime,n)/a,t=Math.floor(e),r=e%1;!r&&e>=1&&(r=1),1===r&&t--,(t=Math.min(t,l+1))%2&&("reverse"===h?(r=1-r,d&&(r-=d/a)):"mirror"===h&&(b=o)),v=F(0,1,r)*a}let w=y?{done:!1,value:c[0]}:b.next(v);i&&(w.value=i(w.value));let{done:S}=w;y||null===s||(S=this.playbackSpeed>=0?this.currentTime>=n:this.currentTime<=0);let x=null===this.holdTime&&("finished"===this.state||"running"===this.state&&S);return x&&f!==eJ&&(w.value=tu(c,this.options,m,this.speed)),p&&p(w.value),x&&this.finish(),w}then(e,t){return this.finished.then(e,t)}get duration(){return M(this.calculatedDuration)}get time(){return M(this.currentTime)}set time(e){e=G(e),this.currentTime=e,null===this.startTime||null!==this.holdTime||0===this.playbackSpeed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(T.now());let t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=M(this.currentTime))}play(){if(this.isStopped)return;let{driver:e=eM,startTime:t}=this.options;this.driver||(this.driver=e(e=>this.tick(e))),this.options.onPlay?.();let r=this.driver.now();"finished"===this.state?(this.updateFinished(),this.startTime=r):null!==this.holdTime?this.startTime=r-this.holdTime:this.startTime||(this.startTime=t??r),"finished"===this.state&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(T.now()),this.holdTime=this.currentTime}complete(){"running"!==this.state&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null,U.mainThread--}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}let tp=e=>180*e/Math.PI,tm=e=>ty(tp(Math.atan2(e[1],e[0]))),tg={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:tm,rotateZ:tm,skewX:e=>tp(Math.atan(e[1])),skewY:e=>tp(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},ty=e=>((e%=360)<0&&(e+=360),e),tv=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),tb=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),tw={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:tv,scaleY:tb,scale:e=>(tv(e)+tb(e))/2,rotateX:e=>ty(tp(Math.atan2(e[6],e[5]))),rotateY:e=>ty(tp(Math.atan2(-e[2],e[0]))),rotateZ:tm,rotate:tm,skewX:e=>tp(Math.atan(e[4])),skewY:e=>tp(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function tS(e){return+!!e.includes("scale")}function tx(e,t){let r,n;if(!e||"none"===e)return tS(t);let i=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);if(i)r=tw,n=i;else{let t=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);r=tg,n=t}if(!n)return tS(t);let o=r[t],a=n[1].split(",").map(tE);return"function"==typeof o?o(a):a[o]}let tI=(e,t)=>{let{transform:r="none"}=getComputedStyle(e);return tx(r,t)};function tE(e){return parseFloat(e.trim())}let tT=e=>e===W||e===ec,tk=new Set(["x","y","z"]),t_=v.filter(e=>!tk.has(e)),tP={width:({x:e},{paddingLeft:t="0",paddingRight:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),height:({y:e},{paddingTop:t="0",paddingBottom:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>tx(t,"x"),y:(e,{transform:t})=>tx(t,"y")};tP.translateX=tP.x,tP.translateY=tP.y;let tA=new Set,tO=!1,tC=!1,tD=!1;function tN(){if(tC){let e=Array.from(tA).filter(e=>e.needsMeasurement),t=new Set(e.map(e=>e.element)),r=new Map;t.forEach(e=>{let t=function(e){let t=[];return t_.forEach(r=>{let n=e.getValue(r);void 0!==n&&(t.push([r,n.get()]),n.set(+!!r.startsWith("scale")))}),t}(e);t.length&&(r.set(e,t),e.render())}),e.forEach(e=>e.measureInitialState()),t.forEach(e=>{e.render();let t=r.get(e);t&&t.forEach(([t,r])=>{e.getValue(t)?.set(r)})}),e.forEach(e=>e.measureEndState()),e.forEach(e=>{void 0!==e.suspendedScrollY&&window.scrollTo(0,e.suspendedScrollY)})}tC=!1,tO=!1,tA.forEach(e=>e.complete(tD)),tA.clear()}function tR(){tA.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(tC=!0)})}class tL{constructor(e,t,r,n,i,o=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=r,this.motionValue=n,this.element=i,this.isAsync=o}scheduleResolve(){this.state="scheduled",this.isAsync?(tA.add(this),tO||(tO=!0,p.read(tR),p.resolveKeyframes(tN))):(this.readKeyframes(),this.complete())}readKeyframes(){let{unresolvedKeyframes:e,name:t,element:r,motionValue:n}=this;if(null===e[0]){let i=n?.get(),o=e[e.length-1];if(void 0!==i)e[0]=i;else if(r&&t){let n=r.readValue(t,o);null!=n&&(e[0]=n)}void 0===e[0]&&(e[0]=o),n&&void 0===i&&n.set(e[0])}for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),tA.delete(this)}cancel(){"scheduled"===this.state&&(tA.delete(this),this.state="pending")}resume(){"pending"===this.state&&this.scheduleResolve()}}let tj=e=>e.startsWith("--");function tF(e){let t;return()=>(void 0===t&&(t=e()),t)}let tG=tF(()=>void 0!==window.ScrollTimeline),tM={},tU=function(e,t){let r=tF(e);return()=>tM[t]??r()}(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(e){return!1}return!0},"linearEasing"),tV=([e,t,r,n])=>`cubic-bezier(${e}, ${t}, ${r}, ${n})`,tB={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:tV([0,.65,.55,1]),circOut:tV([.55,0,1,.45]),backIn:tV([.31,.01,.66,-.59]),backOut:tV([.33,1.53,.69,.99])};function tz(e){return"function"==typeof e&&"applyToOptions"in e}class tH extends th{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;let{element:t,name:r,keyframes:n,pseudoElement:i,allowFlatten:o=!1,finalKeyframe:a,onComplete:s}=e;this.isPseudoElement=!!i,this.allowFlatten=o,this.options=e,B("string"!=typeof e.type,'Mini animate() doesn\'t support "type" as a string.',"mini-spring");let u=function({type:e,...t}){return tz(e)&&tU()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}(e);this.animation=function(e,t,r,{delay:n=0,duration:i=300,repeat:o=0,repeatType:a="loop",ease:s="easeOut",times:u}={},c){let l={[t]:r};u&&(l.offset=u);let h=function e(t,r){if(t)return"function"==typeof t?tU()?eU(t,r):"ease-out":tt(t)?tV(t):Array.isArray(t)?t.map(t=>e(t,r)||tB.easeOut):tB[t]}(s,i);Array.isArray(h)&&(l.easing=h),d.value&&U.waapi++;let f={delay:n,duration:i,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:o+1,direction:"reverse"===a?"alternate":"normal"};c&&(f.pseudoElement=c);let p=e.animate(l,f);return d.value&&p.finished.finally(()=>{U.waapi--}),p}(t,r,n,u,i),!1===u.autoplay&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!i){let e=tu(n,this.options,a,this.speed);this.updateMotionValue?this.updateMotionValue(e):function(e,t,r){tj(t)?e.style.setProperty(t,r):e.style[t]=r}(t,r,e),this.animation.cancel()}s?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),"finished"===this.state&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch(e){}}stop(){if(this.isStopped)return;this.isStopped=!0;let{state:e}=this;"idle"!==e&&"finished"!==e&&(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){return M(Number(this.animation.effect?.getComputedTiming?.().duration||0))}get time(){return M(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=G(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return null!==this.finishedTime?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:t}){return(this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&tG())?(this.animation.timeline=e,c):t(this)}}let tq={anticipate:e8,backInOut:e5,circInOut:te};class t$ extends tH{constructor(e){!function(e){"string"==typeof e.ease&&e.ease in tq&&(e.ease=tq[e.ease])}(e),tl(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){let{motionValue:t,onUpdate:r,onComplete:n,element:i,...o}=this.options;if(!t)return;if(void 0!==e)return void t.set(e);let a=new tf({...o,autoplay:!1}),s=G(this.finishedTime??this.time);t.setWithVelocity(a.sample(s-10).value,a.sample(s).value,10),a.stop()}}let tK=(e,t)=>"zIndex"!==t&&!!("number"==typeof e||Array.isArray(e)||"string"==typeof e&&(eI.test(e)||"0"===e)&&!e.startsWith("url(")),tW=new Set(["opacity","clipPath","filter","transform"]),tJ=tF(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));class tQ extends th{constructor({autoplay:e=!0,delay:t=0,type:r="keyframes",repeat:n=0,repeatDelay:i=0,repeatType:o="loop",keyframes:a,name:s,motionValue:u,element:c,...l}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=T.now();let h={autoplay:e,delay:t,type:r,repeat:n,repeatDelay:i,repeatType:o,name:s,motionValue:u,element:c,...l},d=c?.KeyframeResolver||tL;this.keyframeResolver=new d(a,(e,t,r)=>this.onKeyframesResolved(e,t,h,!r),s,u,c),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,t,r,n){this.keyframeResolver=void 0;let{name:i,type:o,velocity:a,delay:s,isHandoff:u,onUpdate:h}=r;this.resolvedAt=T.now(),!function(e,t,r,n){let i=e[0];if(null===i)return!1;if("display"===t||"visibility"===t)return!0;let o=e[e.length-1],a=tK(i,t),s=tK(o,t);return V(a===s,`You are trying to animate ${t} from "${i}" to "${o}". "${a?o:i}" is not an animatable value.`,"value-not-animatable"),!!a&&!!s&&(function(e){let t=e[0];if(1===e.length)return!0;for(let r=0;r<e.length;r++)if(e[r]!==t)return!0}(e)||("spring"===r||tz(r))&&n)}(e,i,o,a)&&((l.instantAnimations||!s)&&h?.(tu(e,r,t)),e[0]=e[e.length-1],r.duration=0,r.repeat=0);let d={startTime:n?this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt:void 0,finalKeyframe:t,...r,keyframes:e},f=!u&&function(e){let{motionValue:t,name:r,repeatDelay:n,repeatType:i,damping:o,type:a}=e;if(!(t?.owner?.current instanceof HTMLElement))return!1;let{onUpdate:s,transformTemplate:u}=t.owner.getProps();return tJ()&&r&&tW.has(r)&&("transform"!==r||!u)&&!s&&!n&&"mirror"!==i&&0!==o&&"inertia"!==a}(d)?new t$({...d,element:d.motionValue.owner.current}):new tf(d);f.finished.then(()=>this.notifyFinished()).catch(c),this.pendingTimeline&&(this.stopTimeline=f.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=f}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),tD=!0,tR(),tN(),tD=!1),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}let tY=e=>null!==e,tX={type:"spring",stiffness:500,damping:25,restSpeed:10},tZ=e=>({type:"spring",stiffness:550,damping:0===e?2*Math.sqrt(550):30,restSpeed:10}),t0={type:"keyframes",duration:.8},t1={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},t2=(e,{keyframes:t})=>t.length>2?t0:b.has(e)?e.startsWith("scale")?tZ(t[1]):tX:t1,t3=(e,t,r,n={},i,o)=>a=>{let s=u(n,e)||{},c=s.delay||n.delay||0,{elapsed:h=0}=n;h-=G(c);let d={keyframes:Array.isArray(r)?r:[null,r],ease:"easeOut",velocity:t.getVelocity(),...s,delay:-h,onUpdate:e=>{t.set(e),s.onUpdate&&s.onUpdate(e)},onComplete:()=>{a(),s.onComplete&&s.onComplete()},name:e,motionValue:t,element:o?void 0:i};!function({when:e,delay:t,delayChildren:r,staggerChildren:n,staggerDirection:i,repeat:o,repeatType:a,repeatDelay:s,from:u,elapsed:c,...l}){return!!Object.keys(l).length}(s)&&Object.assign(d,t2(e,d)),d.duration&&(d.duration=G(d.duration)),d.repeatDelay&&(d.repeatDelay=G(d.repeatDelay)),void 0!==d.from&&(d.keyframes[0]=d.from);let f=!1;if(!1!==d.type&&(0!==d.duration||d.repeatDelay)||(d.duration=0,0===d.delay&&(f=!0)),(l.instantAnimations||l.skipAnimations)&&(f=!0,d.duration=0,d.delay=0),d.allowFlatten=!s.type&&!s.ease,f&&!o&&void 0!==t.get()){let e=function(e,{repeat:t,repeatType:r="loop"},n){let i=e.filter(tY),o=t&&"loop"!==r&&t%2==1?0:i.length-1;return i[o]}(d.keyframes,s);if(void 0!==e)return void p.update(()=>{d.onUpdate(e),d.onComplete()})}return s.isSync?new tf(d):new tQ(d)};function t4(e,t,{delay:r=0,transitionOverride:n,type:i}={}){let{transition:o=e.getDefaultTransition(),transitionEnd:a,...c}=t;n&&(o=n);let l=[],h=i&&e.animationState&&e.animationState.getState()[i];for(let t in c){let n=e.getValue(t,e.latestValues[t]??null),i=c[t];if(void 0===i||h&&function({protectedKeys:e,needsAnimating:t},r){let n=e.hasOwnProperty(r)&&!0!==t[r];return t[r]=!1,n}(h,t))continue;let a={delay:r,...u(o||{},t)},s=n.get();if(void 0!==s&&!n.isAnimating&&!Array.isArray(i)&&i===s&&!a.velocity)continue;let d=!1;if(window.MotionHandoffAnimation){let r=e.props[R];if(r){let e=window.MotionHandoffAnimation(r,t,p);null!==e&&(a.startTime=e,d=!0)}}D(e,t),n.start(t3(t,n,i,e.shouldReduceMotion&&w.has(t)?{type:!1}:a,e,d));let f=n.animation;f&&l.push(f)}return a&&Promise.all(l).then(()=>{p.update(()=>{a&&function(e,t){let{transitionEnd:r={},transition:n={},...i}=s(e,t)||{};for(let t in i={...i,...r}){var o;let r=O(o=i[t])?o[o.length-1]||0:o;e.hasValue(t)?e.getValue(t).set(r):e.addValue(t,A(r))}}(e,a)})}),l}function t6(e,t,r={}){let n=s(e,t,"exit"===r.type?e.presenceContext?.custom:void 0),{transition:i=e.getDefaultTransition()||{}}=n||{};r.transitionOverride&&(i=r.transitionOverride);let o=n?()=>Promise.all(t4(e,n,r)):()=>Promise.resolve(),a=e.variantChildren&&e.variantChildren.size?(n=0)=>{let{delayChildren:o=0,staggerChildren:a,staggerDirection:s}=i;return function(e,t,r=0,n=0,i=0,o=1,a){let s=[],u=e.variantChildren.size,c=(u-1)*i,l="function"==typeof n,h=l?e=>n(e,u):1===o?(e=0)=>e*i:(e=0)=>c-e*i;return Array.from(e.variantChildren).sort(t5).forEach((e,i)=>{e.notify("AnimationStart",t),s.push(t6(e,t,{...a,delay:r+(l?0:n)+h(i)}).then(()=>e.notify("AnimationComplete",t)))}),Promise.all(s)}(e,t,n,o,a,s,r)}:()=>Promise.resolve(),{when:u}=i;if(!u)return Promise.all([o(),a(r.delay)]);{let[e,t]="beforeChildren"===u?[o,a]:[a,o];return e().then(()=>t())}}function t5(e,t){return e.sortNodePosition(t)}function t8(e,t){if(!Array.isArray(t))return!1;let r=t.length;if(r!==e.length)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function t7(e){return"string"==typeof e||Array.isArray(e)}let t9=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],re=["initial",...t9],rt=re.length,rr=[...t9].reverse(),rn=t9.length;function ri(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function ro(){return{animate:ri(!0),whileInView:ri(),whileHover:ri(),whileTap:ri(),whileDrag:ri(),whileFocus:ri(),exit:ri()}}class ra{constructor(e){this.isMounted=!1,this.node=e}update(){}}class rs extends ra{constructor(e){super(e),e.animationState||(e.animationState=function(e){let t=t=>Promise.all(t.map(({animation:t,options:r})=>(function(e,t,r={}){let n;if(e.notify("AnimationStart",t),Array.isArray(t))n=Promise.all(t.map(t=>t6(e,t,r)));else if("string"==typeof t)n=t6(e,t,r);else{let i="function"==typeof t?s(e,t,r.custom):t;n=Promise.all(t4(e,i,r))}return n.then(()=>{e.notify("AnimationComplete",t)})})(e,t,r))),r=ro(),n=!0,o=t=>(r,n)=>{let i=s(e,n,"exit"===t?e.presenceContext?.custom:void 0);if(i){let{transition:e,transitionEnd:t,...n}=i;r={...r,...n,...t}}return r};function a(a){let{props:u}=e,c=function e(t){if(!t)return;if(!t.isControllingVariants){let r=t.parent&&e(t.parent)||{};return void 0!==t.props.initial&&(r.initial=t.props.initial),r}let r={};for(let e=0;e<rt;e++){let n=re[e],i=t.props[n];(t7(i)||!1===i)&&(r[n]=i)}return r}(e.parent)||{},l=[],h=new Set,d={},f=1/0;for(let t=0;t<rn;t++){var p,m;let s=rr[t],g=r[s],y=void 0!==u[s]?u[s]:c[s],v=t7(y),b=s===a?g.isActive:null;!1===b&&(f=t);let w=y===c[s]&&y!==u[s]&&v;if(w&&n&&e.manuallyAnimateOnMount&&(w=!1),g.protectedKeys={...d},!g.isActive&&null===b||!y&&!g.prevProp||i(y)||"boolean"==typeof y)continue;let S=(p=g.prevProp,"string"==typeof(m=y)?m!==p:!!Array.isArray(m)&&!t8(m,p)),x=S||s===a&&g.isActive&&!w&&v||t>f&&v,I=!1,E=Array.isArray(y)?y:[y],T=E.reduce(o(s),{});!1===b&&(T={});let{prevResolvedValues:k={}}=g,_={...k,...T},P=t=>{x=!0,h.has(t)&&(I=!0,h.delete(t)),g.needsAnimating[t]=!0;let r=e.getValue(t);r&&(r.liveStyle=!1)};for(let e in _){let t=T[e],r=k[e];if(d.hasOwnProperty(e))continue;let n=!1;(O(t)&&O(r)?t8(t,r):t===r)?void 0!==t&&h.has(e)?P(e):g.protectedKeys[e]=!0:null!=t?P(e):h.add(e)}g.prevProp=y,g.prevResolvedValues=T,g.isActive&&(d={...d,...T}),n&&e.blockInitialAnimation&&(x=!1);let A=!(w&&S)||I;x&&A&&l.push(...E.map(e=>({animation:e,options:{type:s}})))}if(h.size){let t={};if("boolean"!=typeof u.initial){let r=s(e,Array.isArray(u.initial)?u.initial[0]:u.initial);r&&r.transition&&(t.transition=r.transition)}h.forEach(r=>{let n=e.getBaseTarget(r),i=e.getValue(r);i&&(i.liveStyle=!0),t[r]=n??null}),l.push({animation:t})}let g=!!l.length;return n&&(!1===u.initial||u.initial===u.animate)&&!e.manuallyAnimateOnMount&&(g=!1),n=!1,g?t(l):Promise.resolve()}return{animateChanges:a,setActive:function(t,n){if(r[t].isActive===n)return Promise.resolve();e.variantChildren?.forEach(e=>e.animationState?.setActive(t,n)),r[t].isActive=n;let i=a(t);for(let e in r)r[e].protectedKeys={};return i},setAnimateFunction:function(r){t=r(e)},getState:()=>r,reset:()=>{r=ro(),n=!0}}}(e))}updateAnimationControlsSubscription(){let{animate:e}=this.node.getProps();i(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){let{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let ru=0;class rc extends ra{constructor(){super(...arguments),this.id=ru++}update(){if(!this.node.presenceContext)return;let{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===r)return;let n=this.node.animationState.setActive("exit",!e);t&&!e&&n.then(()=>{t(this.id)})}mount(){let{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}let rl={x:!1,y:!1};function rh(e,t,r,n={passive:!0}){return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r)}let rd=e=>"mouse"===e.pointerType?"number"!=typeof e.button||e.button<=0:!1!==e.isPrimary;function rf(e){return{point:{x:e.pageX,y:e.pageY}}}let rp=e=>t=>rd(t)&&e(t,rf(t));function rm(e,t,r,n){return rh(e,t,rp(r),n)}function rg({top:e,left:t,right:r,bottom:n}){return{x:{min:t,max:r},y:{min:e,max:n}}}function ry(e){return e.max-e.min}function rv(e,t,r,n=.5){e.origin=n,e.originPoint=ek(t.min,t.max,e.origin),e.scale=ry(r)/ry(t),e.translate=ek(r.min,r.max,e.origin)-e.originPoint,(e.scale>=.9999&&e.scale<=1.0001||isNaN(e.scale))&&(e.scale=1),(e.translate>=-.01&&e.translate<=.01||isNaN(e.translate))&&(e.translate=0)}function rb(e,t,r,n){rv(e.x,t.x,r.x,n?n.originX:void 0),rv(e.y,t.y,r.y,n?n.originY:void 0)}function rw(e,t,r){e.min=r.min+t.min,e.max=e.min+ry(t)}function rS(e,t,r){e.min=t.min-r.min,e.max=e.min+ry(t)}function rx(e,t,r){rS(e.x,t.x,r.x),rS(e.y,t.y,r.y)}let rI=()=>({translate:0,scale:1,origin:0,originPoint:0}),rE=()=>({x:rI(),y:rI()}),rT=()=>({min:0,max:0}),rk=()=>({x:rT(),y:rT()});function r_(e){return[e("x"),e("y")]}function rP(e){return void 0===e||1===e}function rA({scale:e,scaleX:t,scaleY:r}){return!rP(e)||!rP(t)||!rP(r)}function rO(e){return rA(e)||rC(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function rC(e){var t,r;return(t=e.x)&&"0%"!==t||(r=e.y)&&"0%"!==r}function rD(e,t,r,n,i){return void 0!==i&&(e=n+i*(e-n)),n+r*(e-n)+t}function rN(e,t=0,r=1,n,i){e.min=rD(e.min,t,r,n,i),e.max=rD(e.max,t,r,n,i)}function rR(e,{x:t,y:r}){rN(e.x,t.translate,t.scale,t.originPoint),rN(e.y,r.translate,r.scale,r.originPoint)}function rL(e,t){e.min=e.min+t,e.max=e.max+t}function rj(e,t,r,n,i=.5){let o=ek(e.min,e.max,i);rN(e,t,r,o,n)}function rF(e,t){rj(e.x,t.x,t.scaleX,t.scale,t.originX),rj(e.y,t.y,t.scaleY,t.scale,t.originY)}function rG(e,t){return rg(function(e,t){if(!t)return e;let r=t({x:e.left,y:e.top}),n=t({x:e.right,y:e.bottom});return{top:r.y,left:r.x,bottom:n.y,right:n.x}}(e.getBoundingClientRect(),t))}let rM=({current:e})=>e?e.ownerDocument.defaultView:null;function rU(e){return e&&"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}let rV=(e,t)=>Math.abs(e-t);class rB{constructor(e,t,{transformPagePoint:r,contextWindow:n=window,dragSnapToOrigin:i=!1,distanceThreshold:o=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;let e=rq(this.lastMoveEventInfo,this.history),t=null!==this.startEvent,r=function(e,t){return Math.sqrt(rV(e.x,t.x)**2+rV(e.y,t.y)**2)}(e.offset,{x:0,y:0})>=this.distanceThreshold;if(!t&&!r)return;let{point:n}=e,{timestamp:i}=g;this.history.push({...n,timestamp:i});let{onStart:o,onMove:a}=this.handlers;t||(o&&o(this.lastMoveEvent,e),this.startEvent=this.lastMoveEvent),a&&a(this.lastMoveEvent,e)},this.handlePointerMove=(e,t)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=rz(t,this.transformPagePoint),p.update(this.updatePoint,!0)},this.handlePointerUp=(e,t)=>{this.end();let{onEnd:r,onSessionEnd:n,resumeAnimation:i}=this.handlers;if(this.dragSnapToOrigin&&i&&i(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;let o=rq("pointercancel"===e.type?this.lastMoveEventInfo:rz(t,this.transformPagePoint),this.history);this.startEvent&&r&&r(e,o),n&&n(e,o)},!rd(e))return;this.dragSnapToOrigin=i,this.handlers=t,this.transformPagePoint=r,this.distanceThreshold=o,this.contextWindow=n||window;let a=rz(rf(e),this.transformPagePoint),{point:s}=a,{timestamp:u}=g;this.history=[{...s,timestamp:u}];let{onSessionStart:c}=t;c&&c(e,rq(a,this.history)),this.removeListeners=j(rm(this.contextWindow,"pointermove",this.handlePointerMove),rm(this.contextWindow,"pointerup",this.handlePointerUp),rm(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),m(this.updatePoint)}}function rz(e,t){return t?{point:t(e.point)}:e}function rH(e,t){return{x:e.x-t.x,y:e.y-t.y}}function rq({point:e},t){return{point:e,delta:rH(e,r$(t)),offset:rH(e,t[0]),velocity:function(e,t){if(e.length<2)return{x:0,y:0};let r=e.length-1,n=null,i=r$(e);for(;r>=0&&(n=e[r],!(i.timestamp-n.timestamp>G(.1)));)r--;if(!n)return{x:0,y:0};let o=M(i.timestamp-n.timestamp);if(0===o)return{x:0,y:0};let a={x:(i.x-n.x)/o,y:(i.y-n.y)/o};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}(t,.1)}}function r$(e){return e[e.length-1]}function rK(e,t,r){return{min:void 0!==t?e.min+t:void 0,max:void 0!==r?e.max+r-(e.max-e.min):void 0}}function rW(e,t){let r=t.min-e.min,n=t.max-e.max;return t.max-t.min<e.max-e.min&&([r,n]=[n,r]),{min:r,max:n}}function rJ(e,t,r){return{min:rQ(e,t),max:rQ(e,r)}}function rQ(e,t){return"number"==typeof e?e:e[t]||0}let rY=new WeakMap;class rX{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=rk(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:t=!1,distanceThreshold:r}={}){let{presenceContext:n}=this.visualElement;if(n&&!1===n.isPresent)return;let{dragSnapToOrigin:i}=this.getProps();this.panSession=new rB(e,{onSessionStart:e=>{let{dragSnapToOrigin:r}=this.getProps();r?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(rf(e).point)},onStart:(e,t)=>{let{drag:r,dragPropagation:n,onDragStart:i}=this.getProps();if(r&&!n&&(this.openDragLock&&this.openDragLock(),this.openDragLock=function(e){if("x"===e||"y"===e)if(rl[e])return null;else return rl[e]=!0,()=>{rl[e]=!1};return rl.x||rl.y?null:(rl.x=rl.y=!0,()=>{rl.x=rl.y=!1})}(r),!this.openDragLock))return;this.latestPointerEvent=e,this.latestPanInfo=t,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),r_(e=>{let t=this.getAxisMotionValue(e).get()||0;if(eu.test(t)){let{projection:r}=this.visualElement;if(r&&r.layout){let n=r.layout.layoutBox[e];n&&(t=ry(n)*(parseFloat(t)/100))}}this.originPoint[e]=t}),i&&p.postRender(()=>i(e,t)),D(this.visualElement,"transform");let{animationState:o}=this.visualElement;o&&o.setActive("whileDrag",!0)},onMove:(e,t)=>{this.latestPointerEvent=e,this.latestPanInfo=t;let{dragPropagation:r,dragDirectionLock:n,onDirectionLock:i,onDrag:o}=this.getProps();if(!r&&!this.openDragLock)return;let{offset:a}=t;if(n&&null===this.currentDirection){this.currentDirection=function(e,t=10){let r=null;return Math.abs(e.y)>t?r="y":Math.abs(e.x)>t&&(r="x"),r}(a),null!==this.currentDirection&&i&&i(this.currentDirection);return}this.updateAxis("x",t.point,a),this.updateAxis("y",t.point,a),this.visualElement.render(),o&&o(e,t)},onSessionEnd:(e,t)=>{this.latestPointerEvent=e,this.latestPanInfo=t,this.stop(e,t),this.latestPointerEvent=null,this.latestPanInfo=null},resumeAnimation:()=>r_(e=>"paused"===this.getAnimationState(e)&&this.getAxisMotionValue(e).animation?.play())},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:i,distanceThreshold:r,contextWindow:rM(this.visualElement)})}stop(e,t){let r=e||this.latestPointerEvent,n=t||this.latestPanInfo,i=this.isDragging;if(this.cancel(),!i||!n||!r)return;let{velocity:o}=n;this.startAnimation(o);let{onDragEnd:a}=this.getProps();a&&p.postRender(()=>a(r,n))}cancel(){this.isDragging=!1;let{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;let{dragPropagation:r}=this.getProps();!r&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,r){let{drag:n}=this.getProps();if(!r||!rZ(e,n,this.currentDirection))return;let i=this.getAxisMotionValue(e),o=this.originPoint[e]+r[e];this.constraints&&this.constraints[e]&&(o=function(e,{min:t,max:r},n){return void 0!==t&&e<t?e=n?ek(t,e,n.min):Math.max(e,t):void 0!==r&&e>r&&(e=n?ek(r,e,n.max):Math.min(e,r)),e}(o,this.constraints[e],this.elastic[e])),i.set(o)}resolveConstraints(){let{dragConstraints:e,dragElastic:t}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,n=this.constraints;e&&rU(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&r?this.constraints=function(e,{top:t,left:r,bottom:n,right:i}){return{x:rK(e.x,r,i),y:rK(e.y,t,n)}}(r.layoutBox,e):this.constraints=!1,this.elastic=function(e=.35){return!1===e?e=0:!0===e&&(e=.35),{x:rJ(e,"left","right"),y:rJ(e,"top","bottom")}}(t),n!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&r_(e=>{!1!==this.constraints&&this.getAxisMotionValue(e)&&(this.constraints[e]=function(e,t){let r={};return void 0!==t.min&&(r.min=t.min-e.min),void 0!==t.max&&(r.max=t.max-e.min),r}(r.layoutBox[e],this.constraints[e]))})}resolveRefConstraints(){var e;let{dragConstraints:t,onMeasureDragConstraints:r}=this.getProps();if(!t||!rU(t))return!1;let n=t.current;B(null!==n,"If `dragConstraints` is set as a React ref, that ref must be passed to another component's `ref` prop.","drag-constraints-ref");let{projection:i}=this.visualElement;if(!i||!i.layout)return!1;let o=function(e,t,r){let n=rG(e,r),{scroll:i}=t;return i&&(rL(n.x,i.offset.x),rL(n.y,i.offset.y)),n}(n,i.root,this.visualElement.getTransformPagePoint()),a=(e=i.layout.layoutBox,{x:rW(e.x,o.x),y:rW(e.y,o.y)});if(r){let e=r(function({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}(a));this.hasMutatedConstraints=!!e,e&&(a=rg(e))}return a}startAnimation(e){let{drag:t,dragMomentum:r,dragElastic:n,dragTransition:i,dragSnapToOrigin:o,onDragTransitionEnd:a}=this.getProps(),s=this.constraints||{};return Promise.all(r_(a=>{if(!rZ(a,t,this.currentDirection))return;let u=s&&s[a]||{};o&&(u={min:0,max:0});let c={type:"inertia",velocity:r?e[a]:0,bounceStiffness:n?200:1e6,bounceDamping:n?40:1e7,timeConstant:750,restDelta:1,restSpeed:10,...i,...u};return this.startAxisValueAnimation(a,c)})).then(a)}startAxisValueAnimation(e,t){let r=this.getAxisMotionValue(e);return D(this.visualElement,e),r.start(t3(e,r,0,t,this.visualElement,!1))}stopAnimation(){r_(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){r_(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){let t=`_drag${e.toUpperCase()}`,r=this.visualElement.getProps();return r[t]||this.visualElement.getValue(e,(r.initial?r.initial[e]:void 0)||0)}snapToCursor(e){r_(t=>{let{drag:r}=this.getProps();if(!rZ(t,r,this.currentDirection))return;let{projection:n}=this.visualElement,i=this.getAxisMotionValue(t);if(n&&n.layout){let{min:r,max:o}=n.layout.layoutBox[t];i.set(e[t]-ek(r,o,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;let{drag:e,dragConstraints:t}=this.getProps(),{projection:r}=this.visualElement;if(!rU(t)||!r||!this.constraints)return;this.stopAnimation();let n={x:0,y:0};r_(e=>{let t=this.getAxisMotionValue(e);if(t&&!1!==this.constraints){let r=t.get();n[e]=function(e,t){let r=.5,n=ry(e),i=ry(t);return i>n?r=to(t.min,t.max-n,e.min):n>i&&(r=to(e.min,e.max-i,t.min)),F(0,1,r)}({min:r,max:r},this.constraints[e])}});let{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),r_(t=>{if(!rZ(t,e,null))return;let r=this.getAxisMotionValue(t),{min:i,max:o}=this.constraints[t];r.set(ek(i,o,n[t]))})}addListeners(){if(!this.visualElement.current)return;rY.set(this.visualElement,this);let e=rm(this.visualElement.current,"pointerdown",e=>{let{drag:t,dragListener:r=!0}=this.getProps();t&&r&&this.start(e)}),t=()=>{let{dragConstraints:e}=this.getProps();rU(e)&&e.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,n=r.addEventListener("measure",t);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),p.read(t);let i=rh(window,"resize",()=>this.scalePositionWithinConstraints()),o=r.addEventListener("didUpdate",({delta:e,hasLayoutChanged:t})=>{this.isDragging&&t&&(r_(t=>{let r=this.getAxisMotionValue(t);r&&(this.originPoint[t]+=e[t].translate,r.set(r.get()+e[t].translate))}),this.visualElement.render())});return()=>{i(),e(),n(),o&&o()}}getProps(){let e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:r=!1,dragPropagation:n=!1,dragConstraints:i=!1,dragElastic:o=.35,dragMomentum:a=!0}=e;return{...e,drag:t,dragDirectionLock:r,dragPropagation:n,dragConstraints:i,dragElastic:o,dragMomentum:a}}}function rZ(e,t,r){return(!0===t||t===e)&&(null===r||r===e)}class r0 extends ra{constructor(e){super(e),this.removeGroupControls=c,this.removeListeners=c,this.controls=new rX(e)}mount(){let{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||c}unmount(){this.removeGroupControls(),this.removeListeners()}}let r1=e=>(t,r)=>{e&&p.postRender(()=>e(t,r))};class r2 extends ra{constructor(){super(...arguments),this.removePointerDownListener=c}onPointerDown(e){this.session=new rB(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:rM(this.node)})}createPanHandlers(){let{onPanSessionStart:e,onPanStart:t,onPan:r,onPanEnd:n}=this.node.getProps();return{onSessionStart:r1(e),onStart:r1(t),onMove:r,onEnd:(e,t)=>{delete this.session,n&&p.postRender(()=>n(e,t))}}}mount(){this.removePointerDownListener=rm(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}var r3,r4,r6=r(7876);let{schedule:r5}=f(queueMicrotask,!1);var r8=r(4232),r7=r(3885),r9=r(5048);let ne=(0,r8.createContext)({}),nt={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function nr(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}let nn={correct:(e,t)=>{if(!t.target)return e;if("string"==typeof e)if(!ec.test(e))return e;else e=parseFloat(e);let r=nr(e,t.target.x),n=nr(e,t.target.y);return`${r}% ${n}%`}},ni={},no=!1;class na extends r8.Component{componentDidMount(){let{visualElement:e,layoutGroup:t,switchLayoutGroup:r,layoutId:n}=this.props,{projection:i}=e;for(let e in nu)ni[e]=nu[e],H(e)&&(ni[e].isCSSVariable=!0);i&&(t.group&&t.group.add(i),r&&r.register&&n&&r.register(i),no&&i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),nt.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){let{layoutDependency:t,visualElement:r,drag:n,isPresent:i}=this.props,{projection:o}=r;return o&&(o.isPresent=i,no=!0,n||e.layoutDependency!==t||void 0===t||e.isPresent!==i?o.willUpdate():this.safeToRemove(),e.isPresent!==i&&(i?o.promote():o.relegate()||p.postRender(()=>{let e=o.getStack();e&&e.members.length||this.safeToRemove()}))),null}componentDidUpdate(){let{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),r5.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){let{visualElement:e,layoutGroup:t,switchLayoutGroup:r}=this.props,{projection:n}=e;n&&(n.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(n),r&&r.deregister&&r.deregister(n))}safeToRemove(){let{safeToRemove:e}=this.props;e&&e()}render(){return null}}function ns(e){let[t,r]=(0,r7.xQ)(),n=(0,r8.useContext)(r9.L);return(0,r6.jsx)(na,{...e,layoutGroup:n,switchLayoutGroup:(0,r8.useContext)(ne),isPresent:t,safeToRemove:r})}let nu={borderRadius:{...nn,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:nn,borderTopRightRadius:nn,borderBottomLeftRadius:nn,borderBottomRightRadius:nn,boxShadow:{correct:(e,{treeScale:t,projectionDelta:r})=>{let n=eI.parse(e);if(n.length>5)return e;let i=eI.createTransformer(e),o=+("number"!=typeof n[0]),a=r.x.scale*t.x,s=r.y.scale*t.y;n[0+o]/=a,n[1+o]/=s;let u=ek(a,s,.5);return"number"==typeof n[2+o]&&(n[2+o]/=u),"number"==typeof n[3+o]&&(n[3+o]/=u),i(n)}}};var nc=r(7594);function nl(e){return(0,nc.G)(e)&&"ownerSVGElement"in e}let nh=(e,t)=>e.depth-t.depth;class nd{constructor(){this.children=[],this.isDirty=!1}add(e){S(this.children,e),this.isDirty=!0}remove(e){x(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(nh),this.isDirty=!1,this.children.forEach(e)}}function nf(e){return C(e)?e.get():e}let np=["TopLeft","TopRight","BottomLeft","BottomRight"],nm=np.length,ng=e=>"string"==typeof e?parseFloat(e):e,ny=e=>"number"==typeof e||ec.test(e);function nv(e,t){return void 0!==e[t]?e[t]:e.borderRadius}let nb=nS(0,.5,e9),nw=nS(.5,.95,c);function nS(e,t,r){return n=>n<e?0:n>t?1:r(to(e,t,n))}function nx(e,t){e.min=t.min,e.max=t.max}function nI(e,t){nx(e.x,t.x),nx(e.y,t.y)}function nE(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function nT(e,t,r,n,i){return e-=t,e=n+1/r*(e-n),void 0!==i&&(e=n+1/i*(e-n)),e}function nk(e,t,[r,n,i],o,a){!function(e,t=0,r=1,n=.5,i,o=e,a=e){if(eu.test(t)&&(t=parseFloat(t),t=ek(a.min,a.max,t/100)-a.min),"number"!=typeof t)return;let s=ek(o.min,o.max,n);e===o&&(s-=t),e.min=nT(e.min,t,r,s,i),e.max=nT(e.max,t,r,s,i)}(e,t[r],t[n],t[i],t.scale,o,a)}let n_=["x","scaleX","originX"],nP=["y","scaleY","originY"];function nA(e,t,r,n){nk(e.x,t,n_,r?r.x:void 0,n?n.x:void 0),nk(e.y,t,nP,r?r.y:void 0,n?n.y:void 0)}function nO(e){return 0===e.translate&&1===e.scale}function nC(e){return nO(e.x)&&nO(e.y)}function nD(e,t){return e.min===t.min&&e.max===t.max}function nN(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function nR(e,t){return nN(e.x,t.x)&&nN(e.y,t.y)}function nL(e){return ry(e.x)/ry(e.y)}function nj(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class nF{constructor(){this.members=[]}add(e){S(this.members,e),e.scheduleRender()}remove(e){if(x(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){let e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){let t,r=this.members.findIndex(t=>e===t);if(0===r)return!1;for(let e=r;e>=0;e--){let r=this.members[e];if(!1!==r.isPresent){t=r;break}}return!!t&&(this.promote(t),!0)}promote(e,t){let r=this.lead;if(e!==r&&(this.prevLead=r,this.lead=e,e.show(),r)){r.instance&&r.scheduleRender(),e.scheduleRender(),e.resumeFrom=r,t&&(e.resumeFrom.preserveOpacity=!0),r.snapshot&&(e.snapshot=r.snapshot,e.snapshot.latestValues=r.animationValues||r.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);let{crossfade:n}=e.options;!1===n&&r.hide()}}exitAnimationComplete(){this.members.forEach(e=>{let{options:t,resumingFrom:r}=e;t.onExitComplete&&t.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}let nG={nodes:0,calculatedTargetDeltas:0,calculatedProjections:0},nM=["","X","Y","Z"],nU=0;function nV(e,t,r,n){let{latestValues:i}=t;i[e]&&(r[e]=i[e],t.setStaticValue(e,0),n&&(n[e]=0))}function nB({attachResizeListener:e,defaultParent:t,measureScroll:r,checkIsScrollRoot:n,resetTransform:i}){return class{constructor(e={},r=t?.()){this.id=nU++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,d.value&&(nG.nodes=nG.calculatedTargetDeltas=nG.calculatedProjections=0),this.nodes.forEach(nq),this.nodes.forEach(nX),this.nodes.forEach(nZ),this.nodes.forEach(n$),d.addProjectionMetrics&&d.addProjectionMetrics(nG)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=r?r.root||r:this,this.path=r?[...r.path,r]:[],this.parent=r,this.depth=r?r.depth+1:0;for(let e=0;e<this.path.length;e++)this.path[e].shouldResetTransform=!0;this.root===this&&(this.nodes=new nd)}addEventListener(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new I),this.eventHandlers.get(e).add(t)}notifyListeners(e,...t){let r=this.eventHandlers.get(e);r&&r.notify(...t)}hasListeners(e){return this.eventHandlers.has(e)}mount(t){if(this.instance)return;this.isSVG=nl(t)&&!(nl(t)&&"svg"===t.tagName),this.instance=t;let{layoutId:r,layout:n,visualElement:i}=this.options;if(i&&!i.current&&i.mount(t),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(n||r)&&(this.isLayoutDirty=!0),e){let r,n=0,i=()=>this.root.updateBlockedByResize=!1;p.read(()=>{n=window.innerWidth}),e(t,()=>{let e=window.innerWidth;e!==n&&(n=e,this.root.updateBlockedByResize=!0,r&&r(),r=function(e,t){let r=T.now(),n=({timestamp:i})=>{let o=i-r;o>=250&&(m(n),e(o-t))};return p.setup(n,!0),()=>m(n)}(i,250),nt.hasAnimatedSinceResize&&(nt.hasAnimatedSinceResize=!1,this.nodes.forEach(nY)))})}r&&this.root.registerSharedNode(r,this),!1!==this.options.animate&&i&&(r||n)&&this.addEventListener("didUpdate",({delta:e,hasLayoutChanged:t,hasRelativeLayoutChanged:r,layout:n})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}let o=this.options.transition||i.getDefaultTransition()||n6,{onLayoutAnimationStart:a,onLayoutAnimationComplete:s}=i.getProps(),c=!this.targetLayout||!nR(this.targetLayout,n),l=!t&&r;if(this.options.layoutRoot||this.resumeFrom||l||t&&(c||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);let t={...u(o,"layout"),onPlay:a,onComplete:s};(i.shouldReduceMotion||this.options.layoutRoot)&&(t.delay=0,t.type=!1),this.startAnimation(t),this.setAnimationOrigin(e,l)}else t||nY(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=n})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);let e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),m(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){!this.isUpdateBlocked()&&(this.isUpdating=!0,this.nodes&&this.nodes.forEach(n0),this.animationId++)}getTransformTemplate(){let{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(e=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&function e(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;let{visualElement:r}=t.options;if(!r)return;let n=r.props[R];if(window.MotionHasOptimisedAnimation(n,"transform")){let{layout:e,layoutId:r}=t.options;window.MotionCancelOptimisedAnimation(n,"transform",p,!(e||r))}let{parent:i}=t;i&&!i.hasCheckedOptimisedAppear&&e(i)}(this),this.root.isUpdating||this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let e=0;e<this.path.length;e++){let t=this.path[e];t.shouldResetTransform=!0,t.updateScroll("snapshot"),t.options.layoutRoot&&t.willUpdate(!1)}let{layoutId:t,layout:r}=this.options;if(void 0===t&&!r)return;let n=this.getTransformTemplate();this.prevTransformTemplateValue=n?n(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(nW);return}if(this.animationId<=this.animationCommitId)return void this.nodes.forEach(nJ);this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(nQ),this.nodes.forEach(nz),this.nodes.forEach(nH)):this.nodes.forEach(nJ),this.clearAllSnapshots();let e=T.now();g.delta=F(0,1e3/60,e-g.timestamp),g.timestamp=e,g.isProcessing=!0,y.update.process(g),y.preRender.process(g),y.render.process(g),g.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,r5.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(nK),this.sharedNodes.forEach(n1)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,p.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){p.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure(),!this.snapshot||ry(this.snapshot.measuredBox.x)||ry(this.snapshot.measuredBox.y)||(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let e=0;e<this.path.length;e++)this.path[e].updateScroll();let e=this.layout;this.layout=this.measure(!1),this.layoutCorrected=rk(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);let{visualElement:t}=this.options;t&&t.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(e="measure"){let t=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(t=!1),t&&this.instance){let t=n(this.instance);this.scroll={animationId:this.root.animationId,phase:e,isRoot:t,offset:r(this.instance),wasRoot:this.scroll?this.scroll.isRoot:t}}}resetTransform(){if(!i)return;let e=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,t=this.projectionDelta&&!nC(this.projectionDelta),r=this.getTransformTemplate(),n=r?r(this.latestValues,""):void 0,o=n!==this.prevTransformTemplateValue;e&&this.instance&&(t||rO(this.latestValues)||o)&&(i(this.instance,n),this.shouldResetTransform=!1,this.scheduleRender())}measure(e=!0){var t;let r=this.measurePageBox(),n=this.removeElementScroll(r);return e&&(n=this.removeTransform(n)),n7((t=n).x),n7(t.y),{animationId:this.root.animationId,measuredBox:r,layoutBox:n,latestValues:{},source:this.id}}measurePageBox(){let{visualElement:e}=this.options;if(!e)return rk();let t=e.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(ie))){let{scroll:e}=this.root;e&&(rL(t.x,e.offset.x),rL(t.y,e.offset.y))}return t}removeElementScroll(e){let t=rk();if(nI(t,e),this.scroll?.wasRoot)return t;for(let r=0;r<this.path.length;r++){let n=this.path[r],{scroll:i,options:o}=n;n!==this.root&&i&&o.layoutScroll&&(i.wasRoot&&nI(t,e),rL(t.x,i.offset.x),rL(t.y,i.offset.y))}return t}applyTransform(e,t=!1){let r=rk();nI(r,e);for(let e=0;e<this.path.length;e++){let n=this.path[e];!t&&n.options.layoutScroll&&n.scroll&&n!==n.root&&rF(r,{x:-n.scroll.offset.x,y:-n.scroll.offset.y}),rO(n.latestValues)&&rF(r,n.latestValues)}return rO(this.latestValues)&&rF(r,this.latestValues),r}removeTransform(e){let t=rk();nI(t,e);for(let e=0;e<this.path.length;e++){let r=this.path[e];if(!r.instance||!rO(r.latestValues))continue;rA(r.latestValues)&&r.updateSnapshot();let n=rk();nI(n,r.measurePageBox()),nA(t,r.latestValues,r.snapshot?r.snapshot.layoutBox:void 0,n)}return rO(this.latestValues)&&nA(t,this.latestValues),t}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options={...this.options,...e,crossfade:void 0===e.crossfade||e.crossfade}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==g.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(e=!1){let t=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=t.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=t.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=t.isSharedProjectionDirty);let r=!!this.resumingFrom||this!==t;if(!(e||r&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;let{layout:n,layoutId:i}=this.options;if(this.layout&&(n||i)){if(this.resolvedRelativeTargetAt=g.timestamp,!this.targetDelta&&!this.relativeTarget){let e=this.getClosestProjectingParent();e&&e.layout&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget=rk(),this.relativeTargetOrigin=rk(),rx(this.relativeTargetOrigin,this.layout.layoutBox,e.layout.layoutBox),nI(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(this.relativeTarget||this.targetDelta){if(this.target||(this.target=rk(),this.targetWithTransforms=rk()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target){var o,a,s;this.forceRelativeParentToResolveTarget(),o=this.target,a=this.relativeTarget,s=this.relativeParent.target,rw(o.x,a.x,s.x),rw(o.y,a.y,s.y)}else this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):nI(this.target,this.layout.layoutBox),rR(this.target,this.targetDelta)):nI(this.target,this.layout.layoutBox);if(this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;let e=this.getClosestProjectingParent();e&&!!e.resumingFrom==!!this.resumingFrom&&!e.options.layoutScroll&&e.target&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget=rk(),this.relativeTargetOrigin=rk(),rx(this.relativeTargetOrigin,this.target,e.target),nI(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}d.value&&nG.calculatedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||rA(this.parent.latestValues)||rC(this.parent.latestValues)))if(this.parent.isProjecting())return this.parent;else return this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){let e=this.getLead(),t=!!this.resumingFrom||this!==e,r=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(r=!1),t&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(r=!1),this.resolvedRelativeTargetAt===g.timestamp&&(r=!1),r)return;let{layout:n,layoutId:i}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(n||i))return;nI(this.layoutCorrected,this.layout.layoutBox);let o=this.treeScale.x,a=this.treeScale.y;!function(e,t,r,n=!1){let i,o,a=r.length;if(a){t.x=t.y=1;for(let s=0;s<a;s++){o=(i=r[s]).projectionDelta;let{visualElement:a}=i.options;(!a||!a.props.style||"contents"!==a.props.style.display)&&(n&&i.options.layoutScroll&&i.scroll&&i!==i.root&&rF(e,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),o&&(t.x*=o.x.scale,t.y*=o.y.scale,rR(e,o)),n&&rO(i.latestValues)&&rF(e,i.latestValues))}t.x<1.0000000000001&&t.x>.999999999999&&(t.x=1),t.y<1.0000000000001&&t.y>.999999999999&&(t.y=1)}}(this.layoutCorrected,this.treeScale,this.path,t),e.layout&&!e.target&&(1!==this.treeScale.x||1!==this.treeScale.y)&&(e.target=e.layout.layoutBox,e.targetWithTransforms=rk());let{target:s}=e;if(!s){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}this.projectionDelta&&this.prevProjectionDelta?(nE(this.prevProjectionDelta.x,this.projectionDelta.x),nE(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),rb(this.projectionDelta,this.layoutCorrected,s,this.latestValues),this.treeScale.x===o&&this.treeScale.y===a&&nj(this.projectionDelta.x,this.prevProjectionDelta.x)&&nj(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",s)),d.value&&nG.calculatedProjections++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(e=!0){if(this.options.visualElement?.scheduleRender(),e){let e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=rE(),this.projectionDelta=rE(),this.projectionDeltaWithTransform=rE()}setAnimationOrigin(e,t=!1){let r,n=this.snapshot,i=n?n.latestValues:{},o={...this.latestValues},a=rE();this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!t;let s=rk(),u=(n?n.source:void 0)!==(this.layout?this.layout.source:void 0),c=this.getStack(),l=!c||c.members.length<=1,h=!!(u&&!l&&!0===this.options.crossfade&&!this.path.some(n4));this.animationProgress=0,this.mixTargetDelta=t=>{let n=t/1e3;if(n2(a.x,e.x,n),n2(a.y,e.y,n),this.setTargetDelta(a),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout){var c,d,f,p,m,g;rx(s,this.layout.layoutBox,this.relativeParent.layout.layoutBox),f=this.relativeTarget,p=this.relativeTargetOrigin,m=s,g=n,n3(f.x,p.x,m.x,g),n3(f.y,p.y,m.y,g),r&&(c=this.relativeTarget,d=r,nD(c.x,d.x)&&nD(c.y,d.y))&&(this.isProjectionDirty=!1),r||(r=rk()),nI(r,this.relativeTarget)}u&&(this.animationValues=o,function(e,t,r,n,i,o){i?(e.opacity=ek(0,r.opacity??1,nb(n)),e.opacityExit=ek(t.opacity??1,0,nw(n))):o&&(e.opacity=ek(t.opacity??1,r.opacity??1,n));for(let i=0;i<nm;i++){let o=`border${np[i]}Radius`,a=nv(t,o),s=nv(r,o);(void 0!==a||void 0!==s)&&(a||(a=0),s||(s=0),0===a||0===s||ny(a)===ny(s)?(e[o]=Math.max(ek(ng(a),ng(s),n),0),(eu.test(s)||eu.test(a))&&(e[o]+="%")):e[o]=s)}(t.rotate||r.rotate)&&(e.rotate=ek(t.rotate||0,r.rotate||0,n))}(o,i,this.latestValues,n,h,l)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=n},this.mixTargetDelta(1e3*!!this.options.layoutRoot)}startAnimation(e){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(m(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=p.update(()=>{nt.hasAnimatedSinceResize=!0,U.layout++,this.motionValue||(this.motionValue=A(0)),this.currentAnimation=function(e,t,r){let n=C(e)?e:A(e);return n.start(t3("",n,t,r)),n.animation}(this.motionValue,[0,1e3],{...e,velocity:0,isSync:!0,onUpdate:t=>{this.mixTargetDelta(t),e.onUpdate&&e.onUpdate(t)},onStop:()=>{U.layout--},onComplete:()=>{U.layout--,e.onComplete&&e.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);let e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){let e=this.getLead(),{targetWithTransforms:t,target:r,layout:n,latestValues:i}=e;if(t&&r&&n){if(this!==e&&this.layout&&n&&n9(this.options.animationType,this.layout.layoutBox,n.layoutBox)){r=this.target||rk();let t=ry(this.layout.layoutBox.x);r.x.min=e.target.x.min,r.x.max=r.x.min+t;let n=ry(this.layout.layoutBox.y);r.y.min=e.target.y.min,r.y.max=r.y.min+n}nI(t,r),rF(t,i),rb(this.projectionDeltaWithTransform,this.layoutCorrected,t,i)}}registerSharedNode(e,t){this.sharedNodes.has(e)||this.sharedNodes.set(e,new nF),this.sharedNodes.get(e).add(t);let r=t.options.initialPromotionConfig;t.promote({transition:r?r.transition:void 0,preserveFollowOpacity:r&&r.shouldPreserveFollowOpacity?r.shouldPreserveFollowOpacity(t):void 0})}isLead(){let e=this.getStack();return!e||e.lead===this}getLead(){let{layoutId:e}=this.options;return e&&this.getStack()?.lead||this}getPrevLead(){let{layoutId:e}=this.options;return e?this.getStack()?.prevLead:void 0}getStack(){let{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote({needsReset:e,transition:t,preserveFollowOpacity:r}={}){let n=this.getStack();n&&n.promote(this,r),e&&(this.projectionDelta=void 0,this.needsReset=!0),t&&this.setOptions({transition:t})}relegate(){let e=this.getStack();return!!e&&e.relegate(this)}resetSkewAndRotation(){let{visualElement:e}=this.options;if(!e)return;let t=!1,{latestValues:r}=e;if((r.z||r.rotate||r.rotateX||r.rotateY||r.rotateZ||r.skewX||r.skewY)&&(t=!0),!t)return;let n={};r.z&&nV("z",e,n,this.animationValues);for(let t=0;t<nM.length;t++)nV(`rotate${nM[t]}`,e,n,this.animationValues),nV(`skew${nM[t]}`,e,n,this.animationValues);for(let t in e.render(),n)e.setStaticValue(t,n[t]),this.animationValues&&(this.animationValues[t]=n[t]);e.scheduleRender()}applyProjectionStyles(e,t){if(!this.instance||this.isSVG)return;if(!this.isVisible){e.visibility="hidden";return}let r=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,e.visibility="",e.opacity="",e.pointerEvents=nf(t?.pointerEvents)||"",e.transform=r?r(this.latestValues,""):"none";return}let n=this.getLead();if(!this.projectionDelta||!this.layout||!n.target){this.options.layoutId&&(e.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,e.pointerEvents=nf(t?.pointerEvents)||""),this.hasProjected&&!rO(this.latestValues)&&(e.transform=r?r({},""):"none",this.hasProjected=!1);return}e.visibility="";let i=n.animationValues||n.latestValues;this.applyTransformsToTarget();let o=function(e,t,r){let n="",i=e.x.translate/t.x,o=e.y.translate/t.y,a=r?.z||0;if((i||o||a)&&(n=`translate3d(${i}px, ${o}px, ${a}px) `),(1!==t.x||1!==t.y)&&(n+=`scale(${1/t.x}, ${1/t.y}) `),r){let{transformPerspective:e,rotate:t,rotateX:i,rotateY:o,skewX:a,skewY:s}=r;e&&(n=`perspective(${e}px) ${n}`),t&&(n+=`rotate(${t}deg) `),i&&(n+=`rotateX(${i}deg) `),o&&(n+=`rotateY(${o}deg) `),a&&(n+=`skewX(${a}deg) `),s&&(n+=`skewY(${s}deg) `)}let s=e.x.scale*t.x,u=e.y.scale*t.y;return(1!==s||1!==u)&&(n+=`scale(${s}, ${u})`),n||"none"}(this.projectionDeltaWithTransform,this.treeScale,i);r&&(o=r(i,o)),e.transform=o;let{x:a,y:s}=this.projectionDelta;for(let t in e.transformOrigin=`${100*a.origin}% ${100*s.origin}% 0`,n.animationValues?e.opacity=n===this?i.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:i.opacityExit:e.opacity=n===this?void 0!==i.opacity?i.opacity:"":void 0!==i.opacityExit?i.opacityExit:0,ni){if(void 0===i[t])continue;let{correct:r,applyTo:a,isCSSVariable:s}=ni[t],u="none"===o?i[t]:r(i[t],n);if(a){let t=a.length;for(let r=0;r<t;r++)e[a[r]]=u}else s?this.options.visualElement.renderState.vars[t]=u:e[t]=u}this.options.layoutId&&(e.pointerEvents=n===this?nf(t?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(e=>e.currentAnimation?.stop()),this.root.nodes.forEach(nW),this.root.sharedNodes.clear()}}}function nz(e){e.updateLayout()}function nH(e){let t=e.resumeFrom?.snapshot||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){let{layoutBox:r,measuredBox:n}=e.layout,{animationType:i}=e.options,o=t.source!==e.layout.source;"size"===i?r_(e=>{let n=o?t.measuredBox[e]:t.layoutBox[e],i=ry(n);n.min=r[e].min,n.max=n.min+i}):n9(i,t.layoutBox,r)&&r_(n=>{let i=o?t.measuredBox[n]:t.layoutBox[n],a=ry(r[n]);i.max=i.min+a,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[n].max=e.relativeTarget[n].min+a)});let a=rE();rb(a,r,t.layoutBox);let s=rE();o?rb(s,e.applyTransform(n,!0),t.measuredBox):rb(s,r,t.layoutBox);let u=!nC(a),c=!1;if(!e.resumeFrom){let n=e.getClosestProjectingParent();if(n&&!n.resumeFrom){let{snapshot:i,layout:o}=n;if(i&&o){let a=rk();rx(a,t.layoutBox,i.layoutBox);let s=rk();rx(s,r,o.layoutBox),nR(a,s)||(c=!0),n.options.layoutRoot&&(e.relativeTarget=s,e.relativeTargetOrigin=a,e.relativeParent=n)}}}e.notifyListeners("didUpdate",{layout:r,snapshot:t,delta:s,layoutDelta:a,hasLayoutChanged:u,hasRelativeLayoutChanged:c})}else if(e.isLead()){let{onExitComplete:t}=e.options;t&&t()}e.options.transition=void 0}function nq(e){d.value&&nG.nodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function n$(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function nK(e){e.clearSnapshot()}function nW(e){e.clearMeasurements()}function nJ(e){e.isLayoutDirty=!1}function nQ(e){let{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function nY(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function nX(e){e.resolveTargetDelta()}function nZ(e){e.calcProjection()}function n0(e){e.resetSkewAndRotation()}function n1(e){e.removeLeadSnapshot()}function n2(e,t,r){e.translate=ek(t.translate,0,r),e.scale=ek(t.scale,1,r),e.origin=t.origin,e.originPoint=t.originPoint}function n3(e,t,r,n){e.min=ek(t.min,r.min,n),e.max=ek(t.max,r.max,n)}function n4(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}let n6={duration:.45,ease:[.4,0,.1,1]},n5=e=>"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),n8=n5("applewebkit/")&&!n5("chrome/")?Math.round:c;function n7(e){e.min=n8(e.min),e.max=n8(e.max)}function n9(e,t,r){return"position"===e||"preserve-aspect"===e&&!(.2>=Math.abs(nL(t)-nL(r)))}function ie(e){return e!==e.root&&e.scroll?.wasRoot}let it=nB({attachResizeListener:(e,t)=>rh(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),ir={current:void 0},ii=nB({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!ir.current){let e=new it({});e.mount(window),e.setOptions({layoutScroll:!0}),ir.current=e}return ir.current},resetTransform:(e,t)=>{e.style.transform=void 0!==t?t:"none"},checkIsScrollRoot:e=>"fixed"===window.getComputedStyle(e).position});function io(e,t){let r=function(e,t,r){if(e instanceof EventTarget)return[e];if("string"==typeof e){let t=document,r=(void 0)??t.querySelectorAll(e);return r?Array.from(r):[]}return Array.from(e)}(e),n=new AbortController;return[r,{passive:!0,...t,signal:n.signal},()=>n.abort()]}function ia(e){return!("touch"===e.pointerType||rl.x||rl.y)}function is(e,t,r){let{props:n}=e;e.animationState&&n.whileHover&&e.animationState.setActive("whileHover","Start"===r);let i=n["onHover"+r];i&&p.postRender(()=>i(t,rf(t)))}class iu extends ra{mount(){let{current:e}=this.node;e&&(this.unmount=function(e,t,r={}){let[n,i,o]=io(e,r),a=e=>{if(!ia(e))return;let{target:r}=e,n=t(r,e);if("function"!=typeof n||!r)return;let o=e=>{ia(e)&&(n(e),r.removeEventListener("pointerleave",o))};r.addEventListener("pointerleave",o,i)};return n.forEach(e=>{e.addEventListener("pointerenter",a,i)}),o}(e,(e,t)=>(is(this.node,t,"Start"),e=>is(this.node,e,"End"))))}unmount(){}}class ic extends ra{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(t){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=j(rh(this.node.current,"focus",()=>this.onFocus()),rh(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}var il=r(5609);let ih=(e,t)=>!!t&&(e===t||ih(e,t.parentElement)),id=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]),ip=new WeakSet;function im(e){return t=>{"Enter"===t.key&&e(t)}}function ig(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}let iy=(e,t)=>{let r=e.currentTarget;if(!r)return;let n=im(()=>{if(ip.has(r))return;ig(r,"down");let e=im(()=>{ig(r,"up")});r.addEventListener("keyup",e,t),r.addEventListener("blur",()=>ig(r,"cancel"),t)});r.addEventListener("keydown",n,t),r.addEventListener("blur",()=>r.removeEventListener("keydown",n),t)};function iv(e){return rd(e)&&!(rl.x||rl.y)}function ib(e,t,r){let{props:n}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&n.whileTap&&e.animationState.setActive("whileTap","Start"===r);let i=n["onTap"+("End"===r?"":r)];i&&p.postRender(()=>i(t,rf(t)))}class iw extends ra{mount(){let{current:e}=this.node;e&&(this.unmount=function(e,t,r={}){let[n,i,o]=io(e,r),a=e=>{let n=e.currentTarget;if(!iv(e))return;ip.add(n);let o=t(n,e),a=(e,t)=>{window.removeEventListener("pointerup",s),window.removeEventListener("pointercancel",u),ip.has(n)&&ip.delete(n),iv(e)&&"function"==typeof o&&o(e,{success:t})},s=e=>{a(e,n===window||n===document||r.useGlobalTarget||ih(n,e.target))},u=e=>{a(e,!1)};window.addEventListener("pointerup",s,i),window.addEventListener("pointercancel",u,i)};return n.forEach(e=>{((r.useGlobalTarget?window:e).addEventListener("pointerdown",a,i),(0,il.s)(e))&&(e.addEventListener("focus",e=>iy(e,i)),id.has(e.tagName)||-1!==e.tabIndex||e.hasAttribute("tabindex")||(e.tabIndex=0))}),o}(e,(e,t)=>(ib(this.node,t,"Start"),(e,{success:t})=>ib(this.node,e,t?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}let iS=new WeakMap,ix=new WeakMap,iI=e=>{let t=iS.get(e.target);t&&t(e)},iE=e=>{e.forEach(iI)},iT={some:0,all:1};class ik extends ra{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();let{viewport:e={}}=this.node.getProps(),{root:t,margin:r,amount:n="some",once:i}=e,o={root:t?t.current:void 0,rootMargin:r,threshold:"number"==typeof n?n:iT[n]};return function(e,t,r){let n=function({root:e,...t}){let r=e||document;ix.has(r)||ix.set(r,{});let n=ix.get(r),i=JSON.stringify(t);return n[i]||(n[i]=new IntersectionObserver(iE,{root:e,...t})),n[i]}(t);return iS.set(e,r),n.observe(e),()=>{iS.delete(e),n.unobserve(e)}}(this.node.current,o,e=>{let{isIntersecting:t}=e;if(this.isInView===t||(this.isInView=t,i&&!t&&this.hasEnteredView))return;t&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",t);let{onViewportEnter:r,onViewportLeave:n}=this.node.getProps(),o=t?r:n;o&&o(e)})}mount(){this.startObserver()}update(){if("undefined"==typeof IntersectionObserver)return;let{props:e,prevProps:t}=this.node;["amount","margin","root"].some(function({viewport:e={}},{viewport:t={}}={}){return r=>e[r]!==t[r]}(e,t))&&this.startObserver()}unmount(){}}let i_=(0,r8.createContext)({strict:!1});var iP=r(9751);let iA=(0,r8.createContext)({});function iO(e){return i(e.animate)||re.some(t=>t7(e[t]))}function iC(e){return!!(iO(e)||e.variants)}function iD(e){return Array.isArray(e)?e.join(" "):e}var iN=r(2205);let iR={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},iL={};for(let e in iR)iL[e]={isEnabled:t=>iR[e].some(e=>!!t[e])};let ij=Symbol.for("motionComponentSymbol");var iF=r(3866),iG=r(181);function iM(e,{layout:t,layoutId:r}){return b.has(e)||e.startsWith("origin")||(t||void 0!==r)&&(!!ni[e]||"opacity"===e)}let iU=(e,t)=>t&&"number"==typeof e?t.transform(e):e,iV={...W,transform:Math.round},iB={borderWidth:ec,borderTopWidth:ec,borderRightWidth:ec,borderBottomWidth:ec,borderLeftWidth:ec,borderRadius:ec,radius:ec,borderTopLeftRadius:ec,borderTopRightRadius:ec,borderBottomRightRadius:ec,borderBottomLeftRadius:ec,width:ec,maxWidth:ec,height:ec,maxHeight:ec,top:ec,right:ec,bottom:ec,left:ec,padding:ec,paddingTop:ec,paddingRight:ec,paddingBottom:ec,paddingLeft:ec,margin:ec,marginTop:ec,marginRight:ec,marginBottom:ec,marginLeft:ec,backgroundPositionX:ec,backgroundPositionY:ec,rotate:es,rotateX:es,rotateY:es,rotateZ:es,scale:Q,scaleX:Q,scaleY:Q,scaleZ:Q,skew:es,skewX:es,skewY:es,distance:ec,translateX:ec,translateY:ec,translateZ:ec,x:ec,y:ec,z:ec,perspective:ec,transformPerspective:ec,opacity:J,originX:ed,originY:ed,originZ:ec,zIndex:iV,fillOpacity:J,strokeOpacity:J,numOctaves:iV},iz={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},iH=v.length;function iq(e,t,r){let{style:n,vars:i,transformOrigin:o}=e,a=!1,s=!1;for(let e in t){let r=t[e];if(b.has(e)){a=!0;continue}if(H(e)){i[e]=r;continue}{let t=iU(r,iB[e]);e.startsWith("origin")?(s=!0,o[e]=t):n[e]=t}}if(!t.transform&&(a||r?n.transform=function(e,t,r){let n="",i=!0;for(let o=0;o<iH;o++){let a=v[o],s=e[a];if(void 0===s)continue;let u=!0;if(!(u="number"==typeof s?s===+!!a.startsWith("scale"):0===parseFloat(s))||r){let e=iU(s,iB[a]);if(!u){i=!1;let t=iz[a]||a;n+=`${t}(${e}) `}r&&(t[a]=e)}}return n=n.trim(),r?n=r(t,i?"":n):i&&(n="none"),n}(t,e.transform,r):n.transform&&(n.transform="none")),s){let{originX:e="50%",originY:t="50%",originZ:r=0}=o;n.transformOrigin=`${e} ${t} ${r}`}}let i$=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function iK(e,t,r){for(let n in t)C(t[n])||iM(n,r)||(e[n]=t[n])}let iW={offset:"stroke-dashoffset",array:"stroke-dasharray"},iJ={offset:"strokeDashoffset",array:"strokeDasharray"};function iQ(e,{attrX:t,attrY:r,attrScale:n,pathLength:i,pathSpacing:o=1,pathOffset:a=0,...s},u,c,l){if(iq(e,s,c),u){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};let{attrs:h,style:d}=e;h.transform&&(d.transform=h.transform,delete h.transform),(d.transform||h.transformOrigin)&&(d.transformOrigin=h.transformOrigin??"50% 50%",delete h.transformOrigin),d.transform&&(d.transformBox=l?.transformBox??"fill-box",delete h.transformBox),void 0!==t&&(h.x=t),void 0!==r&&(h.y=r),void 0!==n&&(h.scale=n),void 0!==i&&function(e,t,r=1,n=0,i=!0){e.pathLength=1;let o=i?iW:iJ;e[o.offset]=ec.transform(-n);let a=ec.transform(t),s=ec.transform(r);e[o.array]=`${a} ${s}`}(h,i,o,a,!1)}let iY=()=>({...i$(),attrs:{}}),iX=e=>"string"==typeof e&&"svg"===e.toLowerCase(),iZ=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function i0(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||iZ.has(e)}let i1=e=>!i0(e);try{!function(e){"function"==typeof e&&(i1=t=>t.startsWith("on")?!i0(t):e(t))}(require("@emotion/is-prop-valid").default)}catch{}let i2=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function i3(e){if("string"!=typeof e||e.includes("-"));else if(i2.indexOf(e)>-1||/[A-Z]/u.test(e))return!0;return!1}var i4=r(1200);let i6=e=>(t,r)=>{let n=(0,r8.useContext)(iA),o=(0,r8.useContext)(iF.t),s=()=>(function({scrapeMotionValuesFromProps:e,createRenderState:t},r,n,o){return{latestValues:function(e,t,r,n){let o={},s=n(e,{});for(let e in s)o[e]=nf(s[e]);let{initial:u,animate:c}=e,l=iO(e),h=iC(e);t&&h&&!l&&!1!==e.inherit&&(void 0===u&&(u=t.initial),void 0===c&&(c=t.animate));let d=!!r&&!1===r.initial,f=(d=d||!1===u)?c:u;if(f&&"boolean"!=typeof f&&!i(f)){let t=Array.isArray(f)?f:[f];for(let r=0;r<t.length;r++){let n=a(e,t[r]);if(n){let{transitionEnd:e,transition:t,...r}=n;for(let e in r){let t=r[e];if(Array.isArray(t)){let e=d?t.length-1:0;t=t[e]}null!==t&&(o[e]=t)}for(let t in e)o[t]=e[t]}}}return o}(r,n,o,e),renderState:t()}})(e,t,n,o);return r?s():(0,i4.M)(s)};function i5(e,t,r){let{style:n}=e,i={};for(let o in n)(C(n[o])||t.style&&C(t.style[o])||iM(o,e)||r?.getValue(o)?.liveStyle!==void 0)&&(i[o]=n[o]);return i}let i8={useVisualState:i6({scrapeMotionValuesFromProps:i5,createRenderState:i$})};function i7(e,t,r){let n=i5(e,t,r);for(let r in e)(C(e[r])||C(t[r]))&&(n[-1!==v.indexOf(r)?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r]=e[r]);return n}let i9={useVisualState:i6({scrapeMotionValuesFromProps:i7,createRenderState:iY})},oe=e=>t=>t.test(e),ot=[W,ec,eu,es,eh,el,{test:e=>"auto"===e,parse:e=>e}],or=e=>ot.find(oe(e)),on=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),oi=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u,oo=e=>/^0[^.\s]+$/u.test(e),oa=new Set(["brightness","contrast","saturate","opacity"]);function os(e){let[t,r]=e.slice(0,-1).split("(");if("drop-shadow"===t)return e;let[n]=r.match(X)||[];if(!n)return e;let i=r.replace(n,""),o=+!!oa.has(t);return n!==r&&(o*=100),t+"("+o+i+")"}let ou=/\b([a-z-]*)\(.*?\)/gu,oc={...eI,getAnimatableNone:e=>{let t=e.match(ou);return t?t.map(os).join(" "):e}},ol={...iB,color:ep,backgroundColor:ep,outlineColor:ep,fill:ep,stroke:ep,borderColor:ep,borderTopColor:ep,borderRightColor:ep,borderBottomColor:ep,borderLeftColor:ep,filter:oc,WebkitFilter:oc},oh=e=>ol[e];function od(e,t){let r=oh(e);return r!==oc&&(r=eI),r.getAnimatableNone?r.getAnimatableNone(t):void 0}let of=new Set(["auto","none","0"]);class op extends tL{constructor(e,t,r,n,i){super(e,t,r,n,i,!0)}readKeyframes(){let{unresolvedKeyframes:e,element:t,name:r}=this;if(!t||!t.current)return;super.readKeyframes();for(let r=0;r<e.length;r++){let n=e[r];if("string"==typeof n&&$(n=n.trim())){let i=function e(t,r,n=1){B(n<=4,`Max CSS variable fallback depth detected in property "${t}". This may indicate a circular fallback dependency.`,"max-css-var-depth");let[i,o]=function(e){let t=oi.exec(e);if(!t)return[,];let[,r,n,i]=t;return[`--${r??n}`,i]}(t);if(!i)return;let a=window.getComputedStyle(r).getPropertyValue(i);if(a){let e=a.trim();return on(e)?parseFloat(e):e}return $(o)?e(o,r,n+1):o}(n,t.current);void 0!==i&&(e[r]=i),r===e.length-1&&(this.finalKeyframe=n)}}if(this.resolveNoneKeyframes(),!w.has(r)||2!==e.length)return;let[n,i]=e,o=or(n),a=or(i);if(o!==a)if(tT(o)&&tT(a))for(let t=0;t<e.length;t++){let r=e[t];"string"==typeof r&&(e[t]=parseFloat(r))}else tP[r]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){let{unresolvedKeyframes:e,name:t}=this,r=[];for(let t=0;t<e.length;t++){var n;(null===e[t]||("number"==typeof(n=e[t])?0===n:null===n||"none"===n||"0"===n||oo(n)))&&r.push(t)}r.length&&function(e,t,r){let n,i=0;for(;i<e.length&&!n;){let t=e[i];"string"==typeof t&&!of.has(t)&&eb(t).values.length&&(n=e[i]),i++}if(n&&r)for(let i of t)e[i]=od(r,n)}(e,r,t)}measureInitialState(){let{element:e,unresolvedKeyframes:t,name:r}=this;if(!e||!e.current)return;"height"===r&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=tP[r](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;let n=t[t.length-1];void 0!==n&&e.getValue(r,n).jump(n,!1)}measureEndState(){let{element:e,name:t,unresolvedKeyframes:r}=this;if(!e||!e.current)return;let n=e.getValue(t);n&&n.jump(this.measuredOrigin,!1);let i=r.length-1,o=r[i];r[i]=tP[t](e.measureViewportBox(),window.getComputedStyle(e.current)),null!==o&&void 0===this.finalKeyframe&&(this.finalKeyframe=o),this.removedTransforms?.length&&this.removedTransforms.forEach(([t,r])=>{e.getValue(t).set(r)}),this.resolveNoneKeyframes()}}let om=[...ot,ep,eI],og=e=>om.find(oe(e)),oy={current:null},ov={current:!1},ob=new WeakMap,ow=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class oS{scrapeMotionValuesFromProps(e,t,r){return{}}constructor({parent:e,props:t,presenceContext:r,reducedMotionConfig:n,blockInitialAnimation:i,visualState:o},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=tL,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{let e=T.now();this.renderScheduledAt<e&&(this.renderScheduledAt=e,p.render(this.render,!1,!0))};let{latestValues:s,renderState:u}=o;this.latestValues=s,this.baseTarget={...s},this.initialValues=t.initial?{...s}:{},this.renderState=u,this.parent=e,this.props=t,this.presenceContext=r,this.depth=e?e.depth+1:0,this.reducedMotionConfig=n,this.options=a,this.blockInitialAnimation=!!i,this.isControllingVariants=iO(t),this.isVariantNode=iC(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);let{willChange:c,...l}=this.scrapeMotionValuesFromProps(t,{},this);for(let e in l){let t=l[e];void 0!==s[e]&&C(t)&&t.set(s[e],!1)}}mount(e){this.current=e,ob.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((e,t)=>this.bindToMotionValue(t,e)),ov.current||function(){if(ov.current=!0,iN.B)if(window.matchMedia){let e=window.matchMedia("(prefers-reduced-motion)"),t=()=>oy.current=e.matches;e.addEventListener("change",t),t()}else oy.current=!1}(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||oy.current),this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){for(let e in this.projection&&this.projection.unmount(),m(this.notifyUpdate),m(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this),this.events)this.events[e].clear();for(let e in this.features){let t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}bindToMotionValue(e,t){let r;this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();let n=b.has(e);n&&this.onBindTransform&&this.onBindTransform();let i=t.on("change",t=>{this.latestValues[e]=t,this.props.onUpdate&&p.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0)}),o=t.on("renderRequest",this.scheduleRender);window.MotionCheckAppearSync&&(r=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{i(),o(),r&&r(),t.owner&&t.stop()})}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}updateFeatures(){let e="animation";for(e in iL){let t=iL[e];if(!t)continue;let{isEnabled:r,Feature:n}=t;if(!this.features[e]&&n&&r(this.props)&&(this.features[e]=new n(this)),this.features[e]){let t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):rk()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let t=0;t<ow.length;t++){let r=ow[t];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);let n=e["on"+r];n&&(this.propEventSubscriptions[r]=this.on(r,n))}this.prevMotionValues=function(e,t,r){for(let n in t){let i=t[n],o=r[n];if(C(i))e.addValue(n,i);else if(C(o))e.addValue(n,A(i,{owner:e}));else if(o!==i)if(e.hasValue(n)){let t=e.getValue(n);!0===t.liveStyle?t.jump(i):t.hasAnimated||t.set(i)}else{let t=e.getStaticValue(n);e.addValue(n,A(void 0!==t?t:i,{owner:e}))}}for(let n in r)void 0===t[n]&&e.removeValue(n);return t}(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){let t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){let r=this.values.get(e);t!==r&&(r&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);let t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let r=this.values.get(e);return void 0===r&&void 0!==t&&(r=A(null===t?void 0:t,{owner:this}),this.addValue(e,r)),r}readValue(e,t){let r=void 0===this.latestValues[e]&&this.current?this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options):this.latestValues[e];return null!=r&&("string"==typeof r&&(on(r)||oo(r))?r=parseFloat(r):!og(r)&&eI.test(t)&&(r=od(e,t)),this.setBaseTarget(e,C(r)?r.get():r)),C(r)?r.get():r}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){let t,{initial:r}=this.props;if("string"==typeof r||"object"==typeof r){let n=a(this.props,r,this.presenceContext?.custom);n&&(t=n[e])}if(r&&void 0!==t)return t;let n=this.getBaseTargetFromProps(this.props,e);return void 0===n||C(n)?void 0!==this.initialValues[e]&&void 0===t?void 0:this.baseTarget[e]:n}on(e,t){return this.events[e]||(this.events[e]=new I),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}}class ox extends oS{constructor(){super(...arguments),this.KeyframeResolver=op}sortInstanceNodePosition(e,t){return 2&e.compareDocumentPosition(t)?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:r}){delete t[e],delete r[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);let{children:e}=this.props;C(e)&&(this.childSubscription=e.on("change",e=>{this.current&&(this.current.textContent=`${e}`)}))}}function oI(e,{style:t,vars:r},n,i){let o,a=e.style;for(o in t)a[o]=t[o];for(o in i?.applyProjectionStyles(a,n),r)a.setProperty(o,r[o])}class oE extends ox{constructor(){super(...arguments),this.type="html",this.renderInstance=oI}readValueFromInstance(e,t){if(b.has(t))return this.projection?.isProjecting?tS(t):tI(e,t);{let r=window.getComputedStyle(e),n=(H(t)?r.getPropertyValue(t):r[t])||0;return"string"==typeof n?n.trim():n}}measureInstanceViewportBox(e,{transformPagePoint:t}){return rG(e,t)}build(e,t,r){iq(e,t,r.transformTemplate)}scrapeMotionValuesFromProps(e,t,r){return i5(e,t,r)}}let oT=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);class ok extends ox{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=rk}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(b.has(t)){let e=oh(t);return e&&e.default||0}return t=oT.has(t)?t:N(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,r){return i7(e,t,r)}build(e,t,r){iQ(e,t,this.isSVGTag,r.transformTemplate,r.style)}renderInstance(e,t,r,n){for(let r in oI(e,t,void 0,n),t.attrs)e.setAttribute(oT.has(r)?r:N(r),t.attrs[r])}mount(e){this.isSVGTag=iX(e.tagName),super.mount(e)}}let o_=function(e){if("undefined"==typeof Proxy)return e;let t=new Map;return new Proxy((...t)=>e(...t),{get:(r,n)=>"create"===n?e:(t.has(n)||t.set(n,e(n)),t.get(n))})}((r3={animation:{Feature:rs},exit:{Feature:rc},inView:{Feature:ik},tap:{Feature:iw},focus:{Feature:ic},hover:{Feature:iu},pan:{Feature:r2},drag:{Feature:r0,ProjectionNode:ii,MeasureLayout:ns},layout:{ProjectionNode:ii,MeasureLayout:ns}},r4=(e,t)=>i3(e)?new ok(t):new oE(t,{allowProjection:e!==r8.Fragment}),function(e,{forwardMotionProps:t}={forwardMotionProps:!1}){return function({preloadedFeatures:e,createVisualElement:t,useRender:r,useVisualState:n,Component:i}){function o(e,o){var a,s,u;let c,l={...(0,r8.useContext)(iP.Q),...e,layoutId:function({layoutId:e}){let t=(0,r8.useContext)(r9.L).id;return t&&void 0!==e?t+"-"+e:e}(e)},{isStatic:h}=l,d=function(e){let{initial:t,animate:r}=function(e,t){if(iO(e)){let{initial:t,animate:r}=e;return{initial:!1===t||t7(t)?t:void 0,animate:t7(r)?r:void 0}}return!1!==e.inherit?t:{}}(e,(0,r8.useContext)(iA));return(0,r8.useMemo)(()=>({initial:t,animate:r}),[iD(t),iD(r)])}(e),f=n(e,h);if(!h&&iN.B){s=0,u=0,(0,r8.useContext)(i_).strict;let e=function(e){let{drag:t,layout:r}=iL;if(!t&&!r)return{};let n={...t,...r};return{MeasureLayout:t?.isEnabled(e)||r?.isEnabled(e)?n.MeasureLayout:void 0,ProjectionNode:n.ProjectionNode}}(l);c=e.MeasureLayout,d.visualElement=function(e,t,r,n,i){let{visualElement:o}=(0,r8.useContext)(iA),a=(0,r8.useContext)(i_),s=(0,r8.useContext)(iF.t),u=(0,r8.useContext)(iP.Q).reducedMotion,c=(0,r8.useRef)(null);n=n||a.renderer,!c.current&&n&&(c.current=n(e,{visualState:t,parent:o,props:r,presenceContext:s,blockInitialAnimation:!!s&&!1===s.initial,reducedMotionConfig:u}));let l=c.current,h=(0,r8.useContext)(ne);l&&!l.projection&&i&&("html"===l.type||"svg"===l.type)&&function(e,t,r,n){let{layoutId:i,layout:o,drag:a,dragConstraints:s,layoutScroll:u,layoutRoot:c,layoutCrossfade:l}=t;e.projection=new r(e.latestValues,t["data-framer-portal-id"]?void 0:function e(t){if(t)return!1!==t.options.allowProjection?t.projection:e(t.parent)}(e.parent)),e.projection.setOptions({layoutId:i,layout:o,alwaysMeasureLayout:!!a||s&&rU(s),visualElement:e,animationType:"string"==typeof o?o:"both",initialPromotionConfig:n,crossfade:l,layoutScroll:u,layoutRoot:c})}(c.current,r,i,h);let d=(0,r8.useRef)(!1);(0,r8.useInsertionEffect)(()=>{l&&d.current&&l.update(r,s)});let f=r[R],p=(0,r8.useRef)(!!f&&!window.MotionHandoffIsComplete?.(f)&&window.MotionHasOptimisedAnimation?.(f));return(0,iG.E)(()=>{l&&(d.current=!0,window.MotionIsMounted=!0,l.updateFeatures(),r5.render(l.render),p.current&&l.animationState&&l.animationState.animateChanges())}),(0,r8.useEffect)(()=>{l&&(!p.current&&l.animationState&&l.animationState.animateChanges(),p.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(f)}),p.current=!1))}),l}(i,f,l,t,e.ProjectionNode)}return(0,r6.jsxs)(iA.Provider,{value:d,children:[c&&d.visualElement?(0,r6.jsx)(c,{visualElement:d.visualElement,...l}):null,r(i,e,(a=d.visualElement,(0,r8.useCallback)(e=>{e&&f.onMount&&f.onMount(e),a&&(e?a.mount(e):a.unmount()),o&&("function"==typeof o?o(e):rU(o)&&(o.current=e))},[a])),f,h,d.visualElement)]})}e&&function(e){for(let t in e)iL[t]={...iL[t],...e[t]}}(e),o.displayName=`motion.${"string"==typeof i?i:`create(${i.displayName??i.name??""})`}`;let a=(0,r8.forwardRef)(o);return a[ij]=i,a}({...i3(e)?i9:i8,preloadedFeatures:r3,useRender:function(e=!1){return(t,r,n,{latestValues:i},o)=>{let a=(i3(t)?function(e,t,r,n){let i=(0,r8.useMemo)(()=>{let r=iY();return iQ(r,t,iX(n),e.transformTemplate,e.style),{...r.attrs,style:{...r.style}}},[t]);if(e.style){let t={};iK(t,e.style,e),i.style={...t,...i.style}}return i}:function(e,t){let r={},n=function(e,t){let r=e.style||{},n={};return iK(n,r,e),Object.assign(n,function({transformTemplate:e},t){return(0,r8.useMemo)(()=>{let r=i$();return iq(r,t,e),Object.assign({},r.vars,r.style)},[t])}(e,t)),n}(e,t);return e.drag&&!1!==e.dragListener&&(r.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=!0===e.drag?"none":`pan-${"x"===e.drag?"y":"x"}`),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(r.tabIndex=0),r.style=n,r})(r,i,o,t),s=function(e,t,r){let n={};for(let i in e)("values"!==i||"object"!=typeof e.values)&&(i1(i)||!0===r&&i0(i)||!t&&!i0(i)||e.draggable&&i.startsWith("onDrag"))&&(n[i]=e[i]);return n}(r,"string"==typeof t,e),u=t!==r8.Fragment?{...s,...a,ref:n}:{},{children:c}=r,l=(0,r8.useMemo)(()=>C(c)?c.get():c,[c]);return(0,r8.createElement)(t,{...u,children:l})}}(t),createVisualElement:r4,Component:e})}))},3558:(e,t,r)=>{"use strict";r.r(t),r.d(t,{abortActiveGame:()=>G,cleanupAbortedSession:()=>M,cleanupDuplicateCompletedGames:()=>N,createActiveGame:()=>w,createNewActiveGame:()=>R,createSessionDocument:()=>j,fetchCompletedGamesFromFirestore:()=>_,findLatestActiveGameForUserInGroup:()=>x,loadCompletedGamesFromFirestore:()=>P,loadRoundsFromFirestore:()=>T,markAllFollowingRoundsAsInactive:()=>D,markRoundsAsActive:()=>C,markRoundsAsInactive:()=>O,saveCompletedGameToFirestore:()=>k,saveRoundToFirestore:()=>E,subscribeToCompletedGames:()=>A,updateActiveGame:()=>S,updateGameStatus:()=>I,updateSessionActiveGameId:()=>L,updateSessionParticipantPlayerIds:()=>F});var n=r(2009),i=r(5519),o=r(3649),a=r(4415),s=r(415),u=r(2604),c=r(4536),l=r(4277),h=r(7746);function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(){f=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(t,r,n,o){var a,s,u,c,l=Object.create((r&&r.prototype instanceof v?r:v).prototype);return i(l,"_invoke",{value:(a=t,s=n,u=new A(o||[]),c=p,function(t,r){if(c===m)throw Error("Generator is already running");if(c===g){if("throw"===t)throw r;return{value:e,done:!0}}for(u.method=t,u.arg=r;;){var n=u.delegate;if(n){var i=function t(r,n){var i=n.method,o=r.iterator[i];if(o===e)return n.delegate=null,"throw"===i&&r.iterator.return&&(n.method="return",n.arg=e,t(r,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+i+"' method")),y;var a=h(o,r.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,y;var s=a.arg;return s?s.done?(n[r.resultName]=s.value,n.next=r.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):s:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,y)}(n,u);if(i){if(i===y)continue;return i}}if("next"===u.method)u.sent=u._sent=u.arg;else if("throw"===u.method){if(c===p)throw c=g,u.arg;u.dispatchException(u.arg)}else"return"===u.method&&u.abrupt("return",u.arg);c=m;var o=h(a,s,u);if("normal"===o.type){if(c=u.done?g:"suspendedYield",o.arg===y)continue;return{value:o.arg,done:u.done}}"throw"===o.type&&(c=g,u.method="throw",u.arg=o.arg)}})}),l}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var p="suspendedStart",m="executing",g="completed",y={};function v(){}function b(){}function w(){}var S={};c(S,a,function(){return this});var x=Object.getPrototypeOf,I=x&&x(x(O([])));I&&I!==r&&n.call(I,a)&&(S=I);var E=w.prototype=v.prototype=Object.create(S);function T(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function k(e,t){var r;i(this,"_invoke",{value:function(i,o){function a(){return new t(function(r,a){!function r(i,o,a,s){var u=h(e[i],e,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==d(l)&&n.call(l,"__await")?t.resolve(l.__await).then(function(e){r("next",e,a,s)},function(e){r("throw",e,a,s)}):t.resolve(l).then(function(e){c.value=e,a(c)},function(e){return r("throw",e,a,s)})}s(u.arg)}(i,o,r,a)})}return r=r?r.then(a,a):a()}})}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function O(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw TypeError(d(t)+" is not iterable")}return b.prototype=w,i(E,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:b,configurable:!0}),b.displayName=c(w,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,c(e,u,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},T(k.prototype),c(k.prototype,s,function(){return this}),t.AsyncIterator=k,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new k(l(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},T(E),c(E,u,"Generator"),c(E,a,function(){return this}),c(E,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach(function(t){var n,i,o;n=e,i=t,o=r[t],(i=function(e){var t=function(e,t){if("object"!==d(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==d(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===d(t)?t:String(t)}(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function g(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(n,i)}function y(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){g(o,n,i,a,s,"next",e)}function s(e){g(o,n,i,a,s,"throw",e)}a(void 0)})}}var v=(0,n.getFirestore)(i.xv),b=0,w=function(){var e=y(f().mark(function e(t){var r,i,s,u,c,l;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,n.collection)(v,"activeGames"),s=(i=(0,n.doc)(r)).id,u=a.useTimerStore.getState().jassStartTime,c=m(m({},t),{},{activeGameId:s,status:"live",createdAt:(0,n.serverTimestamp)(),lastUpdated:(0,n.serverTimestamp)(),jassStartTime:u?n.Timestamp.fromMillis(u):(0,n.serverTimestamp)(),gameStartTime:u?n.Timestamp.fromMillis(u):(0,n.serverTimestamp)()}),e.prev=1,e.next=2,(0,n.setDoc)(i,c);case 2:return e.abrupt("return",s);case 3:throw e.prev=3,console.error("[GameService] Error creating active game: ",l=e.catch(1)),o.useUIStore.getState().showNotification({type:"error",message:"Fehler beim Erstellen des Online-Spiels."}),l;case 4:case"end":return e.stop()}},e,null,[[1,3]])}));return function(t){return e.apply(this,arguments)}}(),S=function(){var e=y(f().mark(function e(t,r){var i,a,s;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}return console.warn("[GameService] updateActiveGame called without activeGameId."),e.abrupt("return");case 1:return i=(0,n.doc)(v,"activeGames",t),a=m(m({},r),{},{lastUpdated:(0,n.serverTimestamp)()}),e.prev=2,e.next=3,(0,n.updateDoc)(i,a);case 3:e.next=5;break;case 4:e.prev=4,s=e.catch(2),console.error("[GameService] Error updating active game ".concat(t,": "),s),o.useUIStore.getState().showNotification({type:"error",message:"Fehler beim Synchronisieren des Spielstands."});case 5:case"end":return e.stop()}},e,null,[[2,4]])}));return function(t,r){return e.apply(this,arguments)}}(),x=function(){var e=y(f().mark(function e(t,r){var i,o,a,s;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!t||!r)){e.next=1;break}return e.abrupt("return",null);case 1:return i=(0,n.collection)(v,"activeGames"),o=(0,n.query)(i,(0,n.where)("groupId","==",r),(0,n.where)("status","==","live"),(0,n.where)("participantUids","array-contains",t),(0,n.orderBy)("lastUpdated","desc"),(0,n.limit)(1)),e.prev=2,e.next=3,(0,n.getDocs)(o);case 3:if((a=e.sent).empty){e.next=4;break}return s=a.docs[0],e.abrupt("return",s.id);case 4:return e.abrupt("return",null);case 5:e.next=7;break;case 6:return e.prev=6,console.error("[GameService] Error finding active game: ",e.catch(2)),e.abrupt("return",null);case 7:case"end":return e.stop()}},e,null,[[2,6]])}));return function(t,r){return e.apply(this,arguments)}}(),I=function(){var e=y(f().mark(function e(t,r){return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}return console.warn("[GameService] updateGameStatus called without activeGameId."),e.abrupt("return");case 1:if("completed"===r||"aborted"===r){e.next=2;break}return console.warn("[GameService] updateGameStatus called with invalid status: ".concat(r)),e.abrupt("return");case 2:return e.prev=2,e.next=3,S(t,{status:r});case 3:e.next=5;break;case 4:e.prev=4,e.catch(2),console.error("[GameService] Failed to update status for game ".concat(t," via updateActiveGame."));case 5:case"end":return e.stop()}},e,null,[[2,4]])}));return function(t,r){return e.apply(this,arguments)}}(),E=function(){var e=y(f().mark(function e(t,r){var i,a,c,h,d,p,g,w,x,I,E,T,k,_,P,A=arguments;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=A.length>2&&void 0!==A[2]&&A[2],t){e.next=1;break}return console.warn("[GameService] saveRoundToFirestore called without activeGameId."),e.abrupt("return");case 1:if(!((a=Date.now())-b<1e3)){e.next=2;break}return e.abrupt("return");case 2:return b=a,c=(0,n.collection)(v,"activeGames",t,"rounds"),e.prev=3,r.startTime||(r.startTime=r.timestamp),r.endTime=a,h=m({},{id:r.id,roundId:r.roundId,timestamp:n.Timestamp.fromMillis(r.timestamp),actionType:r.actionType,startingPlayer:r.startingPlayer,startingPlayerName:r.startingPlayerName,currentPlayer:r.currentPlayer,isRoundFinalized:r.isRoundFinalized,weisPoints:r.weisPoints,jassPoints:r.jassPoints,scores:r.scores,striche:r.striche,weisActions:r.weisActions||[],roundState:r.roundState,isActive:!0,savedAt:(0,n.serverTimestamp)()}),"jass"===r.actionType&&(g=(p=r).farbe?null==(d=s.S[p.farbe])?void 0:d[p.cardStyle]:void 0,h=m(m({},h),{},{cardStyle:p.cardStyle}),void 0!==g&&(h.farbe=g),void 0!==p.strichInfo&&(h.strichInfo=p.strichInfo)),w=(0,u.g)(h),x=(0,n.doc)(c),e.prev=4,e.next=5,(0,n.runTransaction)(v,function(){var e=y(f().mark(function e(t){return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.set(x,w);case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 5:e.next=7;break;case 6:return e.prev=6,k=e.catch(4),console.error("[GameService] Transaktionsfehler bei Rundspeicherung (roundId: ".concat(r.roundId,"):"),k),o.useUIStore.getState().showNotification({type:"error",message:"Fehler bei der Datenspeicherung. Bitte \xfcberpr\xfcfe deine Internetverbindung und versuche es erneut!"}),e.abrupt("return");case 7:return I={top:r.scores.top,bottom:r.scores.bottom},e.next=8,S(t,{scores:I});case 8:return E=l.useGameStore.getState(),T=(0,u.g)({scores:I,striche:r.striche,weisPoints:r.weisPoints,currentPlayer:r.roundState.nextPlayer,startingPlayer:r.roundState.nextPlayer,currentRound:r.roundState.roundNumber,lastUpdated:(0,n.serverTimestamp)(),currentRoundWeis:[],currentJassPoints:r.jassPoints,isRoundCompleted:r.isRoundFinalized,gamePlayers:E.gamePlayers}),e.prev=9,e.next=10,(0,n.updateDoc)((0,n.doc)(v,"activeGames",t),T);case 10:e.next=12;break;case 11:e.prev=11,_=e.catch(9),console.error("[GameService] Error updating main game document ".concat(t,":"),_),o.useUIStore.getState().showNotification({type:"warning",message:"Die Runde wurde gespeichert, aber es gab ein Problem bei der Aktualisierung der Spiel\xfcbersicht."});case 12:if(!i){e.next=13;break}return e.next=13,S(t,{lastUpdated:(0,n.serverTimestamp)()});case 13:e.next=15;break;case 14:e.prev=14,P=e.catch(3),console.error("[GameService] Error saving round to Firestore for game ".concat(t,":"),P),o.useUIStore.getState().showNotification({type:"error",message:"Fehler beim Speichern der Runde. Bitte \xfcberpr\xfcfe deine Internetverbindung!"});case 15:case"end":return e.stop()}},e,null,[[3,14],[4,6],[9,11]])}));return function(t,r){return e.apply(this,arguments)}}(),T=function(){var e=y(f().mark(function e(t){var r,i,a,s,u;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}return console.warn("[GameService] loadRoundsFromFirestore called without activeGameId."),e.abrupt("return",[]);case 1:return e.prev=1,r=(0,n.collection)(v,"activeGames",t,"rounds"),i=(0,n.query)(r,(0,n.where)("isActive","==",!0)),e.next=2,(0,n.getDocs)(i);case 2:if(!(a=e.sent).empty){e.next=3;break}return console.log("[GameService] No rounds found for game ".concat(t)),e.abrupt("return",[]);case 3:return s=[],a.forEach(function(e){var t,r=e.data(),n=(null==(t=r.timestamp)?void 0:t.toMillis())||Date.now(),i={id:r.id,roundId:r.roundId,timestamp:n,actionType:r.actionType,startingPlayer:r.startingPlayer,startingPlayerName:r.startingPlayerName,currentPlayer:r.currentPlayer,isRoundFinalized:r.isRoundFinalized,weisPoints:r.weisPoints,jassPoints:r.jassPoints,scores:r.scores,striche:r.striche,weisActions:r.weisActions||[],roundState:r.roundState,isCompleted:r.isRoundFinalized,isActive:r.isActive};if("jass"===r.actionType){var o=m(m({},i),{},{actionType:"jass",farbe:r.farbe,cardStyle:r.cardStyle,strichInfo:r.strichInfo,isRoundFinalized:!0,isCompleted:!0});s.push(o)}else s.push(i)}),s.sort(function(e,t){return(e.roundId||0)-(t.roundId||0)}),console.log("[GameService] Successfully loaded ".concat(s.length," active rounds for game ").concat(t)),e.abrupt("return",s);case 4:return e.prev=4,u=e.catch(1),console.error("[GameService] Error loading rounds for game ".concat(t,":"),u),o.useUIStore.getState().showNotification({type:"error",message:"Fehler beim Laden der Spielrunden."}),e.abrupt("return",[]);case 5:case"end":return e.stop()}},e,null,[[1,4]])}));return function(t){return e.apply(this,arguments)}}(),k=function(){var e=y(f().mark(function e(t,r,i){var a,s,l,h,d,p,g,y,b,w,S=arguments;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=!(S.length>3)||void 0===S[3]||S[3],!(!t||"number"!=typeof r||r<=0)){e.next=1;break}return console.error("[saveCompletedGameToFirestore] Ung\xfcltige sessionId oder gameNumber.",{sessionId:t,gameNumber:r}),e.abrupt("return",!1);case 1:if(i){e.next=2;break}return console.error("[saveCompletedGameToFirestore] Keine summaryData \xfcbergeben."),e.abrupt("return",!1);case 2:if(s=c.useJassStore.getState().jassSessionId||t){e.next=3;break}return console.error("[saveCompletedGameToFirestore] Keine g\xfcltige Session-ID gefunden."),e.abrupt("return",!1);case 3:return l=String(r),h=(0,n.doc)(v,"jassGameSummaries/".concat(s,"/completedGames/").concat(l)),e.prev=4,e.next=5,(0,n.getDoc)(h);case 5:if(!(d=e.sent).exists()){e.next=8;break}if(!((!(p=d.data()).roundHistory||0===p.roundHistory.length)&&i.roundHistory&&i.roundHistory.length>0)){e.next=7;break}return console.log("[saveCompletedGameToFirestore] Dokument ".concat(l," existiert bereits, aber ohne Rundenhistorie. Aktualisiere mit neuer Rundenhistorie.")),e.next=6,(0,n.updateDoc)(h,{roundHistory:i.roundHistory,trumpColorsPlayed:i.trumpColorsPlayed||[]});case 6:return a&&o.useUIStore.getState().showNotification({type:"success",message:"Spielhistorie erfolgreich aktualisiert.",duration:3e3}),e.abrupt("return",!0);case 7:return console.log("[saveCompletedGameToFirestore] Dokument ".concat(l," existiert bereits mit Rundenhistorie. \xdcberspringe Speichern.")),e.abrupt("return",!0);case 8:return g=[],i.roundHistory&&Array.isArray(i.roundHistory)?(g=i.roundHistory.map(function(e,t){var r=m({},e);return r.roundState?r.roundState=m(m({},r.roundState),{},{roundNumber:t+1}):r.roundState={roundNumber:t+1,nextPlayer:e.currentPlayer||1},r}),console.log("[saveCompletedGameToFirestore] Rundenhistorie f\xfcr Spiel ".concat(r," neu nummeriert. L\xe4nge: ").concat(g.length))):console.warn("[saveCompletedGameToFirestore] Keine g\xfcltige Rundenhistorie zum Neunummerieren in Spiel ".concat(r," gefunden.")),y=m(m({},i),{},{roundHistory:g}),b=(0,u.g)(y),console.log("[saveCompletedGameToFirestore] Speichere neues Spiel ".concat(r," f\xfcr Session ").concat(s," mit ").concat(g.length," Runden.")),e.next=9,(0,n.setDoc)(h,b);case 9:return a&&o.useUIStore.getState().showNotification({type:"success",message:"Jass-Partie wurde erfolgreich gespeichert & alle Statistiken aktualisiert.",duration:3e3}),e.abrupt("return",!0);case 10:return e.prev=10,w=e.catch(4),console.error("[saveCompletedGameToFirestore] Fehler beim Speichern von Spiel ".concat(r," f\xfcr Session ").concat(s,":"),w),o.useUIStore.getState().showNotification({type:"error",message:"Fehler: Zusammenfassung f\xfcr Spiel ".concat(r," konnte nicht gespeichert werden."),duration:5e3}),e.abrupt("return",!1);case 11:case"end":return e.stop()}},e,null,[[4,10]])}));return function(t,r,n){return e.apply(this,arguments)}}(),_=function(){var e=y(f().mark(function e(t){var r,a,s,u,c,l;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}return console.warn("[GameService] fetchCompletedGamesFromFirestore called without sessionId."),e.abrupt("return",[]);case 1:return r=(0,n.getFirestore)(i.xv),e.prev=2,a=(0,n.collection)(r,"jassGameSummaries",t,"completedGames"),s=(0,n.query)(a,(0,n.orderBy)("gameNumber","asc")),e.next=3,(0,n.getDocs)(s);case 3:if(!(u=e.sent).empty){e.next=4;break}return e.abrupt("return",[]);case 4:return c=[],u.forEach(function(e){c.push(e.data())}),e.abrupt("return",c);case 5:return e.prev=5,l=e.catch(2),console.error("[GameService] Error fetching completed games for session ".concat(t,":"),l),o.useUIStore.getState().showNotification({type:"error",message:"Fehler beim Laden der abgeschlossenen Spiele."}),e.abrupt("return",[]);case 6:case"end":return e.stop()}},e,null,[[2,5]])}));return function(t){return e.apply(this,arguments)}}(),P=function(e,t){if(!e)return console.error("[GameService] loadCompletedGamesFromFirestore aufgerufen ohne sessionId."),function(){};var r=(0,n.getFirestore)(i.xv),o=(0,n.collection)(r,"jassGameSummaries",e,"completedGames"),a=(0,n.query)(o,(0,n.orderBy)("gameNumber","asc"));return(0,n.onSnapshot)(a,function(e){var r=[];e.forEach(function(e){r.push(m({},e.data()))}),t(r)},function(r){console.error("[GameService] Fehler beim Laden der abgeschlossenen Spiele f\xfcr Session ".concat(e,":"),r),t([])})},A=function(e,t){if(!e)return console.warn("[GameService] subscribeToCompletedGames called without sessionId."),function(){};try{var r=(0,n.collection)(v,"jassGameSummaries",e,"completedGames"),i=(0,n.query)(r,(0,n.orderBy)("gameNumber","asc"));return(0,n.onSnapshot)(i,function(r){var n=[];r.forEach(function(e){var t=e.data();n.push(t)}),console.log("[GameService] Snapshot update: ".concat(n.length," completed games for session ").concat(e)),t(n)},function(t){console.error("[GameService] Error in completed games snapshot listener for session ".concat(e,":"),t),o.useUIStore.getState().showNotification({type:"error",message:"Fehler bei der Echtzeitaktualisierung der abgeschlossenen Spiele."})})}catch(t){return console.error("[GameService] Error setting up completed games listener for session ".concat(e,":"),t),o.useUIStore.getState().showNotification({type:"error",message:"Fehler beim Einrichten des Listeners f\xfcr abgeschlossene Spiele."}),function(){}}},O=function(){var e=y(f().mark(function e(t,r){var i,o,a,s,u;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!t||!r.length)){e.next=1;break}return console.log("[GameService] markRoundsAsInactive: Keine activeGameId oder keine zu deaktivierenden Runden."),e.abrupt("return");case 1:return console.log("[GameService] Deaktiviere ".concat(r.length," Runden f\xfcr Spiel ").concat(t,": ").concat(r.join(", "))),e.prev=2,i=(0,n.collection)(v,"activeGames",t,"rounds"),o=(0,n.query)(i,(0,n.where)("isActive","==",!0),(0,n.where)("roundId","in",r)),e.next=3,(0,n.getDocs)(o);case 3:if(!(a=e.sent).empty){e.next=4;break}return console.log("[GameService] Keine zu deaktivierenden Runden gefunden f\xfcr IDs: ".concat(r.join(", "))),e.abrupt("return");case 4:return s=(0,n.writeBatch)(v),a.forEach(function(e){s.update(e.ref,{isActive:!1,deactivatedAt:(0,n.serverTimestamp)(),deactivationReason:"history_navigation_overwrite"}),console.log("[GameService] Markiere Runde ".concat(e.id," (roundId: ").concat(e.data().roundId,") als inaktiv"))}),e.next=5,s.commit();case 5:console.log("[GameService] ".concat(a.size," Runden erfolgreich als inaktiv markiert")),e.next=7;break;case 6:throw e.prev=6,console.error("[GameService] Fehler beim Deaktivieren der Runden:",u=e.catch(2)),u;case 7:case"end":return e.stop()}},e,null,[[2,6]])}));return function(t,r){return e.apply(this,arguments)}}(),C=function(){var e=y(f().mark(function e(t,r){var i,o,a,s,u;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!t||!r.length)){e.next=1;break}return console.log("[GameService] markRoundsAsActive: Keine activeGameId oder keine zu aktivierenden Runden."),e.abrupt("return");case 1:return console.log("[GameService] Aktiviere ".concat(r.length," Runden f\xfcr Spiel ").concat(t,": ").concat(r.join(", "))),e.prev=2,i=(0,n.collection)(v,"activeGames",t,"rounds"),o=(0,n.query)(i,(0,n.where)("roundId","in",r)),e.next=3,(0,n.getDocs)(o);case 3:if(!(a=e.sent).empty){e.next=4;break}return console.log("[GameService] Keine zu aktivierenden Runden gefunden f\xfcr IDs: ".concat(r.join(", "))),e.abrupt("return");case 4:return s=(0,n.writeBatch)(v),a.forEach(function(e){s.update(e.ref,{isActive:!0,reactivatedAt:(0,n.serverTimestamp)(),deactivationReason:null}),console.log("[GameService] Markiere Runde ".concat(e.id," (roundId: ").concat(e.data().roundId,") als aktiv"))}),e.next=5,s.commit();case 5:console.log("[GameService] ".concat(a.size," Runden erfolgreich als aktiv markiert")),e.next=7;break;case 6:throw e.prev=6,console.error("[GameService] Fehler beim Aktivieren der Runden:",u=e.catch(2)),u;case 7:case"end":return e.stop()}},e,null,[[2,6]])}));return function(t,r){return e.apply(this,arguments)}}(),D=function(){var e=y(f().mark(function e(t,r){var i,o,a,s,u;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}return console.log("[GameService] markAllFollowingRoundsAsInactive: Keine activeGameId."),e.abrupt("return");case 1:return console.log("[GameService] Deaktiviere alle aktiven Runden mit ID > ".concat(r," f\xfcr Spiel ").concat(t)),e.prev=2,i=(0,n.collection)(v,"activeGames",t,"rounds"),o=(0,n.query)(i,(0,n.where)("isActive","==",!0),(0,n.where)("roundId",">",r)),e.next=3,(0,n.getDocs)(o);case 3:if(!(a=e.sent).empty){e.next=4;break}return console.log("[GameService] Keine aktiven zu deaktivierenden Runden mit h\xf6herer ID als ".concat(r," gefunden.")),e.abrupt("return");case 4:return s=(0,n.writeBatch)(v),a.forEach(function(e){s.update(e.ref,{isActive:!1,deactivatedAt:(0,n.serverTimestamp)(),deactivationReason:"history_overwrite"}),console.log("[GameService] Markiere Runde ".concat(e.id," (roundId: ").concat(e.data().roundId,") als inaktiv durch History-\xdcberschreibung"))}),e.next=5,s.commit();case 5:console.log("[GameService] ".concat(a.size," Runden mit h\xf6herer ID erfolgreich als inaktiv markiert")),e.next=7;break;case 6:throw e.prev=6,console.error("[GameService] Fehler beim Deaktivieren der Runden mit h\xf6herer ID:",u=e.catch(2)),u;case 7:case"end":return e.stop()}},e,null,[[2,6]])}));return function(t,r){return e.apply(this,arguments)}}(),N=function(){var e=y(f().mark(function e(t){var r,a,s,u,c,l;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}return console.warn("[Cleanup] cleanupDuplicateCompletedGames ohne sessionId aufgerufen."),e.abrupt("return");case 1:return console.log("[Cleanup] Starte Bereinigung f\xfcr Session ".concat(t,"...")),r=(0,n.getFirestore)(i.xv),e.prev=2,a=(0,n.collection)(r,"jassGameSummaries/".concat(t,"/completedGames")),e.next=3,(0,n.getDocs)(a);case 3:if(!(s=e.sent).empty){e.next=4;break}return console.log("[Cleanup] Keine abgeschlossenen Spiele in Session ".concat(t," gefunden.")),e.abrupt("return");case 4:if(u=(0,n.writeBatch)(r),c=0,s.forEach(function(e){var r=e.id;r.startsWith("game_")&&!isNaN(parseInt(r.substring(5)))&&(console.log("[Cleanup] Markiere fehlerhaftes Dokument zur L\xf6schung: ".concat(t,"/completedGames/").concat(r)),u.delete(e.ref),c++)}),!(c>0)){e.next=6;break}return e.next=5,u.commit();case 5:e.next=6;break;case 6:e.next=8;break;case 7:e.prev=7,l=e.catch(2),console.error("[Cleanup] Fehler beim Bereinigen der Session ".concat(t,":"),l),o.useUIStore.getState().showNotification({type:"error",message:"Fehler bei der Bereinigung alter Spieldaten.",duration:5e3});case 8:case"end":return e.stop()}},e,null,[[2,7]])}));return function(t){return e.apply(this,arguments)}}(),R=function(){var e=y(f().mark(function e(t){var r,i,s,c,l,h,d,p,g,y,b,w;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return h=(0,n.collection)(v,"activeGames"),p=(d=(0,n.doc)(h)).id,g=a.useTimerStore.getState().jassStartTime,y=m(m({},t),{},{activeGameId:p,status:"live",createdAt:(0,n.serverTimestamp)(),lastUpdated:(0,n.serverTimestamp)(),jassStartTime:g?n.Timestamp.fromMillis(g):(0,n.serverTimestamp)(),gameStartTime:g?n.Timestamp.fromMillis(g):(0,n.serverTimestamp)(),scores:null!=(r=t.scores)?r:{top:0,bottom:0},striche:null!=(i=t.striche)?i:{top:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0},bottom:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0}},weisPoints:null!=(s=t.weisPoints)?s:{top:0,bottom:0},currentRound:null!=(c=t.currentRound)?c:1,currentRoundWeis:null!=(l=t.currentRoundWeis)?l:[]}),e.prev=1,b=(0,u.g)(y),e.next=2,(0,n.setDoc)(d,b);case 2:return console.log("[GameService] Successfully created NEW active game document with ID: ".concat(p," using setDoc.")),e.abrupt("return",p);case 3:throw e.prev=3,console.error("[GameService] Error creating NEW active game document using setDoc: ",w=e.catch(1)),o.useUIStore.getState().showNotification({type:"error",message:"Fehler beim Erstellen des neuen Online-Spiels."}),w;case 4:case"end":return e.stop()}},e,null,[[1,3]])}));return function(t){return e.apply(this,arguments)}}(),L=function(){var e=y(f().mark(function e(t,r){var i,o,a;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}return console.warn("[GameService] updateSessionActiveGameId called without sessionId."),e.abrupt("return");case 1:return i=(0,n.doc)(v,"sessions",t),e.prev=2,o=(0,u.g)({currentActiveGameId:r,lastUpdated:(0,n.serverTimestamp)()}),e.next=3,(0,n.updateDoc)(i,o);case 3:console.log("[GameService] Session ".concat(t," updated with activeGameId: ").concat(r)),e.next=5;break;case 4:throw e.prev=4,a=e.catch(2),console.error("[GameService] Error updating session ".concat(t," with activeGameId ").concat(r,": "),a),a;case 5:case"end":return e.stop()}},e,null,[[2,4]])}));return function(t,r){return e.apply(this,arguments)}}(),j=function(){var e=y(f().mark(function e(t,r){var i,o,a;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}return console.warn("[GameService] createSessionDocument called without sessionId."),e.abrupt("return");case 1:return i=(0,n.doc)(v,"sessions",t),e.prev=2,o=(0,u.g)(m(m({},r),{},{participantPlayerIds:r.participantPlayerIds||[],startedAt:(0,n.serverTimestamp)(),lastUpdated:(0,n.serverTimestamp)(),currentActiveGameId:null,notes:""})),e.next=3,(0,n.setDoc)(i,o);case 3:console.log("[GameService] Session document ".concat(t," created successfully.")),e.next=5;break;case 4:throw e.prev=4,a=e.catch(2),console.error("[GameService] Error creating session document ".concat(t,":"),a),a;case 5:case"end":return e.stop()}},e,null,[[2,4]])}));return function(t,r){return e.apply(this,arguments)}}(),F=function(){var e=y(f().mark(function e(t,r){var i,o;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}return console.warn("[GameService] updateSessionParticipantPlayerIds called without sessionId."),e.abrupt("return");case 1:return i=(0,n.doc)(v,"sessions",t),e.prev=2,e.next=3,(0,n.updateDoc)(i,{participantPlayerIds:r,lastUpdated:(0,n.serverTimestamp)()});case 3:console.log("[GameService] Session ".concat(t," updated with ").concat(r.length," participantPlayerIds.")),e.next=5;break;case 4:throw e.prev=4,o=e.catch(2),console.error("[GameService] Error updating participantPlayerIds for session ".concat(t,":"),o),o;case 5:case"end":return e.stop()}},e,null,[[2,4]])}));return function(t,r){return e.apply(this,arguments)}}(),G=function(){var e=y(f().mark(function e(t,r){var i,a,s,u,c,l,h,d,p,m,g,b;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}return console.warn("[GameService] abortActiveGame called without activeGameId."),e.abrupt("return");case 1:return console.log("[GameService] Starting abort process for game ".concat(t)),e.prev=2,i=(0,n.doc)(v,"activeGames",t),e.next=3,(0,n.getDoc)(i);case 3:if((a=e.sent).exists()){e.next=4;break}return console.log("[GameService] Game ".concat(t," does not exist, cleanup not needed.")),e.abrupt("return");case 4:return u=(s=a.data()).sessionId,c=s.tournamentInstanceId||(null==r?void 0:r.tournamentInstanceId),console.log("[GameService] Game ".concat(t," found with sessionId: ").concat(u,", tournamentInstanceId: ").concat(c||"none")),e.next=5,(0,n.updateDoc)(i,{status:"aborted",lastUpdated:(0,n.serverTimestamp)()});case 5:if(console.log("[GameService] Game ".concat(t," status set to 'aborted'")),!(!(null!=r&&r.skipSessionCleanup)&&u)){e.next=17;break}if(e.prev=6,!c){e.next=8;break}return l=(0,n.doc)(v,"sessions",c),e.next=7,(0,n.updateDoc)(l,{currentActiveGameId:null,lastUpdated:(0,n.serverTimestamp)()});case 7:console.log("[GameService] Tournament session ".concat(c," cleared of activeGameId")),e.next=15;break;case 8:return h=(0,n.doc)(v,"sessions",u),e.next=9,(0,n.getDoc)(h);case 9:if(!e.sent.exists()){e.next=11;break}return e.next=10,(0,n.updateDoc)(h,{currentActiveGameId:null,lastUpdated:(0,n.serverTimestamp)()});case 10:console.log("[GameService] Regular session ".concat(u," in sessions collection cleared of activeGameId")),e.next=15;break;case 11:return d=(0,n.doc)(v,"jassGameSummaries",u),e.next=12,(0,n.getDoc)(d);case 12:if(!e.sent.exists()){e.next=14;break}return e.next=13,(0,n.updateDoc)(d,{currentActiveGameId:null,lastUpdated:(0,n.serverTimestamp)()});case 13:console.log("[GameService] Regular session ".concat(u," in jassGameSummaries collection cleared of activeGameId")),e.next=15;break;case 14:console.log("[GameService] Session ".concat(u," does not exist in either collection, no cleanup needed"));case 15:e.next=17;break;case 16:e.prev=16,console.error("[GameService] Error clearing session reference:",e.catch(6));case 17:if(!c){e.next=23;break}return e.prev=18,p=(0,n.doc)(v,"tournaments",c),e.next=19,(0,n.getDoc)(p);case 19:if(!(m=e.sent).exists()||m.data().currentActiveGameId!==t){e.next=21;break}return e.next=20,(0,n.updateDoc)(p,{currentActiveGameId:null,updatedAt:(0,n.serverTimestamp)(),lastActivity:(0,n.serverTimestamp)()});case 20:console.log("[GameService] Tournament ".concat(c," cleared of activeGameId"));case 21:e.next=23;break;case 22:e.prev=22,console.error("[GameService] Error clearing tournament reference:",e.catch(18));case 23:if(!(u&&!c)){e.next=27;break}return console.log("[GameService] Calling cleanupAbortedSession for session ".concat(u," BEFORE deleting game document")),e.prev=24,e.next=25,M(u);case 25:console.log("[GameService] Session ".concat(u," cleanup completed successfully")),e.next=27;break;case 26:e.prev=26,g=e.catch(24),console.error("[GameService] Error during session cleanup for ".concat(u,":"),g),console.log("[GameService] Continuing with game document deletion despite session cleanup error");case 27:setTimeout(y(f().mark(function e(){var r;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("[GameService] Attempting to delete game document ".concat(t," after 2 second delay...")),e.next=1,(0,n.getDoc)(i);case 1:if(e.sent.exists()){e.next=2;break}return console.log("[GameService] Game document ".concat(t," was already deleted (likely by Cloud Function cleanup). No action needed.")),e.abrupt("return");case 2:return e.next=3,(0,n.deleteDoc)(i);case 3:console.log("[GameService] Game document ".concat(t," deleted successfully")),e.next=6;break;case 4:if(e.prev=4,r=e.catch(0),console.error("[GameService] CRITICAL ERROR: Failed to delete game document ".concat(t,":"),r),!(r instanceof Error&&(r.message.includes("Missing or insufficient permissions")||r.message.includes("No document to update")))){e.next=5;break}return console.log("[GameService] Document ".concat(t," was likely already cleaned up. This is expected.")),e.abrupt("return");case 5:o.useUIStore.getState().showNotification({type:"warning",message:"Spiel wurde erfolgreich abgebrochen, aber Bereinigung ist unvollst\xe4ndig.",duration:5e3});case 6:case"end":return e.stop()}},e,null,[[0,4]])})),2e3),console.log("[GameService] Abort process completed for game ".concat(t)),e.next=29;break;case 28:throw e.prev=28,b=e.catch(2),console.error("[GameService] Error aborting game ".concat(t,":"),b),Error("Fehler beim Abbrechen des Spiels: ".concat(b instanceof Error?b.message:"Unbekannter Fehler"));case 29:case"end":return e.stop()}},e,null,[[2,28],[6,16],[18,22],[24,26]])}));return function(t,r){return e.apply(this,arguments)}}(),M=function(){var e=y(f().mark(function e(t){var r,n,a,s,u;return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}return console.warn("[GameService] cleanupAbortedSession ohne sessionId aufgerufen."),e.abrupt("return");case 1:return console.log("[GameService] Starte Bereinigung f\xfcr Session ".concat(t,"...")),e.prev=2,r=(0,h.Uz)(i.xv,"europe-west1"),n=(0,h.Qg)(r,"cleanupAbortedSession"),e.next=3,n({sessionId:t});case 3:if(!(a=e.sent.data).success){e.next=4;break}console.log("[GameService] Session ".concat(t," erfolgreich bereinigt: ").concat(a.deletedGamesCount," Spiele gel\xf6scht.")),o.useUIStore.getState().showNotification({type:"success",message:a.message}),e.next=5;break;case 4:throw Error("Cloud Function gab Fehler zur\xfcck");case 5:e.next=7;break;case 6:throw e.prev=6,u=e.catch(2),console.error("[GameService] Fehler beim Bereinigen der Session ".concat(t,":"),u),s="Fehler beim L\xf6schen der Session.",u instanceof Error&&(s=u.message.includes("permission-denied")?"Keine Berechtigung zum L\xf6schen dieser Session.":u.message.includes("not-found")?"Session nicht gefunden.":"Fehler beim L\xf6schen: ".concat(u.message)),o.useUIStore.getState().showNotification({type:"error",message:s,duration:5e3}),u;case 7:case"end":return e.stop()}},e,null,[[2,6]])}));return function(t){return e.apply(this,arguments)}}()},3649:(e,t,r)=>{"use strict";r.r(t),r.d(t,{OnboardingStep:()=>g,defaultStrichStyle:()=>w,useUIStore:()=>E});var n=r(8106),i=r(4319),o=r(8310),a=r(7044),s=r(132),u=r(8112);function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach(function(t){d(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function d(e,t,r){var n;return(n=function(e,t){if("object"!==c(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==c(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"),(t="symbol"===c(n)?n:String(n))in e)?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(){f=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function h(t,r,n,o){var a,s,u,c,l=Object.create((r&&r.prototype instanceof v?r:v).prototype);return i(l,"_invoke",{value:(a=t,s=n,u=new A(o||[]),c=p,function(t,r){if(c===m)throw Error("Generator is already running");if(c===g){if("throw"===t)throw r;return{value:e,done:!0}}for(u.method=t,u.arg=r;;){var n=u.delegate;if(n){var i=function t(r,n){var i=n.method,o=r.iterator[i];if(o===e)return n.delegate=null,"throw"===i&&r.iterator.return&&(n.method="return",n.arg=e,t(r,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+i+"' method")),y;var a=d(o,r.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,y;var s=a.arg;return s?s.done?(n[r.resultName]=s.value,n.next=r.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):s:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,y)}(n,u);if(i){if(i===y)continue;return i}}if("next"===u.method)u.sent=u._sent=u.arg;else if("throw"===u.method){if(c===p)throw c=g,u.arg;u.dispatchException(u.arg)}else"return"===u.method&&u.abrupt("return",u.arg);c=m;var o=d(a,s,u);if("normal"===o.type){if(c=u.done?g:"suspendedYield",o.arg===y)continue;return{value:o.arg,done:u.done}}"throw"===o.type&&(c=g,u.method="throw",u.arg=o.arg)}})}),l}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var p="suspendedStart",m="executing",g="completed",y={};function v(){}function b(){}function w(){}var S={};l(S,a,function(){return this});var x=Object.getPrototypeOf,I=x&&x(x(O([])));I&&I!==r&&n.call(I,a)&&(S=I);var E=w.prototype=v.prototype=Object.create(S);function T(e){["next","throw","return"].forEach(function(t){l(e,t,function(e){return this._invoke(t,e)})})}function k(e,t){var r;i(this,"_invoke",{value:function(i,o){function a(){return new t(function(r,a){!function r(i,o,a,s){var u=d(e[i],e,o);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==c(h)&&n.call(h,"__await")?t.resolve(h.__await).then(function(e){r("next",e,a,s)},function(e){r("throw",e,a,s)}):t.resolve(h).then(function(e){l.value=e,a(l)},function(e){return r("throw",e,a,s)})}s(u.arg)}(i,o,r,a)})}return r=r?r.then(a,a):a()}})}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function O(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw TypeError(c(t)+" is not iterable")}return b.prototype=w,i(E,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:b,configurable:!0}),b.displayName=l(w,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,l(e,u,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},T(k.prototype),l(k.prototype,s,function(){return this}),t.AsyncIterator=k,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new k(h(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},T(E),l(E,u,"Generator"),l(E,a,function(){return this}),l(E,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function p(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(n,i)}function m(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){p(o,n,i,a,s,"next",e)}function s(e){p(o,n,i,a,s,"throw",e)}a(void 0)})}}var g=function(e){return e.INSTALL="INSTALL",e.WELCOME="WELCOME",e.GROUP_CHOICE="GROUP_CHOICE",e.GROUP_CREATE="GROUP_CREATE",e.GROUP_JOIN="GROUP_JOIN",e.GAME_START="GAME_START",e.PROFILE="PROFILE",e.SETTINGS="SETTINGS",e.COMPLETE="COMPLETE",e}({}),y={farbe:"jass-farbe-settings",score:"jass-score-settings",pictogram:"jass-pictogram-settings",strokes:"jass-stroke-settings"},v=function(e,t){try{localStorage.setItem(y[e],JSON.stringify(t))}catch(e){}},b=function(){return{isActive:!1,pressStartTime:null,chargeAmount:0}},w={baseStrich:{length:20,width:1.5,color:"rgba(255, 255, 255, 0.9)",opacity:.9},diagonalStrich:{length:28,width:1.5,angle:45,offset:{x:-1,y:0}},container:{spacing:4,groupSpacing:8,scale:1}},S=s.FT,x={values:Object.fromEntries(o.C3.map(function(e){return[e.id,e.defaultValue]})),isFlipped:!1,enabled:Object.fromEntries(o.C3.map(function(e){return[e.id,!0]}))},I={calculator:{isOpen:!1,value:0,isFlipped:!1},startScreen:{transitionState:"initial",names:{1:"",2:"",3:"",4:""},isOpen:!0},history:{warning:null},chargeEffects:{berg:{top:b(),bottom:b()},bedanken:{top:b(),bottom:b()},matsch:{top:b(),bottom:b()}},menu:{isOpen:!1,activeButton:null,showIntroduction:!1,showResetWarning:!1,props:null},resultatKreidetafel:{isOpen:!1,swipePosition:null,currentStatistic:"striche",animationComplete:!0},settings:{isOpen:!1,activeTab:"farben",cardStyle:"DE",pictogramConfig:{isEnabled:!0,mode:"svg"}},farbeSettings:S,scoreSettings:x,strokeSettings:a.zh,isGameInfoOpen:!1,isHistoryWarningOpen:!1,historyWarningCallback:null,lastDoubleClickPosition:null,historyWarning:{show:!1,message:"",onConfirm:function(){},onCancel:function(){},type:"warning"},isPaused:!1,strichStyle:w,overlayPosition:null,jassFinishNotification:{isOpen:!1,mode:"share",message:void 0,onShare:function(){var e=m(f().mark(function e(){return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),onBack:function(){},onBackLabel:void 0,onContinue:function(){},onRegenerate:function(){var e=m(f().mark(function e(){return f().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},onboarding:{currentStep:g.INSTALL,hasCompletedOnboarding:!0,show:!1,canBeDismissed:!0,isPWA:!1},isTutorialInfoOpen:!1,splitContainer:{isOpen:!1,position:"top"},tutorialBlockedUI:{settingsClose:!1,calculatorClose:!1,gameInfoClose:!1,resultatKreidetafelClose:!1},topSwipeAnimation:!1,bottomSwipeAnimation:!1,notifications:[],isSettingsOpen:!1,isCalculatorOpen:!1,isMenuOpen:!1,activeModal:null,isNotificationCenterOpen:!1,isLoading:!1,startScreenState:"idle",pageCta:{isVisible:!1,text:"",onClick:null,loading:!1,disabled:!1,variant:"default"},isFarbeSettingsModalOpen:!1,resumableGameId:null,signingState:"idle",team1Signed:!1,team2Signed:!1,justAbortedGame:!1,isNavigatingHistory:!1,isReadOnlyMode:!1,headerConfig:null,hasBeenRedirectedToActiveTournament:!1,isGlobalClickDisabled:!1,iosNotification:{dontShowAgain:!1,hasBeenShownThisSession:!1}},E=(0,n.v)()((0,i.Zr)((0,u.D)(function(e,t){return h(h({},I),{},{resetStartScreen:function(){return e(function(e){return h(h({},e),{},{startScreen:{transitionState:"initial",names:{1:"",2:"",3:"",4:""},isOpen:!0}})})},startCharge:function(t,r){return e(function(e){return{chargeEffects:h(h({},e.chargeEffects),{},d({},r,h(h({},e.chargeEffects[r]),{},d({},t,{isActive:!0,pressStartTime:Date.now(),chargeAmount:0}))))}})},updateCharge:function(r,n){var i=t().chargeEffects[n][r];if(i.isActive&&i.pressStartTime){var o=Date.now()-i.pressStartTime;e(function(e){return{chargeEffects:h(h({},e.chargeEffects),{},d({},n,h(h({},e.chargeEffects[n]),{},d({},r,h(h({},i),{},{chargeAmount:Math.min(o/1e3,1)})))))}})}},endCharge:function(t,r){return e(function(e){return{chargeEffects:h(h({},e.chargeEffects),{},d({},r,h(h({},e.chargeEffects[r]),{},d({},t,b()))))}})},resetChargeEffects:function(){return e(function(){return{chargeEffects:{berg:{top:b(),bottom:b()},bedanken:{top:b(),bottom:b()},matsch:{top:b(),bottom:b()}}}})},openCalculator:function(){var r=t();r.tutorialBlockedUI.calculatorClose||(r.isMenuOpen&&e({isMenuOpen:!1}),e({calculator:h(h({},r.calculator),{},{isOpen:!0})}))},closeCalculator:function(){return e(function(e){return{calculator:h(h({},e.calculator),{},{isOpen:!1})}})},setCalculatorFlipped:function(t){return e(function(e){return{calculator:h(h({},e.calculator),{},{isFlipped:t})}})},setStartScreenState:function(t){return e(function(e){return{startScreen:h(h({},e.startScreen),{},{transitionState:t,isOpen:"complete"!==t})}})},setStartScreenNames:function(t){return e(function(e){return{startScreen:h(h({},e.startScreen),{},{names:t})}})},setMenuActiveButton:function(t){return e(function(e){return{menu:h(h({},e.menu),{},{activeButton:t})}})},setShowIntroduction:function(t){return e(function(e){return{menu:h(h({},e.menu),{},{showIntroduction:t})}})},setShowResetWarning:function(t){return e(function(e){return{menu:h(h({},e.menu),{},{showResetWarning:t})}})},resetAll:function(){return e(function(){return{calculator:{isOpen:!1,value:0,isFlipped:!1},startScreen:{transitionState:"initial",names:{1:"",2:"",3:"",4:""},isOpen:!0},history:{warning:null},chargeEffects:{berg:{top:b(),bottom:b()},bedanken:{top:b(),bottom:b()},matsch:{top:b(),bottom:b()}},menu:{isOpen:!1,activeButton:null,showIntroduction:!1,showResetWarning:!1,props:null},resultatKreidetafel:{isOpen:!1,swipePosition:null,currentStatistic:"striche",animationComplete:!0},historyWarning:{show:!1,message:"",onConfirm:function(){},onCancel:function(){},type:"warning"},isMenuOpen:!1}})},setMenuOpen:function(t){return e(function(e){return t&&e.calculator.isOpen?{menu:h(h({},e.menu),{},{isOpen:t}),calculator:h(h({},e.calculator),{},{isOpen:!1}),overlayPosition:t?e.overlayPosition:null}:{menu:h(h({},e.menu),{},{isOpen:t}),overlayPosition:t?e.overlayPosition:null}})},openResultatKreidetafel:function(t){return e({resultatKreidetafel:{isOpen:!0,swipePosition:t,currentStatistic:"striche",animationComplete:!1},overlayPosition:t})},closeResultatKreidetafel:function(){return e({resultatKreidetafel:{isOpen:!1,swipePosition:null,currentStatistic:"striche",animationComplete:!0}})},setGameInfoOpen:function(t){return e({isGameInfoOpen:t})},setHistoryWarningOpen:function(t){return e({isHistoryWarningOpen:t})},setHistoryWarningCallback:function(t){return e({historyWarningCallback:t})},setLastDoubleClickPosition:function(t){return e({lastDoubleClickPosition:t})},showHistoryWarning:function(t){return e(function(e){return{historyWarning:{show:!0,message:t.message,onConfirm:t.onConfirm,onCancel:t.onCancel||function(){},type:t.type||"warning"}}})},closeHistoryWarning:function(){return e(function(e){return{historyWarning:h(h({},e.historyWarning),{},{show:!1})}})},pauseGame:function(){return e({isPaused:!0})},resumeGame:function(){return e({isPaused:!1})},setKreidetafelPosition:function(t){return e(function(e){return{resultatKreidetafel:h(h({},e.resultatKreidetafel),{},{swipePosition:t})}})},setKreidetafelStatistic:function(t){return e(function(e){return{resultatKreidetafel:h(h({},e.resultatKreidetafel),{},{currentStatistic:t})}})},setStrichStyle:function(t){return e(function(e){return{strichStyle:h(h({},e.strichStyle),t)}})},openFarbeSettings:function(){return e(function(e){return{settings:h(h({},e.settings),{},{isOpen:!0,activeTab:"farben"})}})},closeFarbeSettings:function(){return e(function(e){return{settings:h(h({},e.settings),{},{isOpen:!1})}})},setFarbeFlipped:function(r){var n=h(h({},t().farbeSettings),{},{isFlipped:r});v("farbe",n),e({farbeSettings:n})},updateFarbeSettings:function(t){return e(function(e){var r=h(h({},e.farbeSettings),t);return(0,s.mG)(r)?(v("farbe",r),{farbeSettings:r}):e})},openScoreSettings:function(){return e(function(e){return{settings:h(h({},e.settings),{},{isOpen:!0,activeTab:"scores"})}})},closeScoreSettings:function(){return e(function(e){return{settings:h(h({},e.settings),{},{isOpen:!1})}})},updateScoreSettings:function(t){return e(function(e){return{scoreSettings:h(h({},e.scoreSettings),t)}})},setScoreValue:function(t,r){(0,o.IZ)(t,r)&&e(function(e){return{scoreSettings:h(h({},e.scoreSettings),{},{values:h(h({},e.scoreSettings.values),{},d({},t,r))})}})},toggleScoreEnabled:function(t){return e(function(e){return{scoreSettings:h(h({},e.scoreSettings),{},{enabled:h(h({},e.scoreSettings.enabled),{},d({},t,!e.scoreSettings.enabled[t]))})}})},setSettingsTab:function(t){return e(function(e){return{settings:h(h({},e.settings),{},{activeTab:t})}})},openSettings:function(){return e(function(e){return{settings:h(h({},e.settings),{},{isOpen:!0})}})},closeSettings:function(){return e(function(e){return{settings:h(h({},e.settings),{},{isOpen:!1})}})},cyclePictogramMode:function(){return e(function(e){var t,r=e.settings.pictogramConfig;return v("pictogram",t=r.isEnabled?"svg"===r.mode?{isEnabled:!0,mode:"emoji"}:{isEnabled:!1,mode:"svg"}:{isEnabled:!0,mode:"svg"}),{settings:h(h({},e.settings),{},{pictogramConfig:t})}})},updateScoreValue:function(t,r){return e(function(e){if(!(0,o.IZ)(t,r))return e;var n=h({},e.scoreSettings.values);if(n[t]=r,"sieg"===t){var i=Math.floor(r/2);n.berg=Math.min(n.berg,i),n.schneider=Math.min(n.schneider,i)}var a=h(h({},e.scoreSettings),{},{values:n});return v("score",a),{scoreSettings:a}})},updateSettings:function(t,r){e(function(e){var n=h(h({},"farbe"===t?e.farbeSettings:e.scoreSettings),r);return v(t,n),d({},"".concat(t,"Settings"),n)})},setOverlayPosition:function(t){return e({overlayPosition:t})},showJassFinishNotification:function(t){return e(function(e){var r,n;e.jassFinishNotification={isOpen:!0,mode:null!=(r=t.mode)?r:"share",message:null!=(n=t.message)?n:{text:"Jass beendet!",icon:"\uD83C\uDF89"},onShare:t.onShare,onBack:t.onBack,onBackLabel:t.onBackLabel,onContinue:t.onContinue}})},closeJassFinishNotification:function(){return e(function(e){e.jassFinishNotification.isOpen=!1})},setOnboardingStep:function(t){return e(function(e){return{onboarding:h(h({},e.onboarding),{},{currentStep:t})}})},completeOnboarding:function(){return e(function(e){return{onboarding:h(h({},e.onboarding),{},{hasCompletedOnboarding:!0})}})},showOnboarding:function(t){return e(function(e){return{onboarding:h(h({},e.onboarding),{},{show:!0,canBeDismissed:t})}})},hideOnboarding:function(){return e(function(e){return{onboarding:h(h({},e.onboarding),{},{show:!1,hasCompletedOnboarding:!0})}})},setCardStyle:function(t){return e(function(e){e.settings.cardStyle=t,e.farbeSettings.cardStyle=t})},updateStrokeSettings:function(t){(0,a.yB)(t)&&e(function(e){var r=h(h({},e.strokeSettings),t);return v("strokes",r),{strokeSettings:r}})},setStrokeValue:function(t,r){(0,a.yB)(d({},t,r))&&e(function(e){return{strokeSettings:h(h({},e.strokeSettings),{},d({},t,r))}})},openTutorialInfo:function(){return e({isTutorialInfoOpen:!0})},closeTutorialInfo:function(){return e({isTutorialInfoOpen:!1})},closeAllOverlays:function(){return e(function(e){return h(h({},e),{},{menu:h(h({},e.menu),{},{isOpen:!1}),isGameInfoOpen:!1})})},openMenu:function(){return e(function(e){return e.calculator.isOpen?h(h({},e),{},{isMenuOpen:!0,calculator:h(h({},e.calculator),{},{isOpen:!1})}):h(h({},e),{},{isMenuOpen:!0})})},setSplitContainer:function(t,r){return e(function(e){return{splitContainer:{isOpen:t,position:r}}})},closeGameInfo:function(){return e({isGameInfoOpen:!1})},tutorialBlockedUI:{settingsClose:!1,calculatorClose:!1,gameInfoClose:!1,resultatKreidetafelClose:!1},openGameInfo:function(){return e({isGameInfoOpen:!0})},setTopSwipeAnimation:function(t){return e({topSwipeAnimation:t})},setBottomSwipeAnimation:function(t){return e({bottomSwipeAnimation:t})},showNotification:function(r){var n,i=h(h({},r),{},{id:crypto.randomUUID(),timestamp:Date.now()});return e(function(e){e.notifications.some(function(e){return e.id===i.id})||(e.notifications.length>=5&&e.notifications.shift(),e.notifications.push(i))}),i.duration&&i.duration>0&&!(null!=(n=i.actions)&&n.length)&&setTimeout(function(){t().removeNotification(i.id)},i.duration),i.id},removeNotification:function(t){e(function(e){var r=e.notifications.length;e.notifications=e.notifications.filter(function(e){return e.id!==t}),r===e.notifications.length&&console.warn("[UIStore] Attempted to remove notification ".concat(t," but it was not found in the list"))})},setResultatPosition:function(t){return e(function(e){return{resultatKreidetafel:h(h({},e.resultatKreidetafel),{},{swipePosition:t})}})},setResultatAnimationComplete:function(t){return e(function(e){return{resultatKreidetafel:h(h({},e.resultatKreidetafel),{},{animationComplete:t})}})},canOpenGameInfo:function(){var e=t();return!(e.startScreen.isOpen||e.settings.isOpen||e.calculator.isOpen||e.menu.isOpen||e.resultatKreidetafel.isOpen||e.jassFinishNotification.isOpen||e.isTutorialInfoOpen||e.splitContainer.isOpen)},setStartScreenOpen:function(t){return e(function(e){return{startScreen:h(h({},e.startScreen),{},{isOpen:t})}})},toggleMenu:function(){return e(function(e){var t=!e.isMenuOpen;return t&&e.calculator.isOpen?{isMenuOpen:t,calculator:h(h({},e.calculator),{},{isOpen:!1})}:{isMenuOpen:t}})},closeMenu:function(){return e({isMenuOpen:!1})},toggleNotificationCenter:function(){return e(function(e){e.isNotificationCenterOpen=!e.isNotificationCenterOpen})},openNotificationCenter:function(){return e({isNotificationCenterOpen:!0})},closeNotificationCenter:function(){return e({isNotificationCenterOpen:!1})},setLoading:function(t){return e({isLoading:t})},setPageCta:function(t){return e(function(e){if(t.isVisible&&t.text&&t.onClick){var r,n,i;e.pageCta={isVisible:!0,text:t.text,onClick:t.onClick,loading:null!=(r=t.loading)&&r,disabled:null!=(n=t.disabled)&&n,variant:null!=(i=t.variant)?i:"default"}}else e.pageCta=h({},I.pageCta)})},resetPageCta:function(){return e(function(e){e.pageCta=h({},I.pageCta)})},setPageCtaLoading:function(t){return e(function(e){e.pageCta.isVisible&&(e.pageCta.loading=t)})},setPageCtaDisabled:function(t){return e(function(e){e.pageCta.isVisible&&(e.pageCta.disabled=t)})},resetUI:function(){e(function(e){var t=e.farbeSettings,r=e.scoreSettings,n=e.strokeSettings,i=e.settings;Object.assign(e,I),e.farbeSettings=t,e.scoreSettings=r,e.strokeSettings=n,e.settings=i},!1)},openFarbeSettingsModal:function(){return e({isFarbeSettingsModalOpen:!0})},closeFarbeSettingsModal:function(){return e({isFarbeSettingsModalOpen:!1})},setResumableGameId:function(t){e({resumableGameId:t})},clearResumableGameId:function(){e({resumableGameId:null})},startSigningProcess:function(){e({signingState:"top"===t().resultatKreidetafel.swipePosition?"waitingTeam2":"waitingTeam1",team1Signed:!1,team2Signed:!1})},recordSignature:function(t){e(function(e){var r=e.signingState,n=e.team1Signed,i=e.team2Signed;"bottom"===t?(n=!0,r=e.team2Signed?"completed":"waitingTeam2"):(i=!0,r=e.team1Signed?"completed":"waitingTeam1"),e.signingState=r,e.team1Signed=n,e.team2Signed=i})},resetSigningProcess:function(){e({signingState:"idle",team1Signed:!1,team2Signed:!1})},setJustAborted:function(t){return e({justAbortedGame:t})},setIsNavigatingHistory:function(t){return e({isNavigatingHistory:t})},setReadOnlyMode:function(t){return e({isReadOnlyMode:t})},setJassFinishNotificationOpen:function(t){return e(function(e){return{jassFinishNotification:h(h({},e.jassFinishNotification),{},{isOpen:t})}})},setHeaderConfig:function(t){return e({headerConfig:t})},setHasBeenRedirectedToActiveTournament:function(t){return e({hasBeenRedirectedToActiveTournament:t})},setGlobalClickDisabled:function(t,r){e({isGlobalClickDisabled:t}),t&&r&&setTimeout(function(){console.log("⏱️ Globale Klicksperre aufgehoben."),e({isGlobalClickDisabled:!1})},r)},setIOSNotificationDontShowAgain:function(t){return e(function(e){return{iosNotification:h(h({},e.iosNotification),{},{dontShowAgain:t})}})},markIOSNotificationAsShown:function(){return e(function(e){return{iosNotification:h(h({},e.iosNotification),{},{hasBeenShownThisSession:!0})}})},resetIOSNotificationForSession:function(){return e(function(e){return{iosNotification:h(h({},e.iosNotification),{},{hasBeenShownThisSession:!1})}})},shouldShowIOSNotification:function(){var e=t();return!e.iosNotification.dontShowAgain&&!e.iosNotification.hasBeenShownThisSession}})}),{name:"jass-ui-storage",partialize:function(e){return{farbeSettings:e.farbeSettings,scoreSettings:e.scoreSettings,strokeSettings:e.strokeSettings,settings:h(h({},e.settings),{},{cardStyle:e.settings.cardStyle,pictogramConfig:e.settings.pictogramConfig})}}}));E.persist.rehydrate()},3786:(e,t,r)=>{"use strict";r.d(t,{HF:()=>e8,F0:()=>tL,eJ:()=>tg,Wm:()=>tb,xI:()=>rW,hg:()=>tk,gA:()=>tw,J1:()=>tm,oM:()=>tT,x9:()=>ty,df:()=>ri,CI:()=>t_,r7:()=>tx});var n=r(6796),i=r(1139),o=r(6525),a=r(4902),s=r(8308);function u(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}let c=new i.FA("auth","Firebase",u()),l=new o.Vy("@firebase/auth");function h(e,...t){l.logLevel<=o.$b.ERROR&&l.error(`Auth (${n.MF}): ${e}`,...t)}function d(e,...t){throw y(e,...t)}function f(e,...t){return y(e,...t)}function p(e,t,r){let n=Object.assign(Object.assign({},u()),{[t]:r});return new i.FA("auth","Firebase",n).create(t,{appName:e.name})}function m(e){return p(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function g(e,t,r){if(!(t instanceof r))throw r.name!==t.constructor.name&&d(e,"argument-error"),p(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function y(e,...t){if("string"!=typeof e){let r=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(r,...n)}return c.create(e,...t)}function v(e,t,...r){if(!e)throw y(t,...r)}function b(e){let t="INTERNAL ASSERTION FAILED: "+e;throw h(t),Error(t)}function w(e,t){e||b(t)}function S(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.href)||""}function x(){return"http:"===I()||"https:"===I()}function I(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.protocol)||null}class E{constructor(e,t){var r;this.shortDelay=e,this.longDelay=t,r="Short delay should be less than long delay!",t>e||b(r),this.isMobile=(0,i.jZ)()||(0,i.lV)()}get(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(x()||(0,i.sr)()||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function T(e,t){var r,n;r=e.emulator,n="Emulator should always be set here",r||b(n);let{url:i}=e.emulator;return t?`${i}${t.startsWith("/")?t.slice(1):t}`:i}class k{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void b("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void b("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void b("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let _={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},P=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],A=new E(3e4,6e4);function O(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function C(e,t,r,n,o={}){return D(e,o,async()=>{let o={},a={};n&&("GET"===t?a=n:o={body:JSON.stringify(n)});let s=(0,i.Am)(Object.assign({key:e.config.apiKey},a)).slice(1),u=await e._getAdditionalHeaders();u["Content-Type"]="application/json",e.languageCode&&(u["X-Firebase-Locale"]=e.languageCode);let c=Object.assign({method:t,headers:u},o);return(0,i.c1)()||(c.referrerPolicy="no-referrer"),e.emulatorConfig&&(0,i.zJ)(e.emulatorConfig.host)&&(c.credentials="include"),k.fetch()(await R(e,e.config.apiHost,r,s),c)})}async function D(e,t,r){e._canInitEmulator=!1;let n=Object.assign(Object.assign({},_),t);try{let t=new L(e),i=await Promise.race([r(),t.promise]);t.clearNetworkTimeout();let o=await i.json();if("needConfirmation"in o)throw j(e,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{let[t,r]=(i.ok?o.errorMessage:o.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw j(e,"credential-already-in-use",o);if("EMAIL_EXISTS"===t)throw j(e,"email-already-in-use",o);if("USER_DISABLED"===t)throw j(e,"user-disabled",o);let a=n[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(r)throw p(e,a,r);d(e,a)}}catch(t){if(t instanceof i.g)throw t;d(e,"network-request-failed",{message:String(t)})}}async function N(e,t,r,n,i={}){let o=await C(e,t,r,n,i);return"mfaPendingCredential"in o&&d(e,"multi-factor-auth-required",{_serverResponse:o}),o}async function R(e,t,r,n){let i=`${t}${r}?${n}`,o=e.config.emulator?T(e.config,i):`${e.config.apiScheme}://${i}`;return P.includes(r)&&(await e._persistenceManagerAvailable,"COOKIE"===e._getPersistenceType())?e._getPersistence()._getFinalTarget(o).toString():o}class L{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(f(this.auth,"network-request-failed")),A.get())})}}function j(e,t,r){let n={appName:e.name};r.email&&(n.email=r.email),r.phoneNumber&&(n.phoneNumber=r.phoneNumber);let i=f(e,t,n);return i.customData._tokenResponse=r,i}function F(e){return void 0!==e&&void 0!==e.enterprise}class G{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)switch(t.enforcementState){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function M(e,t){return C(e,"GET","/v2/recaptchaConfig",O(e,t))}async function U(e,t){return C(e,"POST","/v1/accounts:delete",t)}async function V(e,t){return C(e,"POST","/v1/accounts:lookup",t)}function B(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function z(e,t=!1){let r=(0,i.Ku)(e),n=await r.getIdToken(t),o=q(n);v(o&&o.exp&&o.auth_time&&o.iat,r.auth,"internal-error");let a="object"==typeof o.firebase?o.firebase:void 0,s=null==a?void 0:a.sign_in_provider;return{claims:o,token:n,authTime:B(H(o.auth_time)),issuedAtTime:B(H(o.iat)),expirationTime:B(H(o.exp)),signInProvider:s||null,signInSecondFactor:(null==a?void 0:a.sign_in_second_factor)||null}}function H(e){return 1e3*Number(e)}function q(e){let[t,r,n]=e.split(".");if(void 0===t||void 0===r||void 0===n)return h("JWT malformed, contained fewer than 3 sections"),null;try{let e=(0,i.u)(r);if(!e)return h("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return h("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function $(e){let t=q(e);return v(t,"internal-error"),v(void 0!==t.exp,"internal-error"),v(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function K(e,t,r=!1){if(r)return t;try{return await t}catch(t){throw t instanceof i.g&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class W{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(!e)return this.errorBackoff=3e4,Math.max(0,(null!=(t=this.user.stsTokenManager.expirationTime)?t:0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(null==e?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class J{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=B(this.lastLoginAt),this.creationTime=B(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Q(e){var t,r,n;let i=e.auth,o=await e.getIdToken(),a=await K(e,V(i,{idToken:o}));v(null==a?void 0:a.users.length,i,"internal-error");let s=a.users[0];e._notifyReloadListener(s);let u=(null==(t=s.providerUserInfo)?void 0:t.length)?X(s.providerUserInfo):[],c=(r=e.providerData,n=u,[...r.filter(e=>!n.some(t=>t.providerId===e.providerId)),...n]),l=e.isAnonymous,h=!(e.email&&s.passwordHash)&&!(null==c?void 0:c.length);Object.assign(e,{uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:c,metadata:new J(s.createdAt,s.lastLoginAt),isAnonymous:!!l&&h})}async function Y(e){let t=(0,i.Ku)(e);await Q(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function X(e){return e.map(e=>{var{providerId:t}=e,r=(0,a.Tt)(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}async function Z(e,t){let r=await D(e,{},async()=>{let r=(0,i.Am)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:o}=e.config,a=await R(e,n,"/v1/token",`key=${o}`),s=await e._getAdditionalHeaders();s["Content-Type"]="application/x-www-form-urlencoded";let u={method:"POST",headers:s,body:r};return e.emulatorConfig&&(0,i.zJ)(e.emulatorConfig.host)&&(u.credentials="include"),k.fetch()(a,u)});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function ee(e,t){return C(e,"POST","/v2/accounts:revokeToken",O(e,t))}class et{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){v(e.idToken,"internal-error"),v(void 0!==e.idToken,"internal-error"),v(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):$(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){v(0!==e.length,"internal-error");let t=$(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(v(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:r,refreshToken:n,expiresIn:i}=await Z(e,t);this.updateTokensAndExpiration(r,n,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*r}static fromJSON(e,t){let{refreshToken:r,accessToken:n,expirationTime:i}=t,o=new et;return r&&(v("string"==typeof r,"internal-error",{appName:e}),o.refreshToken=r),n&&(v("string"==typeof n,"internal-error",{appName:e}),o.accessToken=n),i&&(v("number"==typeof i,"internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new et,this.toJSON())}_performRefresh(){return b("not implemented")}}function er(e,t){v("string"==typeof e||void 0===e,"internal-error",{appName:t})}class en{constructor(e){var{uid:t,auth:r,stsTokenManager:n}=e,i=(0,a.Tt)(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new W(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new J(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){let t=await K(this,this.stsTokenManager.getToken(this.auth,e));return v(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return z(this,e)}reload(){return Y(this)}_assign(e){this!==e&&(v(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new en(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){v(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Q(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if((0,n.xZ)(this.auth.app))return Promise.reject(m(this.auth));let e=await this.getIdToken();return await K(this,U(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,n,i,o,a,s,u,c;let l=null!=(r=t.displayName)?r:void 0,h=null!=(n=t.email)?n:void 0,d=null!=(i=t.phoneNumber)?i:void 0,f=null!=(o=t.photoURL)?o:void 0,p=null!=(a=t.tenantId)?a:void 0,m=null!=(s=t._redirectEventId)?s:void 0,g=null!=(u=t.createdAt)?u:void 0,y=null!=(c=t.lastLoginAt)?c:void 0,{uid:b,emailVerified:w,isAnonymous:S,providerData:x,stsTokenManager:I}=t;v(b&&I,e,"internal-error");let E=et.fromJSON(this.name,I);v("string"==typeof b,e,"internal-error"),er(l,e.name),er(h,e.name),v("boolean"==typeof w,e,"internal-error"),v("boolean"==typeof S,e,"internal-error"),er(d,e.name),er(f,e.name),er(p,e.name),er(m,e.name),er(g,e.name),er(y,e.name);let T=new en({uid:b,auth:e,email:h,emailVerified:w,displayName:l,isAnonymous:S,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:E,createdAt:g,lastLoginAt:y});return x&&Array.isArray(x)&&(T.providerData=x.map(e=>Object.assign({},e))),m&&(T._redirectEventId=m),T}static async _fromIdTokenResponse(e,t,r=!1){let n=new et;n.updateFromServerResponse(t);let i=new en({uid:t.localId,auth:e,stsTokenManager:n,isAnonymous:r});return await Q(i),i}static async _fromGetAccountInfoResponse(e,t,r){let n=t.users[0];v(void 0!==n.localId,"internal-error");let i=void 0!==n.providerUserInfo?X(n.providerUserInfo):[],o=!(n.email&&n.passwordHash)&&!(null==i?void 0:i.length),a=new et;a.updateFromIdToken(r);let s=new en({uid:n.localId,auth:e,stsTokenManager:a,isAnonymous:o});return Object.assign(s,{uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:i,metadata:new J(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash)&&!(null==i?void 0:i.length)}),s}}let ei=new Map;function eo(e){var t,r;t="Expected a class definition",e instanceof Function||b(t);let n=ei.get(e);return n?(r="Instance stored in cache mismatched with class",n instanceof e||b(r)):(n=new e,ei.set(e,n)),n}class ea{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}function es(e,t,r){return`firebase:${e}:${t}:${r}`}ea.type="NONE";class eu{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:n,name:i}=this.auth;this.fullUserKey=es(this.userKey,n.apiKey,i),this.fullPersistenceKey=es("persistence",n.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){let t=await V(this.auth,{idToken:e}).catch(()=>void 0);return t?en._fromGetAccountInfoResponse(this.auth,t,e):null}return en._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new eu(eo(ea),e,r);let n=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),i=n[0]||eo(ea),o=es(r,e.config.apiKey,e.name),a=null;for(let r of t)try{let t=await r._get(o);if(t){let n;if("string"==typeof t){let r=await V(e,{idToken:t}).catch(()=>void 0);if(!r)break;n=await en._fromGetAccountInfoResponse(e,r,t)}else n=en._fromJSON(e,t);r!==i&&(a=n),i=r;break}}catch(e){}let s=n.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&s.length&&(i=s[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(o)}catch(e){}}))),new eu(i,e,r)}}function ec(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";{if(ef(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(el(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(em(t))return"Blackberry";if(eg(t))return"Webos";if(eh(t))return"Safari";if((t.includes("chrome/")||ed(t))&&!t.includes("edge/"))return"Chrome";if(ep(t))return"Android";let r=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if((null==r?void 0:r.length)===2)return r[1]}return"Other"}function el(e=(0,i.ZQ)()){return/firefox\//i.test(e)}function eh(e=(0,i.ZQ)()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function ed(e=(0,i.ZQ)()){return/crios\//i.test(e)}function ef(e=(0,i.ZQ)()){return/iemobile/i.test(e)}function ep(e=(0,i.ZQ)()){return/android/i.test(e)}function em(e=(0,i.ZQ)()){return/blackberry/i.test(e)}function eg(e=(0,i.ZQ)()){return/webos/i.test(e)}function ey(e=(0,i.ZQ)()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function ev(e=(0,i.ZQ)()){return ey(e)||ep(e)||eg(e)||em(e)||/windows phone/i.test(e)||ef(e)}function eb(e,t=[]){let r;switch(e){case"Browser":r=ec((0,i.ZQ)());break;case"Worker":r=`${ec((0,i.ZQ)())}-${e}`;break;default:r=e}let o=t.length?t.join(","):"FirebaseCore-web";return`${r}/JsCore/${n.MF}/${o}`}class ew{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=t=>new Promise((r,n)=>{try{let n=e(t);r(n)}catch(e){n(e)}});r.onAbort=t,this.queue.push(r);let n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}async function eS(e,t={}){return C(e,"GET","/v2/passwordPolicy",O(e,t))}class ex{constructor(e){var t,r,n,i;let o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!=(t=o.minPasswordLength)?t:6,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),void 0!==o.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),void 0!==o.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),void 0!==o.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),void 0!==o.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!=(n=null==(r=e.allowedNonAlphanumericCharacters)?void 0:r.join(""))?n:"",this.forceUpgradeOnSignin=null!=(i=e.forceUpgradeOnSignin)&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,n,i,o,a;let s={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,s),this.validatePasswordCharacterOptions(e,s),s.isValid&&(s.isValid=null==(t=s.meetsMinPasswordLength)||t),s.isValid&&(s.isValid=null==(r=s.meetsMaxPasswordLength)||r),s.isValid&&(s.isValid=null==(n=s.containsLowercaseLetter)||n),s.isValid&&(s.isValid=null==(i=s.containsUppercaseLetter)||i),s.isValid&&(s.isValid=null==(o=s.containsNumericCharacter)||o),s.isValid&&(s.isValid=null==(a=s.containsNonAlphanumericCharacter)||a),s}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),n&&(t.meetsMaxPasswordLength=e.length<=n)}validatePasswordCharacterOptions(e,t){let r;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let n=0;n<e.length;n++)r=e.charAt(n),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,n,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class eI{constructor(e,t,r,n){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new eT(this),this.idTokenSubscription=new eT(this),this.beforeStateQueue=new ew(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=c,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=eo(t)),this._initializationPromise=this.queue(async()=>{var r,n,i;if(!this._deleted){if(this.persistenceManager=await eu.create(this,e),null==(r=this._resolvePersistenceManagerAvailable)||r.call(this),!this._deleted){if(null==(n=this._popupRedirectResolver)?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null==(i=this.currentUser)?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await V(this,{idToken:e}),r=await en._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if((0,n.xZ)(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let r=await this.assertedPersistence.getCurrentUser(),i=r,o=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let r=null==(t=this.redirectUser)?void 0:t._redirectEventId,n=null==i?void 0:i._redirectEventId,a=await this.tryRedirectSignIn(e);(!r||r===n)&&(null==a?void 0:a.user)&&(i=a.user,o=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(o)try{await this.beforeStateQueue.runMiddleware(i)}catch(e){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return(v(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId)?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Q(e)}catch(e){if((null==e?void 0:e.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if((0,n.xZ)(this.app))return Promise.reject(m(this));let t=e?(0,i.Ku)(e):null;return t&&v(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&v(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return(0,n.xZ)(this.app)?Promise.reject(m(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return(0,n.xZ)(this.app)?Promise.reject(m(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(eo(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new ex(await eS(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new i.FA("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await ee(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null==(e=this._currentUser)?void 0:e.toJSON()}}async _setRedirectUser(e,t){let r=await this.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&eo(e)||this._popupRedirectResolver;v(t,this,"argument-error"),this.redirectPersistenceManager=await eu.create(this,[eo(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return(this._isInitialized&&await this.queue(async()=>{}),(null==(t=this._currentUser)?void 0:t._redirectEventId)===e)?this._currentUser:(null==(r=this.redirectUser)?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=null!=(t=null==(e=this.currentUser)?void 0:e.uid)?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,n){if(this._deleted)return()=>{};let i="function"==typeof t?t:t.next.bind(t),o=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(v(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),"function"==typeof t){let i=e.addObserver(t,r,n);return()=>{o=!0,i()}}{let r=e.addObserver(t);return()=>{o=!0,r()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return v(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=eb(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let r=await (null==(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);let n=await this._getAppCheckToken();return n&&(t["X-Firebase-AppCheck"]=n),t}async _getAppCheckToken(){var e;if((0,n.xZ)(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=await (null==(e=this.appCheckServiceProvider.getImmediate({optional:!0}))?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){l.logLevel<=o.$b.WARN&&l.warn(`Auth (${n.MF}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function eE(e){return(0,i.Ku)(e)}class eT{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,i.tD)(e=>this.observer=e)}get next(){return v(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let ek={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function e_(e){return`__${e}${Math.floor(1e6*Math.random())}`}class eP{constructor(){this.enterprise=new eA}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class eA{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}let eO="NO_RECAPTCHA";class eC{constructor(e){this.type="recaptcha-enterprise",this.auth=eE(e)}async verify(e="verify",t=!1){async function r(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,r)=>{M(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(n=>{if(void 0===n.recaptchaKey)r(Error("recaptcha Enterprise site key undefined"));else{let r=new G(n);return null==e.tenantId?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,t(r.siteKey)}}).catch(e=>{r(e)})})}function n(t,r,n){let i=window.grecaptcha;F(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{r(e)}).catch(()=>{r(eO)})}):n(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new eP().execute("siteKey",{action:"verify"}):new Promise((e,i)=>{r(this.auth).then(r=>{if(!t&&F(window.grecaptcha))n(r,e,i);else{var o;if("undefined"==typeof window)return void i(Error("RecaptchaVerifier is only supported in browser"));let t=ek.recaptchaEnterpriseScript;0!==t.length&&(t+=r),(o=t,ek.loadJS(o)).then(()=>{n(r,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})}}async function eD(e,t,r,n=!1,i=!1){let o,a=new eC(e);if(i)o=eO;else try{o=await a.verify(r)}catch(e){o=await a.verify(r,!0)}let s=Object.assign({},t);if("mfaSmsEnrollment"===r||"mfaSmsSignIn"===r){if("phoneEnrollmentInfo"in s){let e=s.phoneEnrollmentInfo.phoneNumber,t=s.phoneEnrollmentInfo.recaptchaToken;Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in s){let e=s.phoneSignInInfo.recaptchaToken;Object.assign(s,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return s}return n?Object.assign(s,{captchaResp:o}):Object.assign(s,{captchaResponse:o}),Object.assign(s,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(s,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),s}async function eN(e,t,r,n,i){var o,a;if("EMAIL_PASSWORD_PROVIDER"===i)if(null==(o=e._getRecaptchaConfig())||!o.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return n(e,t).catch(async i=>{if("auth/missing-recaptcha-token"!==i.code)return Promise.reject(i);{console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let i=await eD(e,t,r,"getOobCode"===r);return n(e,i)}});else{let i=await eD(e,t,r,"getOobCode"===r);return n(e,i)}if("PHONE_PROVIDER"!==i)return Promise.reject(i+" provider is not supported.");if(null==(a=e._getRecaptchaConfig())?void 0:a.isProviderEnabled("PHONE_PROVIDER")){let i=await eD(e,t,r);return n(e,i).catch(async i=>{var o;if((null==(o=e._getRecaptchaConfig())?void 0:o.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&("auth/missing-recaptcha-token"===i.code||"auth/invalid-app-credential"===i.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${r} flow.`);let i=await eD(e,t,r,!1,!0);return n(e,i)}return Promise.reject(i)})}{let i=await eD(e,t,r,!1,!0);return n(e,i)}}async function eR(e){let t=eE(e),r=new G(await M(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}));null==t.tenantId?t._agentRecaptchaConfig=r:t._tenantRecaptchaConfigs[t.tenantId]=r,r.isAnyProviderEnabled()&&new eC(t).verify()}function eL(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function ej(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}class eF{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return b("not implemented")}_getIdTokenResponse(e){return b("not implemented")}_linkToIdToken(e,t){return b("not implemented")}_getReauthenticationResolver(e){return b("not implemented")}}async function eG(e,t){return C(e,"POST","/v1/accounts:resetPassword",O(e,t))}async function eM(e,t){return C(e,"POST","/v1/accounts:update",t)}async function eU(e,t){return C(e,"POST","/v1/accounts:signUp",t)}async function eV(e,t){return N(e,"POST","/v1/accounts:signInWithPassword",O(e,t))}async function eB(e,t){return C(e,"POST","/v1/accounts:sendOobCode",O(e,t))}async function ez(e,t){return eB(e,t)}async function eH(e,t){return eB(e,t)}async function eq(e,t){return N(e,"POST","/v1/accounts:signInWithEmailLink",O(e,t))}async function e$(e,t){return N(e,"POST","/v1/accounts:signInWithEmailLink",O(e,t))}class eK extends eF{constructor(e,t,r,n=null){super("password",r),this._email=e,this._password=t,this._tenantId=n}static _fromEmailAndPassword(e,t){return new eK(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new eK(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);else if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return eN(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",eV,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return eq(e,{email:this._email,oobCode:this._password});default:d(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return eN(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",eU,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return e$(e,{idToken:t,email:this._email,oobCode:this._password});default:d(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function eW(e,t){return N(e,"POST","/v1/accounts:signInWithIdp",O(e,t))}class eJ extends eF{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new eJ(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):d("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e,{providerId:r,signInMethod:n}=t,i=(0,a.Tt)(t,["providerId","signInMethod"]);if(!r||!n)return null;let o=new eJ(r,n);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){return eW(e,this.buildRequest())}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,eW(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,eW(e,t)}buildRequest(){let e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,i.Am)(t)}return e}}async function eQ(e,t){return C(e,"POST","/v1/accounts:sendVerificationCode",O(e,t))}async function eY(e,t){return N(e,"POST","/v1/accounts:signInWithPhoneNumber",O(e,t))}async function eX(e,t){let r=await N(e,"POST","/v1/accounts:signInWithPhoneNumber",O(e,t));if(r.temporaryProof)throw j(e,"account-exists-with-different-credential",r);return r}let eZ={USER_NOT_FOUND:"user-not-found"};async function e0(e,t){return N(e,"POST","/v1/accounts:signInWithPhoneNumber",O(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),eZ)}class e1 extends eF{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new e1({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new e1({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return eY(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return eX(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return e0(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:n}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:n}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:i}=e;return r||t||n||i?new e1({verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:i}):null}}class e2{constructor(e){var t,r,n,o,a,s;let u=(0,i.I9)((0,i.hp)(e)),c=null!=(t=u.apiKey)?t:null,l=null!=(r=u.oobCode)?r:null,h=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!=(n=u.mode)?n:null);v(c&&l&&h,"argument-error"),this.apiKey=c,this.operation=h,this.code=l,this.continueUrl=null!=(o=u.continueUrl)?o:null,this.languageCode=null!=(a=u.lang)?a:null,this.tenantId=null!=(s=u.tenantId)?s:null}static parseLink(e){let t=function(e){let t=(0,i.I9)((0,i.hp)(e)).link,r=t?(0,i.I9)((0,i.hp)(t)).deep_link_id:null,n=(0,i.I9)((0,i.hp)(e)).deep_link_id;return(n?(0,i.I9)((0,i.hp)(n)).link:null)||n||r||t||e}(e);try{return new e2(t)}catch(e){return null}}}class e3{constructor(){this.providerId=e3.PROVIDER_ID}static credential(e,t){return eK._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let r=e2.parseLink(t);return v(r,"argument-error"),eK._fromEmailAndCode(e,r.code,r.tenantId)}}e3.PROVIDER_ID="password",e3.EMAIL_PASSWORD_SIGN_IN_METHOD="password",e3.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class e4{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class e6 extends e4{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class e5 extends e6{constructor(){super("facebook.com")}static credential(e){return eJ._fromParams({providerId:e5.PROVIDER_ID,signInMethod:e5.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return e5.credentialFromTaggedObject(e)}static credentialFromError(e){return e5.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return e5.credential(e.oauthAccessToken)}catch(e){return null}}}e5.FACEBOOK_SIGN_IN_METHOD="facebook.com",e5.PROVIDER_ID="facebook.com";class e8 extends e6{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return eJ._fromParams({providerId:e8.PROVIDER_ID,signInMethod:e8.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return e8.credentialFromTaggedObject(e)}static credentialFromError(e){return e8.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return e8.credential(t,r)}catch(e){return null}}}e8.GOOGLE_SIGN_IN_METHOD="google.com",e8.PROVIDER_ID="google.com";class e7 extends e6{constructor(){super("github.com")}static credential(e){return eJ._fromParams({providerId:e7.PROVIDER_ID,signInMethod:e7.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return e7.credentialFromTaggedObject(e)}static credentialFromError(e){return e7.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return e7.credential(e.oauthAccessToken)}catch(e){return null}}}e7.GITHUB_SIGN_IN_METHOD="github.com",e7.PROVIDER_ID="github.com";class e9 extends e6{constructor(){super("twitter.com")}static credential(e,t){return eJ._fromParams({providerId:e9.PROVIDER_ID,signInMethod:e9.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return e9.credentialFromTaggedObject(e)}static credentialFromError(e){return e9.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return e9.credential(t,r)}catch(e){return null}}}async function te(e,t){return N(e,"POST","/v1/accounts:signUp",O(e,t))}e9.TWITTER_SIGN_IN_METHOD="twitter.com",e9.PROVIDER_ID="twitter.com";class tt{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,n=!1){return new tt({user:await en._fromIdTokenResponse(e,r,n),providerId:tr(r),_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){return await e._updateTokensIfNecessary(r,!0),new tt({user:e,providerId:tr(r),_tokenResponse:r,operationType:t})}}function tr(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class tn extends i.g{constructor(e,t,r,n){var i;super(t.code,t.message),this.operationType=r,this.user=n,Object.setPrototypeOf(this,tn.prototype),this.customData={appName:e.name,tenantId:null!=(i=e.tenantId)?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,n){return new tn(e,t,r,n)}}function ti(e,t,r,n){return("reauthenticate"===t?r._getReauthenticationResolver(e):r._getIdTokenResponse(e)).catch(r=>{if("auth/multi-factor-auth-required"===r.code)throw tn._fromErrorAndOperation(e,r,t,n);throw r})}async function to(e,t,r=!1){let n=await K(e,t._linkToIdToken(e.auth,await e.getIdToken()),r);return tt._forOperation(e,"link",n)}async function ta(e,t,r){await Q(t),v(new Set(t.providerData.map(({providerId:e})=>e).filter(e=>!!e)).has(r)===e,t.auth,!1===e?"provider-already-linked":"no-such-provider")}async function ts(e,t,r=!1){let{auth:i}=e;if((0,n.xZ)(i.app))return Promise.reject(m(i));let o="reauthenticate";try{let n=await K(e,ti(i,o,t,e),r);v(n.idToken,i,"internal-error");let a=q(n.idToken);v(a,i,"internal-error");let{sub:s}=a;return v(e.uid===s,i,"user-mismatch"),tt._forOperation(e,o,n)}catch(e){throw(null==e?void 0:e.code)==="auth/user-not-found"&&d(i,"user-mismatch"),e}}async function tu(e,t,r=!1){if((0,n.xZ)(e.app))return Promise.reject(m(e));let i="signIn",o=await ti(e,i,t),a=await tt._fromIdTokenResponse(e,i,o);return r||await e._updateCurrentUser(a.user),a}async function tc(e,t){return tu(eE(e),t)}class tl{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?th._fromServerResponse(e,t):"totpInfo"in t?td._fromServerResponse(e,t):d(e,"internal-error")}}class th extends tl{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new th(t)}}class td extends tl{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new td(t)}}function tf(e,t,r){var n;v((null==(n=r.url)?void 0:n.length)>0,e,"invalid-continue-uri"),v(void 0===r.dynamicLinkDomain||r.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),v(void 0===r.linkDomain||r.linkDomain.length>0,e,"invalid-hosting-link-domain"),t.continueUrl=r.url,t.dynamicLinkDomain=r.dynamicLinkDomain,t.linkDomain=r.linkDomain,t.canHandleCodeInApp=r.handleCodeInApp,r.iOS&&(v(r.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=r.iOS.bundleId),r.android&&(v(r.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=r.android.installApp,t.androidMinimumVersionCode=r.android.minimumVersion,t.androidPackageName=r.android.packageName)}async function tp(e){let t=eE(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function tm(e,t,r){let n=eE(e),i={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};r&&tf(n,i,r),await eN(n,i,"getOobCode",eH,"EMAIL_PASSWORD_PROVIDER")}async function tg(e,t,r){if((0,n.xZ)(e.app))return Promise.reject(m(e));let i=eE(e),o=eN(i,{returnSecureToken:!0,email:t,password:r,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",te,"EMAIL_PASSWORD_PROVIDER"),a=await o.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&tp(e),t}),s=await tt._fromIdTokenResponse(i,"signIn",a);return await i._updateCurrentUser(s.user),s}function ty(e,t,r){return(0,n.xZ)(e.app)?Promise.reject(m(e)):tc((0,i.Ku)(e),e3.credential(t,r)).catch(async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&tp(e),t})}async function tv(e,t){return C(e,"POST","/v1/accounts:createAuthUri",O(e,t))}async function tb(e,t){let r=x()?S():"http://localhost",{signinMethods:n}=await tv((0,i.Ku)(e),{identifier:t,continueUri:r});return n||[]}async function tw(e,t){let r=(0,i.Ku)(e),n={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&tf(r.auth,n,t);let{email:o}=await ez(r.auth,n);o!==e.email&&await e.reload()}async function tS(e,t){return C(e,"POST","/v1/accounts:update",t)}async function tx(e,{displayName:t,photoURL:r}){if(void 0===t&&void 0===r)return;let n=(0,i.Ku)(e),o=await n.getIdToken(),a=await K(n,tS(n.auth,{idToken:o,displayName:t,photoUrl:r,returnSecureToken:!0}));n.displayName=a.displayName||null,n.photoURL=a.photoUrl||null;let s=n.providerData.find(({providerId:e})=>"password"===e);s&&(s.displayName=n.displayName,s.photoURL=n.photoURL),await n._updateTokensIfNecessary(a)}class tI{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class tE extends tI{constructor(e,t,r,n){super(e,t,r),this.username=n}}function tT(e,t){return(0,i.Ku)(e).setPersistence(t)}function tk(e,t,r,n){return(0,i.Ku)(e).onAuthStateChanged(t,r,n)}function t_(e){return(0,i.Ku)(e).signOut()}class tP{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new tP("enroll",e,t)}static _fromMfaPendingCredential(e){return new tP("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(null==e?void 0:e.multiFactorSession){if(null==(t=e.multiFactorSession)?void 0:t.pendingCredential)return tP._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);else if(null==(r=e.multiFactorSession)?void 0:r.idToken)return tP._fromIdtoken(e.multiFactorSession.idToken)}return null}}class tA{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){let r=eE(e),n=t.customData._serverResponse,i=(n.mfaInfo||[]).map(e=>tl._fromServerResponse(r,e));v(n.mfaPendingCredential,r,"internal-error");let o=tP._fromMfaPendingCredential(n.mfaPendingCredential);return new tA(o,i,async e=>{let i=await e._process(r,o);delete n.mfaInfo,delete n.mfaPendingCredential;let a=Object.assign(Object.assign({},n),{idToken:i.idToken,refreshToken:i.refreshToken});switch(t.operationType){case"signIn":let s=await tt._fromIdTokenResponse(r,t.operationType,a);return await r._updateCurrentUser(s.user),s;case"reauthenticate":return v(t.user,r,"internal-error"),tt._forOperation(t.user,t.operationType,a);default:d(r,"internal-error")}})}async resolveSignIn(e){return this.signInResolver(e)}}function tO(e,t){return C(e,"POST","/v2/accounts/mfaEnrollment:start",O(e,t))}class tC{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(t=>tl._fromServerResponse(e.auth,t)))})}static _fromUser(e){return new tC(e)}async getSession(){return tP._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){let r=await this.getSession(),n=await K(this.user,e._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(n),this.user.reload()}async unenroll(e){let t="string"==typeof e?e:e.uid,r=await this.user.getIdToken();try{var n,i;let e=await K(this.user,(n=this.user.auth,i={idToken:r,mfaEnrollmentId:t},C(n,"POST","/v2/accounts/mfaEnrollment:withdraw",O(n,i))));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(e),await this.user.reload()}catch(e){throw e}}}new WeakMap;let tD="__sak";class tN{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(tD,"1"),this.storage.removeItem(tD),Promise.resolve(!0)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class tR extends tN{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=ev(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let r=this.storage.getItem(t),n=this.localCache[t];r!==n&&e(t,n,r)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,r)=>{this.notifyListeners(e,r)});let r=e.key;t?this.detachListener():this.stopPolling();let n=()=>{let e=this.storage.getItem(r);(t||this.localCache[r]!==e)&&this.notifyListeners(r,e)},o=this.storage.getItem(r);(0,i.lT)()&&10===document.documentMode&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(n,10):n()}notifyListeners(e,t){this.localCache[e]=t;let r=this.listeners[e];if(r)for(let e of Array.from(r))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}tR.type="LOCAL";let tL=tR;function tj(e){var t,r;let n=e.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),i=RegExp(`${n}=([^;]+)`);return null!=(r=null==(t=document.cookie.match(i))?void 0:t[1])?r:null}function tF(e){let t="http:"===window.location.protocol;return`${t?"__dev_":"__HOST-"}FIREBASE_${e.split(":")[3]}`}class tG{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(e){let t=new URL(`${window.location.origin}/__cookies__`);return t.searchParams.set("finalTarget",e),t}async _isAvailable(){var e;return("boolean"!=typeof isSecureContext||!!isSecureContext)&&"undefined"!=typeof navigator&&"undefined"!=typeof document&&(null==(e=navigator.cookieEnabled)||e)}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;let t=tF(e);if(window.cookieStore){let e=await window.cookieStore.get(t);return null==e?void 0:e.value}return tj(t)}async _remove(e){if(!this._isAvailable()||!await this._get(e))return;let t=tF(e);document.cookie=`${t}=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High`,await fetch("/__cookies__",{method:"DELETE"}).catch(()=>void 0)}_addListener(e,t){if(!this._isAvailable())return;let r=tF(e);if(window.cookieStore){let e=e=>{let n=e.changed.find(e=>e.name===r);n&&t(n.value),e.deleted.find(e=>e.name===r)&&t(null)};return this.listenerUnsubscribes.set(t,()=>window.cookieStore.removeEventListener("change",e)),window.cookieStore.addEventListener("change",e)}let n=tj(r),i=setInterval(()=>{let e=tj(r);e!==n&&(t(e),n=e)},1e3);this.listenerUnsubscribes.set(t,()=>clearInterval(i))}_removeListener(e,t){let r=this.listenerUnsubscribes.get(t);r&&(r(),this.listenerUnsubscribes.delete(t))}}tG.type="COOKIE";class tM extends tN{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}tM.type="SESSION";class tU{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;let r=new tU(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let{eventId:t,eventType:r,data:n}=e.data,i=this.handlersMap[r];if(!(null==i?void 0:i.size))return;e.ports[0].postMessage({status:"ack",eventId:t,eventType:r});let o=Array.from(i).map(async t=>t(e.origin,n)),a=await Promise.all(o.map(async e=>{try{let t=await e;return{fulfilled:!0,value:t}}catch(e){return{fulfilled:!1,reason:e}}}));e.ports[0].postMessage({status:"done",eventId:t,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function tV(e="",t=10){let r="";for(let e=0;e<t;e++)r+=Math.floor(10*Math.random());return e+r}tU.receivers=[];class tB{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){let n,i,o="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!o)throw Error("connection_unavailable");return new Promise((a,s)=>{let u=tV("",20);o.port1.start();let c=setTimeout(()=>{s(Error("unsupported_event"))},r);i={messageChannel:o,onMessage(e){if(e.data.eventId===u)switch(e.data.status){case"ack":clearTimeout(c),n=setTimeout(()=>{s(Error("timeout"))},3e3);break;case"done":clearTimeout(n),a(e.data.response);break;default:clearTimeout(c),clearTimeout(n),s(Error("invalid_response"))}}},this.handlers.add(i),o.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[o.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function tz(){return window}function tH(){return void 0!==tz().WorkerGlobalScope&&"function"==typeof tz().importScripts}async function tq(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}let t$="firebaseLocalStorageDb",tK="firebaseLocalStorage",tW="fbase_key";class tJ{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function tQ(e,t){return e.transaction([tK],t?"readwrite":"readonly").objectStore(tK)}function tY(){let e=indexedDB.open(t$,1);return new Promise((t,r)=>{e.addEventListener("error",()=>{r(e.error)}),e.addEventListener("upgradeneeded",()=>{let t=e.result;try{t.createObjectStore(tK,{keyPath:tW})}catch(e){r(e)}}),e.addEventListener("success",async()=>{let r=e.result;r.objectStoreNames.contains(tK)?t(r):(r.close(),await new tJ(indexedDB.deleteDatabase(t$)).toPromise(),t(await tY()))})})}async function tX(e,t,r){return new tJ(tQ(e,!0).put({[tW]:t,value:r})).toPromise()}async function tZ(e,t){let r=tQ(e,!1).get(t),n=await new tJ(r).toPromise();return void 0===n?null:n.value}function t0(e,t){return new tJ(tQ(e,!0).delete(t)).toPromise()}class t1{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await tY()),this.db}async _withRetries(e){let t=0;for(;;)try{let t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return tH()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=tU._getInstance(tH()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await tq(),!this.activeServiceWorker)return;this.sender=new tB(this.activeServiceWorker);let r=await this.sender._send("ping",{},800);r&&(null==(e=r[0])?void 0:e.fulfilled)&&(null==(t=r[0])?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null==(t=null==navigator?void 0:navigator.serviceWorker)?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await tY();return await tX(e,tD,"1"),await t0(e,tD),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>tX(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>tZ(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>t0(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>new tJ(tQ(e,!1).getAll()).toPromise());if(!e||0!==this.pendingWrites)return[];let t=[],r=new Set;if(0!==e.length)for(let{fbase_key:n,value:i}of e)r.add(n),JSON.stringify(this.localCache[n])!==JSON.stringify(i)&&(this.notifyListeners(n,i),t.push(n));for(let e of Object.keys(this.localCache))this.localCache[e]&&!r.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;let r=this.listeners[e];if(r)for(let e of Array.from(r))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}function t2(e,t){return C(e,"POST","/v2/accounts/mfaSignIn:start",O(e,t))}t1.type="LOCAL",e_("rcb"),new E(3e4,6e4);let t3="recaptcha";async function t4(e,t,r){var n;if(!e._getRecaptchaConfig())try{await eR(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let i;if(i="string"==typeof t?{phoneNumber:t}:t,"session"in i){let t=i.session;if("phoneNumber"in i){v("enroll"===t.type,e,"internal-error");let n={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},o=async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===eO){v((null==r?void 0:r.type)===t3,e,"argument-error");let n=await t6(e,t,r);return tO(e,n)}return tO(e,t)},a=eN(e,n,"mfaSmsEnrollment",o,"PHONE_PROVIDER");return(await a.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{v("signin"===t.type,e,"internal-error");let o=(null==(n=i.multiFactorHint)?void 0:n.uid)||i.multiFactorUid;v(o,e,"missing-multi-factor-info");let a={mfaPendingCredential:t.credential,mfaEnrollmentId:o,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},s=async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===eO){v((null==r?void 0:r.type)===t3,e,"argument-error");let n=await t6(e,t,r);return t2(e,n)}return t2(e,t)},u=eN(e,a,"mfaSmsSignIn",s,"PHONE_PROVIDER");return(await u.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{let t={phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"},n=async(e,t)=>{if(t.captchaResponse===eO){v((null==r?void 0:r.type)===t3,e,"argument-error");let n=await t6(e,t,r);return eQ(e,n)}return eQ(e,t)},o=eN(e,t,"sendVerificationCode",n,"PHONE_PROVIDER");return(await o.catch(e=>Promise.reject(e))).sessionInfo}}finally{null==r||r._reset()}}async function t6(e,t,r){v(r.type===t3,e,"argument-error");let n=await r.verify();v("string"==typeof n,e,"argument-error");let i=Object.assign({},t);if("phoneEnrollmentInfo"in i){let e=i.phoneEnrollmentInfo.phoneNumber,t=i.phoneEnrollmentInfo.captchaResponse,r=i.phoneEnrollmentInfo.clientType,o=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:n,captchaResponse:t,clientType:r,recaptchaVersion:o}}),i}if(!("phoneSignInInfo"in i))return Object.assign(i,{recaptchaToken:n}),i;{let e=i.phoneSignInInfo.captchaResponse,t=i.phoneSignInInfo.clientType,r=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:n,captchaResponse:e,clientType:t,recaptchaVersion:r}}),i}}class t5{constructor(e){this.providerId=t5.PROVIDER_ID,this.auth=eE(e)}verifyPhoneNumber(e,t){return t4(this.auth,e,(0,i.Ku)(t))}static credential(e,t){return e1._fromVerification(e,t)}static credentialFromResult(e){return t5.credentialFromTaggedObject(e)}static credentialFromError(e){return t5.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:r}=e;return t&&r?e1._fromTokenResponse(t,r):null}}function t8(e,t){return t?eo(t):(v(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}t5.PROVIDER_ID="phone",t5.PHONE_SIGN_IN_METHOD="phone";class t7 extends eF{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return eW(e,this._buildIdpRequest())}_linkToIdToken(e,t){return eW(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return eW(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function t9(e){return tu(e.auth,new t7(e),e.bypassAuthState)}function re(e){let{auth:t,user:r}=e;return v(r,t,"internal-error"),ts(r,new t7(e),e.bypassAuthState)}async function rt(e){let{auth:t,user:r}=e;return v(r,t,"internal-error"),to(r,new t7(e),e.bypassAuthState)}class rr{constructor(e,t,r,n,i=!1){this.auth=e,this.resolver=r,this.user=n,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:r,postBody:n,tenantId:i,error:o,type:a}=e;if(o)return void this.reject(o);let s={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:n||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(s))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return t9;case"linkViaPopup":case"linkViaRedirect":return rt;case"reauthViaPopup":case"reauthViaRedirect":return re;default:d(this.auth,"internal-error")}}resolve(e){var t,r;t=this.pendingPromise,r="Pending promise was never set",t||b(r),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){var t,r;t=this.pendingPromise,r="Pending promise was never set",t||b(r),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let rn=new E(2e3,1e4);async function ri(e,t,r){if((0,n.xZ)(e.app))return Promise.reject(f(e,"operation-not-supported-in-this-environment"));let i=eE(e);g(e,t,e4);let o=t8(i,r);return new ro(i,"signInViaPopup",t,o).executeNotNull()}class ro extends rr{constructor(e,t,r,n,i){super(e,t,n,i),this.provider=r,this.authWindow=null,this.pollId=null,ro.currentPopupAction&&ro.currentPopupAction.cancel(),ro.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return v(e,this.auth,"internal-error"),e}async onExecution(){var e,t;e=1===this.filter.length,t="Popup operations only handle one event",e||b(t);let r=tV();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],r),this.authWindow.associatedEvent=r,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(f(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null==(e=this.authWindow)?void 0:e.associatedEvent)||null}cancel(){this.reject(f(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ro.currentPopupAction=null}pollUserCancellation(){let e=()=>{var t,r;if(null==(r=null==(t=this.authWindow)?void 0:t.window)?void 0:r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(f(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,rn.get())};e()}}ro.currentPopupAction=null;let ra=new Map;class rs extends rr{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=ra.get(this.auth._key());if(!e){try{let t=await ru(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}ra.set(this.auth._key(),e)}return this.bypassAuthState||ra.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type)return void this.resolve(null);if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function ru(e,t){let r=rd(t),n=rh(e);if(!await n._isAvailable())return!1;let i=await n._get(r)==="true";return await n._remove(r),i}async function rc(e,t){return rh(e)._set(rd(t),"true")}function rl(e,t){ra.set(e._key(),t)}function rh(e){return eo(e._redirectPersistence)}function rd(e){return es("pendingRedirect",e.config.apiKey,e.name)}async function rf(e,t,r=!1){if((0,n.xZ)(e.app))return Promise.reject(m(e));let i=eE(e),o=t8(i,t),a=new rs(i,o,r),s=await a.execute();return s&&!r&&(delete s.user._redirectEventId,await i._persistUserIfCurrent(s.user),await i._setRedirectUser(null,t)),s}async function rp(e){let t=tV(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class rm{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ry(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!ry(e)){let n=(null==(r=e.error.code)?void 0:r.split("auth/")[1])||"internal-error";t.onError(f(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(rg(e))}saveEventToCache(e){this.cachedEventUids.add(rg(e)),this.lastProcessedEventTime=Date.now()}}function rg(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function ry({type:e,error:t}){return"unknown"===e&&(null==t?void 0:t.code)==="auth/no-auth-event"}async function rv(e,t={}){return C(e,"GET","/v1/projects",t)}let rb=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,rw=/^https?/;async function rS(e){if(e.config.emulator)return;let{authorizedDomains:t}=await rv(e);for(let e of t)try{if(function(e){let t=S(),{protocol:r,hostname:n}=new URL(t);if(e.startsWith("chrome-extension://")){let i=new URL(e);return""===i.hostname&&""===n?"chrome-extension:"===r&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===r&&i.hostname===n}if(!rw.test(r))return!1;if(rb.test(e))return n===e;let i=e.replace(/\./g,"\\.");return RegExp("^(.+\\."+i+"|"+i+")$","i").test(n)}(e))return}catch(e){}d(e,"unauthorized-domain")}let rx=new E(3e4,6e4);function rI(){let e=tz().___jsl;if(null==e?void 0:e.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}}let rE=null,rT=new E(5e3,15e3),rk={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},r_=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function rP(e){let t=await (rE=rE||new Promise((t,r)=>{var n,i,o,a;function s(){rI(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{rI(),r(f(e,"network-request-failed"))},timeout:rx.get()})}if(null==(i=null==(n=tz().gapi)?void 0:n.iframes)?void 0:i.Iframe)t(gapi.iframes.getContext());else if(null==(o=tz().gapi)?void 0:o.load)s();else{let t=e_("iframefcb");return tz()[t]=()=>{gapi.load?s():r(f(e,"network-request-failed"))},(a=`${ek.gapiScript}?onload=${t}`,ek.loadJS(a)).catch(e=>r(e))}}).catch(e=>{throw rE=null,e})),r=tz().gapi;return v(r,e,"internal-error"),t.open({where:document.body,url:function(e){let t=e.config;v(t.authDomain,e,"auth-domain-config-required");let r=t.emulator?T(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,o={apiKey:t.apiKey,appName:e.name,v:n.MF},a=r_.get(e.config.apiHost);a&&(o.eid=a);let s=e._getFrameworks();return s.length&&(o.fw=s.join(",")),`${r}?${(0,i.Am)(o).slice(1)}`}(e),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:rk,dontclear:!0},t=>new Promise(async(r,n)=>{await t.restyle({setHideOnLeave:!1});let i=f(e,"network-request-failed"),o=tz().setTimeout(()=>{n(i)},rT.get());function a(){tz().clearTimeout(o),r(t)}t.ping(a).then(a,()=>{n(i)})}))}let rA={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class rO{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}let rC=encodeURIComponent("fac");async function rD(e,t,r,o,a,s){v(e.config.authDomain,e,"auth-domain-config-required"),v(e.config.apiKey,e,"invalid-api-key");let u={apiKey:e.config.apiKey,appName:e.name,authType:r,redirectUrl:o,v:n.MF,eventId:a};if(t instanceof e4)for(let[r,n]of(t.setDefaultLanguage(e.languageCode),u.providerId=t.providerId||"",(0,i.Im)(t.getCustomParameters())||(u.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(s||{})))u[r]=n;if(t instanceof e6){let e=t.getScopes().filter(e=>""!==e);e.length>0&&(u.scopes=e.join(","))}for(let t of(e.tenantId&&(u.tid=e.tenantId),Object.keys(u)))void 0===u[t]&&delete u[t];let c=await e._getAppCheckToken(),l=c?`#${rC}=${encodeURIComponent(c)}`:"";return`${function({config:e}){return e.emulator?T(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${(0,i.Am)(u).slice(1)}${l}`}let rN="webStorageSupport";class rR{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=tM,this._completeRedirectFn=rf,this._overrideRedirectResult=rl}async _openPopup(e,t,r,n){var o,a,s;a=null==(o=this.eventManagers[e._key()])?void 0:o.manager,s="_initialize() not called before _openPopup()",a||b(s);let u=await rD(e,t,r,S(),n);return function(e,t,r,n=500,o=600){let a=Math.max((window.screen.availHeight-o)/2,0).toString(),s=Math.max((window.screen.availWidth-n)/2,0).toString(),u="",c=Object.assign(Object.assign({},rA),{width:n.toString(),height:o.toString(),top:a,left:s}),l=(0,i.ZQ)().toLowerCase();r&&(u=ed(l)?"_blank":r),el(l)&&(t=t||"http://localhost",c.scrollbars="yes");let h=Object.entries(c).reduce((e,[t,r])=>`${e}${t}=${r},`,"");if(function(e=(0,i.ZQ)()){var t;return ey(e)&&!!(null==(t=window.navigator)?void 0:t.standalone)}(l)&&"_self"!==u)return function(e,t){let r=document.createElement("a");r.href=e,r.target=t;let n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),r.dispatchEvent(n)}(t||"",u),new rO(null);let d=window.open(t||"",u,h);v(d,e,"popup-blocked");try{d.focus()}catch(e){}return new rO(d)}(e,u,tV())}async _openRedirect(e,t,r,n){var i;return await this._originValidation(e),i=await rD(e,t,r,S(),n),tz().location.href=i,new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){var r;let{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(r="If manager is not set, promise should be",n||b(r),n)}let n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){let t=await rP(e),r=new rm(e);return t.register("authEvent",t=>(v(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:r.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(rN,{type:rN},r=>{var n;let i=null==(n=null==r?void 0:r[0])?void 0:n[rN];void 0!==i&&t(!!i),d(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=rS(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return ev()||eh()||ey()}}class rL{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return b("unexpected MultiFactorSessionType")}}}class rj extends rL{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new rj(e)}_finalizeEnroll(e,t,r){return C(e,"POST","/v2/accounts/mfaEnrollment:finalize",O(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()}))}_finalizeSignIn(e,t){return C(e,"POST","/v2/accounts/mfaSignIn:finalize",O(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()}))}}class rF{constructor(){}static assertion(e){return rj._fromCredential(e)}}rF.FACTOR_ID="phone";class rG{static assertionForEnrollment(e,t){return rM._fromSecret(e,t)}static assertionForSignIn(e,t){return rM._fromEnrollmentId(e,t)}static async generateSecret(e){var t,r;v(void 0!==(null==(t=e.user)?void 0:t.auth),"internal-error");let n=await C(r=e.user.auth,"POST","/v2/accounts/mfaEnrollment:start",O(r,{idToken:e.credential,totpEnrollmentInfo:{}}));return rU._fromStartTotpMfaEnrollmentResponse(n,e.user.auth)}}rG.FACTOR_ID="totp";class rM extends rL{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new rM(t,void 0,e)}static _fromEnrollmentId(e,t){return new rM(t,e)}async _finalizeEnroll(e,t,r){return v(void 0!==this.secret,e,"argument-error"),C(e,"POST","/v2/accounts/mfaEnrollment:finalize",O(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)}))}async _finalizeSignIn(e,t){v(void 0!==this.enrollmentId&&void 0!==this.otp,e,"argument-error");let r={verificationCode:this.otp};return C(e,"POST","/v2/accounts/mfaSignIn:finalize",O(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r}))}}class rU{constructor(e,t,r,n,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=n,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new rU(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let n=!1;return(rV(e)||rV(t))&&(n=!0),n&&(rV(e)&&(e=(null==(r=this.auth.currentUser)?void 0:r.email)||"unknownuser"),rV(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function rV(e){return void 0===e||(null==e?void 0:e.length)===0}var rB="@firebase/auth",rz="1.10.8";class rH{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null==(e=this.auth.currentUser)?void 0:e.uid)||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){v(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}let rq=(0,i.XA)("authIdTokenMaxAge")||300,r$=null,rK=e=>async t=>{let r=t&&await t.getIdTokenResult(),n=r&&(new Date().getTime()-Date.parse(r.issuedAtTime))/1e3;if(n&&n>rq)return;let i=null==r?void 0:r.token;r$!==i&&(r$=i,await fetch(e,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function rW(e=(0,n.Sx)()){let t=(0,n.j6)(e,"auth");if(t.isInitialized())return t.getImmediate();let r=function(e,t){let r=(0,n.j6)(e,"auth");if(r.isInitialized()){let e=r.getImmediate(),n=r.getOptions();if((0,i.bD)(n,null!=t?t:{}))return e;d(e,"already-initialized")}return r.initialize({options:t})}(e,{popupRedirectResolver:rR,persistence:[t1,tL,tM]}),o=(0,i.XA)("authTokenSyncURL");if(o&&"boolean"==typeof isSecureContext&&isSecureContext){let e=new URL(o,location.origin);if(location.origin===e.origin){let t=rK(e.toString());(0,i.Ku)(r).beforeAuthStateChanged(t,()=>t(r.currentUser)),(0,i.Ku)(r).onIdTokenChanged(e=>t(e),void 0,void 0)}}let a=(0,i.Tj)("auth");return a&&function(e,t,r){let n=eE(e);v(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");let o=eL(t),{host:a,port:s}=function(e){let t=eL(e),r=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!r)return{host:"",port:null};let n=r[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){let e=i[1];return{host:e,port:ej(n.substr(e.length+1))}}{let[e,t]=n.split(":");return{host:e,port:ej(t)}}}(t),u=null===s?"":`:${s}`,c={url:`${o}//${a}${u}/`},l=Object.freeze({host:a,port:s,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!n._canInitEmulator){v(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),v((0,i.bD)(c,n.config.emulator)&&(0,i.bD)(l,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=c,n.emulatorConfig=l,n.settings.appVerificationDisabledForTesting=!0,(0,i.zJ)(a)?((0,i.gE)(`${o}//${a}${u}`),(0,i.P1)("Auth",!0)):function(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(r,`http://${a}`),r}ek={loadJS:e=>new Promise((t,r)=>{let n=document.createElement("script");n.setAttribute("src",e),n.onload=t,n.onerror=e=>{let t=f("internal-error");t.customData=e,r(t)},n.type="text/javascript",n.charset="UTF-8",(function(){var e,t;return null!=(t=null==(e=document.getElementsByTagName("head"))?void 0:e[0])?t:document})().appendChild(n)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},function(e){(0,n.om)(new s.uA("auth",(t,{options:r})=>{let n=t.getProvider("app").getImmediate(),i=t.getProvider("heartbeat"),o=t.getProvider("app-check-internal"),{apiKey:a,authDomain:s}=n.options;v(a&&!a.includes(":"),"invalid-api-key",{appName:n.name});let u=new eI(n,i,o,{apiKey:a,authDomain:s,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:eb(e)}),c=(null==r?void 0:r.persistence)||[],l=(Array.isArray(c)?c:[c]).map(eo);return(null==r?void 0:r.errorMap)&&u._updateErrorMap(r.errorMap),u._initializeWithPersistence(l,null==r?void 0:r.popupRedirectResolver),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),(0,n.om)(new s.uA("auth-internal",e=>new rH(eE(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,n.KO)(rB,rz,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(e)),(0,n.KO)(rB,rz,"esm2017")}("Browser")},3866:(e,t,r)=>{"use strict";r.d(t,{t:()=>n});let n=(0,r(4232).createContext)(null)},3885:(e,t,r)=>{"use strict";r.d(t,{xQ:()=>o});var n=r(4232),i=r(3866);function o(e=!0){let t=(0,n.useContext)(i.t);if(null===t)return[!0,null];let{isPresent:r,onExitComplete:a,register:s}=t,u=(0,n.useId)();(0,n.useEffect)(()=>{if(e)return s(u)},[e]);let c=(0,n.useCallback)(()=>e&&a&&a(u),[u,a,e]);return!r&&a?[!1,c]:[!0]}},4277:(e,t,r)=>{"use strict";r.r(t),r.d(t,{useGameStore:()=>G});var n=r(8106),i=r(4536),o=r(9045),a=r(8517),s=r(3649),u=r(6333),c=r(4415),l=r(7044);r(415);var h=r(132),d=r(8310),f=r(2322),p=r(6602),m=r(5519),g=r(2009),y=r(3558),v=r(2604),b=r(4319);function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(){S=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(t,r,n,o){var a,s,u,c,l=Object.create((r&&r.prototype instanceof g?r:g).prototype);return i(l,"_invoke",{value:(a=t,s=n,u=new A(o||[]),c=d,function(t,r){if(c===f)throw Error("Generator is already running");if(c===p){if("throw"===t)throw r;return{value:e,done:!0}}for(u.method=t,u.arg=r;;){var n=u.delegate;if(n){var i=function t(r,n){var i=n.method,o=r.iterator[i];if(o===e)return n.delegate=null,"throw"===i&&r.iterator.return&&(n.method="return",n.arg=e,t(r,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+i+"' method")),m;var a=h(o,r.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,m;var s=a.arg;return s?s.done?(n[r.resultName]=s.value,n.next=r.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):s:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,m)}(n,u);if(i){if(i===m)continue;return i}}if("next"===u.method)u.sent=u._sent=u.arg;else if("throw"===u.method){if(c===d)throw c=p,u.arg;u.dispatchException(u.arg)}else"return"===u.method&&u.abrupt("return",u.arg);c=f;var o=h(a,s,u);if("normal"===o.type){if(c=u.done?p:"suspendedYield",o.arg===m)continue;return{value:o.arg,done:u.done}}"throw"===o.type&&(c=p,u.method="throw",u.arg=o.arg)}})}),l}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var d="suspendedStart",f="executing",p="completed",m={};function g(){}function y(){}function v(){}var b={};c(b,a,function(){return this});var x=Object.getPrototypeOf,I=x&&x(x(O([])));I&&I!==r&&n.call(I,a)&&(b=I);var E=v.prototype=g.prototype=Object.create(b);function T(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function k(e,t){var r;i(this,"_invoke",{value:function(i,o){function a(){return new t(function(r,a){!function r(i,o,a,s){var u=h(e[i],e,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==w(l)&&n.call(l,"__await")?t.resolve(l.__await).then(function(e){r("next",e,a,s)},function(e){r("throw",e,a,s)}):t.resolve(l).then(function(e){c.value=e,a(c)},function(e){return r("throw",e,a,s)})}s(u.arg)}(i,o,r,a)})}return r=r?r.then(a,a):a()}})}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function O(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw TypeError(w(t)+" is not iterable")}return y.prototype=v,i(E,"constructor",{value:v,configurable:!0}),i(v,"constructor",{value:y,configurable:!0}),y.displayName=c(v,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,c(e,u,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},T(k.prototype),c(k.prototype,s,function(){return this}),t.AsyncIterator=k,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new k(l(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},T(E),c(E,u,"Generator"),c(E,a,function(){return this}),c(E,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function x(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(n,i)}function I(e){return function(e){if(Array.isArray(e))return E(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return E(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return E(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T(Object(r),!0).forEach(function(t){_(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function _(e,t,r){var n;return(n=function(e,t){if("object"!==w(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==w(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"),(t="symbol"===w(n)?n:String(n))in e)?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}(0,g.getFirestore)(m.xv);var P={berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0},A={1:"",2:"",3:"",4:""},O=function(e,t){var r,n,i;return{activeGameId:void 0,currentPlayer:e,startingPlayer:e,initialStartingPlayer:e,isGameStarted:!1,currentRound:1,weisPoints:{top:0,bottom:0},jassPoints:{top:0,bottom:0},scores:{top:0,bottom:0},striche:{top:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0},bottom:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0}},roundHistory:[],currentRoundWeis:[],isGameCompleted:!1,isRoundCompleted:!1,scoreSettings:null!=(r=null==t?void 0:t.scoreSettings)?r:d.$d,farbeSettings:null!=(n=null==t?void 0:t.farbeSettings)?n:h.FT,strokeSettings:null!=(i=null==t?void 0:t.strokeSettings)?i:l.zh,playerNames:A,gamePlayers:null,currentHistoryIndex:-1,historyState:(0,a._9)(),farbe:void 0,isTransitioning:!1}},C=function(e,t,r,n,i){var o,a,u,c=s.useUIStore.getState().settings,l=(null==i?void 0:i.cardStyle)||c.cardStyle,h=Date.now(),d=(null==(o=e.gamePlayers)||null==(o=o[n])?void 0:o.name)||e.playerNames[n]||"Spieler ".concat(n),f=void 0;e.roundHistory.length>0&&e.currentHistoryIndex>=0&&(f=null==(u=e.roundHistory[e.currentHistoryIndex])?void 0:u.roundId);var p=e.roundHistory[e.currentHistoryIndex],m=p?p.timestamp:void 0,g=[];e.currentPlayer&&g.push({player:e.currentPlayer,startTime:m||h-5e3,endTime:h});var y={id:"".concat(h,"-").concat(Math.random().toString(36).substr(2,9)),timestamp:h,roundId:h,startingPlayer:n,startingPlayerName:d,weisPoints:k({},e.weisPoints),jassPoints:k({},e.jassPoints),scores:k({},e.scores),weisActions:I(null!=(a=e.currentRoundWeis)?a:[]),currentPlayer:e.currentPlayer,isActive:!0,visualStriche:{top:t().getVisualStriche("top"),bottom:t().getVisualStriche("bottom")},previousRoundId:f,nextRoundId:void 0,roundState:{roundNumber:e.currentRound,nextPlayer:e.currentPlayer},striche:{top:k({},e.striche.top),bottom:k({},e.striche.bottom)},startTime:m||h-5e3,endTime:h,playerTurns:g};if("weis"===r)return k(k({},y),{},{actionType:"weis",isRoundFinalized:!1,isCompleted:!1});var v=k(k({},y),{},{actionType:"jass",isRoundFinalized:!0,isCompleted:!0,farbe:null==i?void 0:i.farbe,cardStyle:l});return null!=i&&i.strichInfo?v.strichInfo=i.strichInfo:null!=i&&i.strichType&&(v.strichType=i.strichType),v},D=function(e){return Math.max(0,e)},N=function(e,t){var n=e.currentHistoryIndex,i=[].concat(I(e.roundHistory.slice(0,n+1)),[t]),o=e.roundHistory.slice(n+1);if(o.length>0&&e.activeGameId){var a=o.map(function(e){return e.roundId}).filter(function(e){return void 0!==e});a.length>0?(console.log("[truncateFutureAndAddEntry] ".concat(a.length," Eintr\xe4ge (IDs: ").concat(a.join(", "),") werden in Firestore als inaktiv markiert")),setTimeout(function(){Promise.resolve().then(r.bind(r,3558)).then(function(t){(0,t.markRoundsAsInactive)(e.activeGameId,a).catch(function(e){return console.error("[GameStore] Fehler beim Deaktivieren der \xfcberschriebenen Runden:",e)})})},0)):console.log("[truncateFutureAndAddEntry] Keine g\xfcltigen roundIds zum Deaktivieren gefunden.")}return i.length>F&&i.splice(0,i.length-F),{roundHistory:i,currentHistoryIndex:i.length-1}},R=function(e,t){var r,n,i;return e?{currentRound:e.roundState.roundNumber,currentPlayer:e.roundState.nextPlayer,startingPlayer:e.startingPlayer,weisPoints:null!=(r=e.weisPoints)?r:{top:0,bottom:0},jassPoints:null!=(n=e.jassPoints)?n:{top:0,bottom:0},scores:e.scores,striche:e.striche,currentRoundWeis:null!=(i=e.weisActions)?i:[],isRoundCompleted:e.isCompleted}:{currentRound:1,currentPlayer:t().initialStartingPlayer,weisPoints:{top:0,bottom:0},jassPoints:{top:0,bottom:0},scores:{top:0,bottom:0},striche:{top:k({},P),bottom:k({},P)},currentRoundWeis:[],isRoundCompleted:!1}},L=function(e,t){return e.striche.top[t]>0?"top":e.striche.bottom[t]>0?"bottom":void 0},j=function(e){var t=i.useJassStore.getState(),r=t.getCurrentGame();if(r){var n=e.weisPoints;t.updateCurrentGame({teams:{top:k(k({},r.teams.top),{},{striche:e.striche.top,jassPoints:e.scores.top,weisPoints:(r.teams.top.weisPoints||0)+((null==n?void 0:n.top)||0),total:e.scores.top}),bottom:k(k({},r.teams.bottom),{},{striche:e.striche.bottom,jassPoints:e.scores.bottom,weisPoints:(r.teams.bottom.weisPoints||0)+((null==n?void 0:n.bottom)||0),total:e.scores.bottom})},roundHistory:e.roundHistory,currentRound:e.currentRound+1,currentPlayer:e.currentPlayer})}},F=50,G=(0,n.v)()((0,b.lt)(function(e,t){return k(k({},O(1)),{},{gamePlayers:null,playerNames:{1:"Spieler 1",2:"Spieler 2",3:"Spieler 3",4:"Spieler 4"},scoreSettings:d.$d,farbeSettings:h.FT,strokeSettings:l.zh,activeGameId:void 0,isTransitioning:!1,startGame:function(r,n){console.log("\uD83D\uDE80 [GameStore] startGame called (wird ggf. durch resetGame abgel\xf6st)",{initialStartingPlayer:n,gamePlayers:r,activeGameId:t().activeGameId}),e(function(e){var t=k(k({},O(n,{scoreSettings:e.scoreSettings,farbeSettings:e.farbeSettings,strokeSettings:e.strokeSettings})),{},{playerNames:e.playerNames,gamePlayers:r,activeGameId:e.activeGameId,isGameStarted:!0}),i=window.__FIRESTORE_SYNC_API__;return null!=i&&i.markLocalUpdate&&i.markLocalUpdate(),t}),c.useTimerStore.getState().startGameTimer()},startRound:function(){var r=t(),n=c.useTimerStore.getState();1===r.currentRound&&n.startGameTimer(),n.startRoundTimer(),e(function(){return{isRoundCompleted:!1,farbe:void 0,currentRoundWeis:[],weisPoints:{top:0,bottom:0}}})},finalizeRound:function(n,i){var o=c.useTimerStore.getState(),u=t().activeGameId,h=s.useUIStore.getState().settings;t().validateHistoryAction(),o.resetRoundTimer(),o.startRoundTimer();var p=null,m=null,b=null;e(function(e){f.Q5.getState().currentGroup,s.useUIStore.getState(),null!=e.strokeSettings||l.zh,null!=e.scoreSettings||d.$d;var r,o,c,g,y=e.currentPlayer,v=e.currentHistoryIndex>=0?e.roundHistory[e.currentHistoryIndex]:null,w=v?v.scores:{top:0,bottom:0},S=e.currentRound+1,x=(null!=(c=e.currentRoundWeis)?c:[]).reduce(function(e,t){return e[t.position]=(e[t.position]||0)+t.points,e},{top:0,bottom:0}),I=k({},e.striche),E=void 0;if(i){var T=i.team,_=i.type;if(E={team:T,type:_},"matsch"===_)I[T]=k(k({},I[T]),{},{matsch:I[T].matsch+1});else if("kontermatsch"===_){var P=f.Q5.getState().currentGroup,A=s.useUIStore.getState(),O=P&&null!==P.strokeSettings&&void 0!==P.strokeSettings?P.strokeSettings:A.strokeSettings;console.log("[GameStore.finalizeRound] Kontermatsch mit Stroke-Settings:",{team:T,kontermatschValue:O.kontermatsch,currentValue:I[T].kontermatsch,newTotal:I[T].kontermatsch+O.kontermatsch,source:P?"group":"uiStore"}),I[T]=k(k({},I[T]),{},{kontermatsch:I[T].kontermatsch+O.kontermatsch})}else if("schneider"===_){var D=f.Q5.getState().currentGroup,R=s.useUIStore.getState(),L=D&&null!==D.strokeSettings&&void 0!==D.strokeSettings?D.strokeSettings:R.strokeSettings;console.log("[GameStore.finalizeRound] Schneider mit Stroke-Settings:",{team:T,schneiderValue:L.schneider,currentValue:I[T].schneider,newTotal:I[T].schneider+L.schneider,source:D?"group":"uiStore"}),I[T]=k(k({},I[T]),{},{schneider:I[T].schneider+L.schneider})}}var j={top:w.top+n.top+x.top,bottom:w.bottom+n.bottom+x.bottom},F=(0,a.vm)(y),G=k(k({},e),{},{scores:j,striche:I,weisPoints:x,currentRoundWeis:e.currentRoundWeis,currentRound:S,currentPlayer:F,jassPoints:n,roundHistory:e.roundHistory||[],currentHistoryIndex:null!=(g=e.currentHistoryIndex)?g:-1,historyState:e.historyState||(0,a._9)(),playerNames:e.playerNames,gamePlayers:e.gamePlayers,activeGameId:e.activeGameId,initialStartingPlayer:e.initialStartingPlayer,isGameStarted:e.isGameStarted,isGameCompleted:e.isGameCompleted,scoreSettings:e.scoreSettings,farbeSettings:e.farbeSettings,strokeSettings:e.strokeSettings}),M=C(G,t,"jass",y,{farbe:e.farbe,strichInfo:E,cardStyle:h.cardStyle}),U=N(e,M);return b=k(k({},e),{},{scores:j,striche:I,weisPoints:x,currentRoundWeis:e.currentRoundWeis,isRoundCompleted:!0,currentRound:S,currentPlayer:F,startingPlayer:y,jassPoints:n,roundHistory:U.roundHistory,currentHistoryIndex:U.currentHistoryIndex,historyState:e.historyState||(0,a._9)(),playerNames:G.playerNames,gamePlayers:G.gamePlayers,activeGameId:u,initialStartingPlayer:G.initialStartingPlayer,isGameStarted:G.isGameStarted,isGameCompleted:G.isGameCompleted,scoreSettings:G.scoreSettings,farbeSettings:G.farbeSettings,strokeSettings:G.strokeSettings}),p=k(k({},e),{},{scores:j,striche:I,weisPoints:{top:0,bottom:0},currentRoundWeis:[],isRoundCompleted:!0,currentRound:S+1,currentPlayer:F,startingPlayer:F},U),m=M,p});var w=t();b?j(b):(console.warn("[GameStore.finalizeRound] stateForJassStoreSyncInternal war nicht gesetzt. Sync mit potenziell falschem State."),j(w)),u&&setTimeout(function(){null!=(e=window.__FIRESTORE_SYNC_API__)&&e.markLocalUpdate&&window.__FIRESTORE_SYNC_API__.markLocalUpdate();var e,n=t(),i={scores:n.scores,weisPoints:n.weisPoints,currentRound:n.currentRound,currentPlayer:n.currentPlayer,startingPlayer:n.startingPlayer,striche:n.striche,isRoundCompleted:n.isRoundCompleted,currentJassPoints:n.jassPoints,currentRoundWeis:n.currentRoundWeis,lastUpdated:(0,g.serverTimestamp)()},o=(0,v.g)(i);(0,y.updateActiveGame)(u,o).catch(function(e){return console.error("[GameStore.finalizeRound] Firestore update failed:",e)}),m&&Promise.resolve().then(r.bind(r,3558)).then(function(e){var t=e.saveRoundToFirestore;m&&t(u,m).catch(function(e){return console.error("[GameStore.finalizeRound] Round save failed:",e)})})},0),o.resetRoundTimer(),o.startRoundTimer()},updateScore:function(t,r,n){e(function(e){var i=k({},e.scores);return i[t]=D(r),i["top"===t?"bottom":"top"]=D(n),{scores:i}})},addStrich:function(t,r){e(function(e){var n=k(k({},e.striche[t]),{},_({},r,e.striche[t][r]+1));return i.useJassStore.getState().updateCurrentGame({teams:_({},t,{striche:n})}),console.log("\uD83C\uDFB2 Strich hinzugef\xfcgt:",{team:t,type:r,newValue:n[r],allStriche:n}),k(k({},e),{},{striche:k(k({},e.striche),{},_({},t,n))})})},addWeisPoints:function(r,n){var i=t();if(i.currentHistoryIndex<i.roundHistory.length-1)return void(0,s.useUIStore.getState().showHistoryWarning)({message:"Weis wirklich korrigieren? Sp\xe4tere Eintr\xe4ge werden \xfcberschrieben.",onConfirm:function(){var i=null;e(function(e){var i=k({},e.weisPoints);i[r]=(i[r]||0)+n;var o=[].concat(I(e.currentRoundWeis||[]),[{position:r,points:n}]),a=C(k(k({},e),{},{weisPoints:i,currentRoundWeis:o}),t,"weis",e.startingPlayer),s=N(e,a);return k(k({},e),{},{weisPoints:i,currentRoundWeis:o},s)})},onCancel:function(){return t().jumpToLatest()},type:"error"});var o=null;e(function(e){var i=k({},e.weisPoints);i[r]=(i[r]||0)+n;var a=[].concat(I(e.currentRoundWeis||[]),[{position:r,points:n}]),s=C(k(k({},e),{},{weisPoints:i,currentRoundWeis:a}),t,"weis",e.startingPlayer),u=N(e,s);return o=k(k({},e),{},{weisPoints:i,currentRoundWeis:a},u)})},undoLastWeis:function(){var t=null;e(function(e){var t=e.currentRoundWeis.slice(0,-1),r={top:0,bottom:0};return t.forEach(function(e){r[e.position]+=e.points}),k(k({},e),{},{currentRoundWeis:t,weisPoints:r})})},finalizeGame:function(){e(function(){return{isGameCompleted:!0,isTransitioning:!0}})},resetGame:function(t,r,n){var o,a;(o=S().mark(function e(){var t,r,n,o,a,u,c,y,v,b,w,x,I;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=p.yu.getState().currentTournamentInstance,n=f.Q5.getState().currentGroup,o=s.useUIStore.getState(),!(null!=r&&r.settings)){e.next=1;break}return e.abrupt("return",{scoreSettings:r.settings.scoreSettings||d.$d,strokeSettings:r.settings.strokeSettings||l.zh,farbeSettings:r.settings.farbeSettings||h.FT,source:"tournament"});case 1:if(!n){e.next=2;break}return e.abrupt("return",{scoreSettings:n.scoreSettings||d.$d,strokeSettings:n.strokeSettings||l.zh,farbeSettings:n.farbeSettings||h.FT,source:"group"});case 2:if(!(a=null==(t=i.useJassStore.getState().currentSession)?void 0:t.id)){e.next=8;break}return e.prev=3,u=(0,g.getFirestore)(m.xv),c=(0,g.doc)(u,"sessions",a),e.next=4,(0,g.getDoc)(c);case 4:if(!(y=e.sent).exists()||!(b=(v=y.data()).groupId||v.gruppeId)){e.next=6;break}return console.log("[gameStore] resetGame: currentGroup ist leer, lade Gruppen-Settings aus Firestore f\xfcr Gruppe ".concat(b)),w=(0,g.doc)(u,"groups",b),e.next=5,(0,g.getDoc)(w);case 5:if(!(x=e.sent).exists()){e.next=6;break}return I=x.data(),e.abrupt("return",{scoreSettings:I.scoreSettings||d.$d,strokeSettings:I.strokeSettings||l.zh,farbeSettings:I.farbeSettings||h.FT,source:"group-firestore"});case 6:e.next=8;break;case 7:e.prev=7,console.warn("[gameStore] resetGame: Fehler beim Laden der Gruppen-Settings aus Firestore:",e.catch(3));case 8:return e.abrupt("return",{scoreSettings:o.scoreSettings,strokeSettings:o.strokeSettings,farbeSettings:o.farbeSettings,source:"uiStore"});case 9:case"end":return e.stop()}},e,null,[[3,7]])}),a=function(){var e=this,t=arguments;return new Promise(function(r,n){var i=o.apply(e,t);function a(e){x(i,r,n,a,s,"next",e)}function s(e){x(i,r,n,a,s,"throw",e)}a(void 0)})},function(){return a.apply(this,arguments)})().then(function(n){e(function(e){var i=e.playerNames,o=e.gamePlayers;return k(k({},O(t)),{},{scoreSettings:n.scoreSettings,strokeSettings:n.strokeSettings,farbeSettings:n.farbeSettings,playerNames:i,gamePlayers:o,activeGameId:r,roundHistory:[],currentHistoryIndex:-1,isGameStarted:!!r,isTransitioning:!1})})}).catch(function(n){console.error("[gameStore] resetGame: Fehler bei Settings-Ermittlung:",n),e(function(e){var n=e.playerNames,i=e.gamePlayers,o=s.useUIStore.getState();return k(k({},O(t)),{},{scoreSettings:o.scoreSettings,strokeSettings:o.strokeSettings,farbeSettings:o.farbeSettings,playerNames:n,gamePlayers:i,activeGameId:r,roundHistory:[],currentHistoryIndex:-1,isGameStarted:!!r,isTransitioning:!1})})})},resetGamePoints:function(){e(function(){return{scores:{top:0,bottom:0}}})},setScore:function(t,r){e(function(e){var n=k({},e.scores);return n[t]=D(r),{scores:n}})},setPlayerNames:function(t){e(function(){return{playerNames:t}})},updateScoreByStrich:function(n,i){var o=t();if(o.currentHistoryIndex<o.roundHistory.length-1){var a=s.useUIStore.getState().showHistoryWarning;console.log("[GameStore.updateScoreByStrich] History warning triggered."),a({message:u.W,onConfirm:function(){console.log("[GameStore.updateScoreByStrich] Executing action after history warning confirmation (overwrite)");var o=null;e(function(e){var r=k({},e.scores);r[n]+=i;var a=C(k(k({},e),{},{scores:r}),t,"jass",e.startingPlayer),s=N(e,a);return console.log("[GameStore.updateScoreByStrich] History overwritten. New state:",{currentIndex:(o=k(k({},e),{},{scores:r},s)).currentHistoryIndex,historyLength:o.roundHistory.length,scores:o.scores[n]}),o}),setTimeout(function(){null!=(e=window.__FIRESTORE_SYNC_API__)&&e.markLocalUpdate?window.__FIRESTORE_SYNC_API__.markLocalUpdate():console.warn("[GameStore.updateScoreByStrich.onConfirm] markLocalUpdate API not available!");var e,n=t(),i=n.activeGameId;if(i){var o={scores:n.scores},a=(0,v.g)(o);if((0,y.updateActiveGame)(i,a).catch(console.error),n.roundHistory.length>0){var s=n.roundHistory[n.roundHistory.length-1];Promise.resolve().then(r.bind(r,3558)).then(function(e){(0,e.saveRoundToFirestore)(i,s).catch(console.error)})}}},0)},onCancel:function(){return t().jumpToLatest()},type:"error"});return}console.log("[GameStore.updateScoreByStrich] No history warning needed, proceeding with normal state update.");var c=null;e(function(e){var r=k({},e.scores);r[n]+=i;var o=C(k(k({},e),{},{scores:r}),t,"jass",e.startingPlayer),a=N(e,o);return console.log("[GameStore.updateScoreByStrich] Normal score updated by strich:",{currentIndex:(c=k(k({},e),{},{scores:r},a)).currentHistoryIndex,historyLength:c.roundHistory.length,scores:c.scores[n]}),c}),setTimeout(function(){null!=(e=window.__FIRESTORE_SYNC_API__)&&e.markLocalUpdate?window.__FIRESTORE_SYNC_API__.markLocalUpdate():console.warn("[GameStore.updateScoreByStrich] markLocalUpdate API not available!");var e,n=t(),i=n.activeGameId;if(i){var o={scores:n.scores},a=(0,v.g)(o);if((0,y.updateActiveGame)(i,a).catch(console.error),n.roundHistory.length>0){var s=n.roundHistory[n.roundHistory.length-1];Promise.resolve().then(r.bind(r,3558)).then(function(e){(0,e.saveRoundToFirestore)(i,s).catch(console.error)})}}},0)},getVisualStriche:function(e){var r=t().scores[e],n=(0,o.J)(r),i=n.striche,a=n.restZahl;return{stricheCounts:{20:i["20"],50:i["50"],100:i["100"]},restZahl:a}},navigateHistory:function(r){var n,i,o=t();Date.now();var a=o.currentHistoryIndex,u=-1,c=null,l=0,h=o.roundHistory.length+1;do{if(l++,(a="forward"===r?a+1:a-1)<-1||a>=o.roundHistory.length){console.warn("[navigateHistory] Index out of bounds: ".concat(a,", L\xe4nge: ").concat(o.roundHistory.length,". Stopping navigation.")),s.useUIStore.setState({isNavigatingHistory:!1});return}if(c=a>=0?o.roundHistory[a]:null,-1===a||c&&(void 0===c.isActive||!0===c.isActive)){u=a;break}console.log("[navigateHistory] Skipping inactive entry at index: ".concat(a))}while(l<h);if(-1===u&&l>=h){console.error("[navigateHistory] Max attempts reached, could not find active entry. Stopping."),s.useUIStore.setState({isNavigatingHistory:!1});return}e(k(k({},R(c,function(){return o})),{},{currentHistoryIndex:u,weisPoints:{top:0,bottom:0},currentRoundWeis:[]})),console.log("[navigateHistory] Local state updated for index ".concat(u,". Target round: ").concat(null!=(n=null==(i=c)?void 0:i.roundState.roundNumber)?n:"Initial")),s.useUIStore.setState({isNavigatingHistory:!1}),console.log("[navigateHistory] Local navigation complete. UIStore Flag isNavigatingHistory SET to FALSE.")},canNavigateForward:function(){var e=t();return e.currentHistoryIndex<e.roundHistory.length-1},canNavigateBackward:function(){return t().currentHistoryIndex>-1},jumpToLatest:function(){e(function(e){var t=e.roundHistory.length-1;if(t===e.currentHistoryIndex)return e;var r=e.roundHistory[t];if(!r)return e;var n=k(k({},e),{},{currentRound:r.roundState.roundNumber,currentPlayer:r.roundState.nextPlayer,weisPoints:r.weisPoints,jassPoints:r.jassPoints,scores:r.scores,striche:r.striche,currentRoundWeis:r.weisActions,currentHistoryIndex:t,historyState:{lastNavigationTimestamp:Date.now(),weisCache:null},isRoundCompleted:r.isCompleted});"jass"===r.actionType&&(n=k(k({},n),{},{weisPoints:{top:0,bottom:0},currentRoundWeis:[]}),console.log("[jumpToLatest] Resetting weisPoints/currentRoundWeis for restored Jass entry."));var o=c.useTimerStore.getState(),a=i.useJassStore.getState();return o.reactivateGameTimer(a.currentGameId),j(n),n})},syncHistoryState:function(t){e(function(e){return k(k({},e),{},{roundHistory:[].concat(I(e.roundHistory),[t]),currentHistoryIndex:e.roundHistory.length,historyState:{isNavigating:!1,lastNavigationTimestamp:Date.now()}})})},logGameHistory:function(){return t().roundHistory.filter(function(e){return e.isRoundFinalized}).map(function(e){return{roundId:e.roundId,farbe:"jass"===e.actionType?e.farbe:void 0,strichInfo:"jass"===e.actionType?e.strichInfo:void 0,timestamp:new Date(e.timestamp).toLocaleString("de-CH"),points:{top:e.jassPoints.top,bottom:e.jassPoints.bottom},weisPoints:{top:e.weisPoints.top,bottom:e.weisPoints.bottom},totalPoints:{top:e.scores.top,bottom:e.scores.bottom}}})},restoreRoundState:function(t){e(function(e){return k(k({},e),{},{currentRound:t.roundState.roundNumber,currentPlayer:t.roundState.nextPlayer})})},isBergActive:function(e){return t().striche[e].berg>0},isSiegActive:function(e){return t().striche[e].sieg>0},addBerg:function(r){var n=null;e(function(e){var t,i=s.useUIStore.getState().scoreSettings;if(!(null!=i&&null!=(t=i.enabled)&&t.berg))return e;var o=L(e,"berg"),a=k({},e.striche);o===r?a[r].berg=0:o||(a[r].berg=1,a["top"===r?"bottom":"top"].berg=0);var u=k(k({},e),{},{striche:a});return j(u),n=u,u});var i=t();if(i.activeGameId){null!=(o=window.__FIRESTORE_SYNC_API__)&&o.markLocalUpdate?window.__FIRESTORE_SYNC_API__.markLocalUpdate():console.warn("[GameStore.addBerg] markLocalUpdate API not available!");var o,a=i.activeGameId,u={striche:i.striche,lastUpdated:(0,g.serverTimestamp)()},c=(0,v.g)(u);(0,y.updateActiveGame)(a,c).catch(function(e){return console.error("[GameStore.addBerg] Firestore update failed.",e)})}else n&&console.warn("[GameStore.addBerg] activeGameId fehlte im State nach get(), verwende alten finalState f\xfcr Log, falls vorhanden. Firestore-Update \xfcbersprungen.",{oldFinalState:n})},addSieg:function(r){var n=!1;if(e(function(e){var t=f.Q5.getState().currentGroup,i=s.useUIStore.getState(),o=t&&null!==t.scoreSettings&&void 0!==t.scoreSettings?t.scoreSettings:i.scoreSettings,a=t&&null!==t.strokeSettings&&void 0!==t.strokeSettings?t.strokeSettings:i.strokeSettings,u=L(e,"sieg"),c=!o.enabled.berg||e.striche.top.berg>0||e.striche.bottom.berg>0,l=k({},e.striche);if(u===r){l[r]=k(k({},l[r]),{},{sieg:0,schneider:0});var h={striche:l};return j(k(k({},e),h)),n=!0,h}if(!u&&c){var d="top"===r?"bottom":"top";l[r]=k(k({},l[r]),{},{sieg:2}),l[d]=k(k({},l[d]),{},{sieg:0,schneider:0}),o.enabled.schneider&&e.scores[d]<o.values.schneider?l[r].schneider=a.schneider:l[r].schneider=0;var p={striche:l};return j(k(k({},e),p)),n=!0,p}if(JSON.stringify(e.striche)===JSON.stringify(l))return{};n=!0;var m=k(k({},e),{},{striche:l});return j(m),m}),n){var i=t();if(i.activeGameId){null!=(o=window.__FIRESTORE_SYNC_API__)&&o.markLocalUpdate?window.__FIRESTORE_SYNC_API__.markLocalUpdate():console.warn("[GameStore.addSieg] markLocalUpdate API not available!");var o,a=i.activeGameId,u={striche:i.striche,lastUpdated:(0,g.serverTimestamp)()},c=(0,v.g)(u);(0,y.updateActiveGame)(a,c).catch(function(e){return console.error("[GameStore.addSieg] Firestore update failed.",e)})}else console.warn("[GameStore.addSieg] Striche changed but activeGameId missing, skipping Firestore update.")}},addSchneider:function(t){var r=null;e(function(e){var r,n,i=f.Q5.getState().currentGroup,o=s.useUIStore.getState(),a=null!=(r=null==i?void 0:i.scoreSettings)?r:o.scoreSettings,u=null!=(n=null==i?void 0:i.strokeSettings)?n:o.strokeSettings;if(console.log("\uD83C\uDFB2 Settings beim Schneider:",{activeScoreSettings:a,activeStrokeSettings:u,team:t,currentStriche:e.striche[t]}),1!==e.striche[t].sieg)return console.log("Kein Sieg vorhanden, Schneider nicht hinzugef\xfcgt."),e;var c="top"===t?"bottom":"top",l=e.scores[c],h=a.enabled.schneider&&l<a.values.schneider;console.log("Schneider Pr\xfcfung:",{isSchneider:h,otherTeamPoints:l,limit:a.values.schneider,enabled:a.enabled.schneider});var d=h?u.schneider:0;if(e.striche[t].schneider===d)return console.log("Schneider-Status unver\xe4ndert."),e;var p=k(k({},e),{},{striche:k(k({},e.striche),{},_(_({},t,k(k({},e.striche[t]),{},{schneider:d})),c,k(k({},e.striche[c]),{},{schneider:0})))});return j(p),p})},addMatsch:function(n){var i=t();if(i.currentHistoryIndex<i.roundHistory.length-1){var o=s.useUIStore.getState().showHistoryWarning;console.log("[GameStore.addMatsch] History warning triggered."),o({message:"M\xf6chten Sie wirklich einen Matsch in der Vergangenheit hinzuf\xfcgen?",onConfirm:function(){console.log("[GameStore.addMatsch] Executing action after history warning confirmation (overwrite)");var i=null;e(function(e){var r=k(k({},e.striche),{},_({},n,k(k({},e.striche[n]),{},{matsch:e.striche[n].matsch+1}))),o=C(k(k({},e),{},{striche:r}),t,"jass",e.startingPlayer,{strichInfo:{team:n,type:"matsch"}}),a=N(e,o);return console.log("[GameStore.addMatsch] History overwritten. New state:",{currentIndex:(i=k(k({},e),{},{striche:r},a)).currentHistoryIndex,historyLength:i.roundHistory.length,striche:i.striche[n].matsch}),i}),setTimeout(function(){null!=(e=window.__FIRESTORE_SYNC_API__)&&e.markLocalUpdate?window.__FIRESTORE_SYNC_API__.markLocalUpdate():console.warn("[GameStore.addMatsch.onConfirm] markLocalUpdate API not available!");var e,n=t(),i=n.activeGameId;if(i){var o={striche:n.striche},a=(0,v.g)(o);if((0,y.updateActiveGame)(i,a).catch(console.error),n.roundHistory.length>0){var s=n.roundHistory[n.roundHistory.length-1];Promise.resolve().then(r.bind(r,3558)).then(function(e){(0,e.saveRoundToFirestore)(i,s).catch(console.error)})}}},0)},onCancel:function(){return t().jumpToLatest()}});return}console.log("[GameStore.addMatsch] No history warning needed, proceeding.");var a=null;e(function(e){var r=k(k({},e.striche),{},_({},n,k(k({},e.striche[n]),{},{matsch:e.striche[n].matsch+1}))),i=C(k(k({},e),{},{striche:r}),t,"jass",e.startingPlayer,{strichInfo:{team:n,type:"matsch"}}),o=N(e,i);return console.log("[GameStore.addMatsch] Normal Matsch added:",{currentIndex:(a=k(k({},e),{},{striche:r},o)).currentHistoryIndex,historyLength:a.roundHistory.length,striche:a.striche[n].matsch}),a}),setTimeout(function(){null!=(e=window.__FIRESTORE_SYNC_API__)&&e.markLocalUpdate?window.__FIRESTORE_SYNC_API__.markLocalUpdate():console.warn("[GameStore.addMatsch] markLocalUpdate API not available!");var e,n=t(),i=n.activeGameId;if(i){var o={striche:n.striche},a=(0,v.g)(o);if((0,y.updateActiveGame)(i,a).catch(console.error),n.roundHistory.length>0){var s=n.roundHistory[n.roundHistory.length-1];Promise.resolve().then(r.bind(r,3558)).then(function(e){(0,e.saveRoundToFirestore)(i,s).catch(console.error)})}}},0)},getTotalStriche:function(e){var r,n,i=t(),o=s.useUIStore.getState().scoreSettings,a=i.striche[e],u=0;return null!=o&&null!=(r=o.enabled)&&r.berg&&(u+=a.berg),u+=a.sieg,null!=o&&null!=(n=o.enabled)&&n.schneider&&(u+=a.schneider),u+=a.matsch,u+=a.kontermatsch},completeRound:function(){var t=c.useTimerStore.getState();e(function(e){return k(k({},e),{},{isRoundCompleted:!0,currentRound:e.currentRound+1})}),t.resetRoundTimer()},addKontermatsch:function(n){var i=t();if(i.currentHistoryIndex<i.roundHistory.length-1)return void(0,s.useUIStore.getState().showHistoryWarning)({message:"M\xf6chten Sie wirklich einen Kontermatsch in der Vergangenheit hinzuf\xfcgen?",onConfirm:function(){var i=null;e(function(e){var r=f.Q5.getState().currentGroup,i=s.useUIStore.getState(),o=r&&null!==r.strokeSettings&&void 0!==r.strokeSettings?r.strokeSettings:i.strokeSettings,a=k(k({},e.striche),{},_({},n,k(k({},e.striche[n]),{},{kontermatsch:o.kontermatsch}))),u=C(k(k({},e),{},{striche:a}),t,"jass",e.startingPlayer,{strichInfo:{team:n,type:"kontermatsch"}}),c=N(e,u);return k(k({},e),{},{striche:a},c)}),setTimeout(function(){null!=(e=window.__FIRESTORE_SYNC_API__)&&e.markLocalUpdate?window.__FIRESTORE_SYNC_API__.markLocalUpdate():console.warn("[GameStore.addKontermatsch.onConfirm] markLocalUpdate API not available!");var e,n=t(),i=n.activeGameId;if(i){var o={striche:n.striche,lastUpdated:(0,g.serverTimestamp)()},a=(0,v.g)(o);if((0,y.updateActiveGame)(i,a).catch(console.error),n.roundHistory.length>0){var s=n.roundHistory[n.roundHistory.length-1];Promise.resolve().then(r.bind(r,3558)).then(function(e){(0,e.saveRoundToFirestore)(i,s).catch(console.error)})}}},0)},onCancel:function(){return t().jumpToLatest()}});var o=null;e(function(e){var r=f.Q5.getState().currentGroup,i=s.useUIStore.getState(),o=r&&null!==r.strokeSettings&&void 0!==r.strokeSettings?r.strokeSettings:i.strokeSettings,a=k(k({},e.striche),{},_({},n,k(k({},e.striche[n]),{},{kontermatsch:o.kontermatsch}))),u=C(k(k({},e),{},{striche:a}),t,"jass",e.startingPlayer,{strichInfo:{team:n,type:"kontermatsch"}}),c=N(e,u);return k(k({},e),{},{striche:a},c)}),setTimeout(function(){null!=(e=window.__FIRESTORE_SYNC_API__)&&e.markLocalUpdate?window.__FIRESTORE_SYNC_API__.markLocalUpdate():console.warn("[GameStore.addKontermatsch] markLocalUpdate API not available!");var e,n=t(),i=n.activeGameId;if(i){var o={striche:n.striche,lastUpdated:(0,g.serverTimestamp)()},a=(0,v.g)(o);if((0,y.updateActiveGame)(i,a).catch(console.error),n.roundHistory.length>0){var s=n.roundHistory[n.roundHistory.length-1];Promise.resolve().then(r.bind(r,3558)).then(function(e){(0,e.saveRoundToFirestore)(i,s).catch(console.error)})}}},0)},getPlayerName:function(e){var r,n=t();return(null==(r=n.gamePlayers)||null==(r=r[e])?void 0:r.name)||n.playerNames[e]||"Spieler ".concat(e)},resetGameState:function(t){e(function(e){var r,n,i,o,a,s,u,c,f,p,m,g,y,v=(null==t?void 0:t.nextStarter)||e.initialStartingPlayer||1,b=null!=(r=null!=(n=null==t||null==(i=t.settings)?void 0:i.farbeSettings)?n:e.farbeSettings)?r:h.FT,w=null!=(o=null!=(a=null==t||null==(s=t.settings)?void 0:s.scoreSettings)?a:e.scoreSettings)?o:d.$d,S=null!=(u=null!=(c=null==t||null==(f=t.settings)?void 0:f.strokeSettings)?c:e.strokeSettings)?u:l.zh,x=O(v,{farbeSettings:b,scoreSettings:w,strokeSettings:S}),I=e.playerNames&&Object.values(e.playerNames).some(function(e){return""!==e})?e.playerNames:A,E=e.gamePlayers||null,T=!1;t&&t.hasOwnProperty("newActiveGameId")?null===t.newActiveGameId?(y=null,T=!1):"string"==typeof t.newActiveGameId?(y=t.newActiveGameId,T=!0):(y=void 0,T=!1):(y=e.activeGameId,T=!!e.activeGameId);var _=k(k({},x),{},{gamePlayers:E,activeGameId:y,isGameStarted:T,farbeSettings:b,scoreSettings:w,strokeSettings:S,roundHistory:[],currentHistoryIndex:-1,scores:x.scores||{top:0,bottom:0},striche:x.striche||{top:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0},bottom:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0}},playerNames:I||x.playerNames||{1:"Spieler 1",2:"Spieler 2",3:"Spieler 3",4:"Spieler 4"},currentPlayer:x.currentPlayer||1});return console.log("[GameStore] resetGameState durchgef\xfchrt. activeGameId: ".concat(_.activeGameId,", isGameStarted: ").concat(_.isGameStarted,", playerNames: ").concat(JSON.stringify(_.playerNames).substring(0,50),"..."),"Farbe CardStyle:",null==(p=_.farbeSettings)?void 0:p.cardStyle,"Score Sieg:",null==(m=_.scoreSettings)?void 0:m.values.sieg,"Stroke Schneider:",null==(g=_.strokeSettings)?void 0:g.schneider),_})},rebuildStateFromHistory:function(t){e(function(e){if(t<-1||t>=e.roundHistory.length)return console.error("[rebuildStateFromHistory] Ung\xfcltiger Index: ".concat(t)),e;var r=R(-1===t?null:e.roundHistory[t],function(){return e});return k(k(k({},e),r),{},{currentHistoryIndex:t,historyState:{lastNavigationTimestamp:e.historyState.lastNavigationTimestamp,weisCache:null}})})},setPlayers:function(t){return e({playerNames:t})},setGameSettings:function(t){e(function(e){var r=e.farbeSettings,n=e.scoreSettings,i=e.strokeSettings,o=function(e,t){return JSON.stringify(e)!==JSON.stringify(t)},a=t.farbeSettings||r,s=t.scoreSettings||n,u=t.strokeSettings||i;return o(r,a)||o(n,s)||o(i,u)?k(k({},e),{},{farbeSettings:a,scoreSettings:s,strokeSettings:u}):e})},showHistoryWarning:function(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return t().jumpToLatest()},i=t();i.currentHistoryIndex<i.roundHistory.length-1?s.useUIStore.getState().showHistoryWarning({message:e,onConfirm:r,onCancel:n,type:"error"}):(console.warn("[GameStore.showHistoryWarning] Called unexpectedly when already at the latest state."),r())},validateHistoryAction:function(){var e=t();return e.currentHistoryIndex>=e.roundHistory.length-1},setFarbe:function(t){e(function(e){return k(k({},e),{},{farbe:t})})},setTransitioning:function(t){e({isTransitioning:t})}})},{name:"gameStore"}))},4319:(e,t,r)=>{"use strict";r.d(t,{KU:()=>l,Zr:()=>d,lt:()=>u});let n=new Map,i=e=>{let t=n.get(e);return t?Object.fromEntries(Object.entries(t.stores).map(([e,t])=>[e,t.getState()])):{}},o=(e,t,r)=>{if(void 0===e)return{type:"untracked",connection:t.connect(r)};let i=n.get(r.name);if(i)return{type:"tracked",store:e,...i};let o={connection:t.connect(r),stores:{}};return n.set(r.name,o),{type:"tracked",store:e,...o}},a=(e,t)=>{if(void 0===t)return;let r=n.get(e);r&&(delete r.stores[t],0===Object.keys(r.stores).length&&n.delete(e))},s=e=>{var t,r;if(!e)return;let n=e.split("\n"),i=n.findIndex(e=>e.includes("api.setState"));if(i<0)return;let o=(null==(t=n[i+1])?void 0:t.trim())||"";return null==(r=/.+ (.+) .+/.exec(o))?void 0:r[1]},u=(e,t={})=>(r,n,u)=>{let l,{enabled:h,anonymousActionType:d,store:f,...p}=t;try{l=(null==h||h)&&window.__REDUX_DEVTOOLS_EXTENSION__}catch(e){}if(!l)return e(r,n,u);let{connection:m,...g}=o(f,l,p),y=!0;u.setState=(e,t,o)=>{let a=r(e,t);if(!y)return a;let c=void 0===o?{type:d||s(Error().stack)||"anonymous"}:"string"==typeof o?{type:o}:o;return void 0===f?null==m||m.send(c,n()):null==m||m.send({...c,type:`${f}/${c.type}`},{...i(p.name),[f]:u.getState()}),a},u.devtools={cleanup:()=>{m&&"function"==typeof m.unsubscribe&&m.unsubscribe(),a(p.name,f)}};let v=(...e)=>{let t=y;y=!1,r(...e),y=t},b=e(u.setState,n,u);if("untracked"===g.type?null==m||m.init(b):(g.stores[g.store]=u,null==m||m.init(Object.fromEntries(Object.entries(g.stores).map(([e,t])=>[e,e===g.store?b:t.getState()])))),u.dispatchFromDevtools&&"function"==typeof u.dispatch){let e=!1,t=u.dispatch;u.dispatch=(...r)=>{"__setState"!==r[0].type||e||(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),e=!0),t(...r)}}return m.subscribe(e=>{var t;switch(e.type){case"ACTION":if("string"!=typeof e.payload)return void console.error("[zustand devtools middleware] Unsupported action format");return c(e.payload,e=>{if("__setState"===e.type){if(void 0===f)return void v(e.state);1!==Object.keys(e.state).length&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format.
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);let t=e.state[f];return void(null==t||JSON.stringify(u.getState())!==JSON.stringify(t)&&v(t))}u.dispatchFromDevtools&&"function"==typeof u.dispatch&&u.dispatch(e)});case"DISPATCH":switch(e.payload.type){case"RESET":if(v(b),void 0===f)return null==m?void 0:m.init(u.getState());return null==m?void 0:m.init(i(p.name));case"COMMIT":if(void 0===f){null==m||m.init(u.getState());break}return null==m?void 0:m.init(i(p.name));case"ROLLBACK":return c(e.state,e=>{if(void 0===f){v(e),null==m||m.init(u.getState());return}v(e[f]),null==m||m.init(i(p.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return c(e.state,e=>{if(void 0===f)return void v(e);JSON.stringify(u.getState())!==JSON.stringify(e[f])&&v(e[f])});case"IMPORT_STATE":{let{nextLiftedState:r}=e.payload,n=null==(t=r.computedStates.slice(-1)[0])?void 0:t.state;if(!n)return;void 0===f?v(n):v(n[f]),null==m||m.send(null,r);break}case"PAUSE_RECORDING":return y=!y}return}}),b},c=(e,t)=>{let r;try{r=JSON.parse(e)}catch(e){console.error("[zustand devtools middleware] Could not parse the received json",e)}void 0!==r&&t(r)};function l(e,t){let r;try{r=e()}catch(e){return}return{getItem:e=>{var n;let i=e=>null===e?null:JSON.parse(e,null==t?void 0:t.reviver),o=null!=(n=r.getItem(e))?n:null;return o instanceof Promise?o.then(i):i(o)},setItem:(e,n)=>r.setItem(e,JSON.stringify(n,null==t?void 0:t.replacer)),removeItem:e=>r.removeItem(e)}}let h=e=>t=>{try{let r=e(t);if(r instanceof Promise)return r;return{then:e=>h(e)(r),catch(e){return this}}}catch(e){return{then(e){return this},catch:t=>h(t)(e)}}},d=(e,t)=>(r,n,i)=>{let o,a={storage:l(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},s=!1,u=new Set,c=new Set,d=a.storage;if(!d)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${a.name}', the given storage is currently unavailable.`),r(...e)},n,i);let f=()=>{let e=a.partialize({...n()});return d.setItem(a.name,{state:e,version:a.version})},p=i.setState;i.setState=(e,t)=>{p(e,t),f()};let m=e((...e)=>{r(...e),f()},n,i);i.getInitialState=()=>m;let g=()=>{var e,t;if(!d)return;s=!1,u.forEach(e=>{var t;return e(null!=(t=n())?t:m)});let i=(null==(t=a.onRehydrateStorage)?void 0:t.call(a,null!=(e=n())?e:m))||void 0;return h(d.getItem.bind(d))(a.name).then(e=>{if(e)if("number"!=typeof e.version||e.version===a.version)return[!1,e.state];else{if(a.migrate){let t=a.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(e=>{var t;let[i,s]=e;if(r(o=a.merge(s,null!=(t=n())?t:m),!0),i)return f()}).then(()=>{null==i||i(o,void 0),o=n(),s=!0,c.forEach(e=>e(o))}).catch(e=>{null==i||i(void 0,e)})};return i.persist={setOptions:e=>{a={...a,...e},e.storage&&(d=e.storage)},clearStorage:()=>{null==d||d.removeItem(a.name)},getOptions:()=>a,rehydrate:()=>g(),hasHydrated:()=>s,onHydrate:e=>(u.add(e),()=>{u.delete(e)}),onFinishHydration:e=>(c.add(e),()=>{c.delete(e)})},a.skipHydration||g(),o||m}},4415:(e,t,r)=>{"use strict";r.r(t),r.d(t,{useTimerStore:()=>l});var n=r(8106);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return a(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach(function(t){var n,o,a;n=e,o=t,a=r[t],(o=function(e){var t=function(e,t){if("object"!==i(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==i(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===i(t)?t:String(t)}(o))in n?Object.defineProperty(n,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[o]=a}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var c=function(e){return Math.max(0,e)},l=(0,n.v)(function(e,t){return{jassStartTime:null,gameStartTime:null,roundStartTime:null,history:{jass:[],games:[],rounds:[]},isPaused:!1,pauseStartTime:null,totalPausedTime:0,lastJassDuration:0,gameTimers:new Map,activeGameId:null,startJassTimer:function(){e(function(e){return u(u({},e),{},{jassStartTime:Date.now(),history:u(u({},e.history),{},{jass:[].concat(o(e.history.jass),[{startTime:Date.now()}])})})})},startGameTimer:function(){e(function(e){return u(u({},e),{},{gameStartTime:Date.now(),history:u(u({},e.history),{},{games:[].concat(o(e.history.games),[{startTime:Date.now()}])})})})},startRoundTimer:function(){var t=Date.now();e(function(e){return u(u({},e),{},{roundStartTime:t,history:u(u({},e.history),{},{rounds:[].concat(o(e.history.rounds),[{startTime:t}])})})})},completeRound:function(){var t=Date.now();e(function(e){var r=o(e.history.rounds),n=r[r.length-1];return n&&(n.endTime=t,n.duration=t-n.startTime),u(u({},e),{},{roundStartTime:null,history:u(u({},e.history),{},{rounds:r})})})},completeGame:function(){var t=Date.now();e(function(e){var r=o(e.history.games),n=r[r.length-1];return n&&(n.endTime=t,n.duration=t-n.startTime),u(u({},e),{},{gameStartTime:null,roundStartTime:null,history:u(u({},e.history),{},{games:r})})})},completeJass:function(){var r=Date.now(),n=t(),i=n.jassStartTime?r-n.jassStartTime:0;e(function(e){return u(u({},e),{},{lastJassDuration:i,jassStartTime:null,gameStartTime:null,roundStartTime:null,history:u(u({},e.history),{},{jass:e.history.jass.slice(0,-1)})})})},getAnalytics:function(){var e=t(),r=t().getCurrentTime(),n=e.gameStartTime?c(r-e.gameStartTime):0;return{totalJassTime:e.jassStartTime?c(r-e.jassStartTime):e.lastJassDuration,currentGameDuration:n}},resetRoundTimer:function(){e(function(e){return u(u({},e),{},{roundStartTime:null})})},resetGameTimers:function(){e(function(e){return u(u({},e),{},{gameStartTime:null,roundStartTime:null})})},resetAllTimers:function(){e(function(e){return u(u({},e),{},{jassStartTime:null,gameStartTime:null,roundStartTime:null,history:{jass:[],games:[],rounds:[]}})})},pauseTimer:function(){e(function(e){return u(u({},e),{},{isPaused:!0,pauseStartTime:Date.now()})})},resumeTimer:function(){e(function(e){var t=e.pauseStartTime?Date.now()-e.pauseStartTime:0;return u(u({},e),{},{isPaused:!1,pauseStartTime:null,totalPausedTime:e.totalPausedTime+t})})},getCurrentTime:function(){var e=t(),r=Date.now();return e.isPaused&&e.pauseStartTime?e.pauseStartTime-e.totalPausedTime:r-e.totalPausedTime},prepareJassEnd:function(){var e=Date.now(),r=t();return r.jassStartTime?e-r.jassStartTime:0},finalizeJassEnd:function(){e(function(e){return u(u({},e),{},{jassStartTime:null,gameStartTime:null,roundStartTime:null,history:u(u({},e.history),{},{jass:e.history.jass.slice(0,-1)})})})},getElapsedTimes:function(){var e=t(),r=Date.now(),n=e.totalPausedTime+(e.isPaused&&e.pauseStartTime?r-e.pauseStartTime:0);return{jass:e.jassStartTime?r-e.jassStartTime-n:0,game:e.gameStartTime?r-e.gameStartTime-n:0,round:e.roundStartTime?r-e.roundStartTime-n:0}},getTotalPausedTime:function(){var e=t();return e.totalPausedTime+(e.isPaused&&e.pauseStartTime?Date.now()-e.pauseStartTime:0)},restoreTimerSnapshot:function(r){var n=Date.now();t(),e(function(e){var t={jassStartTime:n-r.elapsedJassTime-r.totalPausedTime,gameStartTime:n-r.elapsedGameTime-r.totalPausedTime,roundStartTime:n-r.elapsedRoundTime-r.totalPausedTime,totalPausedTime:r.totalPausedTime,isPaused:!1,pauseStartTime:null},i=new Map(e.gameTimers);if(e.activeGameId){var o=i.get(e.activeGameId);o&&(o.startTime=n,o.isActive=!0,o.pausedTime=r.totalPausedTime)}return u(u(u({},e),t),{},{gameTimers:i})})},activateGameTimer:function(r){t();var n=Date.now();e(function(e){var t=new Map(e.gameTimers),i=null!==e.activeGameId?t.get(e.activeGameId):null;null!=i&&i.isActive&&(i.totalDuration+=n-i.startTime-i.pausedTime,i.isActive=!1);var o=t.get(r);o||(o={startTime:n,totalDuration:0,pausedTime:0,isActive:!1}),o.startTime=n,o.isActive=!0,o.pausedTime=0,t.set(r,o);var a=e.jassStartTime;return u(u({},e),{},{gameTimers:t,activeGameId:r,gameStartTime:n,roundStartTime:n,jassStartTime:a,isPaused:!1,pauseStartTime:null})})},getGameDuration:function(e){var r=t().gameTimers.get(e);if(!r)return 0;if(!r.isActive)return r.totalDuration;var n=Date.now();return r.totalDuration+(n-r.startTime-r.pausedTime)},reactivateGameTimer:function(r){t();var n=Date.now();e(function(e){var t,i=new Map(e.gameTimers),o=null!=(t=i.get(r))?t:{startTime:n,totalDuration:0,pausedTime:0,isActive:!1};o.startTime=n,o.isActive=!0,o.pausedTime=0,i.set(r,o);var a=e.jassStartTime;return u(u({},e),{},{gameTimers:i,activeGameId:r,gameStartTime:n,roundStartTime:n,isPaused:!1,pauseStartTime:null,jassStartTime:a})})},restoreTimers:function(t,r){var n=Date.now();return e({jassStartTime:t,gameStartTime:r,roundStartTime:n}),{jassStartTime:t,gameStartTime:r,roundStartTime:n}}}})},4536:(e,t,r)=>{"use strict";r.r(t),r.d(t,{createInitialTeamStand:()=>O,useJassStore:()=>N});var n=r(8106),i=r(4277);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(){a=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function h(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(e){h=function(e,t,r){return e[t]=r}}function d(t,r,n,o){var a,s,u,c,l=Object.create((r&&r.prototype instanceof v?r:v).prototype);return i(l,"_invoke",{value:(a=t,s=n,u=new A(o||[]),c=p,function(t,r){if(c===m)throw Error("Generator is already running");if(c===g){if("throw"===t)throw r;return{value:e,done:!0}}for(u.method=t,u.arg=r;;){var n=u.delegate;if(n){var i=function t(r,n){var i=n.method,o=r.iterator[i];if(o===e)return n.delegate=null,"throw"===i&&r.iterator.return&&(n.method="return",n.arg=e,t(r,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+i+"' method")),y;var a=f(o,r.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,y;var s=a.arg;return s?s.done?(n[r.resultName]=s.value,n.next=r.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):s:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,y)}(n,u);if(i){if(i===y)continue;return i}}if("next"===u.method)u.sent=u._sent=u.arg;else if("throw"===u.method){if(c===p)throw c=g,u.arg;u.dispatchException(u.arg)}else"return"===u.method&&u.abrupt("return",u.arg);c=m;var o=f(a,s,u);if("normal"===o.type){if(c=u.done?g:"suspendedYield",o.arg===y)continue;return{value:o.arg,done:u.done}}"throw"===o.type&&(c=g,u.method="throw",u.arg=o.arg)}})}),l}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var p="suspendedStart",m="executing",g="completed",y={};function v(){}function b(){}function w(){}var S={};h(S,u,function(){return this});var x=Object.getPrototypeOf,I=x&&x(x(O([])));I&&I!==r&&n.call(I,u)&&(S=I);var E=w.prototype=v.prototype=Object.create(S);function T(e){["next","throw","return"].forEach(function(t){h(e,t,function(e){return this._invoke(t,e)})})}function k(e,t){var r;i(this,"_invoke",{value:function(i,a){function s(){return new t(function(r,s){!function r(i,a,s,u){var c=f(e[i],e,a);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==o(h)&&n.call(h,"__await")?t.resolve(h.__await).then(function(e){r("next",e,s,u)},function(e){r("throw",e,s,u)}):t.resolve(h).then(function(e){l.value=e,s(l)},function(e){return r("throw",e,s,u)})}u(c.arg)}(i,a,r,s)})}return r=r?r.then(s,s):s()}})}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function O(t){if(t||""===t){var r=t[u];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw TypeError(o(t)+" is not iterable")}return b.prototype=w,i(E,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:b,configurable:!0}),b.displayName=h(w,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,h(e,l,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},T(k.prototype),h(k.prototype,c,function(){return this}),t.AsyncIterator=k,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new k(d(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},T(E),h(E,l,"Generator"),h(E,u,function(){return this}),h(E,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function s(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(n,i)}function u(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){s(o,n,i,a,u,"next",e)}function u(e){s(o,n,i,a,u,"throw",e)}a(void 0)})}}function c(e){var t=function(e,t){if("object"!==o(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==o(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===o(t)?t:String(t)}var l=new(function(){var e,t,r,n,i;return n=function e(){var t,r;if(!(this instanceof e))throw TypeError("Cannot call a class as a function");r="jass_sessions",(t=c(t="STORAGE_KEY"))in this?Object.defineProperty(this,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[t]=r},i=[{key:"getStorageKey",value:function(e){return"".concat(this.STORAGE_KEY,"_").concat(e)}},{key:"saveSession",value:(e=u(a().mark(function e(t){var r,n,i;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=this.getStorageKey(t.id),e.next=1,localStorage.setItem(r,JSON.stringify(t));case 1:return e.next=2,this.listSessions();case 2:if((n=e.sent).find(function(e){return e.id===t.id})){e.next=3;break}return n.push(t),e.next=3,localStorage.setItem(this.STORAGE_KEY,JSON.stringify(n));case 3:e.next=5;break;case 4:throw e.prev=4,console.error("Fehler beim Speichern der Session:",i=e.catch(0)),i;case 5:case"end":return e.stop()}},e,this,[[0,4]])})),function(t){return e.apply(this,arguments)})},{key:"loadSession",value:(t=u(a().mark(function e(t){var r;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=localStorage.getItem(this.getStorageKey(t))){e.next=1;break}throw Error("Session ".concat(t," nicht gefunden"));case 1:return e.abrupt("return",JSON.parse(r));case 2:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"listSessions",value:(r=u(a().mark(function e(){var t;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=localStorage.getItem(this.STORAGE_KEY),e.abrupt("return",t?JSON.parse(t):[]);case 1:return e.prev=1,console.error("Fehler beim Laden der Sessions:",e.catch(0)),e.abrupt("return",[]);case 2:case"end":return e.stop()}},e,this,[[0,1]])})),function(){return r.apply(this,arguments)})}],function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,c(n.key),n)}}(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),n}()),h=r(4415),d=r(4796),f=r(6170),p=r(2009),m=r(5519),g=r(2604),y=r(132),v=r(8310),b=r(7044),w=r(3649),S=r(3558);function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(e){return function(e){if(Array.isArray(e))return E(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return E(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return E(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function T(){T=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(t,r,n,o){var a,s,u,c,l=Object.create((r&&r.prototype instanceof g?r:g).prototype);return i(l,"_invoke",{value:(a=t,s=n,u=new A(o||[]),c=d,function(t,r){if(c===f)throw Error("Generator is already running");if(c===p){if("throw"===t)throw r;return{value:e,done:!0}}for(u.method=t,u.arg=r;;){var n=u.delegate;if(n){var i=function t(r,n){var i=n.method,o=r.iterator[i];if(o===e)return n.delegate=null,"throw"===i&&r.iterator.return&&(n.method="return",n.arg=e,t(r,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+i+"' method")),m;var a=h(o,r.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,m;var s=a.arg;return s?s.done?(n[r.resultName]=s.value,n.next=r.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):s:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,m)}(n,u);if(i){if(i===m)continue;return i}}if("next"===u.method)u.sent=u._sent=u.arg;else if("throw"===u.method){if(c===d)throw c=p,u.arg;u.dispatchException(u.arg)}else"return"===u.method&&u.abrupt("return",u.arg);c=f;var o=h(a,s,u);if("normal"===o.type){if(c=u.done?p:"suspendedYield",o.arg===m)continue;return{value:o.arg,done:u.done}}"throw"===o.type&&(c=p,u.method="throw",u.arg=o.arg)}})}),l}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var d="suspendedStart",f="executing",p="completed",m={};function g(){}function y(){}function v(){}var b={};c(b,a,function(){return this});var w=Object.getPrototypeOf,S=w&&w(w(O([])));S&&S!==r&&n.call(S,a)&&(b=S);var I=v.prototype=g.prototype=Object.create(b);function E(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function k(e,t){var r;i(this,"_invoke",{value:function(i,o){function a(){return new t(function(r,a){!function r(i,o,a,s){var u=h(e[i],e,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==x(l)&&n.call(l,"__await")?t.resolve(l.__await).then(function(e){r("next",e,a,s)},function(e){r("throw",e,a,s)}):t.resolve(l).then(function(e){c.value=e,a(c)},function(e){return r("throw",e,a,s)})}s(u.arg)}(i,o,r,a)})}return r=r?r.then(a,a):a()}})}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function O(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw TypeError(x(t)+" is not iterable")}return y.prototype=v,i(I,"constructor",{value:v,configurable:!0}),i(v,"constructor",{value:y,configurable:!0}),y.displayName=c(v,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,c(e,u,"GeneratorFunction")),e.prototype=Object.create(I),e},t.awrap=function(e){return{__await:e}},E(k.prototype),c(k.prototype,s,function(){return this}),t.AsyncIterator=k,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new k(l(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},E(I),c(I,u,"Generator"),c(I,a,function(){return this}),c(I,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function k(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(n,i)}function _(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){k(o,n,i,a,s,"next",e)}function s(e){k(o,n,i,a,s,"throw",e)}a(void 0)})}}function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function A(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach(function(t){var n,i,o;n=e,i=t,o=r[t],(i=function(e){var t=function(e,t){if("object"!==x(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==x(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===x(t)?t:String(t)}(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var O=function(){return{bergActive:!1,bedankenActive:!1,isSigned:!1,striche:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0},total:0,jassPoints:0,weisPoints:0,playerStats:{1:{striche:0,points:0,weisPoints:0},2:{striche:0,points:0,weisPoints:0},3:{striche:0,points:0,weisPoints:0},4:{striche:0,points:0,weisPoints:0}}}},C=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"default",n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;return{id:e,activeGameId:n,timestamp:Date.now(),teams:{top:O(),bottom:O()},sessionId:r,currentRound:1,startingPlayer:t,initialStartingPlayer:null!=i?i:t,currentPlayer:t,roundHistory:[],currentHistoryIndex:-1,historyState:{lastNavigationTimestamp:Date.now()},isGameStarted:!1,isRoundCompleted:!1,isGameCompleted:!1}},D={isJassStarted:!1,currentSession:{id:"initial",gruppeId:"default",startedAt:Date.now(),playerNames:{1:"",2:"",3:"",4:""},games:[],metadata:{},statistics:{gamesPlayed:0,scores:{top:0,bottom:0},weisCount:0,stricheCount:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0}},currentScoreLimit:2500,completedGamesCount:0},currentRound:1,currentGameId:1,activeGameId:null,isJassCompleted:!1,jassSessionId:null,sessionUnsubscribe:null,teams:{top:O(),bottom:O()},games:[],onlineCompletedGames:[],currentGameCache:null,completedGamesUnsubscribe:null},N=(0,n.v)(function(e,t){var n,o,a,s;return A(A({},D),{},{saveSession:(n=_(T().mark(function e(){var r,n,o,a,s,u,c,h,f;return T().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=t(),u=i.useGameStore.getState(),c=(0,d.GH)(s.games,"top"),h=(0,d.GH)(s.games,"bottom"),f={id:"session_".concat(Date.now()),gruppeId:"default",startedAt:(null==(r=s.games[0])?void 0:r.timestamp)||Date.now(),endedAt:Date.now(),playerNames:u.playerNames,games:s.games.map(function(e){var t=e.id,r="string"==typeof t?parseInt(t,10):t;return"number"!=typeof r||isNaN(r)?null:r}).filter(function(e){return null!==e}),currentScoreLimit:null!=(n=null==(o=s.currentSession)?void 0:o.currentScoreLimit)?n:2500,completedGamesCount:s.games.length,metadata:{location:"Standard Location",notes:""},statistics:{gamesPlayed:s.games.length,totalDuration:Date.now()-((null==(a=s.games[0])?void 0:a.timestamp)||Date.now()),scores:{top:s.teams.top.total,bottom:s.teams.bottom.total},weisCount:s.games.reduce(function(e,t){return e+(t.teams.top.weisPoints+t.teams.bottom.weisPoints)},0),stricheCount:{berg:c.berg+h.berg,sieg:c.sieg+h.sieg,matsch:c.matsch+h.matsch,schneider:c.schneider+h.schneider,kontermatsch:c.kontermatsch+h.kontermatsch}}},e.prev=1,e.next=2,l.saveSession(f);case 2:return e.abrupt("return",f.id);case 3:throw e.prev=3,e.catch(1);case 4:case"end":return e.stop()}},e,null,[[1,3]])})),function(){return n.apply(this,arguments)}),loadSession:(o=_(T().mark(function e(t){return T().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,l.loadSession(t);case 1:e.sent,e.next=3;break;case 2:throw e.prev=2,e.catch(0);case 3:case"end":return e.stop()}},e,null,[[0,2]])})),function(e){return o.apply(this,arguments)}),startJass:(a=_(T().mark(function r(n){var o,a,s,u,c,l,d,f,g,w,S,x,I,E,k,_,P,D,N,R,L,j,F,G,M,U,V,B,z,H,q,$;return T().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(u=n.playerNames,c=n.initialStartingPlayer,l=n.activeGameId,d=n.sessionId,f=n.groupId,g=n.participantUids,w=n.participantPlayerIds,I=A({},x={farbeSettings:null!=(o=null==(S=n.initialSettings)?void 0:S.farbeSettings)?o:y.FT,scoreSettings:null!=(a=null==S?void 0:S.scoreSettings)?a:v.$d,strokeSettings:null!=(s=null==S?void 0:S.strokeSettings)?s:b.zh}),!f){r.next=5;break}return r.prev=1,E=(0,p.getFirestore)(m.xv),k=(0,p.doc)(E,"groups",f),r.next=2,(0,p.getDoc)(k);case 2:(_=r.sent).exists()?(N=(D=_.data()).farbeSettings,R=D.scoreSettings,L=D.strokeSettings,I={farbeSettings:A(A(A({},x.farbeSettings),N||{}),{},{cardStyle:null!=(P=null==N?void 0:N.cardStyle)?P:x.farbeSettings.cardStyle}),scoreSettings:null!=R?R:x.scoreSettings,strokeSettings:null!=L?L:x.strokeSettings}):console.warn("[JassStore.startJass] Gruppe ".concat(f," nicht gefunden. Basis-Einstellungen (UI/Turnier/Default) werden verwendet.")),r.next=4;break;case 3:r.prev=3,$=r.catch(1),console.error("[JassStore.startJass] Fehler beim Laden der Gruppe ".concat(f,":"),$),console.warn("[JassStore.startJass] Basis-Einstellungen (UI/Turnier/Default) bleiben nach Fehler erhalten.");case 4:r.next=5;break;case 5:if(d){r.next=6;break}return console.error("[JassStore.startJass] ❌ sessionId ist undefined/null."),r.abrupt("return");case 6:console.log("[JassStore.startJass] \uD83D\uDCC4 Session: ".concat(d," | ActiveGame: ").concat(null!=l?l:"none"));case 7:return j=C(1,c,d,l,c),F=(0,p.getFirestore)(m.xv),G=Date.now(),r.prev=8,M=(0,p.doc)(F,"sessions",d),r.next=9,(0,p.getDoc)(M);case 9:(U=r.sent).exists()&&(V=U.data()).startedAt&&("function"==typeof V.startedAt.toMillis?G=V.startedAt.toMillis():"number"==typeof V.startedAt&&(G=V.startedAt),console.log("[JassStore.startJass] ✅ Verwendet Session startedAt: ".concat(new Date(G).toISOString()))),r.next=11;break;case 10:r.prev=10,console.warn("[JassStore.startJass] ⚠️ Konnte Session-Dokument nicht lesen, verwende lokalen Timestamp:",r.catch(8));case 11:return B={currentFarbeSettings:I.farbeSettings,currentScoreSettings:I.scoreSettings,currentStrokeSettings:I.strokeSettings,playerNames:u,participantUids:null!=g?g:[],participantPlayerIds:null!=w?w:[],groupId:null!=f?f:null,startedAt:(0,p.serverTimestamp)()},r.prev=12,z=(0,p.doc)(F,"sessions",d),r.next=13,(0,p.setDoc)(z,A(A({},B),{},{currentActiveGameId:null!=l?l:null,lastUpdated:(0,p.serverTimestamp)()}),{merge:!0});case 13:r.next=15;break;case 14:r.prev=14,console.error("[JassStore.startJass] ❌ ERSTE SICHERHEIT FEHLGESCHLAGEN:",r.catch(12));case 15:if(!l){r.next=19;break}return r.prev=16,H=(0,p.doc)(F,"activeGames",l),r.next=17,(0,p.setDoc)(H,{activeFarbeSettings:I.farbeSettings,activeScoreSettings:I.scoreSettings,activeStrokeSettings:I.strokeSettings},{merge:!0});case 17:r.next=19;break;case 18:r.prev=18,console.error("[JassStore.startJass] ❌ ZWEITE SICHERHEIT FEHLGESCHLAGEN:",r.catch(16));case 19:e({isJassStarted:!0,currentSession:{id:d,gruppeId:null!=f?f:"",startedAt:G,playerNames:u,games:[1],currentScoreLimit:5e3,completedGamesCount:0,participantUids:null!=g?g:[],participantPlayerIds:null!=w?w:[],metadata:{},statistics:{gamesPlayed:0,scores:{top:0,bottom:0},weisCount:0,stricheCount:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0}},currentFarbeSettings:I.farbeSettings,currentScoreSettings:I.scoreSettings,currentStrokeSettings:I.strokeSettings},currentRound:1,currentGameId:1,activeGameId:null!=l?l:null,isJassCompleted:!1,jassSessionId:d,teams:{top:O(),bottom:O()},games:[j],onlineCompletedGames:[],currentGameCache:j}),i.useGameStore.getState().resetGame(c,l,I),i.useGameStore.setState({playerNames:u}),(q=h.useTimerStore.getState()).startJassTimer(),q.activateGameTimer(1),setTimeout(function(){t().subscribeToSession(d)},100);case 20:case"end":return r.stop()}},r,null,[[1,3],[8,10],[12,14],[16,18]])})),function(e){return a.apply(this,arguments)}),startNextGame:function(r,n){var o,a,s,u,c,l,d=t(),f=i.useGameStore.getState(),p=h.useTimerStore.getState();if(!d.isJassStarted||!d.currentSession)return void console.log("[JassStore.startNextGame] Jass not started or no current session.");var m=d.currentSession.id,g=d.currentGameId+1;console.log("[JassStore.startNextGame] Creating game ".concat(g," with initialStartingPlayer=").concat(r,", newActiveGameId=").concat(n||"none"));var w=C(g,r,m,n,null!=(o=null==(a=d.games[0])?void 0:a.initialStartingPlayer)?o:r);e(function(e){if(!e.currentSession)return{};var t,r,i,o=e.currentSession.statistics,a={gamesPlayed:g,totalDuration:null==o?void 0:o.totalDuration,scores:null!=(t=null==o?void 0:o.scores)?t:{top:0,bottom:0},weisCount:null!=(r=null==o?void 0:o.weisCount)?r:0,stricheCount:null!=(i=null==o?void 0:o.stricheCount)?i:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0}};return{currentGameId:g,games:[].concat(I(e.games),[w]),currentSession:A(A({},e.currentSession),{},{games:[].concat(I(e.currentSession.games),[g]),statistics:a}),currentRound:1,isJassCompleted:!1,activeGameId:null!=n?n:null}}),p.reactivateGameTimer(g);var S=t();if(!S.currentSession)return void console.error("[JassStore.startNextGame] Kritischer Fehler: Keine currentSession gefunden. Breche ab.");var x={farbeSettings:null!=(s=S.currentSession.currentFarbeSettings)?s:y.FT,scoreSettings:null!=(u=S.currentSession.currentScoreSettings)?u:v.$d,strokeSettings:null!=(c=S.currentSession.currentStrokeSettings)?c:b.zh};console.log("[JassStore.startNextGame] \xdcbergebe folgende Settings an resetGame:",{source:S.currentSession.currentFarbeSettings?"Session":"Default",cardStyle:x.farbeSettings.cardStyle,siegPunkte:x.scoreSettings.values.sieg,schneiderStriche:x.strokeSettings.schneider}),f.resetGame(r,n,x),i.useGameStore.setState({playerNames:S.currentSession.playerNames}),null!=(l=d.currentSession)&&l.id&&t().syncCompletedGamesForSession(d.currentSession.id),console.log("[JassStore.startNextGame] Started game ".concat(g,". New Active Game ID: ").concat(n||"none"))},finalizeGame:(s=_(T().mark(function r(){var n,o,a,s,u,c,l,d,y,v,b,S,I,E,k,_,P,O,C,D,N,R,L,j;return T().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(s=t(),u=i.useGameStore.getState(),c=s.games.find(function(e){return e.id===s.currentGameId})){r.next=1;break}return r.abrupt("return");case 1:if(d=(l=h.useTimerStore.getState()).getGameDuration(s.currentGameId),y=A(A({},c),{},{teams:{top:A(A({},c.teams.top),{},{jassPoints:u.scores.top,total:u.scores.top,striche:A({},u.striche.top)}),bottom:A(A({},c.teams.bottom),{},{jassPoints:u.scores.bottom,total:u.scores.bottom,striche:A({},u.striche.bottom)})},roundHistory:c.roundHistory||[],currentRound:u.currentRound,currentPlayer:u.currentPlayer,currentHistoryIndex:u.currentHistoryIndex,historyState:u.historyState,isGameStarted:u.isGameStarted,isRoundCompleted:u.isRoundCompleted,isGameCompleted:!0,metadata:{duration:"number"==typeof d?d:0,completedAt:Date.now(),roundStats:null!=(n=null==(o=c.metadata)?void 0:o.roundStats)?n:{weisCount:0,colorStats:{}}}}),!(c.activeGameId&&null!=(a=s.currentSession)&&a.id)){r.next=17;break}return v=w.useUIStore.getState(),r.prev=2,b=(0,p.getFirestore)(m.xv),r.prev=3,S=(0,p.doc)(b,"activeGames",c.activeGameId),r.next=4,(0,p.setDoc)(S,{status:"completed",lastUpdated:(0,p.serverTimestamp)()},{merge:!0});case 4:console.log("[JassStore.finalizeGame] ✅ ActiveGame als completed markiert"),r.next=8;break;case 5:if(r.prev=5,"permission-denied"!==(N=r.catch(3)).code){r.next=6;break}console.warn("[JassStore.finalizeGame] ⚠️ Permission-denied beim ActiveGame Update - m\xf6glicherweise bereits gel\xf6scht oder User nicht berechtigt. Fahre fort ohne Fehler."),r.next=8;break;case 6:if("not-found"!==N.code){r.next=7;break}console.warn("[JassStore.finalizeGame] ⚠️ ActiveGame nicht gefunden - bereits gel\xf6scht. Fahre fort ohne Fehler."),r.next=8;break;case 7:throw console.error("[JassStore.finalizeGame] ❌ Unerwarteter Fehler beim ActiveGame Update:",N),N;case 8:return r.prev=8,I=null,c&&"number"==typeof c.id&&1===c.id&&(E=y.roundHistory.find(function(e){return"jass"===e.actionType&&"farbe"in e&&e.farbe}))&&"currentPlayer"in E&&(_=E.currentPlayer-1,(P=(null==(k=s.currentSession)?void 0:k.participantPlayerIds)||[])[_]&&(I=P[_])),(O={gameNumber:"number"==typeof c.id?c.id:parseInt(String(c.id),10),activeGameId:c.activeGameId,timestampCompleted:(0,p.serverTimestamp)(),durationMillis:"number"==typeof d?d:0,finalScores:u.scores,finalStriche:u.striche,eventCounts:{top:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0},bottom:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0}},weisPoints:u.weisPoints,startingPlayer:c.startingPlayer,initialStartingPlayer:c.initialStartingPlayer,playerNames:u.playerNames,trumpColorsPlayed:[],roundHistory:y.roundHistory,participantUids:s.currentSession.participantUids||[],groupId:s.currentSession.gruppeId||null,Rosen10player:I}).eventCounts=(0,f.pK)(O),C=(0,p.doc)(b,"jassGameSummaries",s.currentSession.id,"completedGames",String(c.id)),r.next=9,(0,p.setDoc)(C,(0,g.g)(O));case 9:console.log("[JassStore.finalizeGame] ✅ CompletedGame gespeichert in jassGameSummaries"),r.next=11;break;case 10:r.prev=10,"permission-denied"===(R=r.catch(8)).code?console.warn("[JassStore.finalizeGame] ⚠️ Permission-denied beim jassGameSummaries Schreibzugriff. User m\xf6glicherweise nicht in participantUids."):console.error("[JassStore.finalizeGame] ❌ Fehler beim Speichern der Game Summary:",R);case 11:return r.prev=11,D=(0,p.doc)(b,"sessions",s.currentSession.id),r.next=12,(0,p.setDoc)(D,{currentActiveGameId:null,lastUpdated:(0,p.serverTimestamp)()},{merge:!0});case 12:console.log("[JassStore.finalizeGame] ✅ Session activeGameId cleared"),r.next=15;break;case 13:if(r.prev=13,"permission-denied"!==(L=r.catch(11)).code){r.next=14;break}console.warn("[JassStore.finalizeGame] ⚠️ Permission-denied beim Session Update - User m\xf6glicherweise nicht berechtigt. Fahre fort ohne Fehler."),r.next=15;break;case 14:throw console.error("[JassStore.finalizeGame] ❌ Fehler beim Session Update:",L),L;case 15:r.next=17;break;case 16:r.prev=16,console.error("[JassStore.finalizeGame] ❌ Firestore-Update fehlgeschlagen:",j=r.catch(2)),j&&"object"===x(j)&&"code"in j?"permission-denied"===j.code?(console.warn("[JassStore.finalizeGame] ⚠️ Permission-Problem erkannt. Spiel wird lokal finalisiert, aber Firestore-Sync fehlgeschlagen."),v.showNotification({type:"warning",message:"Spiel wurde lokal abgeschlossen, aber die Online-Synchronisation schlug fehl. Ihre Daten sind trotzdem sicher."})):v.showNotification({type:"error",message:"Fehler beim Abschlie\xdfen des Spiels. Bitte versuchen Sie es erneut."}):v.showNotification({type:"error",message:"Unerwarteter Fehler beim Abschlie\xdfen des Spiels."});case 17:e(function(e){return{games:e.games.map(function(e){return e.id===c.id?y:e})}}),l.completeGame();case 18:case"end":return r.stop()}},r,null,[[2,16],[3,5],[8,10],[11,13]])})),function(){return s.apply(this,arguments)}),resetJass:function(){var r,n;null==(r=(n=t()).sessionUnsubscribe)||r.call(n),e(A({},D))},subscribeToSession:function(r){var n=t().sessionUnsubscribe;n&&n();var o=(0,p.getFirestore)(m.xv),a=(0,p.doc)(o,"sessions",r),s=(0,p.onSnapshot)(a,function(n){if(n.exists()){var o,a,s,u=n.data();u.currentFarbeSettings&&u.currentScoreSettings&&u.currentStrokeSettings&&i.useGameStore.getState().setGameSettings({farbeSettings:u.currentFarbeSettings,scoreSettings:u.currentScoreSettings,strokeSettings:u.currentStrokeSettings});var c=t(),l=null!=(o=null!=(a=u.participantPlayerIds)?a:null==(s=c.currentSession)?void 0:s.participantPlayerIds)?o:[];e(function(e){var t,r,n,i;return A(A({},e),{},{activeGameId:null!=(t=u.currentActiveGameId)?t:null,jassSessionId:null!=(r=u.id)?r:e.jassSessionId,currentSession:A(A(A({},e.currentSession),u),{},{id:null!=(n=u.id)?n:null==(i=e.currentSession)?void 0:i.id,participantPlayerIds:l,currentFarbeSettings:u.currentFarbeSettings,currentScoreSettings:u.currentScoreSettings,currentStrokeSettings:u.currentStrokeSettings})})})}else console.warn("[jassStore] Session-Dokument ".concat(r," nicht gefunden."))},function(e){console.error("[jassStore] Fehler im Session-Listener f\xfcr ".concat(r,":"),e)});e({sessionUnsubscribe:s}),t().syncCompletedGamesForSession(r)},syncCompletedGamesForSession:function(r){var n=t().completedGamesUnsubscribe;n&&n();var i=(0,S.loadCompletedGamesFromFirestore)(r,function(t){e({onlineCompletedGames:t})});e({completedGamesUnsubscribe:i})},clearActiveGameForSession:function(t){e(function(e){var r;return e.currentSession&&e.currentSession.id===t?A(A({},e),{},{activeGameId:null,currentSession:A(A({},e.currentSession),{},{currentActiveGameId:null})}):(console.warn("[JassStore] Attempted to clear activeGameId for session ".concat(t,", but current session is different (").concat(null==(r=e.currentSession)?void 0:r.id,") or null.")),e)})},undoNewGame:function(){var r=t();if(!(r.games.length<=1)){var n=r.games.slice(0,-1),o=n[n.length-1];if(o){var a=i.useGameStore.getState();a.resetGamePoints(),a.setScore("top",o.teams.top.jassPoints),a.setScore("bottom",o.teams.bottom.jassPoints);var s=r.games[r.games.length-1],u=A({},r.teams);u.top=A(A({},u.top),{},{jassPoints:u.top.jassPoints-s.teams.top.jassPoints,total:u.top.total-s.teams.top.jassPoints}),u.bottom=A(A({},u.bottom),{},{jassPoints:u.bottom.jassPoints-s.teams.bottom.jassPoints,total:u.bottom.total-s.teams.bottom.jassPoints}),e({games:n,currentGameId:"string"==typeof o.id?parseInt(o.id,10):o.id,teams:u})}}},navigateToGame:function(n){var o,a=t(),s=a.games.find(function(e){return e.id===n});if(s){a.games.length,null==(o=s.roundHistory)||o.length;var u=h.useTimerStore.getState();if(u.activateGameTimer(n),u.startGameTimer(),u.startRoundTimer(),e(function(e){return A(A({},e),{},{currentGameId:n,teams:s.teams})}),s.activeGameId){var c=s.activeGameId;Promise.resolve().then(r.bind(r,3558)).then(function(t){(0,t.loadRoundsFromFirestore)(c).then(function(t){var r=t.length-1;e(function(e){var r=A(A({},s),{},{roundHistory:t});return A(A({},e),{},{games:e.games.map(function(e){return e.id===s.id?r:e})})}),i.useGameStore.setState(function(e){return A(A({},e),{},{roundHistory:t,currentHistoryIndex:r,historyState:{lastNavigationTimestamp:Date.now()}})})}).catch(function(e){console.error("[JassStore] Error loading rounds from Firestore for game ".concat(c,":"),e),i.useGameStore.setState(function(e){return A(A({},e),{},{currentHistoryIndex:-1,historyState:{lastNavigationTimestamp:Date.now()}})})})}),i.useGameStore.setState(function(e){return A(A({},e),{},{activeGameId:s.activeGameId,isGameStarted:!0,isRoundCompleted:!1,isGameCompleted:!1,currentRound:s.currentRound||1,currentPlayer:s.currentPlayer,scores:{top:s.teams.top.jassPoints,bottom:s.teams.bottom.jassPoints},weisPoints:{top:s.teams.top.weisPoints||0,bottom:s.teams.bottom.weisPoints||0},striche:{top:A({},s.teams.top.striche),bottom:A({},s.teams.bottom.striche)},roundHistory:[],currentHistoryIndex:-1,historyState:{lastNavigationTimestamp:Date.now()},playerNames:e.playerNames})})}else{var l=s.roundHistory||[],d=l.length-1;i.useGameStore.setState(function(e){return A(A({},e),{},{activeGameId:void 0,isGameStarted:!0,isRoundCompleted:!1,isGameCompleted:!1,currentRound:s.currentRound||1,currentPlayer:s.currentPlayer,scores:{top:s.teams.top.jassPoints,bottom:s.teams.bottom.jassPoints},weisPoints:{top:s.teams.top.weisPoints||0,bottom:s.teams.bottom.weisPoints||0},striche:{top:A({},s.teams.top.striche),bottom:A({},s.teams.bottom.striche)},roundHistory:l,currentHistoryIndex:d,historyState:{lastNavigationTimestamp:Date.now()},playerNames:e.playerNames})})}console.log("\uD83C\uDFAE Game Navigation Complete:",{gameId:n,timersStarted:!0,gameStarted:!0,roundStarted:!0,activeGameId:s.activeGameId||"none"})}},navigateToPreviousGame:function(){var e=t();return e.currentGameId>1&&(t().navigateToGame(e.currentGameId-1),!0)},navigateToNextGame:function(){var e=t();if(e.currentGameId<e.games.length){var r=h.useTimerStore.getState();return e.currentGameId,t().navigateToGame(e.currentGameId+1),r.startGameTimer(),r.startRoundTimer(),!0}return!1},canNavigateBack:function(){return t().currentGameId>1},canNavigateForward:function(){var e=t();return e.currentGameId<e.games.length},calculateTotalPoints:function(){var e=t();return{top:e.teams.top.total,bottom:e.teams.bottom.total}},calculateTotalJassPoints:function(){var e=t();return{top:e.teams.top.jassPoints,bottom:e.teams.bottom.jassPoints}},getGameHistory:function(){return t().games},getCurrentGame:function(){var e=t();return e.games.find(function(t){return t.id===e.currentGameId})},getVisibleGames:function(){var e=t();return e.games.filter(function(t){var r=t.id,n="string"==typeof r?parseInt(r,10):r;return"number"==typeof n&&!isNaN(n)&&n<=e.currentGameId})},updateCurrentGame:function(t){e(function(e){var r=e.games.find(function(t){return t.id===e.currentGameId});if(!r)return e;var n=t.teams?{top:A(A({},r.teams.top),t.teams.top),bottom:A(A({},r.teams.bottom),t.teams.bottom)}:r.teams,i=A(A(A({},r),t),{},{teams:n});return A(A({},e),{},{games:e.games.map(function(e){return e.id===i.id?i:e})})})},updateWeisPoints:function(t,r){e(function(e){var n=A({},e.teams);return n[t].weisPoints+=r,n[t].total+=r,{teams:n}})},getTotalsUpToGame:function(e){return t().games.filter(function(t){var r="string"==typeof t.id?parseInt(t.id,10):t.id;return"number"==typeof r&&!isNaN(r)&&r<=e}).reduce(function(e,t){return{striche:{top:{berg:e.striche.top.berg+t.teams.top.striche.berg,sieg:e.striche.top.sieg+t.teams.top.striche.sieg,matsch:e.striche.top.matsch+t.teams.top.striche.matsch,schneider:e.striche.top.schneider+t.teams.top.striche.schneider,kontermatsch:e.striche.top.kontermatsch+t.teams.top.striche.kontermatsch},bottom:{berg:e.striche.bottom.berg+t.teams.bottom.striche.berg,sieg:e.striche.bottom.sieg+t.teams.bottom.striche.sieg,matsch:e.striche.bottom.matsch+t.teams.bottom.striche.matsch,schneider:e.striche.bottom.schneider+t.teams.bottom.striche.schneider,kontermatsch:e.striche.bottom.kontermatsch+t.teams.bottom.striche.kontermatsch}},punkte:{top:e.punkte.top+t.teams.top.total,bottom:e.punkte.bottom+t.teams.bottom.total}}},{striche:{top:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0},bottom:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0}},punkte:{top:0,bottom:0}})},startGame:function(){console.warn("startGame Action not implemented yet.")}})})},4609:(e,t,r)=>{"use strict";r.d(t,{jM:()=>z});var n,i=Symbol.for("immer-nothing"),o=Symbol.for("immer-draftable"),a=Symbol.for("immer-state");function s(e,...t){throw Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var u=Object.getPrototypeOf;function c(e){return!!e&&!!e[a]}function l(e){return!!e&&(d(e)||Array.isArray(e)||!!e[o]||!!e.constructor?.[o]||y(e)||v(e))}var h=Object.prototype.constructor.toString();function d(e){if(!e||"object"!=typeof e)return!1;let t=u(e);if(null===t)return!0;let r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object||"function"==typeof r&&Function.toString.call(r)===h}function f(e,t){0===p(e)?Reflect.ownKeys(e).forEach(r=>{t(r,e[r],e)}):e.forEach((r,n)=>t(n,r,e))}function p(e){let t=e[a];return t?t.type_:Array.isArray(e)?1:y(e)?2:3*!!v(e)}function m(e,t){return 2===p(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function g(e,t,r){let n=p(e);2===n?e.set(t,r):3===n?e.add(r):e[t]=r}function y(e){return e instanceof Map}function v(e){return e instanceof Set}function b(e){return e.copy_||e.base_}function w(e,t){if(y(e))return new Map(e);if(v(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);let r=d(e);if(!0!==t&&("class_only"!==t||r)){let t=u(e);return null!==t&&r?{...e}:Object.assign(Object.create(t),e)}{let t=Object.getOwnPropertyDescriptors(e);delete t[a];let r=Reflect.ownKeys(t);for(let n=0;n<r.length;n++){let i=r[n],o=t[i];!1===o.writable&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(t[i]={configurable:!0,writable:!0,enumerable:o.enumerable,value:e[i]})}return Object.create(u(e),t)}}function S(e,t=!1){return I(e)||c(e)||!l(e)||(p(e)>1&&(e.set=e.add=e.clear=e.delete=x),Object.freeze(e),t&&Object.entries(e).forEach(([e,t])=>S(t,!0))),e}function x(){s(2)}function I(e){return Object.isFrozen(e)}var E={};function T(e){let t=E[e];return t||s(0,e),t}function k(e,t){t&&(T("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function _(e){P(e),e.drafts_.forEach(O),e.drafts_=null}function P(e){e===n&&(n=e.parent_)}function A(e){return n={drafts_:[],parent_:n,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function O(e){let t=e[a];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function C(e,t){t.unfinalizedDrafts_=t.drafts_.length;let r=t.drafts_[0];return void 0!==e&&e!==r?(r[a].modified_&&(_(t),s(4)),l(e)&&(e=D(t,e),t.parent_||R(t,e)),t.patches_&&T("Patches").generateReplacementPatches_(r[a].base_,e,t.patches_,t.inversePatches_)):e=D(t,r,[]),_(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==i?e:void 0}function D(e,t,r){if(I(t))return t;let n=t[a];if(!n)return f(t,(i,o)=>N(e,n,t,i,o,r)),t;if(n.scope_!==e)return t;if(!n.modified_)return R(e,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;let t=n.copy_,i=t,o=!1;3===n.type_&&(i=new Set(t),t.clear(),o=!0),f(i,(i,a)=>N(e,n,t,i,a,r,o)),R(e,t,!1),r&&e.patches_&&T("Patches").generatePatches_(n,r,e.patches_,e.inversePatches_)}return n.copy_}function N(e,t,r,n,i,o,a){if(c(i)){let a=D(e,i,o&&t&&3!==t.type_&&!m(t.assigned_,n)?o.concat(n):void 0);if(g(r,n,a),!c(a))return;e.canAutoFreeze_=!1}else a&&r.add(i);if(l(i)&&!I(i)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;D(e,i),(!t||!t.scope_.parent_)&&"symbol"!=typeof n&&Object.prototype.propertyIsEnumerable.call(r,n)&&R(e,i)}}function R(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&S(t,r)}var L={get(e,t){if(t===a)return e;let r=b(e);if(!m(r,t)){var n=e,i=r,o=t;let a=G(i,o);return a?"value"in a?a.value:a.get?.call(n.draft_):void 0}let s=r[t];return e.finalized_||!l(s)?s:s===F(e.base_,t)?(U(e),e.copy_[t]=V(s,e)):s},has:(e,t)=>t in b(e),ownKeys:e=>Reflect.ownKeys(b(e)),set(e,t,r){let n=G(b(e),t);if(n?.set)return n.set.call(e.draft_,r),!0;if(!e.modified_){let n=F(b(e),t),i=n?.[a];if(i&&i.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if((r===n?0!==r||1/r==1/n:r!=r&&n!=n)&&(void 0!==r||m(e.base_,t)))return!0;U(e),M(e)}return!!(e.copy_[t]===r&&(void 0!==r||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t]))||(e.copy_[t]=r,e.assigned_[t]=!0,!0)},deleteProperty:(e,t)=>(void 0!==F(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,U(e),M(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){let r=b(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n?{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:n.enumerable,value:r[t]}:n},defineProperty(){s(11)},getPrototypeOf:e=>u(e.base_),setPrototypeOf(){s(12)}},j={};function F(e,t){let r=e[a];return(r?b(r):e)[t]}function G(e,t){if(!(t in e))return;let r=u(e);for(;r;){let e=Object.getOwnPropertyDescriptor(r,t);if(e)return e;r=u(r)}}function M(e){!e.modified_&&(e.modified_=!0,e.parent_&&M(e.parent_))}function U(e){e.copy_||(e.copy_=w(e.base_,e.scope_.immer_.useStrictShallowCopy_))}function V(e,t){let r=y(e)?T("MapSet").proxyMap_(e,t):v(e)?T("MapSet").proxySet_(e,t):function(e,t){let r=Array.isArray(e),i={type_:+!!r,scope_:t?t.scope_:n,modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1},o=i,a=L;r&&(o=[i],a=j);let{revoke:s,proxy:u}=Proxy.revocable(o,a);return i.draft_=u,i.revoke_=s,u}(e,t);return(t?t.scope_:n).drafts_.push(r),r}f(L,(e,t)=>{j[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),j.deleteProperty=function(e,t){return j.set.call(this,e,t,void 0)},j.set=function(e,t,r){return L.set.call(this,e[0],t,r,e[0])};var B=new class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,r)=>{let n;if("function"==typeof e&&"function"!=typeof t){let r=t;t=e;let n=this;return function(e=r,...i){return n.produce(e,e=>t.call(this,e,...i))}}if("function"!=typeof t&&s(6),void 0!==r&&"function"!=typeof r&&s(7),l(e)){let i=A(this),o=V(e,void 0),a=!0;try{n=t(o),a=!1}finally{a?_(i):P(i)}return k(i,r),C(n,i)}if(e&&"object"==typeof e)s(1,e);else{if(void 0===(n=t(e))&&(n=e),n===i&&(n=void 0),this.autoFreeze_&&S(n,!0),r){let t=[],i=[];T("Patches").generateReplacementPatches_(e,n,t,i),r(t,i)}return n}},this.produceWithPatches=(e,t)=>{let r,n;return"function"==typeof e?(t,...r)=>this.produceWithPatches(t,t=>e(t,...r)):[this.produce(e,t,(e,t)=>{r=e,n=t}),r,n]},"boolean"==typeof e?.autoFreeze&&this.setAutoFreeze(e.autoFreeze),"boolean"==typeof e?.useStrictShallowCopy&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){var t;l(e)||s(8),c(e)&&(c(t=e)||s(10,t),e=function e(t){let r;if(!l(t)||I(t))return t;let n=t[a];if(n){if(!n.modified_)return n.base_;n.finalized_=!0,r=w(t,n.scope_.immer_.useStrictShallowCopy_)}else r=w(t,!0);return f(r,(t,n)=>{g(r,t,e(n))}),n&&(n.finalized_=!1),r}(t));let r=A(this),n=V(e,void 0);return n[a].isManual_=!0,P(r),n}finishDraft(e,t){let r=e&&e[a];r&&r.isManual_||s(9);let{scope_:n}=r;return k(n,t),C(void 0,n)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){let n=t[r];if(0===n.path.length&&"replace"===n.op){e=n.value;break}}r>-1&&(t=t.slice(r+1));let n=T("Patches").applyPatches_;return c(e)?n(e,t):this.produce(e,e=>n(e,t))}},z=B.produce;B.produceWithPatches.bind(B),B.setAutoFreeze.bind(B),B.setUseStrictShallowCopy.bind(B),B.applyPatches.bind(B),B.createDraft.bind(B),B.finishDraft.bind(B)},4796:(e,t,r)=>{"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}r.d(t,{GH:()=>o,Zr:()=>a});var o=function(e,t){return e.reduce(function(e,r){var n,i,o,a,s,u,c,l,h,d;return{berg:e.berg+(null!=(n=null==(i=r.teams[t].striche)?void 0:i.berg)?n:0),sieg:e.sieg+(null!=(o=null==(a=r.teams[t].striche)?void 0:a.sieg)?o:0),matsch:e.matsch+(null!=(s=null==(u=r.teams[t].striche)?void 0:u.matsch)?s:0),schneider:e.schneider+(null!=(c=null==(l=r.teams[t].striche)?void 0:l.schneider)?c:0),kontermatsch:e.kontermatsch+(null!=(h=null==(d=r.teams[t].striche)?void 0:d.kontermatsch)?h:0)}},{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0})},a=function(e){return e.berg+e.sieg+e.schneider}},4902:(e,t,r)=>{"use strict";r.d(t,{C6:()=>i,Cl:()=>o,Tt:()=>a,fX:()=>s});var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function i(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var o=function(){return(o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function a(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)0>t.indexOf(n[i])&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}Object.create;function s(e,t,r){if(r||2==arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}Object.create,"function"==typeof SuppressedError&&SuppressedError},5048:(e,t,r)=>{"use strict";r.d(t,{L:()=>n});let n=(0,r(4232).createContext)({})},5063:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var n=r(4232),i=r(8477),o=r(7212),a=r(3355),s=r(3649),u=r(7876),c=function(e){var t=e.checked,r=e.onChange,n=e.label,i=e.className,o=function(){var e=!t;console.log("\uD83C\uDFAF [Custom Checkbox] Clicked:",{current:t,new:e,label:n}),r(e)};return(0,u.jsxs)("label",{className:"flex items-center cursor-pointer text-gray-300 text-sm hover:text-white transition-colors ".concat(void 0===i?"":i),children:[(0,u.jsx)("div",{className:"mr-2 w-5 h-5 border-2 rounded flex items-center justify-center transition-all duration-200 cursor-pointer",style:{backgroundColor:t?"#EAB308":"#374151",borderColor:t?"#EAB308":"#6B7280",color:t?"white":"transparent"},onClick:o,children:(0,u.jsx)("span",{style:{fontSize:"12px",fontWeight:"bold"},children:t?"✓":""})}),(0,u.jsx)("span",{className:"select-none",onClick:o,children:n})]})},l=r(1302);function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}let d=function(){var e,t=(0,s.useUIStore)(function(e){return e.notifications}),r=(0,s.useUIStore)(function(e){return e.removeNotification}),d=(0,s.useUIStore)(function(e){return e.iosNotification}),f=(0,s.useUIStore)(function(e){return e.setIOSNotificationDontShowAgain}),p=function(e){if(Array.isArray(e))return e}(e=(0,n.useState)(!1))||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],u=!0,c=!1;try{o=(r=r.call(e)).next,!1;for(;!(u=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,2)||function(e,t){if(e){if("string"==typeof e)return h(e,2);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return h(e,t)}}(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),m=p[0],g=p[1];(0,n.useEffect)(function(){g(!0)},[]);var y=function(e){if(e.image)return(0,u.jsx)("img",{src:e.image,alt:"",className:"w-56 h-56 mb-4 rounded-lg object-cover"});switch(e.type){case"warning":return(0,u.jsx)(l.BS8,{className:"w-12 h-12 text-yellow-600 mb-2"});case"success":case"bedanken":return(0,u.jsx)(l.A7C,{className:"w-12 h-12 text-green-600 mb-2"});case"error":return(0,u.jsx)(l.BS8,{className:"w-12 h-12 text-red-600 mb-2"});default:return(0,u.jsx)(l.__w,{className:"w-12 h-12 text-blue-600 mb-2"})}},v=function(e){var t;return null!=(t=e.actions)&&t.length?e.actions.map(function(t,n){return(0,u.jsx)("button",{onClick:function(){t.onClick(),r(e.id)},className:"\n          flex-1 px-6 py-2 rounded-full \n          text-lg font-semibold\n          ".concat(("bedanken"===e.type||"success"===e.type)&&n===e.actions.length-1?"bg-green-600 hover:bg-green-700":n===e.actions.length-1?"bg-yellow-600 hover:bg-yellow-700":"bg-gray-600 hover:bg-gray-700","\n          text-white\n          transition-all duration-100\n          active:scale-95 active:opacity-80\n        "),children:t.label},n)}):(0,u.jsx)("div",{className:"flex justify-center w-full",children:(0,u.jsx)("button",{onClick:function(){return r(e.id)},className:" w-36 bg-yellow-600 text-white px-6 py-2 rounded-full hover:bg-yellow-700 transition-all duration-100 text-lg font-semibold active:scale-95 active:opacity-80 ",children:"Verstanden"})})},b=(0,u.jsx)(o.N,{mode:"wait",children:t.map(function(e){var t,n,i,o,s,l;return(0,u.jsxs)(a.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"\n            fixed inset-0 flex items-center justify-center z-[9999]\n            ".concat(e.isFlipped?"rotate-180":"","\n            ").concat("bedanken"===e.type?"items-end pb-4":"","\n          "),children:[(0,u.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:function(){e.preventClose||r(e.id)}}),(0,u.jsxs)(a.P.div,{initial:{scale:.95},animate:{scale:1},exit:{scale:.95},className:"bg-gray-800 p-6 rounded-lg shadow-lg max-w-xs w-full relative text-white z-10",children:[(0,u.jsxs)("div",{className:"flex flex-col items-center justify-center mb-4",children:[y(e),(0,u.jsx)("p",{className:"text-center mb-6 mt-4",children:e.message})]}),e.checkbox&&(0,u.jsx)("div",{className:"flex items-center justify-center mb-4",children:(0,u.jsx)(c,{checked:e.checkbox.checked,onChange:e.checkbox.onChange,label:e.checkbox.label})}),(e.simpleCheckbox||e.isIOSNotification)&&(0,u.jsx)("div",{className:"flex items-center justify-center mb-6",children:(0,u.jsxs)("div",{className:"flex items-center cursor-pointer select-none px-3 py-2 rounded-lg transition-all duration-200 ".concat((e.isIOSNotification?d.dontShowAgain:null==(t=e.simpleCheckbox)?void 0:t.checked)?"bg-yellow-600/20":"bg-gray-700/30 hover:bg-gray-600/40"),onClick:function(){if(e.isIOSNotification){var t=!d.dontShowAgain;console.log("\uD83C\uDFAF [GlobalContainer iOS] Klick:",{notificationId:e.id,current:d.dontShowAgain,new:t}),f(t)}else if(e.simpleCheckbox){var r=!e.simpleCheckbox.checked;console.log("\uD83C\uDFAF [GlobalContainer SimpleCheckbox] Klick:",{notificationId:e.id,current:e.simpleCheckbox.checked,new:r}),e.simpleCheckbox.onChange(r)}},children:[(0,u.jsx)("div",{className:"w-6 h-6 border-2 rounded mr-3 flex items-center justify-center transition-all duration-200 ".concat((e.isIOSNotification?d.dontShowAgain:null==(n=e.simpleCheckbox)?void 0:n.checked)?"bg-yellow-600 border-yellow-600 text-white":"bg-gray-700 border-gray-500"),children:(e.isIOSNotification?d.dontShowAgain:null==(i=e.simpleCheckbox)?void 0:i.checked)&&(0,u.jsx)("span",{className:"text-white text-lg font-bold leading-none",children:"✓"})}),(0,u.jsx)("span",{className:"text-sm transition-colors duration-200 ".concat((e.isIOSNotification?d.dontShowAgain:null==(o=e.simpleCheckbox)?void 0:o.checked)?"text-yellow-300 font-medium":"text-gray-300"),children:e.isIOSNotification?"Nicht mehr anzeigen":null==(s=e.simpleCheckbox)?void 0:s.label})]})}),(0,u.jsx)("div",{className:"flex justify-".concat((null==(l=e.actions)?void 0:l.length)===1?"center":"between"," gap-4"),children:v(e)})]})]},"notification-".concat(e.id))})});return m?i.createPortal(b,document.body):null}},5226:(e,t,r)=>{"use strict";r.d(t,{XR:()=>ew,qk:()=>eb,c7:()=>ex,KR:()=>eS,D:()=>ev});var n,i,o=r(6796),a=r(1139),s=r(8308);let u="firebasestorage.googleapis.com",c="storageBucket";class l extends a.g{constructor(e,t,r=0){super(h(e),`Firebase Storage: ${t} (${h(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,l.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return h(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}function h(e){return"storage/"+e}function d(){return new l(n.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function f(){return new l(n.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function p(){return new l(n.CANCELED,"User canceled the upload/download.")}function m(){return new l(n.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function g(e){return new l(n.INVALID_ARGUMENT,e)}function y(){return new l(n.APP_DELETED,"The Firebase app was deleted.")}function v(e,t){return new l(n.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function b(e){throw new l(n.INTERNAL_ERROR,"Internal error: "+e)}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(n||(n={}));class w{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=w.makeFromUrl(e,t)}catch(t){return new w(e,"")}if(""===r.path)return r;throw new l(n.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}static makeFromUrl(e,t){let r=null,i="([A-Za-z0-9.\\-_]+)",o=RegExp("^gs://"+i+"(/(.*))?$","i");function a(e){e.path_=decodeURIComponent(e.path)}let s=t.replace(/[.]/g,"\\."),c=RegExp(`^https?://${s}/v[A-Za-z0-9_]+/b/${i}/o(/([^?#]*).*)?$`,"i"),h=t===u?"(?:storage.googleapis.com|storage.cloud.google.com)":t,d=[{regex:o,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:c,indices:{bucket:1,path:3},postModify:a},{regex:RegExp(`^https?://${h}/${i}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:a}];for(let t=0;t<d.length;t++){let n=d[t],i=n.regex.exec(e);if(i){let e=i[n.indices.bucket],t=i[n.indices.path];t||(t=""),r=new w(e,t),n.postModify(r);break}}if(null==r)throw new l(n.INVALID_URL,"Invalid URL '"+e+"'.");return r}}class S{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function x(e){return"string"==typeof e||e instanceof String}function I(e){return E()&&e instanceof Blob}function E(){return"undefined"!=typeof Blob}function T(e,t,r,n){if(n<t)throw g(`Invalid value for '${e}'. Expected ${t} or greater.`);if(n>r)throw g(`Invalid value for '${e}'. Expected ${r} or less.`)}function k(e,t,r){let n=t;return null==r&&(n=`https://${t}`),`${r}://${n}/v0${e}`}function _(e){let t=encodeURIComponent,r="?";for(let n in e)e.hasOwnProperty(n)&&(r=r+(t(n)+"=")+t(e[n])+"&");return r.slice(0,-1)}function P(e,t){let r=e>=500&&e<600,n=-1!==[408,429].indexOf(e),i=-1!==t.indexOf(e);return r||n||i}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(i||(i={}));class A{constructor(e,t,r,n,i,o,a,s,u,c,l,h=!0,d=!1){this.url_=e,this.method_=t,this.headers_=r,this.body_=n,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=s,this.timeout_=u,this.progressCallback_=c,this.connectionFactory_=l,this.retry=h,this.isUsingEmulator=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){let e=(e,t)=>{let r=this.resolve_,n=this.reject_,i=t.connection;if(t.wasSuccessCode)try{let e=this.callback_(i,i.getResponse());void 0!==e?r(e):r()}catch(e){n(e)}else if(null!==i){let e=d();e.serverResponse=i.getErrorText(),n(this.errorCallback_?this.errorCallback_(i,e):e)}else n(t.canceled?this.appDelete_?y():p():f())};this.canceled_?e(!1,new O(!1,null,!0)):this.backoffId_=function(e,t,r){let n=1,i=null,o=null,a=!1,s=0,u=!1;function c(...e){u||(u=!0,t.apply(null,e))}function l(t){i=setTimeout(()=>{i=null,e(d,2===s)},t)}function h(){o&&clearTimeout(o)}function d(e,...t){let r;if(u)return void h();if(e||2===s||a){h(),c.call(null,e,...t);return}n<64&&(n*=2),1===s?(s=2,r=0):r=(n+Math.random())*1e3,l(r)}let f=!1;function p(e){f||(f=!0,h(),!u&&(null!==i?(e||(s=2),clearTimeout(i),l(0)):e||(s=1)))}return l(0),o=setTimeout(()=>{a=!0,p(!0)},r),p}((e,t)=>{if(t)return void e(!1,new O(!1,null,!0));let r=this.connectionFactory_();this.pendingConnection_=r;let n=e=>{let t=e.loaded,r=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,r)};null!==this.progressCallback_&&r.addUploadProgressListener(n),r.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&r.removeUploadProgressListener(n),this.pendingConnection_=null;let t=r.getErrorCode()===i.NO_ERROR,o=r.getStatus();if(!t||P(o,this.additionalRetryCodes_)&&this.retry)return void e(!1,new O(!1,null,r.getErrorCode()===i.ABORT));e(!0,new O(-1!==this.successCodes_.indexOf(o),r))})},e,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class O{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function C(...e){let t="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==t){let r=new t;for(let t=0;t<e.length;t++)r.append(e[t]);return r.getBlob()}if(E())return new Blob(e);throw new l(n.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}let D={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class N{constructor(e,t){this.data=e,this.contentType=t||null}}function R(e){let t=[];for(let r=0;r<e.length;r++){let n=e.charCodeAt(r);n<=127?t.push(n):n<=2047?t.push(192|n>>6,128|63&n):(64512&n)==55296?r<e.length-1&&(64512&e.charCodeAt(r+1))==56320?(n=65536|(1023&n)<<10|1023&e.charCodeAt(++r),t.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n)):t.push(239,191,189):(64512&n)==56320?t.push(239,191,189):t.push(224|n>>12,128|n>>6&63,128|63&n)}return new Uint8Array(t)}function L(e,t){let r;switch(e){case D.BASE64:{let r=-1!==t.indexOf("-"),n=-1!==t.indexOf("_");if(r||n)throw v(e,"Invalid character '"+(r?"-":"_")+"' found: is it base64url encoded?");break}case D.BASE64URL:{let r=-1!==t.indexOf("+"),n=-1!==t.indexOf("/");if(r||n)throw v(e,"Invalid character '"+(r?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/")}}try{r=function(e){if("undefined"==typeof atob)throw new l(n.UNSUPPORTED_ENVIRONMENT,"base-64 is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.");return atob(e)}(t)}catch(t){if(t.message.includes("polyfill"))throw t;throw v(e,"Invalid character found")}let i=new Uint8Array(r.length);for(let e=0;e<r.length;e++)i[e]=r.charCodeAt(e);return i}class j{constructor(e){this.base64=!1,this.contentType=null;let t=e.match(/^data:([^,]+)?,/);if(null===t)throw v(D.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");let r=t[1]||null;null!=r&&(this.base64=function(e,t){return e.length>=t.length&&e.substring(e.length-t.length)===t}(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}class F{constructor(e,t){let r=0,n="";I(e)?(this.data_=e,r=e.size,n=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=n}size(){return this.size_}type(){return this.type_}slice(e,t){if(!I(this.data_))return new F(new Uint8Array(this.data_.buffer,e,t-e),!0);{var r,n,i;let o=(r=this.data_,n=e,i=t,r.webkitSlice?r.webkitSlice(n,i):r.mozSlice?r.mozSlice(n,i):r.slice?r.slice(n,i):null);return null===o?null:new F(o)}}static getBlob(...e){if(E()){let t=e.map(e=>e instanceof F?e.data_:e);return new F(C.apply(null,t))}{let t=e.map(e=>x(e)?function(e,t){switch(e){case D.RAW:return new N(R(t));case D.BASE64:case D.BASE64URL:return new N(L(e,t));case D.DATA_URL:return new N(function(e){let t,r=new j(e);if(r.base64)return L(D.BASE64,r.rest);var n=r.rest;try{t=decodeURIComponent(n)}catch(e){throw v(D.DATA_URL,"Malformed data URL.")}return R(t)}(t),new j(t).contentType)}throw d()}(D.RAW,e).data:e.data_),r=0;t.forEach(e=>{r+=e.byteLength});let n=new Uint8Array(r),i=0;return t.forEach(e=>{for(let t=0;t<e.length;t++)n[i++]=e[t]}),new F(n,!0)}}uploadData(){return this.data_}}function G(e){var t;let r;try{r=JSON.parse(e)}catch(e){return null}return"object"!=typeof(t=r)||Array.isArray(t)?null:r}function M(e){let t=e.lastIndexOf("/",e.length-2);return -1===t?e:e.slice(t+1)}function U(e,t){return t}class V{constructor(e,t,r,n){this.server=e,this.local=t||e,this.writable=!!r,this.xform=n||U}}let B=null;function z(){if(B)return B;let e=[];e.push(new V("bucket")),e.push(new V("generation")),e.push(new V("metageneration")),e.push(new V("name","fullPath",!0));let t=new V("name");t.xform=function(e,t){return!x(t)||t.length<2?t:M(t)},e.push(t);let r=new V("size");return r.xform=function(e,t){return void 0!==t?Number(t):t},e.push(r),e.push(new V("timeCreated")),e.push(new V("updated")),e.push(new V("md5Hash",null,!0)),e.push(new V("cacheControl",null,!0)),e.push(new V("contentDisposition",null,!0)),e.push(new V("contentEncoding",null,!0)),e.push(new V("contentLanguage",null,!0)),e.push(new V("contentType",null,!0)),e.push(new V("metadata","customMetadata",!0)),B=e}function H(e,t,r){let n=G(t);return null===n?null:function(e,t,r){let n={};n.type="file";let i=r.length;for(let e=0;e<i;e++){let i=r[e];n[i.local]=i.xform(n,t[i.server])}return Object.defineProperty(n,"ref",{get:function(){let t=new w(n.bucket,n.fullPath);return e._makeStorageReference(t)}}),n}(e,n,r)}function q(e,t){let r={},n=t.length;for(let i=0;i<n;i++){let n=t[i];n.writable&&(r[n.server]=e[n.local])}return JSON.stringify(r)}let $="prefixes",K="items";class W{constructor(e,t,r,n){this.url=e,this.method=t,this.handler=r,this.timeout=n,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function J(e){if(!e)throw d()}function Q(e,t){return function(r,n){let i=H(e,n,t);return J(null!==i),i}}function Y(e){return function(t,r){var i,o;let a;return 401===t.getStatus()?a=t.getErrorText().includes("Firebase App Check token is invalid")?new l(n.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new l(n.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(i=e.bucket,a=new l(n.QUOTA_EXCEEDED,"Quota for bucket '"+i+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(o=e.path,a=new l(n.UNAUTHORIZED,"User does not have permission to access '"+o+"'.")):a=r,a.status=t.getStatus(),a.serverResponse=r.serverResponse,a}}function X(e){let t=Y(e);return function(r,i){var o;let a=t(r,i);return 404===r.getStatus()&&(o=e.path,a=new l(n.OBJECT_NOT_FOUND,"Object '"+o+"' does not exist.")),a.serverResponse=i.serverResponse,a}}function Z(e,t,r){let n=Object.assign({},r);return n.fullPath=e.path,n.size=t.size(),n.contentType||(n.contentType=t&&t.type()||"application/octet-stream"),n}function ee(e,t,r,n,i){let o=t.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"},s=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();a["Content-Type"]="multipart/related; boundary="+s;let u=Z(t,n,i),c="--"+s+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+q(u,r)+"\r\n--"+s+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",l=F.getBlob(c,n,"\r\n--"+s+"--");if(null===l)throw m();let h={name:u.fullPath},d=k(o,e.host,e._protocol),f=e.maxUploadRetryTime,p=new W(d,"POST",Q(e,r),f);return p.urlParams=h,p.headers=a,p.body=l.uploadData(),p.errorHandler=Y(t),p}class et{constructor(e,t,r,n){this.current=e,this.total=t,this.finalized=!!r,this.metadata=n||null}}function er(e,t){let r=null;try{r=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){J(!1)}return J(!!r&&-1!==(t||["active"]).indexOf(r)),r}let en={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function ei(e){switch(e){case"running":case"pausing":case"canceling":return en.RUNNING;case"paused":return en.PAUSED;case"success":return en.SUCCESS;case"canceled":return en.CANCELED;default:return en.ERROR}}class eo{constructor(e,t,r){"function"==typeof e||null!=t||null!=r?(this.next=e,this.error=null!=t?t:void 0,this.complete=null!=r?r:void 0):(this.next=e.next,this.error=e.error,this.complete=e.complete)}}function ea(e){return(...t)=>{Promise.resolve().then(()=>e(...t))}}class es{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=i.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=i.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=i.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,n,i){if(this.sent_)throw b("cannot .send() more than once");if((0,a.zJ)(e)&&r&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==i)for(let e in i)i.hasOwnProperty(e)&&this.xhr_.setRequestHeader(e,i[e].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw b("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw b("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return -1}}getResponse(){if(!this.sent_)throw b("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw b("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class eu extends es{initXhr(){this.xhr_.responseType="text"}}function ec(){return new eu}class el extends null{initXhr(){this.xhr_.responseType="arraybuffer"}}class eh extends null{initXhr(){this.xhr_.responseType="blob"}}class ed{constructor(e,t){this._service=e,t instanceof w?this._location=t:this._location=w.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new ed(e,t)}get root(){let e=new w(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return M(this._location.path)}get storage(){return this._service}get parent(){let e=function(e){if(0===e.length)return null;let t=e.lastIndexOf("/");return -1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;let t=new w(this._location.bucket,e);return new ed(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw new l(n.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}}function ef(e,t){let r=null==t?void 0:t[c];return null==r?null:w.makeFromBucketSpec(r,e)}class ep{constructor(e,t,r,n,i,o=!1){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=n,this._firebaseVersion=i,this._isUsingEmulator=o,this._bucket=null,this._host=u,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,null!=n?this._bucket=w.makeFromBucketSpec(n,this._host):this._bucket=ef(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=w.makeFromBucketSpec(this._url,e):this._bucket=ef(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){T("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){T("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){if((0,o.xZ)(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new ed(this,e)}_makeRequest(e,t,r,n,i=!0){if(this._deleted)return new S(y());{let o=function(e,t,r,n,i,o,a=!0,s=!1){let u=_(e.urlParams),c=e.url+u,l=Object.assign({},e.headers);return t&&(l["X-Firebase-GMPID"]=t),null!==r&&r.length>0&&(l.Authorization="Firebase "+r),l["X-Firebase-Storage-Version"]="webjs/"+(null!=o?o:"AppManager"),null!==n&&(l["X-Firebase-AppCheck"]=n),new A(c,e.method,l,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,a,s)}(e,this._appId,r,n,t,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,t){let[r,n]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,n).getPromise()}}let em="@firebase/storage",eg="0.13.14",ey="storage";function ev(e,t,r){var n=e=(0,a.Ku)(e),i=t,o=r;n._throwIfRoot("uploadBytes");let s=ee(n.storage,n._location,z(),new F(i,!0),o);return n.storage.makeRequestWithTokens(s,ec).then(e=>({metadata:e,ref:n}))}function eb(e){var t=e=(0,a.Ku)(e);t._throwIfRoot("getDownloadURL");let r=function(e,t,r){let n=k(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime,o=new W(n,"GET",function(t,n){let i=H(e,n,r);return J(null!==i),function(e,t,r,n){let i=G(t);if(null===i||!x(i.downloadTokens))return null;let o=i.downloadTokens;if(0===o.length)return null;let a=encodeURIComponent;return o.split(",").map(t=>{let i=e.bucket,o=e.fullPath;return k("/b/"+a(i)+"/o/"+a(o),r,n)+_({alt:"media",token:t})})[0]}(i,n,e.host,e._protocol)},i);return o.errorHandler=X(t),o}(t.storage,t._location,z());return t.storage.makeRequestWithTokens(r,ec).then(e=>{if(null===e)throw new l(n.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e})}function ew(e){var t=e=(0,a.Ku)(e);t._throwIfRoot("deleteObject");let r=function(e,t){let r=k(t.fullServerUrl(),e.host,e._protocol),n=new W(r,"DELETE",function(e,t){},e.maxOperationRetryTime);return n.successCodes=[200,204],n.errorHandler=X(t),n}(t.storage,t._location);return t.storage.makeRequestWithTokens(r,ec)}function eS(e,t){var r=e=(0,a.Ku)(e);if(!(t&&/^[A-Za-z]+:\/\//.test(t)))return function e(t,r){if(t instanceof ep){if(null==t._bucket)throw new l(n.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+c+"' property when initializing the app?");let i=new ed(t,t._bucket);return null!=r?e(i,r):i}if(void 0!==r){var i=t,o=r;let e=function(e,t){let r=t.split("/").filter(e=>e.length>0).join("/");return 0===e.length?r:e+"/"+r}(i._location.path,o),n=new w(i._location.bucket,e);return new ed(i.storage,n)}return t}(r,t);if(r instanceof ep)return new ed(r,t);throw g("To use ref(service, url), the first argument must be a Storage instance.")}function ex(e=(0,o.Sx)(),t){e=(0,a.Ku)(e);let r=(0,o.j6)(e,ey).getImmediate({identifier:t}),n=(0,a.yU)("storage");return n&&function(e,t,r,n={}){!function(e,t,r,n={}){e.host=`${t}:${r}`;let i=(0,a.zJ)(t);i&&((0,a.gE)(`https://${e.host}/b`),(0,a.P1)("Storage",!0)),e._isUsingEmulator=!0,e._protocol=i?"https":"http";let{mockUserToken:o}=n;o&&(e._overrideAuthToken="string"==typeof o?o:(0,a.Fy)(o,e.app.options.projectId))}(e,t,r,n)}(r,...n),r}(0,o.om)(new s.uA(ey,function(e,{instanceIdentifier:t}){let r=e.getProvider("app").getImmediate();return new ep(r,e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t,o.MF)},"PUBLIC").setMultipleInstances(!0)),(0,o.KO)(em,eg,""),(0,o.KO)(em,eg,"esm2017")},5230:(e,t,r)=>{"use strict";r.d(t,{FE:()=>b,Wq:()=>y,_N:()=>p,_h:()=>v,eg:()=>E,hE:()=>w,kQ:()=>g,nA:()=>x,ri:()=>S,x:()=>I});var n=r(3786),i=r(2009),o=r(5226),a=r(5519),s=r(1411);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach(function(t){var n,i,o;n=e,i=t,o=r[t],(i=function(e){var t=function(e,t){if("object"!==u(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==u(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===u(t)?t:String(t)}(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function h(){h=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function d(t,r,n,o){var a,s,u,c,l=Object.create((r&&r.prototype instanceof v?r:v).prototype);return i(l,"_invoke",{value:(a=t,s=n,u=new A(o||[]),c=p,function(t,r){if(c===m)throw Error("Generator is already running");if(c===g){if("throw"===t)throw r;return{value:e,done:!0}}for(u.method=t,u.arg=r;;){var n=u.delegate;if(n){var i=function t(r,n){var i=n.method,o=r.iterator[i];if(o===e)return n.delegate=null,"throw"===i&&r.iterator.return&&(n.method="return",n.arg=e,t(r,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+i+"' method")),y;var a=f(o,r.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,y;var s=a.arg;return s?s.done?(n[r.resultName]=s.value,n.next=r.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):s:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,y)}(n,u);if(i){if(i===y)continue;return i}}if("next"===u.method)u.sent=u._sent=u.arg;else if("throw"===u.method){if(c===p)throw c=g,u.arg;u.dispatchException(u.arg)}else"return"===u.method&&u.abrupt("return",u.arg);c=m;var o=f(a,s,u);if("normal"===o.type){if(c=u.done?g:"suspendedYield",o.arg===y)continue;return{value:o.arg,done:u.done}}"throw"===o.type&&(c=g,u.method="throw",u.arg=o.arg)}})}),l}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var p="suspendedStart",m="executing",g="completed",y={};function v(){}function b(){}function w(){}var S={};l(S,a,function(){return this});var x=Object.getPrototypeOf,I=x&&x(x(O([])));I&&I!==r&&n.call(I,a)&&(S=I);var E=w.prototype=v.prototype=Object.create(S);function T(e){["next","throw","return"].forEach(function(t){l(e,t,function(e){return this._invoke(t,e)})})}function k(e,t){var r;i(this,"_invoke",{value:function(i,o){function a(){return new t(function(r,a){!function r(i,o,a,s){var c=f(e[i],e,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==u(h)&&n.call(h,"__await")?t.resolve(h.__await).then(function(e){r("next",e,a,s)},function(e){r("throw",e,a,s)}):t.resolve(h).then(function(e){l.value=e,a(l)},function(e){return r("throw",e,a,s)})}s(c.arg)}(i,o,r,a)})}return r=r?r.then(a,a):a()}})}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function O(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw TypeError(u(t)+" is not iterable")}return b.prototype=w,i(E,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:b,configurable:!0}),b.displayName=l(w,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,l(e,c,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},T(k.prototype),l(k.prototype,s,function(){return this}),t.AsyncIterator=k,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new k(d(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},T(E),l(E,c,"Generator"),l(E,a,function(){return this}),l(E,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function d(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(n,i)}function f(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){d(o,n,i,a,s,"next",e)}function s(e){d(o,n,i,a,s,"throw",e)}a(void 0)})}}var p=function(e,t){var r,n,i,o;return{uid:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL,emailVerified:e.emailVerified,isAnonymous:e.isAnonymous,metadata:{creationTime:e.metadata.creationTime,lastSignInTime:e.metadata.lastSignInTime},lastActiveGroupId:null!=(r=null==t?void 0:t.lastActiveGroupId)?r:null,statusMessage:null!=(n=null==t?void 0:t.statusMessage)?n:null,playerId:null!=(i=null==t?void 0:t.playerId)?i:null,profileTheme:null!=(o=null==t?void 0:t.profileTheme)?o:null}},m=function(){var e=f(h().mark(function e(t){var r,n,o,s,u=arguments;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>1&&void 0!==u[1]&&u[1],!(!t||!t.uid||!a.db)){e.next=1;break}throw Error("Invalid user or Firestore not initialized.");case 1:return e.prev=1,n=(0,i.doc)(a.db,"users",t.uid),o={email:t.email,displayName:t.displayName,lastLogin:(0,i.serverTimestamp)()},r&&(o.createdAt=(0,i.serverTimestamp)(),o.statusMessage="Gr\xfcezi! Ich jasse mit Jassguru.",o.preferences={theme:"light",notifications:!0}),e.next=2,(0,i.setDoc)(n,o,{merge:!0});case 2:e.next=4;break;case 3:throw e.prev=3,s=e.catch(1),console.error("Error in createOrUpdateFirestoreUser for ".concat(t.uid,":"),s),Error("Failed to save user data: ".concat(s instanceof Error?s.message:String(s)));case 4:case"end":return e.stop()}},e,null,[[1,3]])}));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=f(h().mark(function e(t,r){var n,o,s;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!t||!r||0===Object.keys(r).length)){e.next=1;break}return e.abrupt("return");case 1:if(n=["uid","email","createdAt","provider","displayName","photoURL"],!Object.keys(r).some(function(e){return n.includes(e)})){e.next=2;break}throw Error("Attempted to update forbidden/public fields in private user document.");case 2:return e.prev=2,o=(0,i.doc)(a.db,"users",t),e.next=3,(0,i.updateDoc)(o,l(l({},r),{},{lastUpdated:(0,i.serverTimestamp)()}));case 3:e.next=6;break;case 4:if(e.prev=4,!((s=e.catch(2))instanceof Error&&s.message.includes("No document to update"))){e.next=5;break}return e.abrupt("return");case 5:throw console.error("Error updating user document for ".concat(t,":"),s),Error("Failed to update user document.");case 6:case"end":return e.stop()}},e,null,[[2,4]])}));return function(t,r){return e.apply(this,arguments)}}(),y=function(){var e=f(h().mark(function e(t,r,i){var o,a,s,u;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=(0,n.xI)(),e.next=1,(0,n.eJ)(o,t,r);case 1:if(a=e.sent.user,!i){e.next=2;break}return e.next=2,(0,n.r7)(a,{displayName:i});case 2:return e.next=3,m(a,!0);case 3:return e.next=4,(0,n.gA)(a);case 4:return e.abrupt("return",p(a));case 5:if(e.prev=5,console.error("Registrierungsfehler im Service:",{email:t,error:u=e.catch(0)}),!(u instanceof Error)){e.next=7;break}if("auth/email-already-in-use"!==(s=u.code)){e.next=6;break}throw Error("Diese E-Mail-Adresse wird bereits verwendet.");case 6:if("auth/weak-password"!==s){e.next=7;break}throw Error("Das Passwort ist zu schwach. Es muss mindestens 6 Zeichen lang sein.");case 7:throw Error("Registrierung fehlgeschlagen. Bitte \xfcberpr\xfcfen Sie Ihre Eingaben.");case 8:case"end":return e.stop()}},e,null,[[0,5]])}));return function(t,r,n){return e.apply(this,arguments)}}(),v=function(){var e=f(h().mark(function e(t,r){var i,o,a,s;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,(0,n.x9)((0,n.xI)(),t,r);case 1:if(!(i=e.sent.user)){e.next=4;break}return e.next=2,m(i,!1);case 2:return e.next=3,T(i.uid);case 3:return o=e.sent,e.abrupt("return",p(i,o));case 4:throw Error("Anmeldung fehlgeschlagen: Kein Benutzerobjekt erhalten.");case 5:e.next=9;break;case 6:if(e.prev=6,console.error("Login Fehler (Email):",{email:t,error:s=e.catch(0)}),!(s instanceof Error)){e.next=8;break}if("auth/user-not-found"!==(a=s.code)&&"auth/wrong-password"!==a&&"auth/invalid-credential"!==a){e.next=7;break}throw Error("Ung\xfcltige E-Mail-Adresse oder Passwort.");case 7:if("auth/user-disabled"!==a){e.next=8;break}throw Error("Dieses Benutzerkonto wurde deaktiviert.");case 8:throw Error("Anmeldung fehlgeschlagen. Bitte versuchen Sie es erneut.");case 9:case"end":return e.stop()}},e,null,[[0,6]])}));return function(t,r){return e.apply(this,arguments)}}(),b=function(){var e=f(h().mark(function e(){var t,r,o,s,u,c,l,d,f;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=new n.HF,e.next=1,(0,n.df)((0,n.xI)(),t);case 1:return r=e.sent.user,o=(0,i.doc)(a.db,"users",r.uid),e.next=2,(0,i.getDoc)(o);case 2:return s=e.sent,e.next=3,m(r,!s.exists());case 3:return e.abrupt("return",p(r));case 4:if(e.prev=4,console.error("Google Sign-In Fehler:",{error:f=e.catch(0)}),!(f instanceof Error)){e.next=8;break}if("auth/popup-closed-by-user"!==(u=f.code)){e.next=5;break}throw Error("Google Sign-In wurde abgebrochen.");case 5:if("auth/account-exists-with-different-credential"!==u){e.next=8;break}if(!(l=null==f||null==(c=f.customData)?void 0:c.email)){e.next=7;break}return e.next=6,(0,n.Wm)((0,n.xI)(),l);case 6:throw d=e.sent,Error("Ein Konto existiert bereits mit dieser E-Mail (".concat(l,"), aber mit einer anderen Anmeldemethode (").concat(d.join(", "),")."));case 7:throw Error("Ein Konto existiert bereits mit dieser E-Mail, aber mit einer anderen Anmeldemethode.");case 8:throw Error("Google Sign-In fehlgeschlagen. Bitte versuchen Sie es erneut.");case 9:case"end":return e.stop()}},e,null,[[0,4]])}));return function(){return e.apply(this,arguments)}}(),w=function(e){return(0,n.J1)((0,n.xI)(),e)},S=function(){return(0,n.CI)((0,n.xI)())},x=function(){var e=a.j2.currentUser;if(!e)throw Error("No user logged in.");return(0,n.gA)(e)},I=function(){var e=f(h().mark(function e(t,r){var i,a,u,c,l,d,f;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!(i=(0,n.xI)().currentUser)||i.uid!==r)){e.next=1;break}throw Error("Authentication error.");case 1:return a=(0,o.c7)(),u=(0,o.KR)(a,"profileImages/".concat(r,"/profile.").concat(t.name.split(".").pop())),e.next=2,(0,o.D)(u,t);case 2:return c=e.sent,e.next=3,(0,o.qk)(c.ref);case 3:return l=e.sent,e.next=4,(0,n.r7)(i,{photoURL:l});case 4:return e.next=5,(0,s.getPlayerIdForUser)(r,i.displayName);case 5:if(!(d=e.sent)){e.next=6;break}return e.next=6,(0,s.updatePlayerDocument)(d,{photoURL:l});case 6:return e.next=7,T(r);case 7:return f=e.sent,e.abrupt("return",p(i,f));case 8:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}(),E=function(){var e=f(h().mark(function e(t){var r,i,o;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(0,n.xI)().currentUser){e.next=1;break}throw Error("No authenticated user found.");case 1:if(i=r.uid,!t.displayName){e.next=2;break}return e.next=2,(0,n.r7)(r,{displayName:t.displayName});case 2:return e.next=3,(0,s.getPlayerIdForUser)(i,r.displayName);case 3:if(!(o=e.sent)){e.next=5;break}return e.next=4,(0,s.updatePlayerDocument)(o,t);case 4:e.next=6;break;case 5:console.warn("Could not find player document for user ".concat(i," to sync profile updates."));case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),T=function(){var e=f(h().mark(function e(t){var r,n;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.db){e.next=1;break}return e.abrupt("return",null);case 1:return r=(0,i.doc)(a.db,"users",t),e.next=2,(0,i.getDoc)(r);case 2:return n=e.sent,e.abrupt("return",n.exists()?n.data():null);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},5237:(e,t,r)=>{"use strict";var n=r(5364);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{default:function(){return v},defaultHead:function(){return p}});var a=r(4252),s=r(8365),u=r(7876),c=s._(r(4232)),l=a._(r(7666)),h=r(6781),d=r(7405),f=r(5441);function p(e){void 0===e&&(e=!1);var t=[(0,u.jsx)("meta",{charSet:"utf-8"},"charset")];return e||t.push((0,u.jsx)("meta",{name:"viewport",content:"width=device-width"},"viewport")),t}function m(e,t){return"string"==typeof t||"number"==typeof t?e:t.type===c.default.Fragment?e.concat(c.default.Children.toArray(t.props.children).reduce(function(e,t){return"string"==typeof t||"number"==typeof t?e:e.concat(t)},[])):e.concat(t)}r(1049);var g=["name","httpEquiv","charSet","itemProp"];function y(e,t){var r,a,s,u,l=t.inAmpMode;return e.reduce(m,[]).reverse().concat(p(l).reverse()).filter((r=new Set,a=new Set,s=new Set,u={},function(e){var t=!0,n=!1;if(e.key&&"number"!=typeof e.key&&e.key.indexOf("$")>0){n=!0;var i=e.key.slice(e.key.indexOf("$")+1);r.has(i)?t=!1:r.add(i)}switch(e.type){case"title":case"base":a.has(e.type)?t=!1:a.add(e.type);break;case"meta":for(var o=0,c=g.length;o<c;o++){var l=g[o];if(e.props.hasOwnProperty(l))if("charSet"===l)s.has(l)?t=!1:s.add(l);else{var h=e.props[l],d=u[l]||new Set;("name"!==l||!n)&&d.has(h)?t=!1:(d.add(h),u[l]=d)}}}return t})).reverse().map(function(e,t){var r=e.key||t;if(n.env.__NEXT_OPTIMIZE_FONTS&&!l&&"link"===e.type&&e.props.href&&["https://fonts.googleapis.com/css","https://use.typekit.net/"].some(function(t){return e.props.href.startsWith(t)})){var a=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach(function(t){var n,o,a;n=e,o=t,a=r[t],(o=function(e){var t=function(e,t){if("object"!==i(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==i(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===i(t)?t:String(t)}(o))in n?Object.defineProperty(n,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[o]=a}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},e.props||{});return a["data-href"]=a.href,a.href=void 0,a["data-optimized-fonts"]=!0,c.default.cloneElement(e,a)}return c.default.cloneElement(e,{key:r})})}var v=function(e){var t=e.children,r=(0,c.useContext)(h.AmpStateContext),n=(0,c.useContext)(d.HeadManagerContext);return(0,u.jsx)(l.default,{reduceComponentsToState:y,headManager:n,inAmpMode:(0,f.isInAmpMode)(r),children:t})};("function"==typeof t.default||"object"===i(t.default)&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},5364:(e,t,r)=>{"use strict";var n,i;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(i=r.g.process)?void 0:i.env)?r.g.process:r(5861)},5441:(e,t)=>{"use strict";function r(e){var t=void 0===e?{}:e,r=t.ampFirst,n=t.hybrid,i=t.hasQuery;return void 0!==r&&r||void 0!==n&&n&&void 0!==i&&i}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"isInAmpMode",{enumerable:!0,get:function(){return r}})},5519:(e,t,r)=>{"use strict";let n,i,o,a;r.d(t,{Dc:()=>eD.Timestamp,j2:()=>u,rJ:()=>eD.collection,_f:()=>eM,db:()=>c,H9:()=>eD.doc,xv:()=>eU,x7:()=>eD.getDoc,GG:()=>eD.getDocs,P:()=>eD.query,O5:()=>eD.serverTimestamp,BN:()=>eD.setDoc,IG:()=>l,mZ:()=>eD.updateDoc,_M:()=>eD.where});var s,u,c,l,h=r(6042),d=r(3786),f=r(6796),p=r(6525),m=r(1139),g=r(8308),y=r(2704);let v="@firebase/installations",b="0.6.18",w=`w:${b}`,S="FIS_v2",x=new m.FA("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function I(e){return e instanceof m.g&&e.code.includes("request-failed")}function E({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function T(e){return{token:e.token,requestStatus:2,expiresIn:Number(e.expiresIn.replace("s","000")),creationTime:Date.now()}}async function k(e,t){let r=(await t.json()).error;return x.create("request-failed",{requestName:e,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function _({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function P(e,{refreshToken:t}){var r;let n=_(e);return n.append("Authorization",(r=t,`${S} ${r}`)),n}async function A(e){let t=await e();return t.status>=500&&t.status<600?e():t}async function O({appConfig:e,heartbeatServiceProvider:t},{fid:r}){let n=E(e),i=_(e),o=t.getImmediate({optional:!0});if(o){let e=await o.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}let a={method:"POST",headers:i,body:JSON.stringify({fid:r,authVersion:S,appId:e.appId,sdkVersion:w})},s=await A(()=>fetch(n,a));if(s.ok){let e=await s.json();return{fid:e.fid||r,registrationStatus:2,refreshToken:e.refreshToken,authToken:T(e.authToken)}}throw await k("Create Installation",s)}function C(e){return new Promise(t=>{setTimeout(t,e)})}let D=/^[cdef][\w-]{21}$/;function N(e){return`${e.appName}!${e.appId}`}let R=new Map;function L(e,t){let r=N(e);j(r,t),function(e,t){let r=function(){return!F&&"BroadcastChannel"in self&&((F=new BroadcastChannel("[Firebase] FID Change")).onmessage=e=>{j(e.data.key,e.data.fid)}),F}();r&&r.postMessage({key:e,fid:t}),function(){0===R.size&&F&&(F.close(),F=null)}()}(r,t)}function j(e,t){let r=R.get(e);if(r)for(let e of r)e(t)}let F=null,G="firebase-installations-store",M=null;function U(){return M||(M=(0,y.P2)("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(G)}})),M}async function V(e,t){let r=N(e),n=(await U()).transaction(G,"readwrite"),i=n.objectStore(G),o=await i.get(r);return await i.put(t,r),await n.done,o&&o.fid===t.fid||L(e,t.fid),t}async function B(e){let t=N(e),r=(await U()).transaction(G,"readwrite");await r.objectStore(G).delete(t),await r.done}async function z(e,t){let r=N(e),n=(await U()).transaction(G,"readwrite"),i=n.objectStore(G),o=await i.get(r),a=t(o);return void 0===a?await i.delete(r):await i.put(a,r),await n.done,a&&(!o||o.fid!==a.fid)&&L(e,a.fid),a}async function H(e){let t,r=await z(e.appConfig,r=>{let n=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(x.create("app-offline"))};let r={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},n=q(e,r);return{installationEntry:r,registrationPromise:n}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:$(e)}:{installationEntry:t}}(e,W(r||{fid:function(){try{var e;let t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;let r=(e=t,btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22));return D.test(r)?r:""}catch(e){return""}}(),registrationStatus:0}));return t=n.registrationPromise,n.installationEntry});return""===r.fid?{installationEntry:await t}:{installationEntry:r,registrationPromise:t}}async function q(e,t){try{let r=await O(e,t);return V(e.appConfig,r)}catch(r){throw I(r)&&409===r.customData.serverCode?await B(e.appConfig):await V(e.appConfig,{fid:t.fid,registrationStatus:0}),r}}async function $(e){let t=await K(e.appConfig);for(;1===t.registrationStatus;)await C(100),t=await K(e.appConfig);if(0===t.registrationStatus){let{installationEntry:t,registrationPromise:r}=await H(e);return r||t}return t}function K(e){return z(e,e=>{if(!e)throw x.create("installation-not-found");return W(e)})}function W(e){var t;return 1===(t=e).registrationStatus&&t.registrationTime+1e4<Date.now()?{fid:e.fid,registrationStatus:0}:e}async function J({appConfig:e,heartbeatServiceProvider:t},r){let n=function(e,{fid:t}){return`${E(e)}/${t}/authTokens:generate`}(e,r),i=P(e,r),o=t.getImmediate({optional:!0});if(o){let e=await o.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}let a={method:"POST",headers:i,body:JSON.stringify({installation:{sdkVersion:w,appId:e.appId}})},s=await A(()=>fetch(n,a));if(s.ok)return T(await s.json());throw await k("Generate Auth Token",s)}async function Q(e,t=!1){let r,n=await z(e.appConfig,n=>{var i;if(!ee(n))throw x.create("not-registered");let o=n.authToken;if(!t&&2===(i=o).requestStatus&&!function(e){let t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(i))return n;if(1===o.requestStatus)return r=Y(e,t),n;{if(!navigator.onLine)throw x.create("app-offline");let t=function(e){let t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(n);return r=Z(e,t),t}});return r?await r:n.authToken}async function Y(e,t){let r=await X(e.appConfig);for(;1===r.authToken.requestStatus;)await C(100),r=await X(e.appConfig);let n=r.authToken;return 0===n.requestStatus?Q(e,t):n}function X(e){return z(e,e=>{var t;if(!ee(e))throw x.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+1e4<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function Z(e,t){try{let r=await J(e,t),n=Object.assign(Object.assign({},t),{authToken:r});return await V(e.appConfig,n),r}catch(r){if(I(r)&&(401===r.customData.serverCode||404===r.customData.serverCode))await B(e.appConfig);else{let r=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await V(e.appConfig,r)}throw r}}function ee(e){return void 0!==e&&2===e.registrationStatus}async function et(e){let{installationEntry:t,registrationPromise:r}=await H(e);return r?r.catch(console.error):Q(e).catch(console.error),t.fid}async function er(e,t=!1){return await en(e),(await Q(e,t)).token}async function en(e){let{registrationPromise:t}=await H(e);t&&await t}function ei(e){return x.create("missing-app-config-values",{valueName:e})}let eo="installations";(0,f.om)(new g.uA(eo,e=>{let t=e.getProvider("app").getImmediate(),r=function(e){if(!e||!e.options)throw ei("App Configuration");if(!e.name)throw ei("App Name");for(let t of["projectId","apiKey","appId"])if(!e.options[t])throw ei(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t),n=(0,f.j6)(t,"heartbeat");return{app:t,appConfig:r,heartbeatServiceProvider:n,_delete:()=>Promise.resolve()}},"PUBLIC")),(0,f.om)(new g.uA("installations-internal",e=>{let t=e.getProvider("app").getImmediate(),r=(0,f.j6)(t,eo).getImmediate();return{getId:()=>et(r),getToken:e=>er(r,e)}},"PRIVATE")),(0,f.KO)(v,b),(0,f.KO)(v,b,"esm2017");let ea="analytics",es="https://www.googletagmanager.com/gtag/js",eu=new p.Vy("@firebase/analytics"),ec=new m.FA("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function el(e){if(!e.startsWith(es)){let t=ec.create("invalid-gtag-resource",{gtagURL:e});return eu.warn(t.message),""}return e}function eh(e){return Promise.all(e.map(e=>e.catch(e=>e)))}async function ed(e,t,r,n,i,o){let a=n[i];try{if(a)await t[a];else{let e=(await eh(r)).find(e=>e.measurementId===i);e&&await t[e.appId]}}catch(e){eu.error(e)}e("config",i,o)}async function ef(e,t,r,n,i){try{let o=[];if(i&&i.send_to){let e=i.send_to;Array.isArray(e)||(e=[e]);let n=await eh(r);for(let r of e){let e=n.find(e=>e.measurementId===r),i=e&&t[e.appId];if(i)o.push(i);else{o=[];break}}}0===o.length&&(o=Object.values(t)),await Promise.all(o),e("event",n,i||{})}catch(e){eu.error(e)}}class ep{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}let em=new ep;async function eg(e){var t;let{appId:r,apiKey:n}=e,i={method:"GET",headers:new Headers({Accept:"application/json","x-goog-api-key":n})},o="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",r),a=await fetch(o,i);if(200!==a.status&&304!==a.status){let e="";try{let r=await a.json();(null==(t=r.error)?void 0:t.message)&&(e=r.error.message)}catch(e){}throw ec.create("config-fetch-failed",{httpStatus:a.status,responseMessage:e})}return a.json()}async function ey(e,t=em,r){let{appId:n,apiKey:i,measurementId:o}=e.options;if(!n)throw ec.create("no-app-id");if(!i){if(o)return{measurementId:o,appId:n};throw ec.create("no-api-key")}let a=t.getThrottleMetadata(n)||{backoffCount:0,throttleEndTimeMillis:Date.now()},s=new eb;return setTimeout(async()=>{s.abort()},void 0!==r?r:6e4),ev({appId:n,apiKey:i,measurementId:o},a,s,t)}async function ev(e,{throttleEndTimeMillis:t,backoffCount:r},n,i=em){var o,a,s;let{appId:u,measurementId:c}=e;try{await (a=n,s=t,new Promise((e,t)=>{let r=setTimeout(e,Math.max(s-Date.now(),0));a.addEventListener(()=>{clearTimeout(r),t(ec.create("fetch-throttle",{throttleEndTimeMillis:s}))})}))}catch(e){if(c)return eu.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:u,measurementId:c};throw e}try{let t=await eg(e);return i.deleteThrottleMetadata(u),t}catch(s){if(!function(e){if(!(e instanceof m.g)||!e.customData)return!1;let t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(s)){if(i.deleteThrottleMetadata(u),c)return eu.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${null==s?void 0:s.message}]`),{appId:u,measurementId:c};throw s}let t=503===Number(null==(o=null==s?void 0:s.customData)?void 0:o.httpStatus)?(0,m.p9)(r,i.intervalMillis,30):(0,m.p9)(r,i.intervalMillis),a={throttleEndTimeMillis:Date.now()+t,backoffCount:r+1};return i.setThrottleMetadata(u,a),eu.debug(`Calling attemptFetch again in ${t} millis`),ev(e,a,n,i)}}class eb{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function ew(e,t,r,n,i){if(i&&i.global)return void e("event",r,n);{let i=await t;e("event",r,Object.assign(Object.assign({},n),{send_to:i}))}}async function eS(){if(!(0,m.zW)())return eu.warn(ec.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await (0,m.eX)()}catch(e){return eu.warn(ec.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}async function ex(e,t,r,o,a,s,u){var c;let l=ey(e);l.then(t=>{r[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&eu.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(e=>eu.error(e)),t.push(l);let h=eS().then(e=>e?o.getId():void 0),[d,f]=await Promise.all([l,h]);!function(e){for(let t of Object.values(window.document.getElementsByTagName("script")))if(t.src&&t.src.includes(es)&&t.src.includes(e))return t;return null}(s)&&function(e,t){var r,n;let i,o=(r="firebase-js-sdk-policy",n={createScriptURL:el},window.trustedTypes&&(i=window.trustedTypes.createPolicy(r,n)),i),a=document.createElement("script"),s=`${es}?l=${e}&id=${t}`;a.src=o?null==o?void 0:o.createScriptURL(s):s,a.async=!0,document.head.appendChild(a)}(s,d.measurementId),i&&(a("consent","default",i),i=void 0),a("js",new Date);let p=null!=(c=null==u?void 0:u.config)?c:{};return p.origin="firebase",p.update=!0,null!=f&&(p.firebase_id=f),a("config",d.measurementId,p),n&&(a("set",n),n=void 0),d.measurementId}class eI{constructor(e){this.app=e}_delete(){return delete eE[this.app.options.appId],Promise.resolve()}}let eE={},eT=[],ek={},e_="dataLayer",eP=!1;async function eA(){if((0,m.sr)()||!(0,m.dM)()||!(0,m.zW)())return!1;try{return await (0,m.eX)()}catch(e){return!1}}let eO="@firebase/analytics",eC="0.10.17";(0,f.om)(new g.uA(ea,(e,{options:t})=>(function(e,t,r){let n=[];if((0,m.sr)()&&n.push("This is a browser extension environment."),(0,m.dM)()||n.push("Cookies are not available."),n.length>0){let e=n.map((e,t)=>`(${t+1}) ${e}`).join(" "),t=ec.create("invalid-analytics-context",{errorInfo:e});eu.warn(t.message)}let i=e.options.appId;if(!i)throw ec.create("no-app-id");if(!e.options.apiKey)if(e.options.measurementId)eu.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw ec.create("no-api-key");if(null!=eE[i])throw ec.create("already-exists",{id:i});if(!eP){var s,u;let e,t;e=[],Array.isArray(window[e_])?e=window[e_]:window[e_]=e;let{wrappedGtag:r,gtagCore:n}=(s="gtag",t=function(...e){window[e_].push(arguments)},window[s]&&"function"==typeof window[s]&&(t=window[s]),window[s]=(u=t,async function(e,...t){try{if("event"===e){let[e,r]=t;await ef(u,eE,eT,e,r)}else if("config"===e){let[e,r]=t;await ed(u,eE,eT,ek,e,r)}else if("consent"===e){let[e,r]=t;u("consent",e,r)}else if("get"===e){let[e,r,n]=t;u("get",e,r,n)}else if("set"===e){let[e]=t;u("set",e)}else u(e,...t)}catch(e){eu.error(e)}}),{gtagCore:t,wrappedGtag:window[s]});a=r,o=n,eP=!0}return eE[i]=ex(e,eT,ek,t,o,e_,r),new eI(e)})(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t),"PUBLIC")),(0,f.om)(new g.uA("analytics-internal",function(e){try{let t=e.getProvider(ea).getImmediate();return{logEvent:(e,r,n)=>{var i;return i=t,void(i=(0,m.Ku)(i),ew(a,eE[i.app.options.appId],e,r,n).catch(e=>eu.error(e)))}}}catch(e){throw ec.create("interop-component-reg-failed",{reason:e})}},"PRIVATE")),(0,f.KO)(eO,eC),(0,f.KO)(eO,eC,"esm2017");var eD=r(2009),eN=r(5226);function eR(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return eL(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return eL(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eL(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var ej="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname,eF={apiKey:"AIzaSyDlzJTOPQhBFm20Cl4IpSkJbM95gtL_xXc",authDomain:"jassguru.firebaseapp.com",projectId:"jassguru",storageBucket:"jassguru.firebasestorage.app",messagingSenderId:"827424297556",appId:"1:827424297556:web:b8a0bec41f98fb35fa53c1"};(Object.entries(eF).filter(function(e){var t=eR(e,2);return t[0],!t[1]}).map(function(e){return eR(e,1)[0]}).length>0||0)&&console.error("❌ FIREBASE-KONFIGURATION FEHLT! ❌\nBitte stelle sicher, dass du die .env.local Datei korrekt eingerichtet hast.\nKopiere .env.example zu .env.local und f\xfclle alle NEXT_PUBLIC_FIREBASE_* Werte aus.\nDie Anwendung wird nicht korrekt funktionieren, bis dies behoben ist.");var eG=!1;try{s=(0,h.Wp)(eF),u=(0,d.xI)(s),(0,d.oM)(u,d.F0).then(function(){}).catch(function(e){console.error("Fehler beim Setzen der Persistenz:",e)});try{c=(0,eD.initializeFirestore)(s,{localCache:(0,eD.persistentLocalCache)({tabManager:(0,eD.persistentMultipleTabManager)(),cacheSizeBytes:eD.CACHE_SIZE_UNLIMITED})})}catch(e){console.error("Fehler bei der Firestore-Initialisierung:",e),c=(0,eD.getFirestore)(s)}l=(0,eN.c7)(s),eG=!0,ej||eA().then(function(e){e&&function(e=(0,f.Sx)()){e=(0,m.Ku)(e);let t=(0,f.j6)(e,ea);t.isInitialized()?t.getImmediate():function(e,t={}){let r=(0,f.j6)(e,ea);if(r.isInitialized()){if(r.getImmediate(),(0,m.bD)(t,r.getOptions()))return;throw ec.create("already-initialized")}r.initialize({options:t})}(e)}(s)}).catch(function(e){console.error("Analytics nicht unterst\xfctzt:",e)})}catch(e){console.error("Fehler bei der Firebase-Initialisierung:",e),s={},u={},c={}}var eM={users:null,players:null,groups:null,games:null,teams:null};if(eG)try{eM={users:(0,eD.collection)(c,"users"),players:(0,eD.collection)(c,"players"),groups:(0,eD.collection)(c,"groups"),games:(0,eD.collection)(c,"games"),teams:(0,eD.collection)(c,"teams")}}catch(e){console.error("Fehler beim Initialisieren der Firestore-Collections:",e)}var eU=s},5609:(e,t,r)=>{"use strict";r.d(t,{s:()=>i});var n=r(7594);function i(e){return(0,n.G)(e)&&"offsetHeight"in e}},5844:(e,t,r)=>{"use strict";r.d(t,{SR:()=>i,lt:()=>n,sn:()=>a,yX:()=>o});var n={green:{primary:"bg-green-600",primaryHover:"bg-green-700/80",accent:"bg-green-500",profileImage:"bg-green-600/20",accentHex:"#22c55e"},blue:{primary:"bg-blue-600",primaryHover:"bg-blue-700/80",accent:"bg-blue-500",profileImage:"bg-blue-600/20",accentHex:"#3b82f6"},purple:{primary:"bg-purple-600",primaryHover:"bg-purple-700/80",accent:"bg-purple-500",profileImage:"bg-purple-600/20",accentHex:"#a855f7"},pink:{primary:"bg-pink-600",primaryHover:"bg-pink-700/80",accent:"bg-pink-500",profileImage:"bg-pink-600/20",accentHex:"#ec4899"},yellow:{primary:"bg-yellow-600",primaryHover:"bg-yellow-700/80",accent:"bg-yellow-500",profileImage:"bg-yellow-600/20",accentHex:"#eab308"},teal:{primary:"bg-teal-600",primaryHover:"bg-teal-700/80",accent:"bg-teal-500",profileImage:"bg-teal-600/20",accentHex:"#14b8a6"},orange:{primary:"bg-orange-600",primaryHover:"bg-orange-700/80",accent:"bg-orange-500",profileImage:"bg-orange-600/20",accentHex:"#f97316"},cyan:{primary:"bg-cyan-600",primaryHover:"bg-cyan-700/80",accent:"bg-cyan-500",profileImage:"bg-cyan-600/20",accentHex:"#06b6d4"}},i="blue",o=function(e){if(e&&n[e])return e;var t=localStorage.getItem("jasstafel-profile-theme");return t&&n[t]?t:i},a=function(e){return e&&n[e]?e:i}},5861:e=>{!function(){var t={229:function(e){var t,r,n,i=e.exports={};function o(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}try{t="function"==typeof setTimeout?setTimeout:o}catch(e){t=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===o||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}var u=[],c=!1,l=-1;function h(){c&&n&&(c=!1,n.length?u=n.concat(u):l=-1,u.length&&d())}function d(){if(!c){var e=s(h);c=!0;for(var t=u.length;t;){for(n=u,u=[];++l<t;)n&&n[l].run();l=-1,t=u.length}n=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function p(){}i.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new f(e,t)),1!==u.length||c||s(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=p,i.addListener=p,i.once=p,i.off=p,i.removeListener=p,i.removeAllListeners=p,i.emit=p,i.prependListener=p,i.prependOnceListener=p,i.listeners=function(e){return[]},i.binding=function(e){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw Error("process.chdir is not supported")},i.umask=function(){return 0}}},r={};function n(e){var i=r[e];if(void 0!==i)return i.exports;var o=r[e]={exports:{}},a=!0;try{t[e](o,o.exports,n),a=!1}finally{a&&delete r[e]}return o.exports}n.ab="//",e.exports=n(229)}()},6042:(e,t,r)=>{"use strict";r.d(t,{Wp:()=>n.Wp,g:()=>n.g});var n=r(6796);(0,n.KO)("firebase","11.10.0","app")},6170:(e,t,r)=>{"use strict";r.d(t,{PW:()=>a,m$:()=>u,pK:()=>s});var n=r(8517);function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=function(e,t){if(!e||!t)return console.warn("generatePairingId: Eine oder beide PlayerIDs fehlen.",{playerId1:e,playerId2:t}),"invalid_pairing_missing_ids";var r=[e,t].sort();return"".concat(r[0],"_").concat(r[1])},s=function(e){var t=e.finalStriche,r=(e.finalScores,e.roundHistory),n={sieg:0,berg:0,matsch:0,kontermatsch:0,schneider:0},i={sieg:0,berg:0,matsch:0,kontermatsch:0,schneider:0};return r&&Array.isArray(r)&&r.forEach(function(e,t){var r,a=null;if(e&&"object"===o(e)&&"strichInfo"in e&&e.strichInfo)a=e.strichInfo;else if(e&&"object"===o(e)&&null!=(r=e.roundState)&&r.strichInfo)a=e.roundState.strichInfo;else if(e&&"object"===o(e)){for(var s in e)if(s.includes("strich")&&e[s]&&"object"===o(e[s])&&e[s].team&&e[s].type){a=e[s];break}}if(a&&a.type&&a.team){var u=a.team;"matsch"===a.type?"bottom"===u?n.matsch++:"top"===u&&i.matsch++:"kontermatsch"===a.type&&("bottom"===u?n.kontermatsch++:"top"===u&&i.kontermatsch++)}}),t.bottom.sieg>0?n.sieg=1:t.top.sieg>0&&(i.sieg=1),t.bottom.berg>0?n.berg=1:t.top.berg>0&&(i.berg=1),t.bottom.schneider>0?n.schneider=1:t.top.schneider>0&&(i.schneider=1),{bottom:n,top:i}},u=function(e){var t=0,r={},i={},o=null,a=0;return e.forEach(function(e){if((0,n.Aw)(e)){var s=e.durationMillis;if(s&&"number"==typeof s&&(t+=s),e.currentPlayer&&s&&"number"==typeof s){var u=e.currentPlayer.toString();i[u]||(i[u]={totalDuration:0,roundCount:0}),i[u].totalDuration+=s,i[u].roundCount+=1}if(e.farbe&&e.currentPlayer){var c=e.currentPlayer.toString(),l=e.farbe.toLowerCase();r[c]||(r[c]={}),r[c][l]||(r[c][l]=0),r[c][l]+=1}0===a&&e.currentPlayer&&e.farbe&&(o=e.currentPlayer.toString()),a++}}),{totalRoundDurationMillis:t,trumpfCountsByPlayer:r,roundDurationsByPlayer:i,Rosen10player:o}}},6333:(e,t,r)=>{"use strict";r.d(t,{A:()=>l,W:()=>c});var n=r(4232),i=r(1302),o=r(3649),a=r(7212),s=r(3355),u=r(7876),c="Resultat wirklich korrigieren? Folgerunden werden gel\xf6scht.";let l=function(e){var t=e.message,r=e.onConfirm,c=e.onDismiss,l=e.show,h=e.swipePosition,d=void 0===h?"bottom":h,f=(0,o.useUIStore)().closeHistoryWarning,p=(0,n.useRef)(0);(0,n.useEffect)(function(){l&&(p.current=Date.now())},[l]);var m=(0,n.useCallback)(function(){f(),r()},[r,f]),g=(0,n.useCallback)(function(){f(),c()},[c,f]),y=(0,n.useCallback)(function(e){if(Date.now()-p.current<200){e.preventDefault(),e.stopPropagation();return}g()},[g]);return(0,u.jsx)(a.N,{children:l&&(0,u.jsxs)(s.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 flex items-center justify-center z-[9999] p-4 pointer-events-auto",children:[(0,u.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:y}),(0,u.jsx)(s.P.div,{initial:{scale:.95},animate:{scale:1},exit:{scale:.95},className:"bg-gray-800 p-6 rounded-lg shadow-lg max-w-xs w-full relative text-white z-10\n              ".concat("top"===d?"rotate-180":""),children:(0,u.jsxs)("div",{className:"".concat("top"===d?"rotate-180":""),children:[(0,u.jsxs)("div",{className:"flex flex-col items-center justify-center mb-4",children:[(0,u.jsx)(i.BS8,{className:"w-12 h-12 text-red-600 mb-6"}),(0,u.jsx)("p",{className:"text-center mb-6",children:t})]}),(0,u.jsxs)("div",{className:"flex justify-between gap-4",children:[(0,u.jsx)("button",{onClick:m,className:"flex-1 bg-yellow-600 text-white px-6 py-2 rounded-full hover:bg-yellow-700 transition-colors text-lg font-semibold",children:"Ja"}),(0,u.jsx)("button",{onClick:g,className:"flex-1 bg-gray-600 text-white px-6 py-2 rounded-full hover:bg-gray-700 transition-colors text-lg font-semibold",children:"Abbrechen"})]})]})})]})})}},6468:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>eg});var n=r(4232);r(3021);var i=r(9099),o=r(7876);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var s=(0,n.createContext)({isPWA:!1}),u=function(e){var t,r=e.children,i=function(e){if(Array.isArray(e))return e}(t=(0,n.useState)(!1))||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],u=!0,c=!1;try{o=(r=r.call(e)).next,!1;for(;!(u=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(t,2)||function(e,t){if(e){if("string"==typeof e)return a(e,2);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}}(t,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),u=i[0],c=i[1];return(0,n.useEffect)(function(){c(window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone||document.referrer.includes("android-app://"))},[]),(0,o.jsx)(s.Provider,{value:{isPWA:u},children:r})},c=r(7328),l=r.n(c);function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(){d=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(t,r,n,o){var a,s,u,c,l=Object.create((r&&r.prototype instanceof v?r:v).prototype);return i(l,"_invoke",{value:(a=t,s=n,u=new A(o||[]),c=p,function(t,r){if(c===m)throw Error("Generator is already running");if(c===g){if("throw"===t)throw r;return{value:e,done:!0}}for(u.method=t,u.arg=r;;){var n=u.delegate;if(n){var i=function t(r,n){var i=n.method,o=r.iterator[i];if(o===e)return n.delegate=null,"throw"===i&&r.iterator.return&&(n.method="return",n.arg=e,t(r,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+i+"' method")),y;var a=f(o,r.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,y;var s=a.arg;return s?s.done?(n[r.resultName]=s.value,n.next=r.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):s:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,y)}(n,u);if(i){if(i===y)continue;return i}}if("next"===u.method)u.sent=u._sent=u.arg;else if("throw"===u.method){if(c===p)throw c=g,u.arg;u.dispatchException(u.arg)}else"return"===u.method&&u.abrupt("return",u.arg);c=m;var o=f(a,s,u);if("normal"===o.type){if(c=u.done?g:"suspendedYield",o.arg===y)continue;return{value:o.arg,done:u.done}}"throw"===o.type&&(c=g,u.method="throw",u.arg=o.arg)}})}),l}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var p="suspendedStart",m="executing",g="completed",y={};function v(){}function b(){}function w(){}var S={};c(S,a,function(){return this});var x=Object.getPrototypeOf,I=x&&x(x(O([])));I&&I!==r&&n.call(I,a)&&(S=I);var E=w.prototype=v.prototype=Object.create(S);function T(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function k(e,t){var r;i(this,"_invoke",{value:function(i,o){function a(){return new t(function(r,a){!function r(i,o,a,s){var u=f(e[i],e,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==h(l)&&n.call(l,"__await")?t.resolve(l.__await).then(function(e){r("next",e,a,s)},function(e){r("throw",e,a,s)}):t.resolve(l).then(function(e){c.value=e,a(c)},function(e){return r("throw",e,a,s)})}s(u.arg)}(i,o,r,a)})}return r=r?r.then(a,a):a()}})}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function O(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw TypeError(h(t)+" is not iterable")}return b.prototype=w,i(E,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:b,configurable:!0}),b.displayName=c(w,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,c(e,u,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},T(k.prototype),c(k.prototype,s,function(){return this}),t.AsyncIterator=k,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new k(l(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},T(E),c(E,u,"Generator"),c(E,a,function(){return this}),c(E,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function f(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(n,i)}function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return m(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return m(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var g=r(1558),y=r(950),v=r(1411);function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(){w=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(t,r,n,o){var a,s,u,c,l=Object.create((r&&r.prototype instanceof g?r:g).prototype);return i(l,"_invoke",{value:(a=t,s=n,u=new A(o||[]),c=d,function(t,r){if(c===f)throw Error("Generator is already running");if(c===p){if("throw"===t)throw r;return{value:e,done:!0}}for(u.method=t,u.arg=r;;){var n=u.delegate;if(n){var i=function t(r,n){var i=n.method,o=r.iterator[i];if(o===e)return n.delegate=null,"throw"===i&&r.iterator.return&&(n.method="return",n.arg=e,t(r,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+i+"' method")),m;var a=h(o,r.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,m;var s=a.arg;return s?s.done?(n[r.resultName]=s.value,n.next=r.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):s:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,m)}(n,u);if(i){if(i===m)continue;return i}}if("next"===u.method)u.sent=u._sent=u.arg;else if("throw"===u.method){if(c===d)throw c=p,u.arg;u.dispatchException(u.arg)}else"return"===u.method&&u.abrupt("return",u.arg);c=f;var o=h(a,s,u);if("normal"===o.type){if(c=u.done?p:"suspendedYield",o.arg===m)continue;return{value:o.arg,done:u.done}}"throw"===o.type&&(c=p,u.method="throw",u.arg=o.arg)}})}),l}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var d="suspendedStart",f="executing",p="completed",m={};function g(){}function y(){}function v(){}var S={};c(S,a,function(){return this});var x=Object.getPrototypeOf,I=x&&x(x(O([])));I&&I!==r&&n.call(I,a)&&(S=I);var E=v.prototype=g.prototype=Object.create(S);function T(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function k(e,t){var r;i(this,"_invoke",{value:function(i,o){function a(){return new t(function(r,a){!function r(i,o,a,s){var u=h(e[i],e,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==b(l)&&n.call(l,"__await")?t.resolve(l.__await).then(function(e){r("next",e,a,s)},function(e){r("throw",e,a,s)}):t.resolve(l).then(function(e){c.value=e,a(c)},function(e){return r("throw",e,a,s)})}s(u.arg)}(i,o,r,a)})}return r=r?r.then(a,a):a()}})}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function O(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw TypeError(b(t)+" is not iterable")}return y.prototype=v,i(E,"constructor",{value:v,configurable:!0}),i(v,"constructor",{value:y,configurable:!0}),y.displayName=c(v,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,c(e,u,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},T(k.prototype),c(k.prototype,s,function(){return this}),t.AsyncIterator=k,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new k(l(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},T(E),c(E,u,"Generator"),c(E,a,function(){return this}),c(E,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function S(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(n,i)}function x(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return I(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return I(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var E=(0,n.createContext)({user:null,player:null,loading:!0});function T(e){var t=e.children,r=(0,y.useAuthStore)(),i=r.user,a=r.status,s=(r.error,r.appMode),u=x((0,n.useState)(null),2),c=u[0],l=u[1],h=x((0,n.useState)(!0),2),d=h[0],f=h[1],p=x((0,n.useState)(null),2),m=(p[0],p[1]);return(0,n.useEffect)(function(){var e,t,r=(e=w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(f(!0),m(null),e.prev=1,!(i&&"online"===s)){e.next=3;break}return e.next=2,(0,v.getPlayerByUserId)(i.uid);case 2:l(e.sent),e.next=4;break;case 3:l(null);case 4:e.next=6;break;case 5:e.prev=5,console.error("Fehler beim Laden des Spielers:",e.catch(1)),m("Spieler konnte nicht geladen werden");case 6:return e.prev=6,f(!1),e.finish(6);case 7:case"end":return e.stop()}},e,null,[[1,5,6,7]])}),t=function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){S(o,n,i,a,s,"next",e)}function s(e){S(o,n,i,a,s,"throw",e)}a(void 0)})},function(){return t.apply(this,arguments)});("authenticated"===a||"unauthenticated"===a)&&r()},[i,a,s]),(0,o.jsx)(E.Provider,{value:{user:i,player:c,loading:"loading"===a||d},children:t})}var k=r(6602),_=r(3649),P=r(5063);function A(e){return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(){O=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(t,r,n,o){var a,s,u,c,l=Object.create((r&&r.prototype instanceof g?r:g).prototype);return i(l,"_invoke",{value:(a=t,s=n,u=new _(o||[]),c=d,function(t,r){if(c===f)throw Error("Generator is already running");if(c===p){if("throw"===t)throw r;return{value:e,done:!0}}for(u.method=t,u.arg=r;;){var n=u.delegate;if(n){var i=function t(r,n){var i=n.method,o=r.iterator[i];if(o===e)return n.delegate=null,"throw"===i&&r.iterator.return&&(n.method="return",n.arg=e,t(r,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+i+"' method")),m;var a=h(o,r.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,m;var s=a.arg;return s?s.done?(n[r.resultName]=s.value,n.next=r.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):s:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,m)}(n,u);if(i){if(i===m)continue;return i}}if("next"===u.method)u.sent=u._sent=u.arg;else if("throw"===u.method){if(c===d)throw c=p,u.arg;u.dispatchException(u.arg)}else"return"===u.method&&u.abrupt("return",u.arg);c=f;var o=h(a,s,u);if("normal"===o.type){if(c=u.done?p:"suspendedYield",o.arg===m)continue;return{value:o.arg,done:u.done}}"throw"===o.type&&(c=p,u.method="throw",u.arg=o.arg)}})}),l}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var d="suspendedStart",f="executing",p="completed",m={};function g(){}function y(){}function v(){}var b={};c(b,a,function(){return this});var w=Object.getPrototypeOf,S=w&&w(w(P([])));S&&S!==r&&n.call(S,a)&&(b=S);var x=v.prototype=g.prototype=Object.create(b);function I(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function E(e,t){var r;i(this,"_invoke",{value:function(i,o){function a(){return new t(function(r,a){!function r(i,o,a,s){var u=h(e[i],e,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==A(l)&&n.call(l,"__await")?t.resolve(l.__await).then(function(e){r("next",e,a,s)},function(e){r("throw",e,a,s)}):t.resolve(l).then(function(e){c.value=e,a(c)},function(e){return r("throw",e,a,s)})}s(u.arg)}(i,o,r,a)})}return r=r?r.then(a,a):a()}})}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function _(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function P(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw TypeError(A(t)+" is not iterable")}return y.prototype=v,i(x,"constructor",{value:v,configurable:!0}),i(v,"constructor",{value:y,configurable:!0}),y.displayName=c(v,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,c(e,u,"GeneratorFunction")),e.prototype=Object.create(x),e},t.awrap=function(e){return{__await:e}},I(E.prototype),c(E.prototype,s,function(){return this}),t.AsyncIterator=E,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new E(l(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},I(x),c(x,u,"Generator"),c(x,a,function(){return this}),c(x,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=P,_.prototype={constructor:_,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;k(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:P(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function C(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(n,i)}function D(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){C(o,n,i,a,s,"next",e)}function s(e){C(o,n,i,a,s,"throw",e)}a(void 0)})}}function N(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,L(n.key),n)}}function R(e,t,r){return(t=L(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function L(e){var t=function(e,t){if("object"!==A(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==A(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===A(t)?t:String(t)}var j=(function(){var e,t,r,n,i;function o(){if(!(this instanceof o))throw TypeError("Cannot call a class as a function");R(this,"registration",null),R(this,"updateAvailable",!1)}return n=[{key:"isPWAMode",value:function(){var e=window.matchMedia("(display-mode: standalone)").matches,t=window.matchMedia("(display-mode: fullscreen)").matches,r=window.matchMedia("(display-mode: minimal-ui)").matches,n="standalone"in window.navigator&&!0===window.navigator.standalone;return e||t||r||n}},{key:"register",value:(e=D(O().mark(function e(){var t,r,n,i=this,o=arguments;return O().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=o.length>0&&void 0!==o[0]?o[0]:{},e.next=1;break;case 1:if("serviceWorker"in navigator){e.next=2;break}return console.log("[SW] Service Worker nicht unterst\xfctzt"),e.abrupt("return");case 2:if(this.isPWAMode()){e.next=3;break}return console.log("[SW] Browser-Modus erkannt - Service Worker wird NICHT registriert"),e.abrupt("return");case 3:return console.log("[SW] PWA-Modus erkannt - Service Worker wird registriert"),e.prev=4,e.next=5,new Promise(function(e){"complete"===document.readyState?e():window.addEventListener("load",function(){return e()})});case 5:return e.next=6,navigator.serviceWorker.register("/sw.js",{scope:"/"});case 6:r=e.sent,this.registration=r,console.log("[SW] Service Worker erfolgreich registriert"),r.addEventListener("updatefound",function(){var e=r.installing;e&&e.addEventListener("statechange",function(){"installed"===e.state&&navigator.serviceWorker.controller&&(i.updateAvailable=!0,console.log("[SW] Update verf\xfcgbar"),t.onUpdate&&t.onUpdate(r))})}),t.onSuccess&&t.onSuccess(r),setInterval(function(){r.update()},18e5),e.next=8;break;case 7:e.prev=7,console.error("[SW] Registrierung fehlgeschlagen:",n=e.catch(4)),t.onError&&t.onError(n);case 8:case"end":return e.stop()}},e,this,[[4,7]])})),function(){return e.apply(this,arguments)})},{key:"update",value:(t=D(O().mark(function e(){return O().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.registration){e.next=1;break}return console.log("[SW] Keine aktive Registrierung"),e.abrupt("return");case 1:return e.prev=1,e.next=2,this.registration.update();case 2:if(!(this.updateAvailable&&this.registration.waiting)){e.next=3;break}return this.registration.waiting.postMessage({type:"SKIP_WAITING"}),e.next=3,new Promise(function(e){var t=function(){window.location.reload(),e()};navigator.serviceWorker.addEventListener("controllerchange",t)});case 3:e.next=5;break;case 4:e.prev=4,console.error("[SW] Update fehlgeschlagen:",e.catch(1));case 5:case"end":return e.stop()}},e,this,[[1,4]])})),function(){return t.apply(this,arguments)})},{key:"unregister",value:(r=D(O().mark(function e(){return O().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.registration){e.next=1;break}return e.abrupt("return");case 1:return e.prev=1,e.next=2,this.registration.unregister();case 2:e.sent&&(console.log("[SW] Service Worker erfolgreich deregistriert"),this.registration=null),e.next=4;break;case 3:e.prev=3,console.error("[SW] Deregistrierung fehlgeschlagen:",e.catch(1));case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(){return r.apply(this,arguments)})},{key:"hasUpdate",value:function(){return this.updateAvailable}},{key:"getRegistration",value:function(){return this.registration}}],i=[{key:"getInstance",value:function(){return o.instance||(o.instance=new o),o.instance}}],n&&N(o.prototype,n),i&&N(o,i),Object.defineProperty(o,"prototype",{writable:!1}),o})().getInstance();function F(e){return(F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function G(){G=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(t,r,n,o){var a,s,u,c,l=Object.create((r&&r.prototype instanceof g?r:g).prototype);return i(l,"_invoke",{value:(a=t,s=n,u=new _(o||[]),c=d,function(t,r){if(c===f)throw Error("Generator is already running");if(c===p){if("throw"===t)throw r;return{value:e,done:!0}}for(u.method=t,u.arg=r;;){var n=u.delegate;if(n){var i=function t(r,n){var i=n.method,o=r.iterator[i];if(o===e)return n.delegate=null,"throw"===i&&r.iterator.return&&(n.method="return",n.arg=e,t(r,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+i+"' method")),m;var a=h(o,r.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,m;var s=a.arg;return s?s.done?(n[r.resultName]=s.value,n.next=r.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):s:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,m)}(n,u);if(i){if(i===m)continue;return i}}if("next"===u.method)u.sent=u._sent=u.arg;else if("throw"===u.method){if(c===d)throw c=p,u.arg;u.dispatchException(u.arg)}else"return"===u.method&&u.abrupt("return",u.arg);c=f;var o=h(a,s,u);if("normal"===o.type){if(c=u.done?p:"suspendedYield",o.arg===m)continue;return{value:o.arg,done:u.done}}"throw"===o.type&&(c=p,u.method="throw",u.arg=o.arg)}})}),l}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var d="suspendedStart",f="executing",p="completed",m={};function g(){}function y(){}function v(){}var b={};c(b,a,function(){return this});var w=Object.getPrototypeOf,S=w&&w(w(P([])));S&&S!==r&&n.call(S,a)&&(b=S);var x=v.prototype=g.prototype=Object.create(b);function I(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function E(e,t){var r;i(this,"_invoke",{value:function(i,o){function a(){return new t(function(r,a){!function r(i,o,a,s){var u=h(e[i],e,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==F(l)&&n.call(l,"__await")?t.resolve(l.__await).then(function(e){r("next",e,a,s)},function(e){r("throw",e,a,s)}):t.resolve(l).then(function(e){c.value=e,a(c)},function(e){return r("throw",e,a,s)})}s(u.arg)}(i,o,r,a)})}return r=r?r.then(a,a):a()}})}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function _(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function P(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw TypeError(F(t)+" is not iterable")}return y.prototype=v,i(x,"constructor",{value:v,configurable:!0}),i(v,"constructor",{value:y,configurable:!0}),y.displayName=c(v,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,c(e,u,"GeneratorFunction")),e.prototype=Object.create(x),e},t.awrap=function(e){return{__await:e}},I(E.prototype),c(E.prototype,s,function(){return this}),t.AsyncIterator=E,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new E(l(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},I(x),c(x,u,"Generator"),c(x,a,function(){return this}),c(x,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=P,_.prototype={constructor:_,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;k(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:P(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function M(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(n,i)}function U(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){M(o,n,i,a,s,"next",e)}function s(e){M(o,n,i,a,s,"throw",e)}a(void 0)})}}function V(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return B(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return B(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}let z=function(){var e=(0,_.useUIStore)(function(e){return e.showNotification}),t=V((0,n.useState)(null),2),r=t[0],i=t[1],o=V((0,n.useState)(!1),2),a=o[0],s=o[1],u=(0,n.useCallback)(function(t){if(!r){var n,o=(n=U(G().mark(function t(){return G().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s(!0),t.prev=1,t.next=2,j.update();case 2:e({message:"Update erfolgreich! Die App wird neu geladen...",type:"success",preventClose:!0,duration:1500}),setTimeout(function(){window.location.reload()},1500),t.next=4;break;case 3:t.prev=3,console.error("[PWA] Update fehlgeschlagen:",t.catch(1)),e({message:"Update fehlgeschlagen. Bitte manuell neu laden.",type:"error",duration:5e3}),s(!1);case 4:case"end":return t.stop()}},t,null,[[1,3]])})),function(){return n.apply(this,arguments)});i(e({message:"\uD83C\uDF89 Neue Version verf\xfcgbar!\n\nJetzt aktualisieren f\xfcr die neuesten Features.",type:"info",actions:[{label:a?"Wird aktualisiert...":"Jetzt aktualisieren",onClick:a?function(){}:o,className:a?"bg-gray-500 cursor-not-allowed text-white":"bg-green-600 hover:bg-green-700 text-white"}],preventClose:!1,duration:3e4}))}},[e,r,a]);return(0,n.useEffect)(function(){j.register({onUpdate:u,onSuccess:function(e){console.log("[PWA] Service Worker erfolgreich registriert")},onError:function(e){console.error("[PWA] Service Worker Fehler:",e)}});var e=setInterval(U(G().mark(function e(){return G().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!j.isPWAMode()){e.next=1;break}return e.next=1,j.update();case 1:case"end":return e.stop()}},e)})),18e5),t=function(){!document.hidden&&j.isPWAMode()&&j.update()};return document.addEventListener("visibilitychange",t),function(){clearInterval(e),document.removeEventListener("visibilitychange",t)}},[u]),null};var H=r(2009),q=r(5519),$=r(4277),K=r(3042),W=r(4536),J=r(4415),Q=r(2604),Y=r(3558);function X(){X=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(t,r,n,o){var a,s,u,c,l=Object.create((r&&r.prototype instanceof g?r:g).prototype);return i(l,"_invoke",{value:(a=t,s=n,u=new _(o||[]),c=d,function(t,r){if(c===f)throw Error("Generator is already running");if(c===p){if("throw"===t)throw r;return{value:e,done:!0}}for(u.method=t,u.arg=r;;){var n=u.delegate;if(n){var i=function t(r,n){var i=n.method,o=r.iterator[i];if(o===e)return n.delegate=null,"throw"===i&&r.iterator.return&&(n.method="return",n.arg=e,t(r,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+i+"' method")),m;var a=h(o,r.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,m;var s=a.arg;return s?s.done?(n[r.resultName]=s.value,n.next=r.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):s:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,m)}(n,u);if(i){if(i===m)continue;return i}}if("next"===u.method)u.sent=u._sent=u.arg;else if("throw"===u.method){if(c===d)throw c=p,u.arg;u.dispatchException(u.arg)}else"return"===u.method&&u.abrupt("return",u.arg);c=f;var o=h(a,s,u);if("normal"===o.type){if(c=u.done?p:"suspendedYield",o.arg===m)continue;return{value:o.arg,done:u.done}}"throw"===o.type&&(c=p,u.method="throw",u.arg=o.arg)}})}),l}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var d="suspendedStart",f="executing",p="completed",m={};function g(){}function y(){}function v(){}var b={};c(b,a,function(){return this});var w=Object.getPrototypeOf,S=w&&w(w(P([])));S&&S!==r&&n.call(S,a)&&(b=S);var x=v.prototype=g.prototype=Object.create(b);function I(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function E(e,t){var r;i(this,"_invoke",{value:function(i,o){function a(){return new t(function(r,a){!function r(i,o,a,s){var u=h(e[i],e,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==er(l)&&n.call(l,"__await")?t.resolve(l.__await).then(function(e){r("next",e,a,s)},function(e){r("throw",e,a,s)}):t.resolve(l).then(function(e){c.value=e,a(c)},function(e){return r("throw",e,a,s)})}s(u.arg)}(i,o,r,a)})}return r=r?r.then(a,a):a()}})}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function _(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function P(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw TypeError(er(t)+" is not iterable")}return y.prototype=v,i(x,"constructor",{value:v,configurable:!0}),i(v,"constructor",{value:y,configurable:!0}),y.displayName=c(v,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,c(e,u,"GeneratorFunction")),e.prototype=Object.create(x),e},t.awrap=function(e){return{__await:e}},I(E.prototype),c(E.prototype,s,function(){return this}),t.AsyncIterator=E,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new E(l(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},I(x),c(x,u,"Generator"),c(x,a,function(){return this}),c(x,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=P,_.prototype={constructor:_,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;k(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:P(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function Z(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(n,i)}function ee(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function et(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(r),!0).forEach(function(t){var n,i,o;n=e,i=t,o=r[t],(i=function(e){var t=function(e,t){if("object"!==er(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==er(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===er(t)?t:String(t)}(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ee(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function er(e){return(er="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function en(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var ei=(0,n.createContext)(null);window.__FIRESTORE_SYNC_API__={markLocalUpdate:null};var eo=function(e){var t,r=e.children,a=(0,H.getFirestore)(q.xv),s=(0,n.useRef)(!1),u=(0,$.useGameStore)(function(e){return e.resetGame}),c=$.useGameStore.setState,l=(0,W.useJassStore)(function(e){return e.activeGameId}),h=(0,W.useJassStore)(function(e){return e.jassSessionId}),d=(0,K.h)().user,f=(0,i.useRouter)();(0,n.useRef)(!1),(0,n.useRef)(0);var p=(0,n.useRef)(0);(0,n.useRef)(new Set);var m=(0,n.useRef)(null),g=function(e){if(Array.isArray(e))return e}(t=(0,n.useState)({isSyncing:!1,lastSyncTime:null,syncError:null,isPaused:!1,currentlyProcessingRoundIds:[]}))||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],u=!0,c=!1;try{o=(r=r.call(e)).next,!1;for(;!(u=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(t,2)||function(e,t){if(e){if("string"==typeof e)return en(e,2);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return en(e,t)}}(t,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),y=g[0],v=g[1],b=(0,n.useRef)(null),w=(0,n.useRef)(null),S=(0,n.useRef)(null),x=(0,n.useRef)(null),I=function(e){return e&&"object"===er(e)&&(e instanceof H.Timestamp||"_seconds"in e&&"_nanoseconds"in e&&"function"==typeof e.toMillis)},E=function(e){if(I(e))try{return e.toMillis()}catch(e){console.error("Fehler beim Aufrufen von toMillis():",e)}return Date.now()},T=(0,n.useCallback)(function(e){var t=$.useGameStore.getState().activeGameId;if(!t)return void console.warn("[FirestoreSyncProvider] handleRemoteGameEndOrAbort called without activeGameId. Skipping.");if(m.current!==t){var r=_.useUIStore.getState().signingState;if("completed"===e&&"completed"===r){m.current=t;return}if(m.current=t,"aborted"===e){J.useTimerStore.getState().resetAllTimers(),u(1,void 0),_.useUIStore.getState().clearResumableGameId(),_.useUIStore.getState().resetAll();var n=!!d;f.push(n?"/start":"/")}else{J.useTimerStore.getState().resetAllTimers(),u(1,void 0),_.useUIStore.getState().clearResumableGameId(),_.useUIStore.getState().resetAll();var i=!!d;f.push(i?"/start":"/")}}},[f,d,u]),k=(0,n.useCallback)(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=$.useGameStore.getState().activeGameId;if(r&&m.current===r)return void console.log("[FirestoreSync applyServerUpdate] Skipping update for game ".concat(r," - termination already handled."));if(s.current){console.log("[FirestoreSync applyServerUpdate] Applying INITIAL sync for game ".concat(l,". Overwriting state..."));var n,i,o,a,u,h,d,f,g,y,v,b,w,S=null!=(i=e.initialStartingPlayer)?i:1,x=null!=(o=e.startingPlayer)?o:S,I=null!=(a=e.currentPlayer)?a:x,k=(0,Q.g)(e);console.log("[FirestoreSync applyServerUpdate] Initial sync data sanitized:",k),c({activeGameId:null!=l?l:void 0,scores:null!=(u=k.scores)?u:{top:0,bottom:0},striche:null!=(h=k.striche)?h:{top:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0},bottom:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0}},weisPoints:null!=(d=k.weisPoints)?d:{top:0,bottom:0},jassPoints:null!=(f=k.jassPoints)?f:{top:0,bottom:0},currentRound:null!=(g=k.currentRound)?g:1,currentPlayer:I,startingPlayer:x,initialStartingPlayer:S,isGameStarted:!0,isGameCompleted:"completed"===k.status||"aborted"===k.status,isRoundCompleted:null!=(y=k.isRoundCompleted)&&y,currentRoundWeis:null!=(v=k.currentRoundWeis)?v:[],playerNames:null!=(b=k.playerNames)?b:{1:"",2:"",3:"",4:""},gamePlayers:null!=(w=k.gamePlayers)?w:null,roundHistory:t||[],currentHistoryIndex:t?t.length-1:-1,historyState:{lastNavigationTimestamp:Date.now()}}),s.current=!1,console.log("[FirestoreSync applyServerUpdate] Initial sync applied. isInitialSyncRef set to false.");return}var P=Date.now();$.useGameStore.getState(),p.current,E(e.lastUpdated),_.useUIStore.getState().isNavigatingHistory&&console.log("[FirestoreSync applyServerUpdate] ⚠️ Currently navigating history, but applying server update anyway for cross-client sync.");var A=(0,Q.g)(e),O=!0===A.isRoundCompleted?{top:0,bottom:0}:null!=(n=A.weisPoints)?n:{top:0,bottom:0};c(function(e){var t,r,n,i,o,a,s,u,c,l;return et(et({},e),{},{scores:null!=(t=A.scores)?t:{top:0,bottom:0},weisPoints:O,striche:null!=(r=A.striche)?r:{top:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0},bottom:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0}},jassPoints:null!=(n=A.currentJassPoints)?n:{top:0,bottom:0},currentRound:null!=(i=A.currentRound)?i:1,currentPlayer:null!=(o=A.currentPlayer)?o:1,startingPlayer:null!=(a=A.startingPlayer)?a:1,isRoundCompleted:null!=(s=A.isRoundCompleted)&&s,currentRoundWeis:null!=(u=A.currentRoundWeis)?u:[],gamePlayers:null!=(c=A.gamePlayers)?c:null,playerNames:null!=(l=A.playerNames)?l:{1:"Spieler 1",2:"Spieler 2",3:"Spieler 3",4:"Spieler 4"}})}),("aborted"===A.status||"completed"===A.status)&&T(A.status)},[c,l,T]),P=(0,n.useCallback)(function(e){try{var t=e.data(),r=I(t.timestamp)?E(t.timestamp):Date.now(),n={id:t.id,roundId:t.roundId,timestamp:r,actionType:t.actionType,startingPlayer:t.startingPlayer,startingPlayerName:t.startingPlayerName,currentPlayer:t.currentPlayer,weisPoints:t.weisPoints||{top:0,bottom:0},jassPoints:t.jassPoints||{top:0,bottom:0},scores:t.scores||{top:0,bottom:0},striche:t.striche||{top:{},bottom:{}},weisActions:t.weisActions||[],roundState:t.roundState||{roundNumber:1,nextPlayer:1},visualStriche:t.visualStriche||{top:{stricheCounts:{},restZahl:0},bottom:{stricheCounts:{},restZahl:0}},isActive:t.isActive};if("jass"===t.actionType)return et(et({},n),{},{actionType:"jass",farbe:t.farbe,cardStyle:t.cardStyle||"deutsch",strichInfo:t.strichInfo,isRoundFinalized:!0,isCompleted:!0,isActive:t.isActive});return et(et({},n),{},{actionType:"weis",isRoundFinalized:!1,isCompleted:!1,isActive:t.isActive})}catch(e){return console.error("Fehler beim Konvertieren des Rundendokuments:",e),null}},[]),A=(0,n.useCallback)(function(){console.log("Pausiere Synchronisation"),v(function(e){return et(et({},e),{},{isPaused:!0})})},[]),O=(0,n.useCallback)(function(){console.log("Setze Synchronisation fort"),v(function(e){return et(et({},e),{},{isPaused:!1})})},[]),C=(0,n.useCallback)(function(){p.current=Date.now()},[]);(0,n.useEffect)(function(){return window.__FIRESTORE_SYNC_API__={markLocalUpdate:C},function(){window.__FIRESTORE_SYNC_API__={markLocalUpdate:null}}},[C]),(0,n.useEffect)(function(){var e,t,r=function(e){x.current=e,m.current=null,v(function(e){return et(et({},e),{},{isSyncing:!0,syncError:null})});try{var t=(0,H.doc)(a,"activeGames",e);b.current=(0,H.onSnapshot)(t,function(t){if(v(function(e){return et(et({},e),{},{isSyncing:!1,lastSyncTime:new Date})}),t.exists()){var r=t.data();k(r,null)}else console.warn("[FirestoreSyncProvider] Active game document ".concat(e," does not exist."))},function(t){console.error("[FirestoreSyncProvider] Error listening to game ".concat(e,":"),t),v(function(e){return et(et({},e),{},{isSyncing:!1,syncError:t})})})}catch(t){console.error("[FirestoreSyncProvider] Failed to set up listener for game ".concat(e,":"),t),v(function(e){return et(et({},e),{},{isSyncing:!1,syncError:t})})}try{var r=(0,H.collection)(a,"activeGames",e,"rounds"),n=(0,H.query)(r,(0,H.orderBy)("timestamp"));w.current=(0,H.onSnapshot)(n,function(e){var t=e.docs.map(function(e){return P(e)}).filter(function(e){return null!==e}),r=$.useGameStore.getState().roundHistory;if(JSON.stringify(t)!==JSON.stringify(r)){var n=t.findLastIndex(function(e){return void 0===e.isActive||!0===e.isActive});c({roundHistory:t,currentHistoryIndex:n>=0?n:-1})}},function(t){console.error("[FirestoreSyncProvider] ❌ CRITICAL ERROR: Rounds listener failed for game ".concat(e,":"),t),console.error("[FirestoreSyncProvider] ❌ Error details:",{name:t.name,message:t.message,code:t.code,stack:t.stack})})}catch(t){console.error("[FirestoreSyncProvider] ❌ FATAL: Failed to set up listener for rounds of game ".concat(e,":"),t),console.error("[FirestoreSyncProvider] ❌ Setup error details:",{name:t.name,message:t.message,stack:t.stack})}},n=function(){b.current&&b.current(),w.current&&w.current(),b.current=null,w.current=null,x.current=null},i=(e=X().mark(function e(t){var n,i,o,s,u,l,h,d,f,p,m,g,y,b,w,S,x,I,E,T,k,_,P,A,O,C;return X().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[FirestoreSyncProvider LOAD] Starting initial load for game ID: ".concat(t)),v(function(e){return et(et({},e),{},{isSyncing:!0,syncError:null})}),e.prev=1,w=(0,H.doc)(a,"activeGames",t),console.log("[FirestoreSyncProvider LOAD] Attempting to get game document: activeGames/".concat(t)),e.next=2,(0,H.getDoc)(w);case 2:if((S=e.sent).exists()){e.next=3;break}throw console.error("[FirestoreSyncProvider LOAD] ERROR: Active game document ".concat(t," not found!")),Error("Active game document ".concat(t," not found during initial load."));case 3:return x=S.data(),console.log("[FirestoreSyncProvider LOAD] Initial game data loaded successfully. Round: ".concat(x.currentRound,", Scores: T").concat(null==(n=x.scores)?void 0:n.top,"/B").concat(null==(i=x.scores)?void 0:i.bottom)),console.log("[FirestoreSyncProvider LOAD] Attempting to load rounds for game ".concat(t)),e.next=4,(0,Y.loadRoundsFromFirestore)(t);case 4:I=e.sent,console.log("[FirestoreSyncProvider LOAD] Initial rounds data loaded successfully: ".concat(I.length," rounds found.")),E=null!=(o=x.initialStartingPlayer)?o:1,T=null!=(s=x.startingPlayer)?s:E,k=null!=(u=x.currentPlayer)?u:T,_=I.findLastIndex(function(e){return void 0===e.isActive||!0===e.isActive}),console.log("[FirestoreSyncProvider LOAD] Preparing to set initial gameStore state. Target gameId: ".concat(t,", Rounds count: ").concat(I.length,", Target history index: ").concat(_)),A=(P=!0===x.isRoundCompleted)?{top:0,bottom:0}:null!=(l=x.weisPoints)?l:{top:0,bottom:0},console.log("[FirestoreSyncProvider LOAD] WeisPoints handling: isRoundCompleted=".concat(x.isRoundCompleted,", shouldReset=").concat(P,", finalWeisPoints=").concat(JSON.stringify(A))),c({activeGameId:t,scores:null!=(h=x.scores)?h:{top:0,bottom:0},striche:null!=(d=x.striche)?d:{top:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0},bottom:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0}},weisPoints:A,jassPoints:null!=(f=x.currentJassPoints)?f:{top:0,bottom:0},currentRound:null!=(p=x.currentRound)?p:1,currentPlayer:k,startingPlayer:T,initialStartingPlayer:E,isGameStarted:!0,isGameCompleted:"completed"===x.status||"aborted"===x.status,isRoundCompleted:null!=(m=x.isRoundCompleted)&&m,currentRoundWeis:null!=(g=x.currentRoundWeis)?g:[],playerNames:null!=(y=x.playerNames)?y:{1:"",2:"",3:"",4:""},gamePlayers:null!=(b=x.gamePlayers)?b:null,roundHistory:I,currentHistoryIndex:_>=0?_:-1,historyState:{lastNavigationTimestamp:Date.now()}}),O=$.useGameStore.getState(),console.log("[FirestoreSyncProvider LOAD] Initial gameStore state SET. Verified activeGameId: ".concat(O.activeGameId,", History length: ").concat(O.roundHistory.length,", Index: ").concat(O.currentHistoryIndex)),console.log("[FirestoreSyncProvider LOAD] Proceeding to set up listeners for game ".concat(t)),r(t),e.next=6;break;case 5:e.prev=5,C=e.catch(1),console.error("[FirestoreSyncProvider LOAD] FATAL ERROR during initial load for game ".concat(t,":"),C),v(function(e){return et(et({},e),{},{isSyncing:!1,syncError:C})});case 6:return e.prev=6,v(function(e){return et(et({},e),{},{isSyncing:!1})}),e.finish(6);case 7:case"end":return e.stop()}},e,null,[[1,5,6,7]])}),t=function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){Z(o,n,i,a,s,"next",e)}function s(e){Z(o,n,i,a,s,"throw",e)}a(void 0)})},function(e){return t.apply(this,arguments)});if(!y.isPaused){var o=x.current;return l?l!==o?(console.log("[FirestoreSyncProvider EFFECT] \uD83D\uDD04 DEBUGGING: ID change detected! Target: ".concat(l,", Previous: ").concat(o,". Initiating reload...")),n(),console.log("[FirestoreSyncProvider EFFECT] \uD83D\uDD04 DEBUGGING: Stores NICHT zur\xfcckgesetzt. Erwarte korrekte Settings von vorheriger Initialisierung."),console.log("[FirestoreSyncProvider EFFECT] \uD83D\uDD04 DEBUGGING: About to call performInitialLoadAndSetupListeners()..."),i(l),console.log("[FirestoreSyncProvider EFFECT] \uD83D\uDD04 DEBUGGING: performInitialLoadAndSetupListeners() call completed.")):b.current&&w.current?console.log("[FirestoreSyncProvider EFFECT] ✅ DEBUGGING: ID unchanged (".concat(l,") and listeners are active. All good!")):(console.log("[FirestoreSyncProvider EFFECT] \uD83D\uDD04 DEBUGGING: ID unchanged (".concat(l,"), but listeners missing! gameListener: ").concat(!!b.current,", roundsListener: ").concat(!!w.current)),console.log("[FirestoreSyncProvider EFFECT] \uD83D\uDD04 DEBUGGING: Setting up missing listeners for existing game..."),n(),r(l),console.log("[FirestoreSyncProvider EFFECT] \uD83D\uDD04 DEBUGGING: Missing listeners setup completed for game ".concat(l,"."))):o&&(n(),m.current=null),function(){}}},[l,y.isPaused]);var D=function(e){try{var t=e.data();if(!t.gameNumber||!t.finalScores||!t.finalStriche)return console.warn("Unvollst\xe4ndiges CompletedGameSummary-Dokument:",e.id),null;var r=I(t.timestampCompleted)?t.timestampCompleted:new H.Timestamp(0,0),n=[];return Array.isArray(t.roundHistory)&&(n=t.roundHistory.map(function(e){return e&&I(e.timestamp)&&(e.timestamp=E(e.timestamp)),e})),{gameNumber:t.gameNumber,timestampCompleted:r,durationMillis:t.durationMillis||0,finalScores:t.finalScores,finalStriche:t.finalStriche,weisPoints:t.weisPoints||{top:0,bottom:0},startingPlayer:t.startingPlayer,initialStartingPlayer:t.initialStartingPlayer,playerNames:t.playerNames||{1:"",2:"",3:"",4:""},trumpColorsPlayed:t.trumpColorsPlayed||[],roundHistory:n,participantUids:t.participantUids||[],groupId:t.groupId,completedAt:t.completedAt||null}}catch(e){return console.error("Fehler beim Konvertieren des CompletedGameSummary-Dokuments:",e),null}};return(0,n.useEffect)(function(){if(h&&!y.isPaused){S.current&&(S.current(),S.current=null);try{console.log("[FirestoreSyncProvider] Setting up listener for completed games using sessionId: ".concat(h));var e=(0,H.collection)(a,"jassGameSummaries",h,"completedGames"),t=(0,H.query)(e,(0,H.orderBy)("gameNumber"));return S.current=(0,H.onSnapshot)(t,function(e){var t=new Date().toISOString(),r=e.docs.map(function(e){return D(e)}).filter(function(e){return null!==e});W.useJassStore.setState(function(e){var n=JSON.stringify(e.onlineCompletedGames),i=JSON.stringify(r);return n!==i?et(et({},e),{},{onlineCompletedGames:r}):(console.log("[FirestoreSync COMPLETED_GAMES ".concat(t,"] State unchanged. No update to jassStore needed.")),e)})},function(e){var t=new Date().toISOString();console.error("[FirestoreSync COMPLETED_GAMES ".concat(t,"] Error listening to completed games in session ").concat(h,":"),e),v(function(t){return et(et({},t),{},{syncError:e instanceof Error?e:Error("Unknown error")})})}),function(){S.current&&(S.current(),S.current=null)}}catch(e){console.error("Fehler beim Einrichten der completedGames-Listener",e),v(function(t){return et(et({},t),{},{syncError:e instanceof Error?e:Error("Unknown error")})})}}},[h,y.isPaused]),(0,o.jsx)(ei.Provider,{value:{syncStatus:y,pauseSync:A,resumeSync:O,markLocalUpdate:C},children:r})},ea=r(1923),es=r(7200),eu=r(6722),ec=r(3177),el=r(8934);function eh(e){return(eh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ed(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function ef(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ep(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ep(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ep(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var em=function(){var e=ef((0,n.useState)(!1),2),t=e[0],r=e[1];return(0,n.useEffect)(function(){var e=setTimeout(function(){r(!0)},2e3);return function(){return clearTimeout(e)}},[]),(0,o.jsxs)("div",{className:"flex flex-1 flex-col items-center justify-center min-h-full bg-gray-900 text-white",children:[(0,o.jsx)(ea.A,{color:"#ffffff",size:40}),(0,o.jsx)("p",{className:"mt-4 text-lg",children:"App wird geladen..."}),t&&(0,o.jsx)("p",{className:"mt-2 text-sm text-gray-400 text-center max-w-xs",children:"Falls die App nicht l\xe4dt, pr\xfcfe deine Internetverbindung oder lade die Seite neu."})]})};let eg=function(e){var t=e.Component,r=e.pageProps,a=ef((0,n.useState)(!1),2),s=(a[0],a[1]);!function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"screen",i=p((0,n.useState)(null),2),o=i[0],a=i[1],s=p((0,n.useState)(!1),2),u=(s[0],s[1]),c=(0,n.useRef)(!1),l=(e=d().mark(function e(){return d().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(c.current||o)){e.next=1;break}return e.abrupt("return");case 1:if(c.current=!0,e.prev=2,!("wakeLock"in navigator)){e.next=4;break}return e.next=3,navigator.wakeLock.request(r);case 3:a(e.sent),u(!0),e.next=5;break;case 4:case 5:e.next=7;break;case 6:e.prev=6,e.catch(2);case 7:return e.prev=7,c.current=!1,e.finish(7);case 8:case"end":return e.stop()}},e,null,[[2,6,7,8]])}),t=function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){f(o,n,i,a,s,"next",e)}function s(e){f(o,n,i,a,s,"throw",e)}a(void 0)})},function(){return t.apply(this,arguments)}),h=function(){o&&o.release().then(function(){a(null),u(!1)}).catch(function(e){})};(0,n.useEffect)(function(){var e=function(){"visible"===document.visibilityState&&l()};return l(),document.addEventListener("visibilitychange",e),function(){document.removeEventListener("visibilitychange",e),h()}},[r])}();var c=(0,y.useAuthStore)(function(e){return e.initAuth}),h=(0,y.useAuthStore)(function(e){return e.status});(0,y.useAuthStore)(function(e){return e.user}),(0,y.useAuthStore)(function(e){return e.isGuest}),y.useAuthStore.getState().isAuthenticated();var m=ef((0,n.useState)(!1),2),v=m[0],b=m[1],w=(0,i.useRouter)(),S=(0,k.yu)(function(e){return e.checkUserActiveTournament}),x=(0,k.yu)(function(e){return e.userActiveTournamentId}),I=(0,k.yu)(function(e){return e.userActiveTournamentStatus}),E=(0,_.useUIStore)(function(e){return e.hasBeenRedirectedToActiveTournament}),A=(0,_.useUIStore)(function(e){return e.setHasBeenRedirectedToActiveTournament});return(0,n.useEffect)(function(){s(!0);try{c()}catch(e){console.error("Fehler bei der Authentifizierung-Initialisierung:",e),(0,ec.LP)(e)&&(0,ec.dd)()}},[c]),(0,n.useEffect)(function(){if(w.isReady){var e=w.pathname,t=(0,eu.N)(e);if(t)return void b(!0);if("loading"!==h&&"idle"!==h)b(!0);else{var r=setTimeout(function(){("loading"===h||"idle"===h)&&!v&&(console.warn("_app.tsx: Auth-Status Timeout! Fallback zu WelcomeScreen."),b(!0),t||(0,es.p)(w,"/",void 0,!0))},4e3);return function(){return clearTimeout(r)}}}},[w.isReady,w.pathname,h,v]),(0,n.useEffect)(function(){if(w.isReady){var e=w.pathname;if(!(0,eu.N)(e)){if("loading"===h||"idle"===h){var t=setTimeout(function(){("loading"===h||"idle"===h)&&(console.warn("_app.tsx: Routing-Timeout! Forciere Weiterleitung zu WelcomeScreen."),(0,es.p)(w,"/",void 0,!0))},5e3);return function(){return clearTimeout(t)}}var r="authenticated"===h,n=y.useAuthStore.getState().isGuest;if(r&&!n){e.startsWith("/auth")&&(0,es.p)(w,"/start",void 0,!0);return}if(!r||n)if("true"===sessionStorage.getItem("guestFromWelcome"))console.log("[_app] Context erkannt: guestFromWelcome=true, navigiere zu /"),sessionStorage.removeItem("guestFromWelcome"),(0,es.p)(w,"/",void 0,!0);else{var i=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://"),o=i?"/auth/login":"/";console.log("[_app] ".concat(i?"PWA":"Browser","-Context erkannt, navigiere zu ").concat(o)),(0,es.p)(w,o,void 0,!0)}}}},[h,w.isReady,w.pathname]),(0,n.useMemo)(function(){return(0,eu.N)(w.pathname)},[w.pathname]),(0,n.useEffect)(function(){if(!w.isReady||"authenticated"!==h){E&&A(!1);return}var e=y.useAuthStore.getState().user;e&&(A(!1),S(e.uid))},[h,w.isReady,S,A]),(0,n.useEffect)(function(){if(w.isReady&&"authenticated"===h&&"success"===I&&x&&!E){var e="/view/tournament/".concat(x),t=w.pathname;if(![e,"/jass","/game","/tournaments/[instanceId]/settings","/view/session","/view/group"].some(function(e){if(e.includes("[instanceId]")){var r=e.substring(0,e.indexOf("["));return t.startsWith(r)}return t.startsWith(e)})){var r=setTimeout(function(){(0,es.p)(w,e,void 0,!0),A(!0)},0);return function(){return clearTimeout(r)}}}w.isReady&&"success"===I&&!x&&E&&A(!1)},[x,I,w.isReady,w.pathname,E,A,h]),(0,n.useEffect)(function(){(0,el.go)()},[]),(0,o.jsxs)(u,{children:[(0,o.jsxs)(l(),{children:[(0,o.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"}),(0,o.jsx)("meta",{httpEquiv:"Cache-Control",content:"no-cache, no-store, must-revalidate"}),(0,o.jsx)("meta",{httpEquiv:"Pragma",content:"no-cache"}),(0,o.jsx)("meta",{httpEquiv:"Expires",content:"0"}),(0,o.jsx)("title",{children:"Jassguru.ch - Die Jass-Community in deiner Tasche"}),(0,o.jsx)("meta",{name:"description",content:"Schneller, smarter, vernetzter Jassen. Deine digitale Jasstafel f\xfcr Ranglisten, Statistiken und Turniere. Werde Teil der Jass-Community!"}),(0,o.jsx)("meta",{name:"keywords",content:"Jassen, Jass, Jass-Community, Jasstafel, Jassz\xe4hler, Rangliste, Statistik, Tabelle, Turnier, Schieber, Coiffeur, Differenzler, Schweizer Jass"}),(0,o.jsx)("link",{rel:"canonical",href:"https://www.jassguru.ch"}),(0,o.jsx)("meta",{property:"og:type",content:"website"}),(0,o.jsx)("meta",{property:"og:url",content:"https://www.jassguru.ch/"}),(0,o.jsx)("meta",{property:"og:title",content:"Jassguru.ch - Die Jass-Community in deiner Tasche"}),(0,o.jsx)("meta",{property:"og:description",content:"Schneller, smarter, vernetzter Jassen. Deine digitale Jasstafel f\xfcr Ranglisten, Statistiken und Turniere."}),(0,o.jsx)("meta",{property:"og:image",content:"https://www.jassguru.ch/apple-touch-icon.png"}),(0,o.jsx)("meta",{name:"twitter:card",content:"summary_large_image"}),(0,o.jsx)("meta",{name:"twitter:title",content:"Jassguru.ch - Die Jass-Community in deiner Tasche"}),(0,o.jsx)("meta",{name:"twitter:description",content:"Schneller, smarter, vernetzter Jassen mit digitalen Ranglisten und Statistiken."}),(0,o.jsx)("meta",{name:"twitter:image",content:"https://www.jassguru.ch/apple-touch-icon.png"})]}),(0,o.jsx)(g.O,{children:(0,o.jsx)(T,{children:(0,o.jsxs)(eo,{children:[v?(0,o.jsx)(t,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ed(Object(r),!0).forEach(function(t){var n,i,o;n=e,i=t,o=r[t],(i=function(e){var t=function(e,t){if("object"!==eh(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==eh(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===eh(t)?t:String(t)}(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ed(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},r)):(0,o.jsx)(em,{}),(0,o.jsx)(P.A,{}),(0,o.jsx)(z,{})," "]})})})]})}},6525:(e,t,r)=>{"use strict";var n;r.d(t,{$b:()=>n,Vy:()=>c});let i=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(n||(n={}));let o={debug:n.DEBUG,verbose:n.VERBOSE,info:n.INFO,warn:n.WARN,error:n.ERROR,silent:n.SILENT},a=n.INFO,s={[n.DEBUG]:"log",[n.VERBOSE]:"log",[n.INFO]:"info",[n.WARN]:"warn",[n.ERROR]:"error"},u=(e,t,...r)=>{if(t<e.logLevel)return;let n=new Date().toISOString(),i=s[t];if(i)console[i](`[${n}]  ${e.name}:`,...r);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class c{constructor(e){this.name=e,this._logLevel=a,this._logHandler=u,this._userLogHandler=null,i.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in n))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?o[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,n.DEBUG,...e),this._logHandler(this,n.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,n.VERBOSE,...e),this._logHandler(this,n.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,n.INFO,...e),this._logHandler(this,n.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,n.WARN,...e),this._logHandler(this,n.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,n.ERROR,...e),this._logHandler(this,n.ERROR,...e)}}},6602:(e,t,r)=>{"use strict";r.d(t,{At:()=>I,FH:()=>E,cK:()=>k,jl:()=>T,nX:()=>_,yu:()=>x});var n=r(8106),i=r(7133),o=r(2009),a=r(5519),s=r(8310),u=r(7044),c=r(132),l=r(4277);function h(e,t){if(e){if("string"==typeof e)return d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return d(e,t)}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(){p=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(t,r,n,o){var a,s,u,c,l=Object.create((r&&r.prototype instanceof v?r:v).prototype);return i(l,"_invoke",{value:(a=t,s=n,u=new A(o||[]),c=d,function(t,r){if(c===m)throw Error("Generator is already running");if(c===g){if("throw"===t)throw r;return{value:e,done:!0}}for(u.method=t,u.arg=r;;){var n=u.delegate;if(n){var i=function t(r,n){var i=n.method,o=r.iterator[i];if(o===e)return n.delegate=null,"throw"===i&&r.iterator.return&&(n.method="return",n.arg=e,t(r,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+i+"' method")),y;var a=h(o,r.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,y;var s=a.arg;return s?s.done?(n[r.resultName]=s.value,n.next=r.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):s:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,y)}(n,u);if(i){if(i===y)continue;return i}}if("next"===u.method)u.sent=u._sent=u.arg;else if("throw"===u.method){if(c===d)throw c=g,u.arg;u.dispatchException(u.arg)}else"return"===u.method&&u.abrupt("return",u.arg);c=m;var o=h(a,s,u);if("normal"===o.type){if(c=u.done?g:"suspendedYield",o.arg===y)continue;return{value:o.arg,done:u.done}}"throw"===o.type&&(c=g,u.method="throw",u.arg=o.arg)}})}),l}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var d="suspendedStart",m="executing",g="completed",y={};function v(){}function b(){}function w(){}var S={};c(S,a,function(){return this});var x=Object.getPrototypeOf,I=x&&x(x(O([])));I&&I!==r&&n.call(I,a)&&(S=I);var E=w.prototype=v.prototype=Object.create(S);function T(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function k(e,t){var r;i(this,"_invoke",{value:function(i,o){function a(){return new t(function(r,a){!function r(i,o,a,s){var u=h(e[i],e,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==f(l)&&n.call(l,"__await")?t.resolve(l.__await).then(function(e){r("next",e,a,s)},function(e){r("throw",e,a,s)}):t.resolve(l).then(function(e){c.value=e,a(c)},function(e){return r("throw",e,a,s)})}s(u.arg)}(i,o,r,a)})}return r=r?r.then(a,a):a()}})}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function O(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw TypeError(f(t)+" is not iterable")}return b.prototype=w,i(E,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:b,configurable:!0}),b.displayName=c(w,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,c(e,u,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},T(k.prototype),c(k.prototype,s,function(){return this}),t.AsyncIterator=k,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new k(l(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},T(E),c(E,u,"Generator"),c(E,a,function(){return this}),c(E,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function m(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(n,i)}function g(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){m(o,n,i,a,s,"next",e)}function s(e){m(o,n,i,a,s,"throw",e)}a(void 0)})}}function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach(function(t){b(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function b(e,t,r){var n;return(n=function(e,t){if("object"!==f(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==f(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"),(t="symbol"===f(n)?n:String(n))in e)?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var w={rankingMode:"total_points",scoreSettings:s.$d,strokeSettings:u.zh,farbeSettings:c.FT,minParticipants:4,maxParticipants:null},S={currentTournamentInstance:null,detailsStatus:"idle",loadingInstanceId:null,currentTournamentGames:[],gamesStatus:"idle",tournamentParticipants:[],participantsStatus:"idle",userTournamentInstances:[],userActiveTournamentId:null,userActiveTournamentStatus:"idle",userActiveTournamentError:null,activePasse:null,tournamentPlayerStats:null,status:"idle",error:null,passeRoundsCache:{},passeRoundsStatus:{},currentViewingPasse:null,passeDetailsStatus:"idle",tournamentListenerUnsubscribe:null},x=(0,n.v)(function(e,t){var n,m,y,x,I,E,T,k,_,P,A,O,C,D,N,R,L,j,F,G,M;return v(v({},S),{},{createTournament:(n=g(p().mark(function r(n,o,a,l,h){var d,f,m,g,y,v,b,w,S;return p().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return e({status:"loading-list",error:null}),r.prev=1,v={rankingMode:h.rankingMode,scoreSettings:null!=(d=h.scoreSettings)?d:s.$d,strokeSettings:null!=(f=h.strokeSettings)?f:u.zh,farbeSettings:null!=(m=h.farbeSettings)?m:c.FT,minParticipants:null!=(g=h.minParticipants)?g:4,maxParticipants:null!=(y=h.maxParticipants)?y:null},r.next=2,(0,i.createTournamentInstance)(n,o,a,l,v,"upcoming");case 2:return b=r.sent,r.next=3,t().loadUserTournamentInstances(o);case 3:return e({status:"success",currentTournamentInstance:null}),r.abrupt("return",b);case 4:throw r.prev=4,w=(S=r.catch(1))instanceof Error?S.message:"Fehler beim Erstellen des Turniers.",console.error("[TournamentStore] Error creating tournament:",S),e({status:"error",error:w}),S;case 5:case"end":return r.stop()}},r,null,[[1,4]])})),function(e,t,r,i,o){return n.apply(this,arguments)}),loadUserTournamentInstances:(m=g(p().mark(function t(r,n){var o,a;return p().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e({status:"loading-list",error:null}),t.prev=1,!n){t.next=3;break}return t.next=2,(0,i.fetchTournamentInstancesForGroup)(n);case 2:e({userTournamentInstances:t.sent,status:"success"}),t.next=5;break;case 3:return t.next=4,(0,i.fetchTournamentsForUser)(r);case 4:e({userTournamentInstances:t.sent,status:"success"});case 5:t.next=7;break;case 6:t.prev=6,o=(a=t.catch(1))instanceof Error?a.message:"Fehler beim Laden der Turnier-Instanzen.",console.error("[TournamentStore] Error loading tournament instances:",a),e({status:"error",error:o});case 7:case"end":return t.stop()}},t,null,[[1,6]])})),function(e,t){return m.apply(this,arguments)}),setCurrentTournamentInstance:function(t){e({currentTournamentInstance:t}),t&&e({currentTournamentGames:[],tournamentParticipants:[],passeRoundsCache:{},passeRoundsStatus:{}})},fetchTournamentInstanceDetails:(y=g(p().mark(function r(n){var o,a,l,h,d,m,g,y,b,S,x,I,E;return p().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(((null==(o=(l=t()).currentTournamentInstance)?void 0:o.id)!==n||"success"!==l.detailsStatus)&&("loading"!==l.detailsStatus||l.loadingInstanceId!==n)){r.next=1;break}return(null==(h=l.currentTournamentInstance)?void 0:h.id)!==n||l.tournamentListenerUnsubscribe||t().setupTournamentListener(n),r.abrupt("return");case 1:return console.log("[TournamentStore] Fetching details for tournament: ".concat(n)),(null==(a=l.currentTournamentInstance)?void 0:a.id)===n&&l.currentTournamentInstance||(console.log("[TournamentStore] Instance ID changed or no current instance. Clearing games and participants for ".concat(n,".")),e({currentTournamentGames:[],gamesStatus:"idle",tournamentParticipants:[],participantsStatus:"idle",passeRoundsCache:{},passeRoundsStatus:{},currentViewingPasse:null,passeDetailsStatus:"idle"})),e({detailsStatus:"loading",loadingInstanceId:n,error:null}),r.prev=2,r.next=3,(0,i.fetchTournamentInstanceDetails)(n);case 3:(d=r.sent)?((x=v(v({},w),d.settings||{})).scoreSettings=v(v({},s.$d),(null==(m=d.settings)?void 0:m.scoreSettings)||{}),x.strokeSettings=v(v({},u.zh),(null==(g=d.settings)?void 0:g.strokeSettings)||{}),x.farbeSettings=v(v({},c.FT),(null==(y=d.settings)?void 0:y.farbeSettings)||{}),x.farbeSettings&&"object"===f(x.farbeSettings)&&(x.farbeSettings.values=v(v({},c.FT.values),x.farbeSettings.values||{})),I=v(v({},d),{},{settings:x}),console.log("[TournamentStore] Normalisierte Turniereinstellungen f\xfcr ".concat(n,":"),{hat_settings:!!I.settings,hat_farbeSettings:!!(null!=(b=I.settings)&&b.farbeSettings),cardStyle:null==(S=I.settings)||null==(S=S.farbeSettings)?void 0:S.cardStyle}),t().loadingInstanceId===n&&(e({currentTournamentInstance:I,status:"success",detailsStatus:"success",loadingInstanceId:null}),t().setupTournamentListener(n))):t().loadingInstanceId===n&&(console.warn("[TournamentStore] Tournament instance ".concat(n," not found by service or access denied.")),e({status:"error",detailsStatus:"error",error:"Turnier nicht gefunden oder Zugriff verweigert.",currentTournamentInstance:null,loadingInstanceId:null})),r.next=5;break;case 4:r.prev=4,E=r.catch(2),console.error("[TournamentStore] Error in fetchTournamentInstanceDetails for ".concat(n,":"),E),t().loadingInstanceId===n&&e({status:"error",detailsStatus:"error",error:E instanceof Error?E.message:"Fehler beim Laden der Turnier-Details.",currentTournamentInstance:null,loadingInstanceId:null});case 5:case"end":return r.stop()}},r,null,[[2,4]])})),function(e){return y.apply(this,arguments)}),loadTournamentGames:(x=g(p().mark(function r(n){var o,a;return p().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if("loading"!==t().gamesStatus){r.next=1;break}return console.log("[TournamentStore] Games for ".concat(n," are already loading. Skipping redundant fetch.")),r.abrupt("return");case 1:return e({status:"loading-games",gamesStatus:"loading",error:null}),r.prev=2,r.next=3,(0,i.fetchTournamentGames)(n);case 3:e({currentTournamentGames:r.sent,status:"success",gamesStatus:"success"}),r.next=5;break;case 4:r.prev=4,o=(a=r.catch(2))instanceof Error?a.message:"Fehler beim Laden der Turnier-Spiele.",console.error("[TournamentStore] Error loading tournament games for ".concat(n,":"),a),e({status:"error",gamesStatus:"error",error:o});case 5:case"end":return r.stop()}},r,null,[[2,4]])})),function(e){return x.apply(this,arguments)}),loadTournamentParticipants:(I=g(p().mark(function r(n){var o,a;return p().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if("loading"!==t().participantsStatus){r.next=1;break}return console.log("[TournamentStore] Participants for ".concat(n," are already loading. Skipping redundant fetch.")),r.abrupt("return");case 1:return e({status:"loading-participants",participantsStatus:"loading",error:null}),r.prev=2,r.next=3,(0,i.fetchTournamentParticipants)(n);case 3:e({tournamentParticipants:r.sent.map(function(e){var t=e.userId,r=e.id;return t?v(v({},e),{},{uid:t,playerId:r,completedPassesCount:e.completedPassesCount||0,currentPasseNumberForPlayer:e.currentPasseNumberForPlayer||1}):(console.error("[TournamentStore] loadTournamentParticipants: Player ".concat(e.displayName," (ID: ").concat(r,") has no userId. Skipping.")),null)}).filter(function(e){return null!==e}),status:"success",participantsStatus:"success"}),r.next=5;break;case 4:r.prev=4,o=(a=r.catch(2))instanceof Error?a.message:"Fehler beim Laden der Teilnehmer.",console.error("[TournamentStore] Error loading participants for ".concat(n,":"),a),e({status:"error",participantsStatus:"error",error:o});case 5:case"end":return r.stop()}},r,null,[[2,4]])})),function(e){return I.apply(this,arguments)}),startNewPasse:(E=g(p().mark(function r(n,i,f){var m,y,b,w,S,x,I,E,T,k,_,P,A,O,C,D,N,R,L,j,F,G,M;return p().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(e({status:"loading-games",error:null}),!(!(m=t().currentTournamentInstance)||!m.settings)){r.next=1;break}return e({status:"error",error:y="Turnierdetails oder -einstellungen nicht geladen, um Passe zu starten."}),console.error("[TournamentStore] startNewPasse: ",y),r.abrupt("return",null);case 1:if(w=(b=m.settings).scoreSettings,S=b.strokeSettings,x=b.farbeSettings,I=null!=w?w:s.$d,E=null!=S?S:u.zh,T=null!=x?x:c.FT,console.log("[TournamentStore] Turniereinstellungen f\xfcr Passe-Start (direkt aus currentTournament.settings):",{scoreSettingsValid:!!I,strokeSettingsValid:!!E,farbeSettingsValid:!!T,cardStyle:T.cardStyle,siegPunkte:I.values.sieg,schneiderStriche:E.schneider}),!i.some(function(e){return"number"!=typeof e.completedPassesCount})){r.next=2;break}return console.error("[TournamentStore] startNewPasse: ",k="Fehler: completedPassesCount fehlt f\xfcr einen oder mehrere Spieler.",i),e({status:"error",error:k}),r.abrupt("return",null);case 2:var U;return _=1+Math.min.apply(Math,function(e){if(Array.isArray(e))return d(e)}(U=i.map(function(e){return e.completedPassesCount}))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(U)||h(U)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),P=Number(f),A=i.map(function(e){return v(v({},e),{},{playerNumber:Number(e.playerNumber)})}),console.log("[TournamentStore] startNewPasse - \xdcbergebene Spieler (Input):"),i.forEach(function(e){return console.log("  - UID: ".concat(e.uid,", Name: ").concat(e.name,", PlayerNum: ").concat(e.playerNumber,", completedPasses: ").concat(e.completedPassesCount))}),O=A.reduce(function(e,t){return e[t.playerNumber]=t.name,e},{}),C=A.reduce(function(e,t){return e[t.playerNumber]={type:"member",uid:t.uid,name:t.name,photoURL:t.photoURL||null},e},{}),console.log("[TournamentStore] startNewPasse - gamePlayersForGame erstellt:"),Object.entries(C).forEach(function(e){var t=function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],u=!0,c=!1;try{o=(r=r.call(e)).next,!1;for(;!(u=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,2)||h(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),r=t[0],n=t[1];return console.log("  - Player ".concat(r,": UID: ").concat(n.uid,", Name: ").concat(n.name))}),D={top:[2,4],bottom:[1,3]},console.log("[TournamentStore] Turniereinstellungen bei Passe-Start:",{scoreSettings:I?"vorhanden":"fehlend",strokeSettings:E?"vorhanden":"fehlend",farbeSettings:T?"vorhanden":"fehlend",cardStyle:null==T?void 0:T.cardStyle}),N={groupId:null,sessionId:"tournament_".concat(n,"_passe_").concat(_),currentGameNumber:_,teams:{top:D.top,bottom:D.bottom},lastUpdated:(0,o.serverTimestamp)(),tournamentInstanceId:n,participantUids:i.map(function(e){return e.uid}),playerNames:O,gamePlayers:C,startingPlayer:P,initialStartingPlayer:P,currentPlayer:P,currentRound:1,scores:{top:0,bottom:0},striche:{top:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0},bottom:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0}},roundHistory:[],status:"live",createdAt:(0,o.serverTimestamp)(),passeTournamentNumber:_,weisPoints:{top:0,bottom:0},jassPoints:{top:0,bottom:0},currentRoundWeis:[],isGameStarted:!0,isRoundCompleted:!1,isGameCompleted:!1,scoreSettings:I,strokeSettings:E,farbeSettings:T},R=(0,o.collection)(a.db,"activeGames"),r.next=3,(0,o.addDoc)(R,N);case 3:return j=(L=r.sent).id,F=(0,o.doc)(a.db,"tournaments",n),r.prev=4,r.next=5,(0,o.runTransaction)(a.db,function(){var e=g(p().mark(function e(t){var r,n;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,t.get(F);case 1:if((r=e.sent).exists()){e.next=2;break}throw"Tournament document does not exist!";case 2:n=(r.data().participants||[]).map(function(e){return i.some(function(t){return t.uid===e.uid})?v(v({},e),{},{currentPasseNumberForPlayer:_}):e}),t.update(F,{participants:n});case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 5:r.next=8;break;case 6:return r.prev=6,console.error("[TournamentStore] Transaction failed to update participant passe numbers: ",M=r.catch(4)),r.next=7,(0,o.deleteDoc)(L);case 7:throw e({status:"error",error:"Fehler beim Aktualisieren der Teilnehmerdaten f\xfcr die Passe."}),M;case 8:return G=v(v({},N),{},{activeGameId:j,createdAt:o.Timestamp.now(),lastUpdated:o.Timestamp.now()}),l.useGameStore.getState().resetGame(P,j,{farbeSettings:T,scoreSettings:I,strokeSettings:E}),console.log("[TournamentStore] gameStore.resetGame f\xfcr Passe ".concat(j," mit Turniereinstellungen aufgerufen.")),e({activePasse:G,status:"success"}),r.abrupt("return",j);case 9:case"end":return r.stop()}},r,null,[[4,6]])})),function(e,t,r){return E.apply(this,arguments)}),updateActivePasse:function(t){e(function(e){return{activePasse:e.activePasse?v(v({},e.activePasse),t):null}})},completePasse:(T=g(p().mark(function r(n,o){var a,s;return p().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return e({status:"loading-games",error:null}),r.prev=1,r.next=2,(0,i.completeTournamentPasse)(n,o);case 2:if(!o.tournamentInstanceId){r.next=3;break}return r.next=3,t().loadTournamentGames(o.tournamentInstanceId);case 3:e({activePasse:null,status:"success"}),r.next=5;break;case 4:r.prev=4,a=(s=r.catch(1))instanceof Error?s.message:"Fehler beim Abschliessen der Passe.",console.error("[TournamentStore] Error completing passe:",s),e({status:"error",error:a});case 5:case"end":return r.stop()}},r,null,[[1,4]])})),function(e,t){return T.apply(this,arguments)}),updateTournamentSettings:(k=g(p().mark(function r(n,o){var a,l,h,d,f,m,g,y;return p().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(t().status,e({status:"updating-settings",error:null}),r.prev=1,!(!(l=t().currentTournamentInstance)||l.id!==n)){r.next=2;break}return r.next=2,t().fetchTournamentInstanceDetails(n);case 2:if(!(!(h=t().currentTournamentInstance)||h.id!==n)){r.next=3;break}return console.error("[TournamentStore] Konnte Turnierdetails nicht abrufen f\xfcr Update: ".concat(n)),e({status:"error",error:"Turnierdetails konnten nicht abgerufen werden."}),r.abrupt("return",!1);case 3:return f=v(v({},d=h.settings||w),o),o.scoreSettings&&(f.scoreSettings=v(v(v({},s.$d),d.scoreSettings||{}),o.scoreSettings)),o.strokeSettings&&(f.strokeSettings=v(v(v({},u.zh),d.strokeSettings||{}),o.strokeSettings)),o.farbeSettings&&(f.farbeSettings=v(v(v({},c.FT),d.farbeSettings||{}),o.farbeSettings),o.farbeSettings.values&&(f.farbeSettings.values=v(v(v({},c.FT.values),(null==(m=d.farbeSettings)?void 0:m.values)||{}),o.farbeSettings.values))),console.log("[TournamentStore] Aktualisierte Turniereinstellungen:",{hat_settings:!!f,hat_farbeSettings:!!f.farbeSettings,cardStyle:null==(a=f.farbeSettings)?void 0:a.cardStyle}),r.next=4,(0,i.updateTournamentSettings)(n,f);case 4:return r.next=5,t().fetchTournamentInstanceDetails(n);case 5:if("error"!==t().detailsStatus){r.next=6;break}return r.abrupt("return",!1);case 6:return e({status:"success"}),r.abrupt("return",!0);case 7:return r.prev=7,g=(y=r.catch(1))instanceof Error?y.message:"Fehler beim Aktualisieren der Turnier-Einstellungen.",console.error("[TournamentStore] Error updating tournament settings for ".concat(n,":"),y),e({status:"error",error:g}),r.abrupt("return",!1);case 8:case"end":return r.stop()}},r,null,[[1,7]])})),function(e,t){return k.apply(this,arguments)}),updateTournamentDetails:(_=g(p().mark(function r(n,o){var a,s,u;return p().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return a=t().status,e({status:"updating-settings",error:null}),r.prev=1,r.next=2,(0,i.updateTournamentBaseDetails)(n,o);case 2:return r.next=3,t().fetchTournamentInstanceDetails(n);case 3:if("error"!==t().detailsStatus){r.next=4;break}return e({status:a}),r.abrupt("return",!1);case 4:return e({status:"success"}),r.abrupt("return",!0);case 5:return r.prev=5,s=(u=r.catch(1))instanceof Error?u.message:"Fehler beim Aktualisieren der Turnierdetails (Name/Beschreibung).",console.error("[TournamentStore] Error updating tournament base details for ".concat(n,":"),u),e({status:"error",error:s}),r.abrupt("return",!1);case 6:case"end":return r.stop()}},r,null,[[1,5]])})),function(e,t){return _.apply(this,arguments)}),removeParticipant:(P=g(p().mark(function r(n,o){var a,s;return p().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return e({status:"managing-participant",error:null}),r.prev=1,r.next=2,(0,i.removeParticipantFromTournament)(n,o);case 2:return r.next=3,t().fetchTournamentInstanceDetails(n);case 3:return e({status:"success"}),r.abrupt("return",!0);case 4:return r.prev=4,a=(s=r.catch(1))instanceof Error?s.message:"Fehler beim Entfernen des Teilnehmers.",console.error("[TournamentStore] Error removing participant ".concat(o," from ").concat(n,":"),s),e({status:"error",error:a}),r.abrupt("return",!1);case 5:case"end":return r.stop()}},r,null,[[1,4]])})),function(e,t){return P.apply(this,arguments)}),makeParticipantAdmin:(A=g(p().mark(function r(n,o){var a,s;return p().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return e({status:"managing-participant",error:null}),r.prev=1,r.next=2,(0,i.addTournamentAdmin)(n,o);case 2:return r.next=3,t().fetchTournamentInstanceDetails(n);case 3:return e({status:"success"}),r.abrupt("return",!0);case 4:return r.prev=4,a=(s=r.catch(1))instanceof Error?s.message:"Fehler beim Ernennen zum Admin.",console.error("[TournamentStore] Error making participant ".concat(o," admin in ").concat(n,":"),s),e({status:"error",error:a}),r.abrupt("return",!1);case 5:case"end":return r.stop()}},r,null,[[1,4]])})),function(e,t){return A.apply(this,arguments)}),removeParticipantAdmin:(O=g(p().mark(function r(n,o){var a,s;return p().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return e({status:"managing-participant",error:null}),r.prev=1,r.next=2,(0,i.removeTournamentAdmin)(n,o);case 2:return r.next=3,t().fetchTournamentInstanceDetails(n);case 3:return e({status:"success"}),r.abrupt("return",!0);case 4:return r.prev=4,a=(s=r.catch(1))instanceof Error?s.message:"Fehler beim Entfernen des Admin-Status.",console.error("[TournamentStore] Error removing admin status for ".concat(o," in ").concat(n,":"),s),e({status:"error",error:a}),r.abrupt("return",!1);case 5:case"end":return r.stop()}},r,null,[[1,4]])})),function(e,t){return O.apply(this,arguments)}),addParticipantManual:(C=g(p().mark(function r(n,o){var a,s;return p().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return e({status:"managing-participant",error:null}),r.prev=1,r.next=2,(0,i.addParticipantToTournament)(n,o);case 2:return r.next=3,t().fetchTournamentInstanceDetails(n);case 3:return e({status:"success"}),r.abrupt("return",!0);case 4:return r.prev=4,a=(s=r.catch(1))instanceof Error?s.message:"Fehler beim Hinzuf\xfcgen des Teilnehmers.",console.error("[TournamentStore] Error adding participant ".concat(o," to ").concat(n,":"),s),e({status:"error",error:a}),r.abrupt("return",!1);case 5:case"end":return r.stop()}},r,null,[[1,4]])})),function(e,t){return C.apply(this,arguments)}),leaveTournament:(D=g(p().mark(function r(n,o){var a,s,u;return p().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return e({status:"leaving-tournament",error:null}),r.prev=1,r.next=2,(0,i.leaveTournament)(n,o);case 2:return r.next=3,t().loadUserTournamentInstances(o);case 3:return(null==(a=t().currentTournamentInstance)?void 0:a.id)===n&&e({currentTournamentInstance:null}),e({status:"success"}),r.abrupt("return",!0);case 4:return r.prev=4,s=(u=r.catch(1))instanceof Error?u.message:"Fehler beim Verlassen des Turniers.",console.error("[TournamentStore] Error leaving tournament ".concat(n," for user ").concat(o,":"),u),e({status:"error",error:s}),r.abrupt("return",!1);case 5:case"end":return r.stop()}},r,null,[[1,4]])})),function(e,t){return D.apply(this,arguments)}),clearError:function(){e({error:null,status:t().currentTournamentInstance?"success":"idle"})},clearCurrentTournamentInstance:function(){console.log("[TournamentStore] Clearing current tournament instance and related data.");var r=t().tournamentListenerUnsubscribe;r&&(console.log("[TournamentStore] Removing tournament listener."),r()),e({currentTournamentInstance:null,currentTournamentGames:[],tournamentParticipants:[],activePasse:null,detailsStatus:"idle",participantsStatus:"idle",gamesStatus:"idle",passeRoundsCache:{},passeRoundsStatus:{},error:null,status:"idle",loadingInstanceId:null,currentViewingPasse:null,passeDetailsStatus:"idle",tournamentListenerUnsubscribe:null})},loadPasseRounds:(N=g(p().mark(function r(n,o){var a,s,u,c;return p().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if("loading"!==(a=t().passeRoundsStatus[o])&&"success"!==a){r.next=1;break}return r.abrupt("return");case 1:return console.log("[TournamentStore] Fetching rounds for passe: ".concat(o," in instance: ").concat(n)),e(function(e){return{passeRoundsStatus:v(v({},e.passeRoundsStatus),{},b({},o,"loading")),status:"loading-passe-rounds",error:null}}),r.prev=2,r.next=3,(0,i.fetchPasseRounds)(n,o);case 3:s=r.sent,e(function(e){return{passeRoundsCache:v(v({},e.passeRoundsCache),{},b({},o,s)),passeRoundsStatus:v(v({},e.passeRoundsStatus),{},b({},o,"success")),status:"success"}}),r.next=5;break;case 4:r.prev=4,u=(c=r.catch(2))instanceof Error?c.message:"Fehler beim Laden der Runden f\xfcr Passe ".concat(o,"."),console.error("[TournamentStore] Error loading rounds for passe ".concat(o,":"),c),e(function(e){return{passeRoundsStatus:v(v({},e.passeRoundsStatus),{},b({},o,"error")),status:"error",error:u}});case 5:case"end":return r.stop()}},r,null,[[2,4]])})),function(e,t){return N.apply(this,arguments)}),addMultipleParticipants:(R=g(p().mark(function r(n,o){var a,s,u,c,l,d,f;return p().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:e({status:"managing-participant",error:null}),r.prev=1,a=!0,s=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=h(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}(o),r.prev=2,s.s();case 3:if((u=s.n()).done){r.next=8;break}return c=u.value,r.prev=4,r.next=5,(0,i.addParticipantToTournament)(n,c);case 5:r.next=7;break;case 6:r.prev=6,l=r.catch(4),a=!1,console.error("[TournamentStore] Error adding participant ".concat(c," in batch:"),l);case 7:r.next=3;break;case 8:r.next=10;break;case 9:r.prev=9,d=r.catch(2),s.e(d);case 10:return r.prev=10,s.f(),r.finish(10);case 11:if(!a){r.next=13;break}return r.next=12,t().loadTournamentParticipants(n);case 12:return e({status:"success"}),r.abrupt("return",!0);case 13:return r.next=14,t().loadTournamentParticipants(n);case 14:return e({status:"error",error:"Nicht alle Teilnehmer konnten hinzugef\xfcgt werden."}),r.abrupt("return",!1);case 15:r.next=17;break;case 16:return r.prev=16,e({status:"error",error:(f=r.catch(1))instanceof Error?f.message:"Fehler beim Hinzuf\xfcgen der Teilnehmer."}),r.abrupt("return",!1);case 17:case"end":return r.stop()}},r,null,[[1,16],[2,9,10,11],[4,6]])})),function(e,t){return R.apply(this,arguments)}),checkUserActiveTournament:(L=g(p().mark(function n(i){var o,a,s,u;return p().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("loading"!==t().userActiveTournamentStatus){n.next=1;break}return n.abrupt("return",!1);case 1:return e({userActiveTournamentStatus:"loading",userActiveTournamentError:null}),n.prev=2,n.next=3,Promise.resolve().then(r.bind(r,7133));case 3:return o=n.sent.fetchActiveTournamentForUser,n.next=4,o(i);case 4:if(!(a=n.sent)){n.next=5;break}return e({userActiveTournamentId:a.id,userActiveTournamentStatus:"success"}),n.abrupt("return",!0);case 5:return e({userActiveTournamentId:null,userActiveTournamentStatus:"success"}),n.abrupt("return",!1);case 6:n.next=8;break;case 7:return n.prev=7,s=(u=n.catch(2))instanceof Error?u.message:"Fehler beim Pr\xfcfen des aktiven Turniers.",console.error("[TournamentStore] Error in checkUserActiveTournament:",u),e({userActiveTournamentId:null,userActiveTournamentStatus:"error",userActiveTournamentError:s}),n.abrupt("return",!1);case 8:case"end":return n.stop()}},n,null,[[2,7]])})),function(e){return L.apply(this,arguments)}),fetchTournamentGameById:(j=g(p().mark(function t(r,n){var i,s,u,c;return p().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("[TournamentStore] Fetching details for passe ".concat(n," in tournament ").concat(r)),e({passeDetailsStatus:"loading",error:null}),t.prev=1,i=(0,o.doc)(a.db,"tournaments",r,"games",n),t.next=2,(0,o.getDoc)(i);case 2:(s=t.sent).exists()?(u=v(v({},s.data()),{},{passeId:s.id}),console.log("[TournamentStore] Passe ".concat(n," found.")),e({currentViewingPasse:u,passeDetailsStatus:"success"})):(console.warn("[TournamentStore] Passe ".concat(n," not found in tournament ").concat(r,".")),e({currentViewingPasse:null,passeDetailsStatus:"error",error:"Passe nicht gefunden."})),t.next=4;break;case 3:t.prev=3,c=t.catch(1),console.error("[TournamentStore] Error fetching passe ".concat(n,":"),c),e({currentViewingPasse:null,passeDetailsStatus:"error",error:c.message||"Fehler beim Laden der Passen-Details."});case 4:case"end":return t.stop()}},t,null,[[1,3]])})),function(e,t){return j.apply(this,arguments)}),completeTournament:(F=g(p().mark(function r(n){var a,s,u;return p().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return e({status:"updating-settings",error:null}),r.prev=1,r.next=2,(0,i.markTournamentAsCompletedService)(n);case 2:if(!((a=t().currentTournamentInstance)&&a.id===n)){r.next=3;break}e({currentTournamentInstance:v(v({},a),{},{status:"completed",completedAt:o.Timestamp.now()}),status:"success"}),r.next=5;break;case 3:return r.next=4,t().fetchTournamentInstanceDetails(n);case 4:e({status:"success"});case 5:return r.abrupt("return",!0);case 6:return r.prev=6,s=(u=r.catch(1))instanceof Error?u.message:"Fehler beim Abschliessen des Turniers.",console.error("[TournamentStore] Error completing tournament:",u),e({status:"error",error:s}),r.abrupt("return",!1);case 7:case"end":return r.stop()}},r,null,[[1,6]])})),function(e){return F.apply(this,arguments)}),setupTournamentListener:function(r){var n,i=t().tournamentListenerUnsubscribe;if(i&&(null==(n=t().currentTournamentInstance)?void 0:n.id)===r)return void console.log("[TournamentStore] Listener already exists for tournament ".concat(r,", skipping setup"));i&&i(),console.log("[TournamentStore] Setting up real-time listener for tournament ".concat(r));var l=(0,o.doc)(a.db,"tournaments",r),h=(0,o.onSnapshot)(l,function(n){if(n.exists()){var i,o,a,l,h,d,f,p,m,g,y,b=n.data(),S=v(v(v({},w),b.settings||{}),{},{scoreSettings:v(v({},s.$d),(null==(i=b.settings)?void 0:i.scoreSettings)||{}),strokeSettings:v(v({},u.zh),(null==(o=b.settings)?void 0:o.strokeSettings)||{}),farbeSettings:v(v({},c.FT),(null==(a=b.settings)?void 0:a.farbeSettings)||{})}),x=v(v({id:n.id},b),{},{settings:S}),I=t().currentTournamentInstance;(null==I?void 0:I.id)===r?I.completedPasseCount!==x.completedPasseCount||I.status!==x.status||JSON.stringify(I.participantUids)!==JSON.stringify(x.participantUids)||JSON.stringify(null==(l=I.settings)?void 0:l.rankingMode)!==JSON.stringify(null==(h=x.settings)?void 0:h.rankingMode)||JSON.stringify(null==(d=I.settings)?void 0:d.scoreSettings)!==JSON.stringify(null==(f=x.settings)?void 0:f.scoreSettings)||JSON.stringify(null==(p=I.settings)?void 0:p.strokeSettings)!==JSON.stringify(null==(m=x.settings)?void 0:m.strokeSettings)||JSON.stringify(null==(g=I.settings)?void 0:g.farbeSettings)!==JSON.stringify(null==(y=x.settings)?void 0:y.farbeSettings)?(console.log("[TournamentStore] Relevant changes detected for tournament ".concat(r,", updating state")),e({currentTournamentInstance:x,detailsStatus:"success"}),I.completedPasseCount!==x.completedPasseCount&&(console.log("[TournamentStore] Detected completedPasseCount change, reloading games..."),t().loadTournamentGames(r))):console.log("[TournamentStore] No relevant changes for tournament ".concat(r,", skipping update")):e({currentTournamentInstance:x,detailsStatus:"success"})}else console.warn("[TournamentStore] Tournament ".concat(r," was deleted or is no longer accessible.")),e({currentTournamentInstance:null,detailsStatus:"error",error:"Turnier wurde gel\xf6scht oder ist nicht mehr zug\xe4nglich."})},function(t){console.error("[TournamentStore] Error in tournament real-time listener for ".concat(r,":"),t),e({detailsStatus:"error",error:"Fehler beim Empfangen von Turnier-Updates."})});e({tournamentListenerUnsubscribe:h})},clearTournamentListener:function(){var r=t().tournamentListenerUnsubscribe;r&&(console.log("[TournamentStore] Clearing tournament real-time listener"),r(),e({tournamentListenerUnsubscribe:null}))},resetTournamentState:function(){var r=t().tournamentListenerUnsubscribe;r&&(console.log("[TournamentStore] Removing tournament listener during reset."),r()),e(S)},activateTournament:(G=g(p().mark(function r(n){var o,a;return p().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return e({status:"updating-settings",error:null}),r.prev=1,r.next=2,(0,i.activateTournamentService)(n);case 2:return r.next=3,t().fetchTournamentInstanceDetails(n);case 3:if("error"!==t().detailsStatus){r.next=4;break}return r.abrupt("return",!1);case 4:return e({status:"success"}),r.abrupt("return",!0);case 5:return r.prev=5,o=(a=r.catch(1))instanceof Error?a.message:"Fehler beim Aktivieren des Turniers.",console.error("[TournamentStore] Error activating tournament ".concat(n,":"),a),e({status:"error",error:o}),r.abrupt("return",!1);case 6:case"end":return r.stop()}},r,null,[[1,5]])})),function(e){return G.apply(this,arguments)}),recordPasseCompletion:(M=g(p().mark(function r(n,i,s,u,c){var l,h,d,f,m,y,b;return p().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return e({status:"loading-games",error:null}),console.log("[TournamentStore] Recording completion for passe ".concat(i," in tournament ").concat(n)),r.prev=1,h=(0,o.doc)(a.db,"tournaments",n),d=(0,o.doc)(a.db,"activeGames",i),r.next=2,(0,o.runTransaction)(a.db,function(){var e=g(p().mark(function e(t){var r,i;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,t.get(h);case 1:if((r=e.sent).exists()){e.next=2;break}throw Error("Tournament ".concat(n," not found."));case 2:i=(r.data().participants||[]).map(function(e){if(s.includes(e.uid)){var t=(e.completedPassesCount||0)+1;return v(v({},e),{},{completedPassesCount:t,currentPasseNumberForPlayer:t+1})}return e}),t.update(h,{participants:i}),t.update(d,{status:"completed",completedAt:(0,o.serverTimestamp)(),scores:u,striche:c});case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:return(f=t().currentTournamentInstance)&&f.id===n&&(m=(f.participants||[]).map(function(e){if(s.includes(e.uid)){var t=(e.completedPassesCount||0)+1;return v(v({},e),{},{completedPassesCount:t,currentPasseNumberForPlayer:t+1})}return e}),e({currentTournamentInstance:v(v({},f),{},{participants:m}),status:"success"})),(null==(l=t().activePasse)?void 0:l.activeGameId)===i&&e({activePasse:null}),r.next=3,t().loadTournamentGames(n);case 3:r.next=5;break;case 4:throw r.prev=4,y=(b=r.catch(1))instanceof Error?b.message:"Fehler beim Abschliessen der Passe im Turnier.",console.error("[TournamentStore] Error in recordPasseCompletion for passe ".concat(i,":"),b),e({status:"error",error:y}),b;case 5:case"end":return r.stop()}},r,null,[[1,4]])})),function(e,t,r,n,i){return M.apply(this,arguments)})})}),I=function(e){return e.tournamentParticipants},E=function(e){return e.detailsStatus},T=function(e){return e.participantsStatus},k=function(e){return e.gamesStatus},_=function(e){return e.loadingInstanceId}},6722:(e,t,r)=>{"use strict";r.d(t,{cn:()=>eh,N:()=>ed});var n=r(9241);let i=e=>{let t=u(e),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=e;return{getClassGroupId:e=>{let r=e.split("-");return""===r[0]&&1!==r.length&&r.shift(),o(r,t)||s(e)},getConflictingClassGroupIds:(e,t)=>{let i=r[e]||[];return t&&n[e]?[...i,...n[e]]:i}}},o=(e,t)=>{if(0===e.length)return t.classGroupId;let r=e[0],n=t.nextPart.get(r),i=n?o(e.slice(1),n):void 0;if(i)return i;if(0===t.validators.length)return;let a=e.join("-");return t.validators.find(({validator:e})=>e(a))?.classGroupId},a=/^\[(.+)\]$/,s=e=>{if(a.test(e)){let t=a.exec(e)[1],r=t?.substring(0,t.indexOf(":"));if(r)return"arbitrary.."+r}},u=e=>{let{theme:t,classGroups:r}=e,n={nextPart:new Map,validators:[]};for(let e in r)c(r[e],n,e,t);return n},c=(e,t,r,n)=>{e.forEach(e=>{if("string"==typeof e){(""===e?t:l(t,e)).classGroupId=r;return}if("function"==typeof e)return h(e)?void c(e(n),t,r,n):void t.validators.push({validator:e,classGroupId:r});Object.entries(e).forEach(([e,i])=>{c(i,l(t,e),r,n)})})},l=(e,t)=>{let r=e;return t.split("-").forEach(e=>{r.nextPart.has(e)||r.nextPart.set(e,{nextPart:new Map,validators:[]}),r=r.nextPart.get(e)}),r},h=e=>e.isThemeGetter,d=e=>{if(e<1)return{get:()=>void 0,set:()=>{}};let t=0,r=new Map,n=new Map,i=(i,o)=>{r.set(i,o),++t>e&&(t=0,n=r,r=new Map)};return{get(e){let t=r.get(e);return void 0!==t?t:void 0!==(t=n.get(e))?(i(e,t),t):void 0},set(e,t){r.has(e)?r.set(e,t):i(e,t)}}},f=e=>{let{prefix:t,experimentalParseClassName:r}=e,n=e=>{let t,r=[],n=0,i=0,o=0;for(let a=0;a<e.length;a++){let s=e[a];if(0===n&&0===i){if(":"===s){r.push(e.slice(o,a)),o=a+1;continue}if("/"===s){t=a;continue}}"["===s?n++:"]"===s?n--:"("===s?i++:")"===s&&i--}let a=0===r.length?e:e.substring(o),s=p(a);return{modifiers:r,hasImportantModifier:s!==a,baseClassName:s,maybePostfixModifierPosition:t&&t>o?t-o:void 0}};if(t){let e=t+":",r=n;n=t=>t.startsWith(e)?r(t.substring(e.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:t,maybePostfixModifierPosition:void 0}}if(r){let e=n;n=t=>r({className:t,parseClassName:e})}return n},p=e=>e.endsWith("!")?e.substring(0,e.length-1):e.startsWith("!")?e.substring(1):e,m=e=>{let t=Object.fromEntries(e.orderSensitiveModifiers.map(e=>[e,!0]));return e=>{if(e.length<=1)return e;let r=[],n=[];return e.forEach(e=>{"["===e[0]||t[e]?(r.push(...n.sort(),e),n=[]):n.push(e)}),r.push(...n.sort()),r}},g=e=>({cache:d(e.cacheSize),parseClassName:f(e),sortModifiers:m(e),...i(e)}),y=/\s+/,v=(e,t)=>{let{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:i,sortModifiers:o}=t,a=[],s=e.trim().split(y),u="";for(let e=s.length-1;e>=0;e-=1){let t=s[e],{isExternal:c,modifiers:l,hasImportantModifier:h,baseClassName:d,maybePostfixModifierPosition:f}=r(t);if(c){u=t+(u.length>0?" "+u:u);continue}let p=!!f,m=n(p?d.substring(0,f):d);if(!m){if(!p||!(m=n(d))){u=t+(u.length>0?" "+u:u);continue}p=!1}let g=o(l).join(":"),y=h?g+"!":g,v=y+m;if(a.includes(v))continue;a.push(v);let b=i(m,p);for(let e=0;e<b.length;++e){let t=b[e];a.push(y+t)}u=t+(u.length>0?" "+u:u)}return u};function b(){let e,t,r=0,n="";for(;r<arguments.length;)(e=arguments[r++])&&(t=w(e))&&(n&&(n+=" "),n+=t);return n}let w=e=>{let t;if("string"==typeof e)return e;let r="";for(let n=0;n<e.length;n++)e[n]&&(t=w(e[n]))&&(r&&(r+=" "),r+=t);return r},S=e=>{let t=t=>t[e]||[];return t.isThemeGetter=!0,t},x=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,I=/^\((?:(\w[\w-]*):)?(.+)\)$/i,E=/^\d+\/\d+$/,T=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,k=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,_=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,P=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,A=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,O=e=>E.test(e),C=e=>!!e&&!Number.isNaN(Number(e)),D=e=>!!e&&Number.isInteger(Number(e)),N=e=>e.endsWith("%")&&C(e.slice(0,-1)),R=e=>T.test(e),L=()=>!0,j=e=>k.test(e)&&!_.test(e),F=()=>!1,G=e=>P.test(e),M=e=>A.test(e),U=e=>!B(e)&&!W(e),V=e=>et(e,eo,F),B=e=>x.test(e),z=e=>et(e,ea,j),H=e=>et(e,es,C),q=e=>et(e,en,F),$=e=>et(e,ei,M),K=e=>et(e,ec,G),W=e=>I.test(e),J=e=>er(e,ea),Q=e=>er(e,eu),Y=e=>er(e,en),X=e=>er(e,eo),Z=e=>er(e,ei),ee=e=>er(e,ec,!0),et=(e,t,r)=>{let n=x.exec(e);return!!n&&(n[1]?t(n[1]):r(n[2]))},er=(e,t,r=!1)=>{let n=I.exec(e);return!!n&&(n[1]?t(n[1]):r)},en=e=>"position"===e||"percentage"===e,ei=e=>"image"===e||"url"===e,eo=e=>"length"===e||"size"===e||"bg-size"===e,ea=e=>"length"===e,es=e=>"number"===e,eu=e=>"family-name"===e,ec=e=>"shadow"===e;Symbol.toStringTag;let el=function(e,...t){let r,n,i,o=function(s){return n=(r=g(t.reduce((e,t)=>t(e),e()))).cache.get,i=r.cache.set,o=a,a(s)};function a(e){let t=n(e);if(t)return t;let o=v(e,r);return i(e,o),o}return function(){return o(b.apply(null,arguments))}}(()=>{let e=S("color"),t=S("font"),r=S("text"),n=S("font-weight"),i=S("tracking"),o=S("leading"),a=S("breakpoint"),s=S("container"),u=S("spacing"),c=S("radius"),l=S("shadow"),h=S("inset-shadow"),d=S("text-shadow"),f=S("drop-shadow"),p=S("blur"),m=S("perspective"),g=S("aspect"),y=S("ease"),v=S("animate"),b=()=>["auto","avoid","all","avoid-page","page","left","right","column"],w=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],x=()=>[...w(),W,B],I=()=>["auto","hidden","clip","visible","scroll"],E=()=>["auto","contain","none"],T=()=>[W,B,u],k=()=>[O,"full","auto",...T()],_=()=>[D,"none","subgrid",W,B],P=()=>["auto",{span:["full",D,W,B]},D,W,B],A=()=>[D,"auto",W,B],j=()=>["auto","min","max","fr",W,B],F=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],G=()=>["start","end","center","stretch","center-safe","end-safe"],M=()=>["auto",...T()],et=()=>[O,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...T()],er=()=>[e,W,B],en=()=>[...w(),Y,q,{position:[W,B]}],ei=()=>["no-repeat",{repeat:["","x","y","space","round"]}],eo=()=>["auto","cover","contain",X,V,{size:[W,B]}],ea=()=>[N,J,z],es=()=>["","none","full",c,W,B],eu=()=>["",C,J,z],ec=()=>["solid","dashed","dotted","double"],el=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],eh=()=>[C,N,Y,q],ed=()=>["","none",p,W,B],ef=()=>["none",C,W,B],ep=()=>["none",C,W,B],em=()=>[C,W,B],eg=()=>[O,"full",...T()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[R],breakpoint:[R],color:[L],container:[R],"drop-shadow":[R],ease:["in","out","in-out"],font:[U],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[R],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[R],shadow:[R],spacing:["px",C],text:[R],"text-shadow":[R],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",O,B,W,g]}],container:["container"],columns:[{columns:[C,B,W,s]}],"break-after":[{"break-after":b()}],"break-before":[{"break-before":b()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:x()}],overflow:[{overflow:I()}],"overflow-x":[{"overflow-x":I()}],"overflow-y":[{"overflow-y":I()}],overscroll:[{overscroll:E()}],"overscroll-x":[{"overscroll-x":E()}],"overscroll-y":[{"overscroll-y":E()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:k()}],"inset-x":[{"inset-x":k()}],"inset-y":[{"inset-y":k()}],start:[{start:k()}],end:[{end:k()}],top:[{top:k()}],right:[{right:k()}],bottom:[{bottom:k()}],left:[{left:k()}],visibility:["visible","invisible","collapse"],z:[{z:[D,"auto",W,B]}],basis:[{basis:[O,"full","auto",s,...T()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[C,O,"auto","initial","none",B]}],grow:[{grow:["",C,W,B]}],shrink:[{shrink:["",C,W,B]}],order:[{order:[D,"first","last","none",W,B]}],"grid-cols":[{"grid-cols":_()}],"col-start-end":[{col:P()}],"col-start":[{"col-start":A()}],"col-end":[{"col-end":A()}],"grid-rows":[{"grid-rows":_()}],"row-start-end":[{row:P()}],"row-start":[{"row-start":A()}],"row-end":[{"row-end":A()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":j()}],"auto-rows":[{"auto-rows":j()}],gap:[{gap:T()}],"gap-x":[{"gap-x":T()}],"gap-y":[{"gap-y":T()}],"justify-content":[{justify:[...F(),"normal"]}],"justify-items":[{"justify-items":[...G(),"normal"]}],"justify-self":[{"justify-self":["auto",...G()]}],"align-content":[{content:["normal",...F()]}],"align-items":[{items:[...G(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...G(),{baseline:["","last"]}]}],"place-content":[{"place-content":F()}],"place-items":[{"place-items":[...G(),"baseline"]}],"place-self":[{"place-self":["auto",...G()]}],p:[{p:T()}],px:[{px:T()}],py:[{py:T()}],ps:[{ps:T()}],pe:[{pe:T()}],pt:[{pt:T()}],pr:[{pr:T()}],pb:[{pb:T()}],pl:[{pl:T()}],m:[{m:M()}],mx:[{mx:M()}],my:[{my:M()}],ms:[{ms:M()}],me:[{me:M()}],mt:[{mt:M()}],mr:[{mr:M()}],mb:[{mb:M()}],ml:[{ml:M()}],"space-x":[{"space-x":T()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":T()}],"space-y-reverse":["space-y-reverse"],size:[{size:et()}],w:[{w:[s,"screen",...et()]}],"min-w":[{"min-w":[s,"screen","none",...et()]}],"max-w":[{"max-w":[s,"screen","none","prose",{screen:[a]},...et()]}],h:[{h:["screen","lh",...et()]}],"min-h":[{"min-h":["screen","lh","none",...et()]}],"max-h":[{"max-h":["screen","lh",...et()]}],"font-size":[{text:["base",r,J,z]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[n,W,H]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",N,B]}],"font-family":[{font:[Q,B,t]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[i,W,B]}],"line-clamp":[{"line-clamp":[C,"none",W,H]}],leading:[{leading:[o,...T()]}],"list-image":[{"list-image":["none",W,B]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",W,B]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:er()}],"text-color":[{text:er()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...ec(),"wavy"]}],"text-decoration-thickness":[{decoration:[C,"from-font","auto",W,z]}],"text-decoration-color":[{decoration:er()}],"underline-offset":[{"underline-offset":[C,"auto",W,B]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:T()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",W,B]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",W,B]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:en()}],"bg-repeat":[{bg:ei()}],"bg-size":[{bg:eo()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},D,W,B],radial:["",W,B],conic:[D,W,B]},Z,$]}],"bg-color":[{bg:er()}],"gradient-from-pos":[{from:ea()}],"gradient-via-pos":[{via:ea()}],"gradient-to-pos":[{to:ea()}],"gradient-from":[{from:er()}],"gradient-via":[{via:er()}],"gradient-to":[{to:er()}],rounded:[{rounded:es()}],"rounded-s":[{"rounded-s":es()}],"rounded-e":[{"rounded-e":es()}],"rounded-t":[{"rounded-t":es()}],"rounded-r":[{"rounded-r":es()}],"rounded-b":[{"rounded-b":es()}],"rounded-l":[{"rounded-l":es()}],"rounded-ss":[{"rounded-ss":es()}],"rounded-se":[{"rounded-se":es()}],"rounded-ee":[{"rounded-ee":es()}],"rounded-es":[{"rounded-es":es()}],"rounded-tl":[{"rounded-tl":es()}],"rounded-tr":[{"rounded-tr":es()}],"rounded-br":[{"rounded-br":es()}],"rounded-bl":[{"rounded-bl":es()}],"border-w":[{border:eu()}],"border-w-x":[{"border-x":eu()}],"border-w-y":[{"border-y":eu()}],"border-w-s":[{"border-s":eu()}],"border-w-e":[{"border-e":eu()}],"border-w-t":[{"border-t":eu()}],"border-w-r":[{"border-r":eu()}],"border-w-b":[{"border-b":eu()}],"border-w-l":[{"border-l":eu()}],"divide-x":[{"divide-x":eu()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":eu()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...ec(),"hidden","none"]}],"divide-style":[{divide:[...ec(),"hidden","none"]}],"border-color":[{border:er()}],"border-color-x":[{"border-x":er()}],"border-color-y":[{"border-y":er()}],"border-color-s":[{"border-s":er()}],"border-color-e":[{"border-e":er()}],"border-color-t":[{"border-t":er()}],"border-color-r":[{"border-r":er()}],"border-color-b":[{"border-b":er()}],"border-color-l":[{"border-l":er()}],"divide-color":[{divide:er()}],"outline-style":[{outline:[...ec(),"none","hidden"]}],"outline-offset":[{"outline-offset":[C,W,B]}],"outline-w":[{outline:["",C,J,z]}],"outline-color":[{outline:er()}],shadow:[{shadow:["","none",l,ee,K]}],"shadow-color":[{shadow:er()}],"inset-shadow":[{"inset-shadow":["none",h,ee,K]}],"inset-shadow-color":[{"inset-shadow":er()}],"ring-w":[{ring:eu()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:er()}],"ring-offset-w":[{"ring-offset":[C,z]}],"ring-offset-color":[{"ring-offset":er()}],"inset-ring-w":[{"inset-ring":eu()}],"inset-ring-color":[{"inset-ring":er()}],"text-shadow":[{"text-shadow":["none",d,ee,K]}],"text-shadow-color":[{"text-shadow":er()}],opacity:[{opacity:[C,W,B]}],"mix-blend":[{"mix-blend":[...el(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":el()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[C]}],"mask-image-linear-from-pos":[{"mask-linear-from":eh()}],"mask-image-linear-to-pos":[{"mask-linear-to":eh()}],"mask-image-linear-from-color":[{"mask-linear-from":er()}],"mask-image-linear-to-color":[{"mask-linear-to":er()}],"mask-image-t-from-pos":[{"mask-t-from":eh()}],"mask-image-t-to-pos":[{"mask-t-to":eh()}],"mask-image-t-from-color":[{"mask-t-from":er()}],"mask-image-t-to-color":[{"mask-t-to":er()}],"mask-image-r-from-pos":[{"mask-r-from":eh()}],"mask-image-r-to-pos":[{"mask-r-to":eh()}],"mask-image-r-from-color":[{"mask-r-from":er()}],"mask-image-r-to-color":[{"mask-r-to":er()}],"mask-image-b-from-pos":[{"mask-b-from":eh()}],"mask-image-b-to-pos":[{"mask-b-to":eh()}],"mask-image-b-from-color":[{"mask-b-from":er()}],"mask-image-b-to-color":[{"mask-b-to":er()}],"mask-image-l-from-pos":[{"mask-l-from":eh()}],"mask-image-l-to-pos":[{"mask-l-to":eh()}],"mask-image-l-from-color":[{"mask-l-from":er()}],"mask-image-l-to-color":[{"mask-l-to":er()}],"mask-image-x-from-pos":[{"mask-x-from":eh()}],"mask-image-x-to-pos":[{"mask-x-to":eh()}],"mask-image-x-from-color":[{"mask-x-from":er()}],"mask-image-x-to-color":[{"mask-x-to":er()}],"mask-image-y-from-pos":[{"mask-y-from":eh()}],"mask-image-y-to-pos":[{"mask-y-to":eh()}],"mask-image-y-from-color":[{"mask-y-from":er()}],"mask-image-y-to-color":[{"mask-y-to":er()}],"mask-image-radial":[{"mask-radial":[W,B]}],"mask-image-radial-from-pos":[{"mask-radial-from":eh()}],"mask-image-radial-to-pos":[{"mask-radial-to":eh()}],"mask-image-radial-from-color":[{"mask-radial-from":er()}],"mask-image-radial-to-color":[{"mask-radial-to":er()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":w()}],"mask-image-conic-pos":[{"mask-conic":[C]}],"mask-image-conic-from-pos":[{"mask-conic-from":eh()}],"mask-image-conic-to-pos":[{"mask-conic-to":eh()}],"mask-image-conic-from-color":[{"mask-conic-from":er()}],"mask-image-conic-to-color":[{"mask-conic-to":er()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:en()}],"mask-repeat":[{mask:ei()}],"mask-size":[{mask:eo()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",W,B]}],filter:[{filter:["","none",W,B]}],blur:[{blur:ed()}],brightness:[{brightness:[C,W,B]}],contrast:[{contrast:[C,W,B]}],"drop-shadow":[{"drop-shadow":["","none",f,ee,K]}],"drop-shadow-color":[{"drop-shadow":er()}],grayscale:[{grayscale:["",C,W,B]}],"hue-rotate":[{"hue-rotate":[C,W,B]}],invert:[{invert:["",C,W,B]}],saturate:[{saturate:[C,W,B]}],sepia:[{sepia:["",C,W,B]}],"backdrop-filter":[{"backdrop-filter":["","none",W,B]}],"backdrop-blur":[{"backdrop-blur":ed()}],"backdrop-brightness":[{"backdrop-brightness":[C,W,B]}],"backdrop-contrast":[{"backdrop-contrast":[C,W,B]}],"backdrop-grayscale":[{"backdrop-grayscale":["",C,W,B]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[C,W,B]}],"backdrop-invert":[{"backdrop-invert":["",C,W,B]}],"backdrop-opacity":[{"backdrop-opacity":[C,W,B]}],"backdrop-saturate":[{"backdrop-saturate":[C,W,B]}],"backdrop-sepia":[{"backdrop-sepia":["",C,W,B]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":T()}],"border-spacing-x":[{"border-spacing-x":T()}],"border-spacing-y":[{"border-spacing-y":T()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",W,B]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[C,"initial",W,B]}],ease:[{ease:["linear","initial",y,W,B]}],delay:[{delay:[C,W,B]}],animate:[{animate:["none",v,W,B]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[m,W,B]}],"perspective-origin":[{"perspective-origin":x()}],rotate:[{rotate:ef()}],"rotate-x":[{"rotate-x":ef()}],"rotate-y":[{"rotate-y":ef()}],"rotate-z":[{"rotate-z":ef()}],scale:[{scale:ep()}],"scale-x":[{"scale-x":ep()}],"scale-y":[{"scale-y":ep()}],"scale-z":[{"scale-z":ep()}],"scale-3d":["scale-3d"],skew:[{skew:em()}],"skew-x":[{"skew-x":em()}],"skew-y":[{"skew-y":em()}],transform:[{transform:[W,B,"","none","gpu","cpu"]}],"transform-origin":[{origin:x()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:eg()}],"translate-x":[{"translate-x":eg()}],"translate-y":[{"translate-y":eg()}],"translate-z":[{"translate-z":eg()}],"translate-none":["translate-none"],accent:[{accent:er()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:er()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",W,B]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":T()}],"scroll-mx":[{"scroll-mx":T()}],"scroll-my":[{"scroll-my":T()}],"scroll-ms":[{"scroll-ms":T()}],"scroll-me":[{"scroll-me":T()}],"scroll-mt":[{"scroll-mt":T()}],"scroll-mr":[{"scroll-mr":T()}],"scroll-mb":[{"scroll-mb":T()}],"scroll-ml":[{"scroll-ml":T()}],"scroll-p":[{"scroll-p":T()}],"scroll-px":[{"scroll-px":T()}],"scroll-py":[{"scroll-py":T()}],"scroll-ps":[{"scroll-ps":T()}],"scroll-pe":[{"scroll-pe":T()}],"scroll-pt":[{"scroll-pt":T()}],"scroll-pr":[{"scroll-pr":T()}],"scroll-pb":[{"scroll-pb":T()}],"scroll-pl":[{"scroll-pl":T()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",W,B]}],fill:[{fill:["none",...er()]}],"stroke-w":[{stroke:[C,J,z,H]}],stroke:[{stroke:["none",...er()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}});function eh(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return el((0,n.$)(t))}function ed(e){return"/"===e||["/auth","/jass","/join","/impressum","/agb","/datenschutz","/view","/profile"].some(function(t){return e.startsWith(t)})}},6781:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"AmpStateContext",{enumerable:!0,get:function(){return n}});var n=r(4252)._(r(4232)).default.createContext({})},6796:(e,t,r)=>{"use strict";r.d(t,{KO:()=>P,MF:()=>E,Sx:()=>k,Us:()=>b,Wp:()=>T,g:()=>o.g,j6:()=>v,om:()=>y,xZ:()=>w});var n=r(8308),i=r(6525),o=r(1139),a=r(2704);class s{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!function(e){let t=e.getComponent();return(null==t?void 0:t.type)==="VERSION"}(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let u="@firebase/app",c="0.13.2",l=new i.Vy("@firebase/app"),h="[DEFAULT]",d={[u]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},f=new Map,p=new Map,m=new Map;function g(e,t){try{e.container.addComponent(t)}catch(r){l.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function y(e){let t=e.name;if(m.has(t))return l.debug(`There were multiple attempts to register component ${t}.`),!1;for(let r of(m.set(t,e),f.values()))g(r,e);for(let t of p.values())g(t,e);return!0}function v(e,t){let r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function b(e,t,r=h){v(e,t).clearInstance(r)}function w(e){return null!=e&&void 0!==e.settings}let S=new o.FA("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class x{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new n.uA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw S.create("app-deleted",{appName:this._name})}}function I(e,t){let r=(0,o.u)(e.split(".")[1]);if(null===r)return void console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`);if(void 0===JSON.parse(r).exp)return void console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`);let n=1e3*JSON.parse(r).exp;n-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}let E="11.10.0";function T(e,t={}){let r=e;"object"!=typeof t&&(t={name:t});let i=Object.assign({name:h,automaticDataCollectionEnabled:!0},t),a=i.name;if("string"!=typeof a||!a)throw S.create("bad-app-name",{appName:String(a)});if(r||(r=(0,o.T9)()),!r)throw S.create("no-options");let s=f.get(a);if(s)if((0,o.bD)(r,s.options)&&(0,o.bD)(i,s.config))return s;else throw S.create("duplicate-app",{appName:a});let u=new n.h1(a);for(let e of m.values())u.addComponent(e);let c=new x(r,i,u);return f.set(a,c),c}function k(e=h){let t=f.get(e);if(!t&&e===h&&(0,o.T9)())return T();if(!t)throw S.create("no-app",{appName:e});return t}async function _(e){let t=!1,r=e.name;f.has(r)?(t=!0,f.delete(r)):p.has(r)&&0>=e.decRefCount()&&(p.delete(r),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function P(e,t,r){var i;let o=null!=(i=d[e])?i:e;r&&(o+=`-${r}`);let a=o.match(/\s|\//),s=t.match(/\s|\//);if(a||s){let e=[`Unable to register library "${o}" with version "${t}":`];a&&e.push(`library name "${o}" contains illegal characters (whitespace or "/")`),a&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),l.warn(e.join(" "));return}y(new n.uA(`${o}-version`,()=>({library:o,version:t}),"VERSION"))}let A="firebase-heartbeat-store",O=null;function C(){return O||(O=(0,a.P2)("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(A)}catch(e){console.warn(e)}}}).catch(e=>{throw S.create("idb-open",{originalErrorMessage:e.message})})),O}async function D(e){try{let t=(await C()).transaction(A),r=await t.objectStore(A).get(R(e));return await t.done,r}catch(e){if(e instanceof o.g)l.warn(e.message);else{let t=S.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});l.warn(t.message)}}}async function N(e,t){try{let r=(await C()).transaction(A,"readwrite"),n=r.objectStore(A);await n.put(t,R(e)),await r.done}catch(e){if(e instanceof o.g)l.warn(e.message);else{let t=S.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});l.warn(t.message)}}}function R(e){return`${e.name}!${e.options.appId}`}class L{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new F(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{let r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=j();if((null==(e=this._heartbeatsCache)?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,(null==(t=this._heartbeatsCache)?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(e=>e.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:r}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,r=e[0].date;for(let n=1;n<e.length;n++)e[n].date<r&&(r=e[n].date,t=n);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){l.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)==null||0===this._heartbeatsCache.heartbeats.length)return"";let t=j(),{heartbeatsToSend:r,unsentEntries:n}=function(e,t=1024){let r=[],n=e.slice();for(let i of e){let e=r.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),G(r)>t){e.dates.pop();break}}else if(r.push({agent:i.agent,dates:[i.date]}),G(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}(this._heartbeatsCache.heartbeats),i=(0,o.Uj)(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return l.warn(e),""}}}function j(){return new Date().toISOString().substring(0,10)}class F{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,o.zW)()&&(0,o.eX)().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await D(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let r=await this.read();return N(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){let r=await this.read();return N(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}}}function G(e){return(0,o.Uj)(JSON.stringify({version:2,heartbeats:e})).length}y(new n.uA("platform-logger",e=>new s(e),"PRIVATE")),y(new n.uA("heartbeat",e=>new L(e),"PRIVATE")),P(u,c,""),P(u,c,"esm2017"),P("fire-js","")},7044:(e,t,r)=>{"use strict";r.d(t,{yB:()=>a,zh:()=>o});var n=function(e){return e.JASSGROUP="JASSGROUP",e}({}),i={berg:1,sieg:2,matsch:1},o={schneider:2,kontermatsch:2};n.JASSGROUP,i.berg,i.sieg,i.matsch,o.schneider,o.kontermatsch;var a=function(e){return(void 0===e.schneider||!![0,1,2].includes(e.schneider))&&(void 0===e.kontermatsch||!![0,1,2].includes(e.kontermatsch))}},7133:(e,t,r)=>{"use strict";r.r(t),r.d(t,{activateTournamentService:()=>$,addParticipantToTournament:()=>T,addParticipantsToTournamentBatch:()=>k,addTournamentAdmin:()=>P,clearActivePasseInTournament:()=>K,completeAndRecordTournamentPasse:()=>z,completeTournamentPasse:()=>R,createTournamentInstance:()=>w,fetchActivePasseForUser:()=>N,fetchActiveTournamentForUser:()=>I,fetchPasseRounds:()=>j,fetchTournamentGames:()=>L,fetchTournamentInstanceDetails:()=>x,fetchTournamentInstancesForGroup:()=>S,fetchTournamentParticipants:()=>C,fetchTournamentsForUser:()=>U,generateTournamentInviteToken:()=>V,leaveTournament:()=>O,markTournamentAsCompletedService:()=>H,redeemTournamentInvite:()=>B,removeParticipantFromTournament:()=>_,removeTournamentAdmin:()=>A,startTournamentPasseService:()=>D,updateActiveTournamentPasse:()=>F,updateTournamentBaseDetails:()=>q,updateTournamentInstanceData:()=>E,updateTournamentSettings:()=>G,uploadTournamentLogoFirebase:()=>M});var n=r(2009),i=r(5519),o=r(1411),a=r(8517),s=r(7746),u=r(5226),c=r(8310),l=r(7044),h=r(132);function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach(function(t){var n,i,o;n=e,i=t,o=r[t],(i=function(e){var t=function(e,t){if("object"!==d(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==d(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===d(t)?t:String(t)}(i))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function m(){m=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(t,r,n,o){var a,s,u,c,l=Object.create((r&&r.prototype instanceof v?r:v).prototype);return i(l,"_invoke",{value:(a=t,s=n,u=new A(o||[]),c=f,function(t,r){if(c===p)throw Error("Generator is already running");if(c===g){if("throw"===t)throw r;return{value:e,done:!0}}for(u.method=t,u.arg=r;;){var n=u.delegate;if(n){var i=function t(r,n){var i=n.method,o=r.iterator[i];if(o===e)return n.delegate=null,"throw"===i&&r.iterator.return&&(n.method="return",n.arg=e,t(r,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+i+"' method")),y;var a=h(o,r.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,y;var s=a.arg;return s?s.done?(n[r.resultName]=s.value,n.next=r.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):s:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,y)}(n,u);if(i){if(i===y)continue;return i}}if("next"===u.method)u.sent=u._sent=u.arg;else if("throw"===u.method){if(c===f)throw c=g,u.arg;u.dispatchException(u.arg)}else"return"===u.method&&u.abrupt("return",u.arg);c=p;var o=h(a,s,u);if("normal"===o.type){if(c=u.done?g:"suspendedYield",o.arg===y)continue;return{value:o.arg,done:u.done}}"throw"===o.type&&(c=g,u.method="throw",u.arg=o.arg)}})}),l}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var f="suspendedStart",p="executing",g="completed",y={};function v(){}function b(){}function w(){}var S={};c(S,a,function(){return this});var x=Object.getPrototypeOf,I=x&&x(x(O([])));I&&I!==r&&n.call(I,a)&&(S=I);var E=w.prototype=v.prototype=Object.create(S);function T(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function k(e,t){var r;i(this,"_invoke",{value:function(i,o){function a(){return new t(function(r,a){!function r(i,o,a,s){var u=h(e[i],e,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==d(l)&&n.call(l,"__await")?t.resolve(l.__await).then(function(e){r("next",e,a,s)},function(e){r("throw",e,a,s)}):t.resolve(l).then(function(e){c.value=e,a(c)},function(e){return r("throw",e,a,s)})}s(u.arg)}(i,o,r,a)})}return r=r?r.then(a,a):a()}})}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function O(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw TypeError(d(t)+" is not iterable")}return b.prototype=w,i(E,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:b,configurable:!0}),b.displayName=c(w,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,c(e,u,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},T(k.prototype),c(k.prototype,s,function(){return this}),t.AsyncIterator=k,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new k(l(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},T(E),c(E,u,"Generator"),c(E,a,function(){return this}),c(E,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function g(e){return function(e){if(Array.isArray(e))return y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return y(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return y(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function v(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(n,i)}function b(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){v(o,n,i,a,s,"next",e)}function s(e){v(o,n,i,a,s,"throw",e)}a(void 0)})}}var w=function(){var e=b(m().mark(function e(t,r,o,a,s){var u,c,l,h,d,f,p,y=arguments;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(u=y.length>5&&void 0!==y[5]?y[5]:"upcoming",e.prev=1,c=(0,n.collection)(i.db,"tournaments"),l=Array.isArray(a)?g(new Set([r].concat(g(a)))):[r],h=[r],!(!(d={groupId:t,name:o.trim(),description:"",logoUrl:null,instanceDate:null,status:u,createdBy:r,adminIds:h,participantUids:l,settings:s,createdAt:(0,n.serverTimestamp)(),updatedAt:(0,n.serverTimestamp)(),completedPasseCount:0,currentActiveGameId:null,lastActivity:(0,n.serverTimestamp)()}).name||d.name.length<3)){e.next=2;break}throw Error("Der Turniername muss mindestens 3 Zeichen lang sein.");case 2:return d.settings&&d.settings.minParticipants&&l.length<d.settings.minParticipants,e.next=3,(0,n.addDoc)(c,d);case 3:return f=e.sent,e.abrupt("return",f.id);case 4:throw e.prev=4,console.error("[tournamentService] Error creating tournament instance:",p=e.catch(1)),Error(p instanceof Error?p.message:"Turnier konnte nicht erstellt werden.");case 5:case"end":return e.stop()}},e,null,[[1,4]])}));return function(t,r,n,i,o){return e.apply(this,arguments)}}(),S=function(){var e=b(m().mark(function e(t){var r,o,a,s,u,c;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=(0,n.collection)(i.db,"tournaments"),o=(0,n.query)(r,(0,n.where)("groupId","==",t)),e.next=1,(0,n.getDocs)(o);case 1:return a=e.sent,s=[],a.forEach(function(e){s.push(p({id:e.id},e.data()))}),s.sort(function(e,t){var r=e.createdAt&&"object"===d(e.createdAt)&&"toMillis"in e.createdAt?e.createdAt.toMillis():0;return(t.createdAt&&"object"===d(t.createdAt)&&"toMillis"in t.createdAt?t.createdAt.toMillis():0)-r}),e.abrupt("return",s);case 2:if(e.prev=2,c=e.catch(0),console.error("[tournamentService] Error fetching tournaments for group ".concat(t,":"),c),!(c&&"object"===d(c)&&"code"in c)||"failed-precondition"!==(u=c).code&&"permission-denied"!==u.code&&"not-found"!==u.code){e.next=3;break}return console.log("[tournamentService] Normal state: No tournaments accessible for group ".concat(t," (").concat(u.code,")")),e.abrupt("return",[]);case 3:throw Error("Turniere konnten nicht geladen werden.");case 4:case"end":return e.stop()}},e,null,[[0,2]])}));return function(t){return e.apply(this,arguments)}}(),x=function(){var e=b(m().mark(function e(t){var r,o,a,s;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=(0,n.doc)(i.db,"tournaments",t),e.next=1,(0,n.getDoc)(r);case 1:if(!(o=e.sent).exists()){e.next=2;break}return a=o.data(),e.abrupt("return",p({id:o.id},a));case 2:return console.warn("[tournamentService] Tournament instance with ID ".concat(t," not found.")),e.abrupt("return",null);case 3:e.next=5;break;case 4:return e.prev=4,s=e.catch(0),console.error("[tournamentService] Error fetching tournament details for ".concat(t,":"),s),e.abrupt("return",null);case 5:case"end":return e.stop()}},e,null,[[0,4]])}));return function(t){return e.apply(this,arguments)}}(),I=function(){var e=b(m().mark(function e(t){var r,o,a,s,u;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}return e.abrupt("return",null);case 1:return e.prev=1,r=(0,n.collection)(i.db,"tournaments"),o=(0,n.query)(r,(0,n.where)("participantUids","array-contains",t),(0,n.where)("status","==","active")),e.next=2,(0,n.getDocs)(o);case 2:if((a=e.sent).empty){e.next=3;break}return(s=a.docs.map(function(e){return p({id:e.id},e.data())})).sort(function(e,t){var r=e.createdAt&&"object"===d(e.createdAt)&&"toMillis"in e.createdAt?e.createdAt.toMillis():0;return(t.createdAt&&"object"===d(t.createdAt)&&"toMillis"in t.createdAt?t.createdAt.toMillis():0)-r}),u=s[0],e.abrupt("return",u);case 3:return e.abrupt("return",null);case 4:return e.prev=4,console.error("Error fetching active tournament:",e.catch(1)),e.abrupt("return",null);case 5:case"end":return e.stop()}},e,null,[[1,4]])}));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=b(m().mark(function e(t,r){var o,a;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Updating data for tournament instance ".concat(t),r),o=(0,n.doc)(i.db,"tournaments",t),a=p(p({},r),{},{updatedAt:(0,n.serverTimestamp)()}),e.next=1,(0,n.updateDoc)(o,a);case 1:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}(),T=function(){var e=b(m().mark(function e(t,r){var o,a;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[tournamentService] Adding participant ".concat(r," to tournament instance ").concat(t)),o=(0,n.doc)(i.db,"tournaments",t),e.prev=1,e.next=2,(0,n.updateDoc)(o,{participantUids:(0,n.arrayUnion)(r),updatedAt:(0,n.serverTimestamp)()});case 2:console.log("[tournamentService] Participant ".concat(r," successfully added to tournament ").concat(t,".")),e.next=4;break;case 3:throw e.prev=3,a=e.catch(1),console.error("[tournamentService] Error adding participant ".concat(r," to tournament ").concat(t,":"),a),Error("Teilnehmer konnte nicht zum Turnier hinzugef\xfcgt werden.");case 4:case"end":return e.stop()}},e,null,[[1,3]])}));return function(t,r){return e.apply(this,arguments)}}(),k=function(){var e=b(m().mark(function e(t,r){var o,a;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!r||0===r.length)){e.next=1;break}return console.log("[tournamentService] No user IDs provided to addParticipantsToTournamentBatch."),e.abrupt("return");case 1:return console.log("[tournamentService] Adding batch of ".concat(r.length," participants to tournament instance ").concat(t)),o=(0,n.doc)(i.db,"tournaments",t),e.prev=2,e.next=3,(0,n.updateDoc)(o,{participantUids:n.arrayUnion.apply(void 0,g(r)),updatedAt:(0,n.serverTimestamp)()});case 3:console.log("[tournamentService] Batch of participants successfully added to tournament ".concat(t,".")),e.next=5;break;case 4:throw e.prev=4,a=e.catch(2),console.error("[tournamentService] Error adding batch of participants to tournament ".concat(t,":"),a),Error("Teilnehmer-Batch konnte nicht zum Turnier hinzugef\xfcgt werden.");case 5:case"end":return e.stop()}},e,null,[[2,4]])}));return function(t,r){return e.apply(this,arguments)}}(),_=function(){var e=b(m().mark(function e(t,r){var o,a,s,u,c,l,h,d,f,p,g,y,v;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[tournamentService] Removing participant ".concat(r," from tournament instance ").concat(t)),o=(0,n.doc)(i.db,"tournaments",t),e.prev=1,e.next=2,(0,n.getDoc)(o);case 2:if((d=e.sent).exists()){e.next=3;break}throw Error("Turnier nicht gefunden.");case 3:if("completed"!==(f=d.data()).status&&"archived"!==f.status){e.next=4;break}throw console.warn("[tournamentService] Cannot remove participant from completed/archived tournament ".concat(t,".")),Error("Teilnehmer k\xf6nnen nicht aus einem abgeschlossenen oder archivierten Turnier entfernt werden.");case 4:if(!((p=null==(a=f.adminIds)?void 0:a.includes(r))&&(null==(s=f.adminIds)?void 0:s.length)===1)){e.next=6;break}if((null==(g=f.participantUids)?void 0:g.length)!==1||f.participantUids[0]!==r){e.next=5;break}throw console.warn("[tournamentService] Cannot remove participant ".concat(r," as they are the last participant and last admin.")),Error("Der letzte Teilnehmer kann nicht entfernt werden, wenn er auch der einzige Admin ist.");case 5:console.warn("[tournamentService] Participant ".concat(r," is an admin. Consider admin role transfer before removal if they are the last admin and other participants exist."));case 6:return y={participantUids:(0,n.arrayRemove)(r),updatedAt:(0,n.serverTimestamp)()},p&&(null!=(u=null==(c=f.adminIds)?void 0:c.length)?u:0)>1?(y.adminIds=(0,n.arrayRemove)(r),console.log("[tournamentService] Also removing ".concat(r," from adminIds."))):p&&(null!=(l=null==(h=f.adminIds)?void 0:h.length)?l:0)===1&&console.warn("[tournamentService] Participant ".concat(r," is the last admin. Not removing from adminIds via this function directly. Use removeTournamentAdmin with caution or ensure new admin is appointed first.")),e.next=7,(0,n.updateDoc)(o,y);case 7:console.log("[tournamentService] Participant ".concat(r," successfully removed from tournament ").concat(t,".")),e.next=10;break;case 8:if(e.prev=8,v=e.catch(1),console.error("[tournamentService] Error removing participant ".concat(r," from tournament ").concat(t,":"),v),!(v instanceof Error&&(v.message.includes("letzte Teilnehmer")||v.message.includes("Turnier nicht gefunden")||v.message.includes("abgeschlossenen oder archivierten")))){e.next=9;break}throw v;case 9:throw Error("Teilnehmer konnte nicht aus dem Turnier entfernt werden.");case 10:case"end":return e.stop()}},e,null,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),P=function(){var e=b(m().mark(function e(t,r){var o,a,s,u,c;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[tournamentService] Making user ".concat(r," admin for tournament instance ").concat(t)),o=(0,n.doc)(i.db,"tournaments",t),e.prev=1,e.next=2,(0,n.getDoc)(o);case 2:if((s=e.sent).exists()){e.next=3;break}throw Error("Turnier nicht gefunden.");case 3:if("completed"!==(u=s.data()).status&&"archived"!==u.status){e.next=4;break}throw console.warn("[tournamentService] Cannot add admin to completed/archived tournament ".concat(t,".")),Error("Admins k\xf6nnen nicht zu einem abgeschlossenen oder archivierten Turnier hinzugef\xfcgt werden.");case 4:if(null!=(a=u.participantUids)&&a.includes(r)){e.next=5;break}throw console.warn("[tournamentService] User ".concat(r," is not a participant of tournament ").concat(t,". Cannot make admin.")),Error("Nur Turnierteilnehmer k\xf6nnen zu Admins ernannt werden.");case 5:return e.next=6,(0,n.updateDoc)(o,{adminIds:(0,n.arrayUnion)(r),participantUids:(0,n.arrayUnion)(r),updatedAt:(0,n.serverTimestamp)()});case 6:console.log("[tournamentService] User ".concat(r," successfully made admin in tournament ").concat(t,".")),e.next=9;break;case 7:if(e.prev=7,c=e.catch(1),console.error("[tournamentService] Error making user ".concat(r," admin for tournament ").concat(t,":"),c),!(c instanceof Error&&(c.message.includes("Nur Turnierteilnehmer")||c.message.includes("Turnier nicht gefunden")||c.message.includes("abgeschlossenen oder archivierten")))){e.next=8;break}throw c;case 8:throw Error("Admin-Status konnte nicht zugewiesen werden.");case 9:case"end":return e.stop()}},e,null,[[1,7]])}));return function(t,r){return e.apply(this,arguments)}}(),A=function(){var e=b(m().mark(function e(t,r){var o,a,s,u,c,l;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[tournamentService] Removing admin rights for user ".concat(r," from tournament instance ").concat(t)),o=(0,n.doc)(i.db,"tournaments",t),e.prev=1,e.next=2,(0,n.getDoc)(o);case 2:if((u=e.sent).exists()){e.next=3;break}throw Error("Turnier nicht gefunden.");case 3:if("completed"!==(c=u.data()).status&&"archived"!==c.status){e.next=4;break}throw console.warn("[tournamentService] Cannot remove admin from completed/archived tournament ".concat(t,".")),Error("Admin-Status kann bei einem abgeschlossenen oder archivierten Turnier nicht entfernt werden.");case 4:if(r!==c.createdBy){e.next=5;break}throw console.warn("[tournamentService] Cannot remove founder ".concat(r," as admin.")),Error("Der Gr\xfcnder des Turniers kann nicht als Admin entfernt werden.");case 5:if(!(null!=(a=c.adminIds)&&a.includes(r)&&(null==(s=c.adminIds)?void 0:s.length)===1)){e.next=6;break}throw console.warn("[tournamentService] Cannot remove user ".concat(r," as they are the last admin.")),Error("Der letzte Admin kann nicht entfernt werden. Bitte ernenne zuerst einen neuen Admin.");case 6:return e.next=7,(0,n.updateDoc)(o,{adminIds:(0,n.arrayRemove)(r),updatedAt:(0,n.serverTimestamp)()});case 7:console.log("[tournamentService] Admin status for user ".concat(r," successfully removed in tournament ").concat(t,".")),e.next=10;break;case 8:if(e.prev=8,l=e.catch(1),console.error("[tournamentService] Error removing admin rights for user ".concat(r," from tournament ").concat(t,":"),l),!(l instanceof Error&&(l.message.includes("letzte Admin")||l.message.includes("Turnier nicht gefunden")||l.message.includes("Gr\xfcnder")||l.message.includes("abgeschlossenen oder archivierten")))){e.next=9;break}throw l;case 9:throw Error("Admin-Status konnte nicht entfernt werden.");case 10:case"end":return e.stop()}},e,null,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),O=function(){var e=b(m().mark(function e(t,r){var o,a,s,u,c,l,h,d,f,p;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[tournamentService] User ".concat(r," attempting to leave tournament instance ").concat(t)),o=(0,n.doc)(i.db,"tournaments",t),e.prev=1,e.next=2,(0,n.getDoc)(o);case 2:if((l=e.sent).exists()){e.next=3;break}throw Error("Turnier nicht gefunden.");case 3:if("active"===(h=l.data()).status){e.next=4;break}throw console.warn("[tournamentService] Cannot leave a tournament that is not active (status: ".concat(h.status,"). Instance: ").concat(t,".")),Error("Du kannst nur aus einem laufenden Turnier austreten.");case 4:if(null!=(a=h.participantUids)&&a.includes(r)){e.next=5;break}return console.warn("[tournamentService] User ".concat(r," is not a participant of tournament ").concat(t,". Cannot leave.")),e.abrupt("return");case 5:if(d=(null==(s=h.participantUids)?void 0:s.length)===1&&h.participantUids[0]===r,!(null!=(u=h.adminIds)&&u.includes(r)&&!d)){e.next=6;break}throw Error("Der letzte Admin kann das Turnier nicht verlassen, wenn noch andere Teilnehmer vorhanden sind. Bitte ernennen Sie zuerst einen neuen Admin.");case 6:return f={participantUids:(0,n.arrayRemove)(r)},null!=(c=h.adminIds)&&c.includes(r)&&!d&&(f.adminIds=(0,n.arrayRemove)(r)),f.updatedAt=(0,n.serverTimestamp)(),e.next=7,(0,n.updateDoc)(o,f);case 7:console.log("[tournamentService] User ".concat(r," successfully left tournament ").concat(t," (removed from participants).")),e.next=10;break;case 8:if(e.prev=8,p=e.catch(1),console.error("[tournamentService] Error allowing user ".concat(r," to leave tournament ").concat(t,":"),p),!(p instanceof Error&&(p.message.includes("laufenden Turnier")||p.message.includes("Turnier nicht gefunden")))){e.next=9;break}throw p;case 9:throw Error("Austreten aus dem Turnier fehlgeschlagen.");case 10:case"end":return e.stop()}},e,null,[[1,8]])}));return function(t,r){return e.apply(this,arguments)}}(),C=function(){var e=b(m().mark(function e(t){var r,n,i,a;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,x(t);case 1:if(!(!(r=e.sent)||!r.participantUids||0===r.participantUids.length)){e.next=2;break}return console.log("[tournamentService] No participants found or tournament ".concat(t," not found.")),e.abrupt("return",[]);case 2:return n=r.participantUids,console.log("[tournamentService] Found ".concat(n.length," participant UIDs for tournament ").concat(t,":"),n),e.next=3,(0,o.getPublicPlayerProfilesByUserIds)(n);case 3:return(i=e.sent).sort(function(e,t){return(e.displayName||"").localeCompare(t.displayName||"")}),console.log("[tournamentService] Fetched ".concat(i.length," detailed participant profiles for tournament ").concat(t,".")),e.abrupt("return",i);case 4:return e.prev=4,a=e.catch(0),console.error("[tournamentService] Error fetching participants for tournament ".concat(t,":"),a),e.abrupt("return",[]);case 5:case"end":return e.stop()}},e,null,[[0,4]])}));return function(t){return e.apply(this,arguments)}}(),D=function(){var e=b(m().mark(function e(t,r,o,a){var s,u,d,f,g,y,v,b,w,S,x,I,E,T,k,_,P,A,O,C,D,N,R,L,j,F,G,M,U,V,B,z,H,q;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,n.getFirestore)(i.xv),u=(0,n.doc)(s,"tournaments",t),e.prev=1,e.next=2,(0,n.getDoc)(u);case 2:if((E=e.sent).exists()){e.next=3;break}throw Error("Tournament instance ".concat(t," not found."));case 3:if(T=E.data(),k=o.filter(function(e){return 1===e.playerNumber||3===e.playerNumber}).map(function(e){return e.playerNumber}),_=o.filter(function(e){return 2===e.playerNumber||4===e.playerNumber}).map(function(e){return e.playerNumber}),2===k.length&&2===_.length){e.next=4;break}throw Error("Ung\xfcltige Spielerzuweisung zu Teams. Es m\xfcssen 2 Spieler pro Team sein.");case 4:return P={1:(null==(d=o.find(function(e){return 1===e.playerNumber}))?void 0:d.name)||"Spieler 1",2:(null==(f=o.find(function(e){return 2===e.playerNumber}))?void 0:f.name)||"Spieler 2",3:(null==(g=o.find(function(e){return 3===e.playerNumber}))?void 0:g.name)||"Spieler 3",4:(null==(y=o.find(function(e){return 4===e.playerNumber}))?void 0:y.name)||"Spieler 4"},A=o.map(function(e){return e.uid}),O={1:o.find(function(e){return 1===e.playerNumber})?{type:"member",uid:o.find(function(e){return 1===e.playerNumber}).uid,name:o.find(function(e){return 1===e.playerNumber}).name}:null,2:o.find(function(e){return 2===e.playerNumber})?{type:"member",uid:o.find(function(e){return 2===e.playerNumber}).uid,name:o.find(function(e){return 2===e.playerNumber}).name}:null,3:o.find(function(e){return 3===e.playerNumber})?{type:"member",uid:o.find(function(e){return 3===e.playerNumber}).uid,name:o.find(function(e){return 3===e.playerNumber}).name}:null,4:o.find(function(e){return 4===e.playerNumber})?{type:"member",uid:o.find(function(e){return 4===e.playerNumber}).uid,name:o.find(function(e){return 4===e.playerNumber}).name}:null},C=null!=(v=null==(b=T.settings)?void 0:b.scoreSettings)?v:c.$d,D=null!=(w=null==(S=T.settings)?void 0:S.strokeSettings)?w:l.zh,N=null!=(x=null==(I=T.settings)?void 0:I.farbeSettings)?x:h.FT,R=Number(a),L={groupId:T.groupId,sessionId:t,tournamentInstanceId:t,status:"live",participantUids:A,playerNames:P,gamePlayers:O,teams:{top:_,bottom:k},scores:{top:0,bottom:0},striche:{top:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0},bottom:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0}},weisPoints:{top:0,bottom:0},currentRound:1,currentGameNumber:r,startingPlayer:R,initialStartingPlayer:R,currentPlayer:R,isRoundCompleted:!1,isGameCompleted:!1,activeScoreSettings:C,activeStrokeSettings:D,activeFarbeSettings:N},j=(0,n.collection)(s,"activeGames"),e.prev=5,e.next=6,(0,n.addDoc)(j,L);case 6:return G=e.sent,e.next=7,(0,n.updateDoc)(G,{activeGameId:G.id,createdAt:(0,n.serverTimestamp)(),lastUpdated:(0,n.serverTimestamp)(),gameStartTime:(0,n.serverTimestamp)(),jassStartTime:(0,n.serverTimestamp)()});case 7:return M=(0,n.doc)(s,"sessions",t),U={gruppeId:T.groupId,startedAt:null!=(F=T.createdAt)?F:(0,n.serverTimestamp)(),playerNames:P,participantUids:T.participantUids,status:"active",isTournamentSession:!0,currentActiveGameId:G.id,tournamentInstanceId:t,lastActivity:(0,n.serverTimestamp)()},e.prev=8,e.next=9,(0,n.setDoc)(M,U,{merge:!0});case 9:e.next=11;break;case 10:e.prev=10,H=e.catch(8),console.error("[tournamentService] Error creating/updating session document ".concat(t,":"),H);case 11:return V=(0,n.doc)(s,"tournaments",t),e.prev=12,e.next=13,(0,n.updateDoc)(V,{currentActiveGameId:G.id,updatedAt:(0,n.serverTimestamp)(),lastActivity:(0,n.serverTimestamp)()});case 13:e.next=15;break;case 14:e.prev=14,q=e.catch(12),console.error("[tournamentService] Error updating tournament document ".concat(t," with active game ID:"),q);case 15:return e.prev=15,e.next=16,(0,n.getDoc)(G);case 16:if(!(B=e.sent).exists()){e.next=17;break}return z=p({activeGameId:B.id},B.data()),e.abrupt("return",z);case 17:return console.error("[tournamentService ERROR] Failed to fetch newly created passe document."),e.abrupt("return",null);case 18:e.next=20;break;case 19:return e.prev=19,console.error("[tournamentService ERROR] Error fetching newly created passe:",e.catch(15)),e.abrupt("return",null);case 20:e.next=22;break;case 21:return e.prev=21,console.error("[tournamentService ERROR] Error in inner try-block of startTournamentPasseService:",e.catch(5)),e.abrupt("return",null);case 22:e.next=24;break;case 23:return e.prev=23,console.error("[tournamentService ERROR] Error in outer try-block of startTournamentPasseService:",e.catch(1)),e.abrupt("return",null);case 24:case"end":return e.stop()}},e,null,[[1,23],[5,21],[8,10],[12,14],[15,19]])}));return function(t,r,n,i){return e.apply(this,arguments)}}(),N=function(){var e=b(m().mark(function e(t,r){var o,a,s,u,c,l,h,d;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Fetching active passe for user ".concat(r," in instance ").concat(t)),o=(0,n.query)((0,n.collection)(i.db,"activeGames"),(0,n.where)("tournamentInstanceId","==",t),(0,n.where)("participantUids","array-contains",r),(0,n.where)("status","==","live"),(0,n.limit)(1)),e.next=1,(0,n.getDocs)(o);case 1:if(!(a=e.sent).empty){e.next=2;break}return e.abrupt("return",null);case 2:for(c=0,u=(s=a.docs[0]).data(),l=["groupId","sessionId","currentGameNumber","participantUids","status","playerNames","teams","scores","striche","weisPoints","currentPlayer","currentRound","startingPlayer","initialStartingPlayer","createdAt","lastUpdated"];c<l.length;c++)void 0===u[h=l[c]]&&console.error("[tournamentService] Fetched active game ".concat(s.id," is missing required field: ").concat(h,". Data:"),u);return d={activeGameId:s.id,groupId:u.groupId,sessionId:u.sessionId,tournamentInstanceId:u.tournamentInstanceId,currentGameNumber:u.currentGameNumber||0,participantUids:u.participantUids||[],status:u.status||"aborted",playerNames:u.playerNames||{1:"",2:"",3:"",4:""},teams:u.teams||{top:[],bottom:[]},scores:u.scores||{top:0,bottom:0},striche:u.striche||{top:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0},bottom:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0}},weisPoints:u.weisPoints||{top:0,bottom:0},currentPlayer:u.currentPlayer,currentRound:u.currentRound||1,startingPlayer:u.startingPlayer,initialStartingPlayer:u.initialStartingPlayer,currentJassPoints:u.currentJassPoints,isRoundCompleted:u.isRoundCompleted,gamePlayers:u.gamePlayers,gameStartTime:u.gameStartTime,jassStartTime:u.jassStartTime,createdAt:u.createdAt||n.Timestamp.now(),lastUpdated:u.lastUpdated||n.Timestamp.now()},e.abrupt("return",d);case 3:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}(),R=function(){var e=b(m().mark(function e(t,r){var o,a,s;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.warn("[tournamentService] completeTournamentPasse (ID: ".concat(t,") called. \n                 Implementation requires a Cloud Function with Transaction.")),console.log("[tournamentService] Final Passe Data:",r),o=(0,n.doc)(i.db,"tournaments",r.tournamentInstanceId),e.prev=1,a=(0,n.doc)(i.db,"activeGames",t),e.next=2,(0,n.updateDoc)(a,p(p({},r),{},{status:"completed",completedAt:(0,n.serverTimestamp)()}));case 2:return e.next=3,(0,n.updateDoc)(o,{completedPasseCount:(0,n.increment)(1),updatedAt:(0,n.serverTimestamp)()});case 3:console.log("[tournamentService] Passe ".concat(t," completed and tournament ").concat(r.tournamentInstanceId," updated.")),e.next=5;break;case 4:throw e.prev=4,s=e.catch(1),console.error("[tournamentService] Error completing tournament passe ".concat(t,":"),s),Error("Completion logic should be server-side.");case 5:case"end":return e.stop()}},e,null,[[1,4]])}));return function(t,r){return e.apply(this,arguments)}}(),L=function(){var e=b(m().mark(function e(t){var r,o,a,s,u;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=(0,n.collection)(i.db,"tournaments",t,"games"),o=(0,n.query)(r,(0,n.orderBy)("passeNumber","asc")),e.next=1,(0,n.getDocs)(o);case 1:return a=e.sent,s=[],a.forEach(function(e){s.push(p({passeId:e.id},e.data()))}),console.log("[tournamentService] Fetched ".concat(s.length," completed games/passen for tournament ").concat(t,".")),e.abrupt("return",s);case 2:throw e.prev=2,u=e.catch(0),console.error("[tournamentService] Error fetching completed games for tournament ".concat(t,":"),u),Error("Abgeschlossene Turnierspiele konnten nicht geladen werden.");case 3:case"end":return e.stop()}},e,null,[[0,2]])}));return function(t){return e.apply(this,arguments)}}(),j=function(){var e=b(m().mark(function e(t,r){var o,a,s,u,c;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=(0,n.collection)(i.db,"tournaments",t,"games",r,"rounds"),a=(0,n.query)(o,(0,n.orderBy)("roundState.roundNumber","asc")),e.next=1,(0,n.getDocs)(a);case 1:return s=e.sent,u=[],s.forEach(function(e){var t=p({roundId:e.id},e.data());u.push(t)}),console.log("[tournamentService] Fetched ".concat(u.length," rounds for passe ").concat(r," in tournament ").concat(t,".")),e.abrupt("return",u);case 2:throw e.prev=2,c=e.catch(0),console.error("[tournamentService] Error fetching rounds for passe ".concat(r," in tournament ").concat(t,":"),c),Error("Runden f\xfcr Passe ".concat(r," konnten nicht geladen werden."));case 3:case"end":return e.stop()}},e,null,[[0,2]])}));return function(t,r){return e.apply(this,arguments)}}(),F=function(){var e=b(m().mark(function e(t,r){var o;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Updating active passe ".concat(t),r),o=(0,n.doc)(i.db,"activeGames",t),e.next=1,(0,n.updateDoc)(o,p(p({},r),{},{lastUpdated:(0,n.serverTimestamp)()}));case 1:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}(),G=function(){var e=b(m().mark(function e(t,r){var o,a,s,u,c,l;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(u in console.log("Updating settings for tournament instance ".concat(t,":"),r),o=(0,n.doc)(i.db,"tournaments",t),e.prev=1,a={updatedAt:(0,n.serverTimestamp)()},r.hasOwnProperty("logoUrl")&&(a.logoUrl=r.logoUrl),s={},r)r.hasOwnProperty(u)&&"logoUrl"!==u&&(c=u,s["settings.".concat(c)]=r[c]);if(Object.keys(s).length>0&&Object.assign(a,s),!(Object.keys(a).length>1)){e.next=3;break}return e.next=2,(0,n.updateDoc)(o,a);case 2:console.log("[tournamentService] Successfully updated settings for tournament ".concat(t," with data:"),a),e.next=4;break;case 3:console.log("[tournamentService] No specific settings (besides logo or updatedAt) to update for tournament ".concat(t,".")),a.updatedAt&&1===Object.keys(a).length&&console.log("[tournamentService] Only updatedAt was present, no other settings changed.");case 4:e.next=6;break;case 5:throw e.prev=5,l=e.catch(1),console.error("[tournamentService] Error updating settings for tournament ".concat(t,":"),l),Error("Turniereinstellungen konnten nicht aktualisiert werden.");case 6:case"end":return e.stop()}},e,null,[[1,5]])}));return function(t,r){return e.apply(this,arguments)}}(),M=function(){var e=b(m().mark(function e(t,r){var n,o,a,s,c,l,h,d,f;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=1;break}throw Error("Keine Datei f\xfcr den Upload ausgew\xe4hlt.");case 1:if(t){e.next=2;break}throw Error("Keine Turnier-ID f\xfcr den Logo-Upload angegeben.");case 2:return n=(0,u.c7)(i.xv),o=r.name.split(".").pop()||"jpg",a="logo.".concat(o),s="tournamentLogos/".concat(t,"/").concat(a),c=(0,u.KR)(n,s),e.prev=3,console.log("[tournamentService] Uploading tournament logo to: ".concat(s)),e.next=4,(0,u.D)(c,r);case 4:return l=e.sent,e.next=5,(0,u.qk)(l.ref);case 5:return console.log("[tournamentService] Tournament logo uploaded successfully. Download URL:",h=e.sent),e.abrupt("return",h);case 6:if(e.prev=6,console.error("[tournamentService] Error uploading tournament logo:",f=e.catch(3)),!(f instanceof Error&&"code"in f)){e.next=8;break}if("storage/unauthorized"!==(d=f).code){e.next=7;break}throw Error("Fehlende Berechtigung f\xfcr den Logo-Upload. \xdcberpr\xfcfe die Storage-Regeln.");case 7:if("storage/canceled"!==d.code){e.next=8;break}throw Error("Logo-Upload wurde abgebrochen.");case 8:throw Error("Turnierlogo konnte nicht hochgeladen werden.");case 9:case"end":return e.stop()}},e,null,[[3,6]])}));return function(t,r){return e.apply(this,arguments)}}(),U=function(){var e=b(m().mark(function e(t){var r,o,a,s,u,c;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}return console.warn("[tournamentService] fetchTournamentsForUser called without userId."),e.abrupt("return",[]);case 1:return e.prev=1,r=(0,n.collection)(i.db,"tournaments"),o=(0,n.query)(r,(0,n.where)("participantUids","array-contains",t)),e.next=2,(0,n.getDocs)(o);case 2:return a=e.sent,s=[],a.forEach(function(e){s.push(p({id:e.id},e.data()))}),e.abrupt("return",s);case 3:if(e.prev=3,c=e.catch(1),console.error("[tournamentService] Error fetching tournaments for user ".concat(t,":"),c),!(c&&"object"===d(c)&&"code"in c)||"permission-denied"!==(u=c).code&&"not-found"!==u.code&&"failed-precondition"!==u.code){e.next=4;break}return console.log("[tournamentService] Normal state: No tournaments accessible for user ".concat(t," (").concat(u.code,")")),e.abrupt("return",[]);case 4:throw Error("Turniere f\xfcr den Benutzer konnten nicht geladen werden.");case 5:case"end":return e.stop()}},e,null,[[1,3]])}));return function(t){return e.apply(this,arguments)}}(),V=function(){var e=b(m().mark(function e(t){var r,n,o,a,u;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}throw Error("Tournament ID is required to generate an invite token.");case 1:return e.prev=1,n=(0,s.Uz)(i.xv,"europe-west1"),o=(0,s.Qg)(n,"generateTournamentInviteToken"),console.log("[tournamentService] Calling cloud function 'generateTournamentInviteToken' for tournament: ".concat(t)),e.next=2,o({tournamentId:t});case 2:if(a=null==(r=e.sent.data)?void 0:r.token){e.next=3;break}throw Error("No token received from cloud function.");case 3:return console.log("[tournamentService] Received invite token for tournament ".concat(t)),e.abrupt("return",a);case 4:throw e.prev=4,console.error("[tournamentService] Error calling 'generateTournamentInviteToken' cloud function:",u=e.catch(1)),Error(u instanceof Error?u.message:"Failed to generate tournament invite token.");case 5:case"end":return e.stop()}},e,null,[[1,4]])}));return function(t){return e.apply(this,arguments)}}(),B=function(){var e=b(m().mark(function e(t){var r,n,o,a,u;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}return e.abrupt("return",{success:!1,message:"Kein Token angegeben."});case 1:return e.prev=1,r=(0,s.Uz)(i.xv,"europe-west1"),n=(0,s.Qg)(r,"acceptTournamentInviteFunction"),console.log("[tournamentService] Calling cloud function 'acceptTournamentInviteFunction' with token."),e.next=2,n({token:t});case 2:if(!(!(o=e.sent.data)||"boolean"!=typeof o.success)){e.next=3;break}return console.error("[tournamentService] Invalid response from 'acceptTournamentInviteFunction'",o),e.abrupt("return",{success:!1,message:"Ung\xfcltige Antwort vom Server."});case 3:return o.success?console.log("[tournamentService] Successfully redeemed invite token for tournament: ".concat(o.tournamentId)):console.warn("[tournamentService] Failed to redeem invite token: ".concat(o.message)),e.abrupt("return",o);case 4:return e.prev=4,console.error("[tournamentService] Error calling 'acceptTournamentInviteFunction' cloud function:",u=e.catch(1)),a=u instanceof Error?u.message:"Beitritt zum Turnier fehlgeschlagen.",e.abrupt("return",{success:!1,message:a});case 5:case"end":return e.stop()}},e,null,[[1,4]])}));return function(t){return e.apply(this,arguments)}}(),z=function(){var e=b(m().mark(function e(t,r){var o,s,u,f,p,y,v,b,w,S,x,I,E,T,k,_,P,A,O,C,D,N,R,L,j,F,G,M,U,V,B,z,H,q,$,K;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=(0,n.getFirestore)(i.xv),s=(0,n.doc)(o,"activeGames",t),u=(0,n.doc)(o,"tournaments",r),f=(0,n.doc)(o,"tournaments",r,"games",t),p=(0,n.collection)(o,"activeGames",t,"rounds"),e.prev=1,e.next=2,(0,n.getDoc)(s);case 2:if((S=e.sent).exists()){e.next=3;break}throw console.error("[tournamentService] Active passe document ".concat(t," not found.")),Error("Aktive Passe nicht gefunden.");case 3:return x=S.data(),I=(0,n.query)(p,(0,n.orderBy)("roundId")),e.next=4,(0,n.getDocs)(I);case 4:E=e.sent.docs.map(function(e){return e.data()}),T=x.currentGameNumber,k=r,_=[],A=null!=(y=null==(P=g(E).reverse().find(a.Aw))?void 0:P.weisPoints)?y:{top:0,bottom:0},O=0,C=[1,2,3,4];case 5:if(!(O<C.length)){e.next=9;break}if(R=C[O],L=null==(D=x.gamePlayers)?void 0:D[R]){e.next=6;break}return console.warn("[tournamentService] Missing gamePlayer entry for seat ".concat(R," in activeGame ").concat(t)),e.abrupt("continue",8);case 6:if("member"===L.type){e.next=7;break}return console.warn("[tournamentService] Skipping player at seat ".concat(R," because they are not a 'member' type.")),e.abrupt("continue",8);case 7:j=L.uid,F=L.name,G=x.teams.top.includes(R)?"top":"bottom",M=x.scores[G],U=x.striche[G],V=null!=(N=A[G])?N:0,_.push({playerId:j,playerName:F,seat:R,team:G,scoreInPasse:M,stricheInPasse:U,weisInPasse:V});case 8:O++,e.next=5;break;case 9:return B=_.map(function(e){return e.playerId}),z=void 0,H=void 0,x.createdAt&&x.createdAt instanceof n.Timestamp?(H=x.createdAt,z=n.Timestamp.now().toMillis()-x.createdAt.toMillis()):"object"===d(x.createdAt)&&x.createdAt&&(H=(0,n.serverTimestamp)()),q="number"==typeof z?z:0,$={passeId:t,tournamentInstanceId:k,passeNumber:T,completedAt:(0,n.serverTimestamp)(),startedAt:H,durationMillis:q,startingPlayer:x.initialStartingPlayer,participantUidsForPasse:B,playerDetails:_,teamScoresPasse:x.scores,teamStrichePasse:x.striche,activeScoreSettings:null!=(v=x.activeScoreSettings)?v:c.$d,activeStrokeSettings:null!=(b=x.activeStrokeSettings)?b:l.zh,activeFarbeSettings:null!=(w=x.activeFarbeSettings)?w:h.FT,roundHistory:E},e.next=10,(0,n.setDoc)(f,$);case 10:return e.next=11,(0,n.updateDoc)(s,{status:"completed",completedAt:(0,n.serverTimestamp)()});case 11:return e.next=12,(0,n.updateDoc)(u,{completedPasseCount:(0,n.increment)(1),currentActiveGameId:null,updatedAt:(0,n.serverTimestamp)(),lastActivity:(0,n.serverTimestamp)()});case 12:return e.abrupt("return",!0);case 13:return e.prev=13,K=e.catch(1),console.error("[tournamentService] Error completing and recording passe ".concat(t,":"),K),e.abrupt("return",!1);case 14:case"end":return e.stop()}},e,null,[[1,13]])}));return function(t,r){return e.apply(this,arguments)}}(),H=function(){var e=b(m().mark(function e(t){var r,o;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[tournamentService] Marking tournament instance ".concat(t," as completed.")),r=(0,n.doc)(i.db,"tournaments",t),e.prev=1,e.next=2,(0,n.updateDoc)(r,{status:"completed",completedAt:(0,n.serverTimestamp)(),updatedAt:(0,n.serverTimestamp)()});case 2:console.log("[tournamentService] Tournament instance ".concat(t," successfully marked as completed.")),e.next=4;break;case 3:throw e.prev=3,o=e.catch(1),console.error("[tournamentService] Error marking tournament ".concat(t," as completed:"),o),Error("Turnier konnte nicht als abgeschlossen markiert werden.");case 4:case"end":return e.stop()}},e,null,[[1,3]])}));return function(t){return e.apply(this,arguments)}}(),q=function(){var e=b(m().mark(function e(t,r){var o,a,s;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}throw Error("Eine Turnier-Instanz-ID ist erforderlich.");case 1:if(!(!r||void 0===r.name&&void 0===r.description)){e.next=2;break}throw Error("Keine Details zum Aktualisieren \xfcbergeben (Name oder Beschreibung erforderlich).");case 2:if(o=(0,n.doc)(i.db,"tournaments",t),a={updatedAt:(0,n.serverTimestamp)()},void 0===r.name){e.next=4;break}if(!("string"!=typeof r.name||r.name.trim().length<3)){e.next=3;break}throw Error("Turniername muss mindestens 3 Zeichen lang sein.");case 3:a.name=r.name.trim();case 4:return void 0!==r.description&&(a.description="string"==typeof r.description?r.description.trim():""),e.prev=5,e.next=6,(0,n.updateDoc)(o,a);case 6:console.log("[TournamentService] Basinformationen f\xfcr Turnier ".concat(t," erfolgreich aktualisiert.")),e.next=8;break;case 7:throw e.prev=7,s=e.catch(5),console.error("[TournamentService] Fehler beim Aktualisieren der Basinformationen f\xfcr Turnier ".concat(t,":"),s),s;case 8:case"end":return e.stop()}},e,null,[[5,7]])}));return function(t,r){return e.apply(this,arguments)}}(),$=function(){var e=b(m().mark(function e(t){var r,o,a;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[tournamentService] Activating tournament instance ".concat(t,".")),r=(0,n.doc)(i.db,"tournaments",t),e.prev=1,e.next=2,(0,n.getDoc)(r);case 2:if(!((o=e.sent).exists()&&"upcoming"!==o.data().status)){e.next=3;break}throw Error("Turnier kann nur aktiviert werden, wenn es den Status 'anstehend' hat.");case 3:return e.next=4,(0,n.updateDoc)(r,{status:"active",updatedAt:(0,n.serverTimestamp)()});case 4:console.log("[tournamentService] Tournament instance ".concat(t," successfully activated.")),e.next=6;break;case 5:throw e.prev=5,a=e.catch(1),console.error("[tournamentService] Error activating tournament ".concat(t,":"),a),Error(a instanceof Error?a.message:"Turnier konnte nicht aktiviert werden.");case 6:case"end":return e.stop()}},e,null,[[1,5]])}));return function(t){return e.apply(this,arguments)}}(),K=function(){var e=b(m().mark(function e(t){var r,o,a,s,u,c,l,h,d,f,p,g,y,v;return m().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}return console.warn("[tournamentService] clearActivePasseInTournament called without instanceId."),e.abrupt("return");case 1:return console.log("[tournamentService] Clearing currentActiveGameId for tournament instance ".concat(t)),r=(0,n.doc)(i.db,"tournaments",t),e.prev=2,e.next=3,(0,n.getDoc)(r);case 3:if((o=e.sent).exists()){e.next=4;break}throw Error("Turnier ".concat(t," nicht gefunden."));case 4:return a=o.data().currentActiveGameId,s=[],u=!1,a?(console.log("[tournamentService] Found active passe ".concat(a," in tournament document")),s.push(a)):console.log("[tournamentService] No active passe found in tournament document, searching all active passes for tournament ".concat(t)),c=(0,n.query)((0,n.collection)(i.db,"activeGames"),(0,n.where)("tournamentInstanceId","==",t),(0,n.where)("status","==","live")),e.next=5,(0,n.getDocs)(c);case 5:(l=e.sent).empty?0===s.length&&console.log("[tournamentService] No active passes found for tournament ".concat(t," through any method")):(console.log("[tournamentService] Found ".concat(l.size," active passes in tournament ").concat(t," from direct query")),l.forEach(function(e){var t=e.id;s.includes(t)||(console.log("[tournamentService] Adding passe ".concat(t," to abort list from query results")),s.push(t))})),h=0,d=s;case 6:if(!(h<d.length)){e.next=14;break}return f=d[h],e.prev=7,console.log("[tournamentService] Setting status to 'aborted' for passe ".concat(f)),p=(0,n.doc)(i.db,"activeGames",f),e.next=8,(0,n.getDoc)(p);case 8:if((g=e.sent).exists()){e.next=9;break}return console.warn("[tournamentService] Active game document ".concat(f," not found, skipping abort.")),e.abrupt("continue",13);case 9:if("aborted"!==g.data().status){e.next=10;break}return console.log("[tournamentService] Passe ".concat(f," is already in 'aborted' state, skipping.")),e.abrupt("continue",13);case 10:return e.next=11,(0,n.updateDoc)(p,{status:"aborted",completedAt:(0,n.serverTimestamp)()});case 11:console.log("[tournamentService] Successfully set status to 'aborted' for passe ".concat(f)),u=!0,e.next=13;break;case 12:e.prev=12,y=e.catch(7),console.error("[tournamentService] Error aborting passe ".concat(f,":"),y);case 13:h++,e.next=6;break;case 14:return console.log("[tournamentService] Resetting currentActiveGameId to null in tournament document ".concat(t)),e.next=15,(0,n.updateDoc)(r,{currentActiveGameId:null,updatedAt:(0,n.serverTimestamp)(),lastActivity:(0,n.serverTimestamp)()});case 15:console.log("[tournamentService] Successfully cleared currentActiveGameId for tournament ".concat(t,".")),u?console.log("[tournamentService] Successfully aborted ".concat(s.length," active passes and reset currentActiveGameId in tournament ").concat(t,".")):console.log("[tournamentService] Reset currentActiveGameId in tournament ".concat(t,", but no active passes were found or needed to be aborted.")),e.next=17;break;case 16:throw e.prev=16,v=e.catch(2),console.error("[tournamentService] Error clearing active passe in tournament ".concat(t,":"),v),Error("Die aktive Passe im Turnier konnte serverseitig nicht korrekt bereinigt werden.");case 17:case"end":return e.stop()}},e,null,[[2,16],[7,12]])}));return function(t){return e.apply(this,arguments)}}()},7200:(e,t,r)=>{"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(){i=function(){return t};var e,t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function h(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(e){h=function(e,t,r){return e[t]=r}}function d(t,r,n,i){var o,s,u,c,l=Object.create((r&&r.prototype instanceof v?r:v).prototype);return a(l,"_invoke",{value:(o=t,s=n,u=new A(i||[]),c=p,function(t,r){if(c===m)throw Error("Generator is already running");if(c===g){if("throw"===t)throw r;return{value:e,done:!0}}for(u.method=t,u.arg=r;;){var n=u.delegate;if(n){var i=function t(r,n){var i=n.method,o=r.iterator[i];if(o===e)return n.delegate=null,"throw"===i&&r.iterator.return&&(n.method="return",n.arg=e,t(r,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+i+"' method")),y;var a=f(o,r.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,y;var s=a.arg;return s?s.done?(n[r.resultName]=s.value,n.next=r.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):s:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,y)}(n,u);if(i){if(i===y)continue;return i}}if("next"===u.method)u.sent=u._sent=u.arg;else if("throw"===u.method){if(c===p)throw c=g,u.arg;u.dispatchException(u.arg)}else"return"===u.method&&u.abrupt("return",u.arg);c=m;var a=f(o,s,u);if("normal"===a.type){if(c=u.done?g:"suspendedYield",a.arg===y)continue;return{value:a.arg,done:u.done}}"throw"===a.type&&(c=g,u.method="throw",u.arg=a.arg)}})}),l}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var p="suspendedStart",m="executing",g="completed",y={};function v(){}function b(){}function w(){}var S={};h(S,u,function(){return this});var x=Object.getPrototypeOf,I=x&&x(x(O([])));I&&I!==r&&o.call(I,u)&&(S=I);var E=w.prototype=v.prototype=Object.create(S);function T(e){["next","throw","return"].forEach(function(t){h(e,t,function(e){return this._invoke(t,e)})})}function k(e,t){var r;a(this,"_invoke",{value:function(i,a){function s(){return new t(function(r,s){!function r(i,a,s,u){var c=f(e[i],e,a);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==n(h)&&o.call(h,"__await")?t.resolve(h.__await).then(function(e){r("next",e,s,u)},function(e){r("throw",e,s,u)}):t.resolve(h).then(function(e){l.value=e,s(l)},function(e){return r("throw",e,s,u)})}u(c.arg)}(i,a,r,s)})}return r=r?r.then(s,s):s()}})}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function O(t){if(t||""===t){var r=t[u];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function r(){for(;++i<t.length;)if(o.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw TypeError(n(t)+" is not iterable")}return b.prototype=w,a(E,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:b,configurable:!0}),b.displayName=h(w,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,h(e,l,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},T(k.prototype),h(k.prototype,c,function(){return this}),t.AsyncIterator=k,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new k(d(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},T(E),h(E,l,"Generator"),h(E,u,function(){return this}),h(E,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var u=o.call(a,"catchLoc"),c=o.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function o(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(n,i)}r.d(t,{p:()=>s});var a=0,s=function(){var e,t=(e=i().mark(function e(t,r,n){var o,s,u,c=arguments;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=c.length>3&&void 0!==c[3]&&c[3],s=Date.now(),!(!o&&a&&s-a<300)){e.next=1;break}return e.abrupt("return",!1);case 1:return a=s,e.prev=2,e.next=3,t.push(r,void 0,n);case 3:return e.abrupt("return",!0);case 4:return e.prev=4,u=e.catch(2),console.error("[RouterUtils] Fehler bei Navigation zu ".concat(r,":"),u),e.abrupt("return",!1);case 5:case"end":return e.stop()}},e,null,[[2,4]])}),function(){var t=this,r=arguments;return new Promise(function(n,i){var a=e.apply(t,r);function s(e){o(a,n,i,s,u,"next",e)}function u(e){o(a,n,i,s,u,"throw",e)}s(void 0)})});return function(e,r,n){return t.apply(this,arguments)}}()},7212:(e,t,r)=>{"use strict";r.d(t,{N:()=>v});var n=r(7876),i=r(4232),o=r(5048),a=r(1200),s=r(181),u=r(3866),c=r(5609),l=r(9751);class h extends i.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=t.offsetParent,r=(0,c.s)(e)&&e.offsetWidth||0,n=this.props.sizeRef.current;n.height=t.offsetHeight||0,n.width=t.offsetWidth||0,n.top=t.offsetTop,n.left=t.offsetLeft,n.right=r-n.width-n.left}return null}componentDidUpdate(){}render(){return this.props.children}}function d({children:e,isPresent:t,anchorX:r,root:o}){let a=(0,i.useId)(),s=(0,i.useRef)(null),u=(0,i.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:c}=(0,i.useContext)(l.Q);return(0,i.useInsertionEffect)(()=>{let{width:e,height:n,top:i,left:l,right:h}=u.current;if(t||!s.current||!e||!n)return;let d="left"===r?`left: ${l}`:`right: ${h}`;s.current.dataset.motionPopId=a;let f=document.createElement("style");c&&(f.nonce=c);let p=o??document.head;return p.appendChild(f),f.sheet&&f.sheet.insertRule(`
          [data-motion-pop-id="${a}"] {
            position: absolute !important;
            width: ${e}px !important;
            height: ${n}px !important;
            ${d}px !important;
            top: ${i}px !important;
          }
        `),()=>{p.removeChild(f),p.contains(f)&&p.removeChild(f)}},[t]),(0,n.jsx)(h,{isPresent:t,childRef:s,sizeRef:u,children:i.cloneElement(e,{ref:s})})}let f=({children:e,initial:t,isPresent:r,onExitComplete:o,custom:s,presenceAffectsLayout:c,mode:l,anchorX:h,root:f})=>{let m=(0,a.M)(p),g=(0,i.useId)(),y=!0,v=(0,i.useMemo)(()=>(y=!1,{id:g,initial:t,isPresent:r,custom:s,onExitComplete:e=>{for(let t of(m.set(e,!0),m.values()))if(!t)return;o&&o()},register:e=>(m.set(e,!1),()=>m.delete(e))}),[r,m,o]);return c&&y&&(v={...v}),(0,i.useMemo)(()=>{m.forEach((e,t)=>m.set(t,!1))},[r]),i.useEffect(()=>{r||m.size||!o||o()},[r]),"popLayout"===l&&(e=(0,n.jsx)(d,{isPresent:r,anchorX:h,root:f,children:e})),(0,n.jsx)(u.t.Provider,{value:v,children:e})};function p(){return new Map}var m=r(3885);let g=e=>e.key||"";function y(e){let t=[];return i.Children.forEach(e,e=>{(0,i.isValidElement)(e)&&t.push(e)}),t}let v=({children:e,custom:t,initial:r=!0,onExitComplete:u,presenceAffectsLayout:c=!0,mode:l="sync",propagate:h=!1,anchorX:d="left",root:p})=>{let[v,b]=(0,m.xQ)(h),w=(0,i.useMemo)(()=>y(e),[e]),S=h&&!v?[]:w.map(g),x=(0,i.useRef)(!0),I=(0,i.useRef)(w),E=(0,a.M)(()=>new Map),[T,k]=(0,i.useState)(w),[_,P]=(0,i.useState)(w);(0,s.E)(()=>{x.current=!1,I.current=w;for(let e=0;e<_.length;e++){let t=g(_[e]);S.includes(t)?E.delete(t):!0!==E.get(t)&&E.set(t,!1)}},[_,S.length,S.join("-")]);let A=[];if(w!==T){let e=[...w];for(let t=0;t<_.length;t++){let r=_[t],n=g(r);S.includes(n)||(e.splice(t,0,r),A.push(r))}return"wait"===l&&A.length&&(e=A),P(y(e)),k(w),null}let{forceRender:O}=(0,i.useContext)(o.L);return(0,n.jsx)(n.Fragment,{children:_.map(e=>{let i=g(e),o=(!h||!!v)&&(w===_||S.includes(i));return(0,n.jsx)(f,{isPresent:o,initial:(!x.current||!!r)&&void 0,custom:t,presenceAffectsLayout:c,mode:l,root:p,onExitComplete:o?void 0:()=>{if(!E.has(i))return;E.set(i,!0);let e=!0;E.forEach(t=>{t||(e=!1)}),e&&(O?.(),P(I.current),h&&b?.(),u&&u())},anchorX:d,children:e},i)})})}},7247:(e,t)=>{t.read=function(e,t,r,n,i){var o,a,s=8*i-n-1,u=(1<<s)-1,c=u>>1,l=-7,h=r?i-1:0,d=r?-1:1,f=e[t+h];for(h+=d,o=f&(1<<-l)-1,f>>=-l,l+=s;l>0;o=256*o+e[t+h],h+=d,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=n;l>0;a=256*a+e[t+h],h+=d,l-=8);if(0===o)o=1-c;else{if(o===u)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),o-=c}return(f?-1:1)*a*Math.pow(2,o-n)},t.write=function(e,t,r,n,i,o){var a,s,u,c=8*o-i-1,l=(1<<c)-1,h=l>>1,d=5960464477539062e-23*(23===i),f=n?0:o-1,p=n?1:-1,m=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(s=+!!isNaN(t),a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),a+h>=1?t+=d/u:t+=d*Math.pow(2,1-h),t*u>=2&&(a++,u/=2),a+h>=l?(s=0,a=l):a+h>=1?(s=(t*u-1)*Math.pow(2,i),a+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;e[r+f]=255&s,f+=p,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;e[r+f]=255&a,f+=p,a/=256,c-=8);e[r+f-p]|=128*m}},7328:(e,t,r)=>{e.exports=r(5237)},7594:(e,t,r)=>{"use strict";function n(e){return"object"==typeof e&&null!==e}r.d(t,{G:()=>n})},7666:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return a}});var n=r(4232),i=n.useLayoutEffect,o=n.useEffect;function a(e){var t=e.headManager,r=e.reduceComponentsToState;function a(){if(t&&t.mountedInstances){var i=n.Children.toArray(Array.from(t.mountedInstances).filter(Boolean));t.updateHead(r(i,e))}}return i(function(){var r;return null==t||null==(r=t.mountedInstances)||r.add(e.children),function(){var r;null==t||null==(r=t.mountedInstances)||r.delete(e.children)}}),i(function(){return t&&(t._pendingUpdate=a),function(){t&&(t._pendingUpdate=a)}}),o(function(){return t&&t._pendingUpdate&&(t._pendingUpdate(),t._pendingUpdate=null),function(){t&&t._pendingUpdate&&(t._pendingUpdate(),t._pendingUpdate=null)}}),null}},7746:(e,t,r)=>{"use strict";r.d(t,{Uz:()=>I,Qg:()=>E});var n=r(6796),i=r(1139),o=r(8308);function a(e,t){let r={};for(let n in e)e.hasOwnProperty(n)&&(r[n]=t(e[n]));return r}function s(e){if(null==e)return null;if(e instanceof Number&&(e=e.valueOf()),"number"==typeof e&&isFinite(e)||!0===e||!1===e||"[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(e=>s(e));if("function"==typeof e||"object"==typeof e)return a(e,e=>s(e));throw Error("Data cannot be encoded in JSON: "+e)}function u(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":{let t=Number(e.value);if(isNaN(t))throw Error("Data cannot be decoded from JSON: "+e);return t}default:throw Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(e=>u(e)):"function"==typeof e||"object"==typeof e?a(e,e=>u(e)):e}let c="functions",l={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class h extends i.g{constructor(e,t,r){super(`${c}/${e}`,t||""),this.details=r,Object.setPrototypeOf(this,h.prototype)}}function d(e,t){let r,n=function(e){if(e>=200&&e<300)return"ok";switch(e){case 0:case 500:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(e),i=n;try{let e=t&&t.error;if(e){let t=e.status;if("string"==typeof t){if(!l[t])return new h("internal","internal");n=l[t],i=t}let o=e.message;"string"==typeof o&&(i=o),r=e.details,void 0!==r&&(r=u(r))}}catch(e){}return"ok"===n?null:new h(n,i,r)}class f{constructor(e,t,r,i){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,(0,n.xZ)(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=r.getImmediate({optional:!0}),this.auth||t.get().then(e=>this.auth=e,()=>{}),this.messaging||r.get().then(e=>this.messaging=e,()=>{}),this.appCheck||null==i||i.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{let e=await this.auth.getToken();return null==e?void 0:e.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return await this.messaging.getToken()}catch(e){return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){let t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){let t=await this.getAuthToken();return{authToken:t,messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken(e)}}}let p="us-central1",m=/^data: (.*?)(?:\n|$)/;class g{constructor(e,t,r,n,i=p,o=(...e)=>fetch(...e)){this.app=e,this.fetchImpl=o,this.emulatorOrigin=null,this.contextProvider=new f(e,t,r,n),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{let e=new URL(i);this.customDomain=e.origin+("/"===e.pathname?"":e.pathname),this.region=p}catch(e){this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){let t=this.app.options.projectId;if(null!==this.emulatorOrigin){let r=this.emulatorOrigin;return`${r}/${t}/${this.region}/${e}`}return null!==this.customDomain?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}async function y(e,t,r,n){let i;r["Content-Type"]="application/json";try{i=await n(e,{method:"POST",body:JSON.stringify(t),headers:r})}catch(e){return{status:0,json:null}}let o=null;try{o=await i.json()}catch(e){}return{status:i.status,json:o}}async function v(e,t){let r={},n=await e.contextProvider.getContext(t.limitedUseAppCheckTokens);return n.authToken&&(r.Authorization="Bearer "+n.authToken),n.messagingToken&&(r["Firebase-Instance-ID-Token"]=n.messagingToken),null!==n.appCheckToken&&(r["X-Firebase-AppCheck"]=n.appCheckToken),r}async function b(e,t,r,n){var i;let o,a={data:r=s(r)},c=await v(e,n),l=(i=n.timeout||7e4,o=null,{promise:new Promise((e,t)=>{o=setTimeout(()=>{t(new h("deadline-exceeded","deadline-exceeded"))},i)}),cancel:()=>{o&&clearTimeout(o)}}),f=await Promise.race([y(t,a,c,e.fetchImpl),l.promise,e.cancelAllRequests]);if(l.cancel(),!f)throw new h("cancelled","Firebase Functions instance was deleted.");let p=d(f.status,f.json);if(p)throw p;if(!f.json)throw new h("internal","Response is not valid JSON object.");let m=f.json.data;if(void 0===m&&(m=f.json.result),void 0===m)throw new h("internal","Response is missing data field.");return{data:u(m)}}async function w(e,t,r,n){var i;let o,a,c,l={data:r=s(r)},f=await v(e,n);f["Content-Type"]="application/json",f.Accept="text/event-stream";try{o=await e.fetchImpl(t,{method:"POST",body:JSON.stringify(l),headers:f,signal:null==n?void 0:n.signal})}catch(t){if(t instanceof Error&&"AbortError"===t.name){let e=new h("cancelled","Request was cancelled.");return{data:Promise.reject(e),stream:{[Symbol.asyncIterator]:()=>({next:()=>Promise.reject(e)})}}}let e=d(0,null);return{data:Promise.reject(e),stream:{[Symbol.asyncIterator]:()=>({next:()=>Promise.reject(e)})}}}let p=new Promise((e,t)=>{a=e,c=t});null==(i=null==n?void 0:n.signal)||i.addEventListener("abort",()=>{let e=new h("cancelled","Request was cancelled.");c(e)});let g=function(e,t,r,n){let i=(e,n)=>{let i=e.match(m);if(!i)return;let o=i[1];try{let e=JSON.parse(o);if("result"in e)return void t(u(e.result));if("message"in e)return void n.enqueue(u(e.message));if("error"in e){let t=d(0,e);n.error(t),r(t);return}}catch(e){if(e instanceof h){n.error(e),r(e);return}}},o=new TextDecoder;return new ReadableStream({start(t){let a="";return s();async function s(){if(null==n?void 0:n.aborted){let e=new h("cancelled","Request was cancelled");return t.error(e),r(e),Promise.resolve()}try{let{value:u,done:c}=await e.read();if(c){a.trim()&&i(a.trim(),t),t.close();return}if(null==n?void 0:n.aborted){let n=new h("cancelled","Request was cancelled");t.error(n),r(n),await e.cancel();return}let l=(a+=o.decode(u,{stream:!0})).split("\n");for(let e of(a=l.pop()||"",l))e.trim()&&i(e.trim(),t);return s()}catch(n){let e=n instanceof h?n:d(0,null);t.error(e),r(e)}}},cancel:()=>e.cancel()})}(o.body.getReader(),a,c,null==n?void 0:n.signal);return{stream:{[Symbol.asyncIterator](){let e=g.getReader();return{async next(){let{value:t,done:r}=await e.read();return{value:t,done:r}},return:async()=>(await e.cancel(),{done:!0,value:void 0})}}},data:p}}let S="@firebase/functions",x="0.12.9";function I(e=(0,n.Sx)(),t=p){let r=(0,n.j6)((0,i.Ku)(e),c).getImmediate({identifier:t}),o=(0,i.yU)("functions");return o&&function(e,t,r){var n=(0,i.Ku)(e);let o=(0,i.zJ)(t);n.emulatorOrigin=`http${o?"s":""}://${t}:${r}`,o&&((0,i.gE)(n.emulatorOrigin),(0,i.P1)("Functions",!0))}(r,...o),r}function E(e,t,r){var n=(0,i.Ku)(e);let o=e=>(function(e,t,r,n){let i=e._url(t);return b(e,i,r,n)})(n,t,e,r||{});return o.stream=(e,r)=>(function(e,t,r,n){let i=e._url(t);return w(e,i,r,n||{})})(n,t,e,r),o}(0,n.om)(new o.uA(c,(e,{instanceIdentifier:t})=>{let r=e.getProvider("app").getImmediate(),n=e.getProvider("auth-internal");return new g(r,n,e.getProvider("messaging-internal"),e.getProvider("app-check-internal"),t)},"PUBLIC").setMultipleInstances(!0)),(0,n.KO)(S,x,void 0),(0,n.KO)(S,x,"esm2017")},8106:(e,t,r)=>{"use strict";r.d(t,{v:()=>u});var n=r(4232);let i=e=>{let t,r=new Set,n=(e,n)=>{let i="function"==typeof e?e(t):e;if(!Object.is(i,t)){let e=t;t=(null!=n?n:"object"!=typeof i||null===i)?i:Object.assign({},t,i),r.forEach(r=>r(t,e))}},i=()=>t,o={setState:n,getState:i,getInitialState:()=>a,subscribe:e=>(r.add(e),()=>r.delete(e))},a=t=e(n,i,o);return o},o=e=>e?i(e):i,a=e=>e,s=e=>{let t=o(e),r=e=>(function(e,t=a){let r=n.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getInitialState()));return n.useDebugValue(r),r})(t,e);return Object.assign(r,t),r},u=e=>e?s(e):s},8112:(e,t,r)=>{"use strict";r.d(t,{D:()=>i});var n=r(4609);let i=e=>(t,r,i)=>(i.setState=(e,r,...i)=>t("function"==typeof e?(0,n.jM)(e):e,r,...i),e(i.setState,r,i))},8308:(e,t,r)=>{"use strict";r.d(t,{h1:()=>s,uA:()=>i});var n=r(1139);class i{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let o="[DEFAULT]";class a{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new n.cY;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let r=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),n=null!=(t=null==e?void 0:e.optional)&&t;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(e){if(n)return null;throw e}if(n)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:o})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:r});t.resolve(e)}catch(e){}}}}clearInstance(e=o){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=o){return this.instances.has(e)}getOptions(e=o){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let n=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[e,t]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(e)&&t.resolve(n);return n}onInit(e,t){var r;let n=this.normalizeInstanceIdentifier(t),i=null!=(r=this.onInitCallbacks.get(n))?r:new Set;i.add(e),this.onInitCallbacks.set(n,i);let o=this.instances.get(n);return o&&e(o,n),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let n of r)try{n(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var r;let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e)===o?void 0:r,options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}return n||null}normalizeInstanceIdentifier(e=o){return this.component?this.component.multipleInstances?e:o:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class s{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new a(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},8310:(e,t,r)=>{"use strict";r.d(t,{$d:()=>a,C3:()=>o,IZ:()=>u,qC:()=>i,sz:()=>n});var n=157,i=257,o=[{id:"sieg",name:"Sieg",defaultValue:2e3,maxValue:1e4,order:1},{id:"berg",name:"Berg",defaultValue:1e3,maxValue:5e3,order:2},{id:"schneider",name:"Schneider",defaultValue:1e3,maxValue:5e3,order:3}],a={values:o.reduce(function(e,t){var r;return e[t.id]=null!=(r=t.defaultValue)?r:"sieg"===t.id?2e3:1e3,e},{}),enabled:{sieg:!0,berg:!0,schneider:!0}},s=function(e){var t=o.find(function(t){return t.id===e});if(!t)throw Error("Ung\xfcltiger ScoreMode: ".concat(e));return t},u=function(e,t){var r=s(e);if(t<0)return!1;if("sieg"===e)return t<=r.maxValue;var n=Math.floor(s("sieg").defaultValue/2);return t<=Math.min(r.maxValue,n)}},8449:(e,t,r)=>{"use strict";r.d(t,{Ak:()=>n});let n=(e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&r[e]];return t}},8517:(e,t,r)=>{"use strict";r.d(t,{Aw:()=>c,GA:()=>u,OB:()=>f,Xr:()=>a,Zv:()=>l,_9:()=>h,s2:()=>p,vm:()=>d,wq:()=>o});var n=r(8310),i=r(7044),o=["schneider","kontermatsch"],a={top:[2,4],bottom:[1,3]},s=null,u=function(e){},c=function(e){return"jass"===e.actionType},l=function(e){return arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.zh,arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.$d,{horizontal:(e.matsch||0)+(e.kontermatsch||0),vertikal:(e.berg||0)+(e.sieg||0)+(e.schneider||0)}},h=function(){return{lastNavigationTimestamp:Date.now(),weisCache:null}},d=function(e){var t,r=e%4+1;return(t=r)>=1&&t<=4?r:1},f=function(e,t){return"top"===t&&(2===e||4===e)||"bottom"===t&&(1===e||3===e)},p={none:0,low:500,medium:1500,high:3e3,super:5e3,extreme:8e3}},8934:(e,t,r)=>{"use strict";let n;r.d(t,{U8:()=>S,go:()=>x});var i=r(3177),o=r(3558);let a={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},s=new Uint8Array(16),u=[];for(let e=0;e<256;++e)u.push((e+256).toString(16).slice(1));let c=function(e,t,r){if(a.randomUUID&&!t&&!e)return a.randomUUID();let i=(e=e||{}).random||(e.rng||function(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(s)})();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=i[e];return t}return function(e,t=0){return u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]}(i)};function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(){h=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function d(t,r,n,o){var a,s,u,c,l=Object.create((r&&r.prototype instanceof v?r:v).prototype);return i(l,"_invoke",{value:(a=t,s=n,u=new A(o||[]),c=p,function(t,r){if(c===m)throw Error("Generator is already running");if(c===g){if("throw"===t)throw r;return{value:e,done:!0}}for(u.method=t,u.arg=r;;){var n=u.delegate;if(n){var i=function t(r,n){var i=n.method,o=r.iterator[i];if(o===e)return n.delegate=null,"throw"===i&&r.iterator.return&&(n.method="return",n.arg=e,t(r,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+i+"' method")),y;var a=f(o,r.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,y;var s=a.arg;return s?s.done?(n[r.resultName]=s.value,n.next=r.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):s:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,y)}(n,u);if(i){if(i===y)continue;return i}}if("next"===u.method)u.sent=u._sent=u.arg;else if("throw"===u.method){if(c===p)throw c=g,u.arg;u.dispatchException(u.arg)}else"return"===u.method&&u.abrupt("return",u.arg);c=m;var o=f(a,s,u);if("normal"===o.type){if(c=u.done?g:"suspendedYield",o.arg===y)continue;return{value:o.arg,done:u.done}}"throw"===o.type&&(c=g,u.method="throw",u.arg=o.arg)}})}),l}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var p="suspendedStart",m="executing",g="completed",y={};function v(){}function b(){}function w(){}var S={};c(S,a,function(){return this});var x=Object.getPrototypeOf,I=x&&x(x(O([])));I&&I!==r&&n.call(I,a)&&(S=I);var E=w.prototype=v.prototype=Object.create(S);function T(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function k(e,t){var r;i(this,"_invoke",{value:function(i,o){function a(){return new t(function(r,a){!function r(i,o,a,s){var u=f(e[i],e,o);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==l(h)&&n.call(h,"__await")?t.resolve(h.__await).then(function(e){r("next",e,a,s)},function(e){r("throw",e,a,s)}):t.resolve(h).then(function(e){c.value=e,a(c)},function(e){return r("throw",e,a,s)})}s(u.arg)}(i,o,r,a)})}return r=r?r.then(a,a):a()}})}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function O(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw TypeError(l(t)+" is not iterable")}return b.prototype=w,i(E,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:b,configurable:!0}),b.displayName=c(w,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,c(e,u,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},T(k.prototype),c(k.prototype,s,function(){return this}),t.AsyncIterator=k,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new k(d(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},T(E),c(E,u,"Generator"),c(E,a,function(){return this}),c(E,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return s.type="throw",s.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function d(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){r(e);return}s.done?t(u):Promise.resolve(u).then(n,i)}function f(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function a(e){d(o,n,i,a,s,"next",e)}function s(e){d(o,n,i,a,s,"throw",e)}a(void 0)})}}function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach(function(t){g(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function g(e,t,r){return(t=y(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function y(e){var t=function(e,t){if("object"!==l(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==l(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===l(t)?t:String(t)}var v={maxRetries:10,baseRetryDelay:1e3,maxRetryDelay:3e4,batchSize:3,networkCheckInterval:5e3},b=function(){var e,t,r,n,a,s,u,l,d,p;return d=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!(this instanceof e))throw TypeError("Cannot call a class as a function");g(this,"isRunning",!1),g(this,"syncInterval",null),g(this,"networkCheckInterval",null),g(this,"isOnline",navigator.onLine),this.config=m(m({},v),t),this.setupNetworkListeners()},p=[{key:"setupNetworkListeners",value:function(){var e=this;window.addEventListener("online",function(){console.log("[SyncEngine] \uD83C\uDF10 Network: ONLINE - Resuming sync"),e.isOnline=!0,e.start()}),window.addEventListener("offline",function(){console.log("[SyncEngine] \uD83D\uDCF4 Network: OFFLINE - Pausing sync"),e.isOnline=!1,e.pause()}),this.networkCheckInterval=setInterval(function(){var t=e.isOnline;e.isOnline=navigator.onLine,!t&&e.isOnline?(console.log("[SyncEngine] \uD83D\uDD04 Network check: Back online - Resuming sync"),e.start()):t&&!e.isOnline&&(console.log("[SyncEngine] \uD83D\uDD04 Network check: Gone offline - Pausing sync"),e.pause())},this.config.networkCheckInterval)}},{key:"start",value:(e=f(h().mark(function e(){var t=this;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.isRunning||!this.isOnline)){e.next=1;break}return e.abrupt("return");case 1:return console.log("[SyncEngine] \uD83D\uDE80 Starting background synchronization"),this.isRunning=!0,e.next=2,this.processSyncQueue();case 2:this.syncInterval=setInterval(f(h().mark(function e(){return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.isOnline&&t.isRunning)){e.next=1;break}return e.next=1,t.processSyncQueue();case 1:case"end":return e.stop()}},e)})),1e4);case 3:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"pause",value:function(){this.isRunning&&(console.log("[SyncEngine] ⏸️ Pausing synchronization"),this.isRunning=!1,this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null))}},{key:"stop",value:function(){console.log("[SyncEngine] \uD83D\uDED1 Stopping sync engine"),this.pause(),this.networkCheckInterval&&(clearInterval(this.networkCheckInterval),this.networkCheckInterval=null),window.removeEventListener("online",this.start),window.removeEventListener("offline",this.pause)}},{key:"queueGameFinalization",value:(t=f(h().mark(function e(t,r){var n,o,a,s=arguments;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s.length>2&&void 0!==s[2]&&s[2],e.next=1,(0,i.eW)();case 1:return n=e.sent,o={id:c(),type:"GAME_COMPLETED",sessionId:t,gameData:r,timestamp:Date.now(),attempts:0},e.prev=2,e.next=3,n.addToSyncQueue(o);case 3:if(console.log("[SyncEngine] ✅ Game finalization queued: ".concat(o.id)),!this.isOnline){e.next=4;break}return e.next=4,this.processSyncQueue();case 4:e.next=6;break;case 5:throw e.prev=5,console.error("[SyncEngine] ❌ Failed to queue game finalization:",a=e.catch(2)),a;case 6:case"end":return e.stop()}},e,this,[[2,5]])})),function(e,r){return t.apply(this,arguments)})},{key:"saveOfflineGame",value:(r=f(h().mark(function e(t,r){var n,o,a;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,(0,i.eW)();case 1:return n=e.sent,o={id:c(),sessionId:t,gameData:r,timestamp:Date.now(),synced:!1},e.prev=2,e.next=3,n.saveOfflineGame(o);case 3:console.log("[SyncEngine] \uD83D\uDCBE Game saved offline: ".concat(o.id)),e.next=5;break;case 4:throw e.prev=4,console.error("[SyncEngine] ❌ Failed to save offline game:",a=e.catch(2)),a;case 5:case"end":return e.stop()}},e,null,[[2,4]])})),function(e,t){return r.apply(this,arguments)})},{key:"processSyncQueue",value:(n=f(h().mark(function e(){var t,r,n,o,a,s=this;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isOnline){e.next=1;break}return e.abrupt("return");case 1:return e.prev=1,e.next=2,(0,i.eW)();case 2:return t=e.sent,e.next=3,t.getPendingSyncItems();case 3:if(0!==(r=e.sent).length){e.next=4;break}return e.abrupt("return");case 4:console.log("[SyncEngine] \uD83D\uDD04 Processing ".concat(r.length," pending sync items")),n=this.config.batchSize,o=0;case 5:if(!(o<r.length)){e.next=7;break}return a=r.slice(o,o+n),e.next=6,Promise.all(a.map(function(e){return s.processSyncItem(e)}));case 6:o+=n,e.next=5;break;case 7:e.next=9;break;case 8:e.prev=8,console.error("[SyncEngine] ❌ Error processing sync queue:",e.catch(1));case 9:case"end":return e.stop()}},e,this,[[1,8]])})),function(){return n.apply(this,arguments)})},{key:"processSyncItem",value:(a=f(h().mark(function e(t){var r,n,o,a;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,(0,i.eW)();case 1:if(r=e.sent,e.prev=2,!(t.attempts>=this.config.maxRetries)){e.next=4;break}return console.error("[SyncEngine] ❌ Max retries exceeded for item ".concat(t.id,". Removing from queue.")),e.next=3,r.removeSyncItem(t.id);case 3:return e.abrupt("return");case 4:if(n=Math.min(this.config.baseRetryDelay*Math.pow(2,t.attempts),this.config.maxRetryDelay),!(t.lastAttempt&&Date.now()-t.lastAttempt<n)){e.next=5;break}return e.abrupt("return");case 5:return console.log("[SyncEngine] \uD83D\uDD04 Attempting sync for item ".concat(t.id," (attempt ").concat(t.attempts+1,")")),e.next=6,this.syncGameFinalization(t);case 6:return e.next=7,r.removeSyncItem(t.id);case 7:console.log("[SyncEngine] ✅ Successfully synced item ".concat(t.id)),e.next=9;break;case 8:return e.prev=8,a=e.catch(2),console.warn("[SyncEngine] ⚠️ Sync attempt failed for item ".concat(t.id,":"),a),o=m(m({},t),{},{attempts:t.attempts+1,lastAttempt:Date.now(),error:a instanceof Error?a.message:String(a)}),e.next=9,r.updateSyncItem(o);case 9:case"end":return e.stop()}},e,this,[[2,8]])})),function(e){return a.apply(this,arguments)})},{key:"syncGameFinalization",value:(s=f(h().mark(function e(t){var r,n,i,a;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.sessionId,i=(n=t.gameData).gameNumber||1,e.prev=1,e.next=2,(0,o.saveCompletedGameToFirestore)(r,i,n,!1);case 2:if(console.log("[SyncEngine] ✅ Completed game saved to Firestore: Session ".concat(r,", Game ").concat(i)),!1===n.clearActiveGameId){e.next=6;break}return e.prev=3,e.next=4,(0,o.updateSessionActiveGameId)(r,null);case 4:console.log("[SyncEngine] ✅ Session activeGameId cleared: ".concat(r)),e.next=6;break;case 5:e.prev=5,console.warn("[SyncEngine] ⚠️ Failed to clear session activeGameId (non-critical):",e.catch(3));case 6:e.next=8;break;case 7:throw e.prev=7,console.error("[SyncEngine] ❌ Failed to sync game finalization:",a=e.catch(1)),a;case 8:case"end":return e.stop()}},e,null,[[1,7],[3,5]])})),function(e){return s.apply(this,arguments)})},{key:"getPendingCount",value:(u=f(h().mark(function e(){var t,r;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,(0,i.eW)();case 1:return t=e.sent,e.next=2,t.getPendingSyncItems();case 2:return r=e.sent,e.abrupt("return",r.length);case 3:return e.prev=3,console.error("[SyncEngine] ❌ Failed to get pending count:",e.catch(0)),e.abrupt("return",0);case 4:case"end":return e.stop()}},e,null,[[0,3]])})),function(){return u.apply(this,arguments)})},{key:"clearCompletedSyncs",value:(l=f(h().mark(function e(){var t;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,(0,i.eW)();case 1:return t=e.sent,e.next=2,t.clearSyncedGames();case 2:console.log("[SyncEngine] ✅ Cleared completed syncs from local storage"),e.next=4;break;case 3:e.prev=3,console.error("[SyncEngine] ❌ Failed to clear completed syncs:",e.catch(0));case 4:case"end":return e.stop()}},e,null,[[0,3]])})),function(){return l.apply(this,arguments)})}],function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,y(n.key),n)}}(d.prototype,p),Object.defineProperty(d,"prototype",{writable:!1}),d}(),w=null,S=function(){return w||(w=new b),w},x=function(e){return w&&w.stop(),w=new b(e)}},9045:(e,t,r)=>{"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}r.d(t,{J:()=>o});var o=function(e){var t={100:Math.floor(e/100),50:0,20:0},r=e%100;return r>=50&&(t[50]=Math.floor(r/50),r%=50),r>=20&&(t[20]=Math.floor(r/20),r%=20),{striche:t,restZahl:r}}},9099:(e,t,r)=>{e.exports=r(4600)},9241:(e,t,r)=>{"use strict";function n(){for(var e,t,r=0,n="",i=arguments.length;r<i;r++)(e=arguments[r])&&(t=function e(t){var r,n,i="";if("string"==typeof t||"number"==typeof t)i+=t;else if("object"==typeof t)if(Array.isArray(t)){var o=t.length;for(r=0;r<o;r++)t[r]&&(n=e(t[r]))&&(i&&(i+=" "),i+=n)}else for(n in t)t[n]&&(i&&(i+=" "),i+=n);return i}(e))&&(n&&(n+=" "),n+=t);return n}r.d(t,{$:()=>n})},9751:(e,t,r)=>{"use strict";r.d(t,{Q:()=>n});let n=(0,r(4232).createContext)({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"})}},e=>{var t=t=>e(e.s=t);e.O(0,[6593,8792],()=>(t(92),t(4600))),_N_E=e.O()}]);