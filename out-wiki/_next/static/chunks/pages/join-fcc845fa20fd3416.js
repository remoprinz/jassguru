(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6288],{15029:(e,r,t)=>{"use strict";t.d(r,{$S:()=>h,cc:()=>s,fn:()=>a,n_:()=>u,q5:()=>l});var n="jassguru_tournament_invite_token",o="jassguru_group_invite_token",i=function(e){try{e&&(sessionStorage.setItem(n,e),console.log("[tokenStorage] Turniertoken gespeichert:",e))}catch(e){console.error("[tokenStorage] Fehler beim Speichern des Turniertokens:",e)}},a=function(){try{return sessionStorage.getItem(n)}catch(e){console.error("[tokenStorage] Fehler beim Lesen des Turniertokens:",e)}return null},s=function(){try{sessionStorage.removeItem(n),console.log("[tokenStorage] Turniertoken gel\xf6scht")}catch(e){console.error("[tokenStorage] Fehler beim L\xf6schen des Turniertokens:",e)}},c=function(e){try{e&&(sessionStorage.setItem(o,e),console.log("[tokenStorage] Gruppentoken gespeichert:",e))}catch(e){console.error("[tokenStorage] Fehler beim Speichern des Gruppentokens:",e)}},u=function(){try{return sessionStorage.getItem(o)}catch(e){console.error("[tokenStorage] Fehler beim Lesen des Gruppentokens:",e)}return null},l=function(){try{sessionStorage.removeItem(o),console.log("[tokenStorage] Gruppentoken gel\xf6scht")}catch(e){console.error("[tokenStorage] Fehler beim L\xf6schen des Gruppentokens:",e)}},h=function(e){e.tournamentToken&&i(e.tournamentToken),e.token&&c(e.token)}},23803:(e,r,t)=>{"use strict";t.d(r,{A:()=>n});var n=(0,t(11037).A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},33615:(e,r,t)=>{"use strict";t.d(r,{A:()=>n});var n=(0,t(11037).A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},68574:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>E,dynamic:()=>_});var n=t(14232),o=t(89099),i=t(27788),a=t(94566),s=t(31931),c=t(74231),u=t(37746),l=t(16042),h=t(23803),f=t(96898),p=t(95014),d=t(37537),g=t(93504),m=t(15029),y=t(23513),v=t(37876);function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(){x=function(){return r};var e,r={},t=Object.prototype,n=t.hasOwnProperty,o=Object.defineProperty||function(e,r,t){e[r]=t.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(e,r,t){return Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}),e[r]}try{u({},"")}catch(e){u=function(e,r,t){return e[r]=t}}function l(r,t,n,i){var a,s,c,u,l=Object.create((t&&t.prototype instanceof m?t:m).prototype);return o(l,"_invoke",{value:(a=r,s=n,c=new T(i||[]),u=f,function(r,t){if(u===p)throw Error("Generator is already running");if(u===d){if("throw"===r)throw t;return{value:e,done:!0}}for(c.method=r,c.arg=t;;){var n=c.delegate;if(n){var o=function r(t,n){var o=n.method,i=t.iterator[o];if(i===e)return n.delegate=null,"throw"===o&&t.iterator.return&&(n.method="return",n.arg=e,r(t,n),"throw"===n.method)||"return"!==o&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+o+"' method")),g;var a=h(i,t.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,g;var s=a.arg;return s?s.done?(n[t.resultName]=s.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):s:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,g)}(n,c);if(o){if(o===g)continue;return o}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if(u===f)throw u=d,c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);u=p;var i=h(a,s,c);if("normal"===i.type){if(u=c.done?d:"suspendedYield",i.arg===g)continue;return{value:i.arg,done:c.done}}"throw"===i.type&&(u=d,c.method="throw",c.arg=i.arg)}})}),l}function h(e,r,t){try{return{type:"normal",arg:e.call(r,t)}}catch(e){return{type:"throw",arg:e}}}r.wrap=l;var f="suspendedStart",p="executing",d="completed",g={};function m(){}function y(){}function v(){}var k={};u(k,a,function(){return this});var w=Object.getPrototypeOf,S=w&&w(w(N([])));S&&S!==t&&n.call(S,a)&&(k=S);var E=v.prototype=m.prototype=Object.create(k);function _(e){["next","throw","return"].forEach(function(r){u(e,r,function(e){return this._invoke(r,e)})})}function O(e,r){var t;o(this,"_invoke",{value:function(o,i){function a(){return new r(function(t,a){!function t(o,i,a,s){var c=h(e[o],e,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==b(l)&&n.call(l,"__await")?r.resolve(l.__await).then(function(e){t("next",e,a,s)},function(e){t("throw",e,a,s)}):r.resolve(l).then(function(e){u.value=e,a(u)},function(e){return t("throw",e,a,s)})}s(c.arg)}(o,i,t,a)})}return t=t?t.then(a,a):a()}})}function L(e){var r={tryLoc:e[0]};1 in e&&(r.catchLoc=e[1]),2 in e&&(r.finallyLoc=e[2],r.afterLoc=e[3]),this.tryEntries.push(r)}function j(e){var r=e.completion||{};r.type="normal",delete r.arg,e.completion=r}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function N(r){if(r||""===r){var t=r[a];if(t)return t.call(r);if("function"==typeof r.next)return r;if(!isNaN(r.length)){var o=-1,i=function t(){for(;++o<r.length;)if(n.call(r,o))return t.value=r[o],t.done=!1,t;return t.value=e,t.done=!0,t};return i.next=i}}throw TypeError(b(r)+" is not iterable")}return y.prototype=v,o(E,"constructor",{value:v,configurable:!0}),o(v,"constructor",{value:y,configurable:!0}),y.displayName=u(v,c,"GeneratorFunction"),r.isGeneratorFunction=function(e){var r="function"==typeof e&&e.constructor;return!!r&&(r===y||"GeneratorFunction"===(r.displayName||r.name))},r.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u(e,c,"GeneratorFunction")),e.prototype=Object.create(E),e},r.awrap=function(e){return{__await:e}},_(O.prototype),u(O.prototype,s,function(){return this}),r.AsyncIterator=O,r.async=function(e,t,n,o,i){void 0===i&&(i=Promise);var a=new O(l(e,t,n,o),i);return r.isGeneratorFunction(t)?a:a.next().then(function(e){return e.done?e.value:a.next()})},_(E),u(E,c,"Generator"),u(E,a,function(){return this}),u(E,"toString",function(){return"[object Generator]"}),r.keys=function(e){var r=Object(e),t=[];for(var n in r)t.push(n);return t.reverse(),function e(){for(;t.length;){var n=t.pop();if(n in r)return e.value=n,e.done=!1,e}return e.done=!0,e}},r.values=N,T.prototype={constructor:T,reset:function(r){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(j),!r)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var t=this;function o(n,o){return s.type="throw",s.arg=r,t.next=n,o&&(t.method="next",t.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,r){for(var t=this.tryEntries.length-1;t>=0;--t){var o=this.tryEntries[t];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=r&&r<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=r,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(e,r){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&r&&(this.next=r),g},finish:function(e){for(var r=this.tryEntries.length-1;r>=0;--r){var t=this.tryEntries[r];if(t.finallyLoc===e)return this.complete(t.completion,t.afterLoc),j(t),g}},catch:function(e){for(var r=this.tryEntries.length-1;r>=0;--r){var t=this.tryEntries[r];if(t.tryLoc===e){var n=t.completion;if("throw"===n.type){var o=n.arg;j(t)}return o}}throw Error("illegal catch attempt")},delegateYield:function(r,t,n){return this.delegate={iterator:N(r),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=e),g}},r}function k(e,r,t,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void t(e)}s.done?r(c):Promise.resolve(c).then(n,o)}function w(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var n,o,i,a,s=[],c=!0,u=!1;try{if(i=(t=t.call(e)).next,0===r){if(Object(t)!==t)return;c=!1}else for(;!(c=(n=i.call(t)).done)&&(s.push(n.value),s.length!==r);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=t.return&&(a=t.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,r)||function(e,r){if(e){if("string"==typeof e)return S(e,r);var t=({}).toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?S(e,r):void 0}}(e,r)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=Array(r);t<r;t++)n[t]=e[t];return n}let E=function(){var e=(0,o.useRouter)(),r=(0,i.useAuthStore)(),t=r.isAuthenticated,b=r.status,S=r.user,E=(0,a.useUIStore)(),_=E.showNotification,O=E.setLoading,L=(0,s.Q5)().setCurrentGroup,j=(0,n.useRef)(!1),T=w((0,n.useState)(null),2),N=T[0],G=T[1],A=w((0,n.useState)("idle"),2),C=A[0],I=A[1],P=w((0,n.useState)(null),2),F=P[0],B=P[1],R=e.query,z=R.token,K=R.tournamentToken,M=R.groupToken;return((0,n.useEffect)(function(){var r,n,o=Array.isArray(K)?K[0]:K,i=Array.isArray(M)?M[0]:M,a=Array.isArray(z)?z[0]:z;!i&&a&&(console.log('[JOIN_PAGE_EFFECT] Generic "token" found and no explicit groupToken, using generic token as groupToken.'),i=a),e.isReady&&"idle"!==b&&!j.current&&(o||i)&&(j.current=!0,(r=x().mark(function r(){var n,a,c,h,f,p,d,y,v,k,w,E,L,j,T,N,A,C,P,F;return x().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(I("processing"),!(!i&&!o)){r.next=1;break}return console.error("[PROCESS_TOKENS_LOGIC] Error: No group or tournament token found."),G("Kein Einladungscode im Link gefunden."),B("Weder in der URL noch im lokalen Speicher war ein Code vorhanden."),I("error"),(0,m.q5)(),(0,m.cc)(),r.abrupt("return");case 1:if("loading"!==b){r.next=2;break}return r.abrupt("return");case 2:if(t()){r.next=3;break}return _({message:"Bitte melde dich an, um der Einladung zu folgen.",type:"info"}),n={redirect:e.asPath},e.push({pathname:"/auth/login",query:n}),r.abrupt("return");case 3:if(S){r.next=4;break}return console.error("[PROCESS_TOKENS_LOGIC] Error: User object is null/undefined despite being authenticated."),G("Benutzerdaten nicht geladen. Bitte versuche es erneut."),B("Benutzerdaten nicht geladen. Bitte versuche es erneut."),I("error"),r.abrupt("return");case 4:if(O(!0),a=null,c=null,h="",f="idle",!o){r.next=9;break}return G("Bearbeite Turniereinladung..."),r.prev=5,r.next=6,(0,g.redeemTournamentInvite)(o);case 6:(p=r.sent).success&&p.tournamentId?(_({message:p.message||"Erfolgreich dem Turnier beigetreten!",type:"success"}),I("success"),G(p.message||"Erfolgreich dem Turnier beigetreten!"),c="/view/tournament/".concat(p.tournamentId),(0,m.cc)(),f="success"):(console.error("[PROCESS_TOKENS_LOGIC] Error redeeming tournament token:",p.message),G(p.message||"Fehler beim Beitritt zum Turnier."),B(p.message||"Fehler beim Beitritt zum Turnier."),I("error"),_({message:p.message||"Fehler beim Beitritt zum Turnier.",type:"error"}),f="error"),r.next=8;break;case 7:r.prev=7,console.error("[PROCESS_TOKENS_LOGIC] Exception redeeming tournament token:",d=(C=r.catch(5))instanceof Error?C.message:"Ein unerwarteter Fehler ist aufgetreten."),G(d),B(d),I("error"),_({message:d,type:"error"}),f="error";case 8:r.next=16;break;case 9:if(!i){r.next=16;break}return G("Gruppeneinladung wird verarbeitet..."),r.prev=10,v=(0,u.Uz)(void 0,"europe-west1"),k=(0,u.Qg)(v,"joinGroupByToken"),r.prev=11,r.next=12,k({token:i});case 12:w=r.sent,r.next=14;break;case 13:throw r.prev=13,console.error("[PROCESS_TOKENS_LOGIC] Error calling joinGroupByToken:",P=r.catch(11)),P;case 14:if((a=w.data)&&a.success&&null!=(y=a.group)&&y.id){try{(E=s.Q5.getState()).addUserGroup(a.group),E.setCurrentGroup(a.group)}catch(e){console.error("[PROCESS_TOKENS_LOGIC] Error updating group store:",e)}_({message:h=a.alreadyMember?"Du bist bereits Mitglied dieser Gruppe.":"Du bist erfolgreich der Gruppe beigetreten!",type:"success"}),I("success"),G(h),L=new URLSearchParams({joined:a.group.name||"unbekannte Gruppe",newMember:a.alreadyMember?"false":"true"}),c="/start?".concat(L.toString()),(0,m.q5)(),f="success"}else console.error("[PROCESS_TOKENS_LOGIC] Cloud Function reported failure:",a),B(h=(null==(j=a)?void 0:j.message)||"Der Beitritt zur Gruppe ist fehlgeschlagen. Bitte versuche es erneut oder pr\xfcfe den Code."),I("error"),_&&_({message:h,type:"error"}),f="error";r.next=16;break;case 15:r.prev=15,N=(T=(F=r.catch(10))instanceof l.g)?F.code:"unknown",console.error("[PROCESS_TOKENS_LOGIC] Exception joining group:",A=F instanceof Error?F.message:"Ein unerwarteter Fehler ist aufgetreten."),T&&console.error("[PROCESS_TOKENS_LOGIC] Firebase error code:",N),G("Fehler beim Beitritt zur Gruppe."),B(A),I("error"),_&&_({message:"Fehler: ".concat(A.substring(0,100)).concat(A.length>100?"...":""),type:"error"}),f="error";case 16:I(f),"error"===f&&B(h),_&&("success"===f&&h?_({message:h,type:"success"}):"error"===f&&h&&_({message:h,type:"error"})),O(!1),"success"===f&&c&&setTimeout(function(){e.push(c)},1500);case 17:case"end":return r.stop()}},r,null,[[5,7],[10,15],[11,13]])}),n=function(){var e=this,t=arguments;return new Promise(function(n,o){var i=r.apply(e,t);function a(e){k(i,n,o,a,s,"next",e)}function s(e){k(i,n,o,a,s,"throw",e)}a(void 0)})},function(){return n.apply(this,arguments)})())},[e.isReady,K,M,z,b,t,S,_,O,e.asPath,L]),"loading"===b||"idle"===b)?(0,v.jsx)(y.A,{message:"Authentifizierung wird gepr\xfcft..."}):"processing"===C?(0,v.jsx)(y.A,{message:N||"Einladung wird verarbeitet..."}):"error"===C?(0,v.jsx)(c.A,{children:(0,v.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center p-4",children:[(0,v.jsx)(h.A,{className:"h-12 w-12 text-red-500 mb-4"}),(0,v.jsx)("p",{className:"text-red-500 text-xl font-semibold",children:"Fehler beim Beitritt"}),(0,v.jsx)("p",{className:"mt-2 text-gray-300",children:N}),F&&(0,v.jsxs)("p",{className:"text-xs text-gray-400 mt-1",children:["Detail: ",F]}),(0,v.jsx)(d.$,{onClick:function(){return e.push("/start")},variant:"default",className:"mt-4 bg-blue-600 hover:bg-blue-700 text-white",children:"Zur Startseite"})]})}):"success"===C?(0,v.jsx)(c.A,{children:(0,v.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center p-4",children:[(0,v.jsx)(f.A,{className:"h-12 w-12 text-green-500 mb-4"}),(0,v.jsx)("p",{className:"text-green-500 text-xl font-semibold",children:N}),(0,v.jsx)("p",{className:"mt-2 text-gray-300",children:"Du wirst weitergeleitet..."}),(0,v.jsx)("div",{className:"mt-4",children:(0,v.jsx)(p.A,{className:"h-8 w-8 text-white animate-spin"})})]})}):(0,v.jsx)(y.A,{message:"Status wird ermittelt..."})};var _="force-dynamic"},89276:(e,r,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/join",function(){return t(68574)}])},96898:(e,r,t)=>{"use strict";t.d(r,{A:()=>n});var n=(0,t(11037).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])}},e=>{e.O(0,[8230,4587,9517,4455,3546,4231,636,6593,8792],()=>e(e.s=89276)),_N_E=e.O()}]);