(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7521],{900:(e,t,n)=>{"use strict";n.d(t,{j:()=>c});var r=n(88880),o=n(54573),i=["Eicheln","Rosen","Schellen","Schilten"],a={Misère:"\uD83E\uDD2E",Eicheln:"\uD83C\uDF33",Rosen:"\uD83C\uDF39",Schellen:"\uD83D\uDD14",Schilten:"\uD83D\uDEE1️",Obe:"\uD83D\uDC47",Une:"\uD83D\uDC47","3x3":"3️⃣",Quer:"↕️",Slalom:"⛷️"},s={Misère:"\uD83E\uDD2E",Eicheln:"♠️",Rosen:"♣️",Schellen:"♥️",Schilten:"♦️",Obe:"\uD83D\uDC46",Une:"\uD83D\uDC47","3x3":"3️⃣",Quer:"↕️",Slalom:"⛷️"},l={},c=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"DE",c=(0,o.Sn)(e),u="".concat(c,"-").concat(t,"-").concat(n);if(l[u])return l[u];if("emoji"===t){var m="DE"===n?a:s;return l[u]=m[e],l[u]}var d=r.S[c];if(void 0===d||void 0===d[n])return console.warn("getPictogram: Mapping f\xfcr Farbe '".concat(c,"' (Original: '").concat(e,"') oder Stil '").concat(n,"' nicht gefunden. Gebe leeren Pfad zur\xfcck.")),l[u]="","";var f=d[n].toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]/g,""),g="FR"===n?"standardFR":"standardDE",p="/assets/pictograms/".concat(g,"/").concat(f,".").concat(i.includes(c)?"png":"svg");return l[u]=p,p}},6284:(e,t,n)=>{"use strict";n.d(t,{h:()=>s}),n(14232);var r=n(900),o=n(54573),i=n(88880),a=n(37876),s=function(e){var t,n,s=e.farbe,l=e.mode,c=void 0===l?"svg":l,u=e.cardStyle,m=void 0===u?"DE":u,d=e.className,f=(0,r.j)(s,c,m),g=(0,o.Sn)(s),p=null!=(t=null==(n=i.S[g])?void 0:n[m])?t:g;return f?(0,a.jsx)("div",{className:"flex items-center justify-center w-8 h-8 ".concat(null!=d?d:""),children:"emoji"===c?(0,a.jsx)("span",{className:"text-2xl",children:f}):(0,a.jsx)("img",{src:f,alt:p,className:"w-6 h-6 object-contain"})}):null}},34712:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/view/[gameId]",function(){return n(79951)}])},54573:(e,t,n)=>{"use strict";n.d(t,{SS:()=>l,Sn:()=>o,Yq:()=>a,Yz:()=>c,a3:()=>s,xW:()=>i});var r=n(42009);function o(e){return e?e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}):""}function i(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(Boolean).join(" ")}function a(e){var t;if(!e)return"-";if(e instanceof Date)t=e;else{if(!e||"number"!=typeof e.seconds)return"-";t=new r.Timestamp(e.seconds,e.nanoseconds).toDate()}return t.toLocaleDateString("de-CH")}function s(e){if(e<60)return"".concat(e,"s");var t=Math.floor(e/60),n=e%60;if(t<60)return n>0?"".concat(t,"m ").concat(n,"s"):"".concat(t,"m");var r=Math.floor(t/60),o=t%60;if(r<24)return o>0?"".concat(r,"h ").concat(o,"m"):"".concat(r,"h");var i=Math.floor(r/24),a=r%24;return a>0?"".concat(i,"d ").concat(a,"h"):"".concat(i,"d")}function l(e){return s(Math.floor(e/1e3))}function c(e){var t=e/60;return t<30?"blitz_schnell":t<75?"schnell":t<150?"normal":t<240?"gem\xfctlich":"marathon"}},68774:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(14232);function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var i=function(e){var t,n=function(e){if(Array.isArray(e))return e}(t=(0,r.useState)(!1))||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],l=!0,c=!1;try{i=(n=n.call(e)).next,!1;for(;!(l=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return s}}(t,2)||function(e,t){if(e){if("string"==typeof e)return o(e,2);var n=({}).toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(t,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),i=n[0],a=n[1],s=(0,r.useRef)(0),l=function(e){a(!0)},c=function(t){a(!1);var n=Date.now();n-s.current<50||(s.current=n,e())};return{isPressedDown:i,handlers:{onMouseDown:l,onMouseUp:c,onMouseLeave:function(){return a(!1)},onTouchStart:l,onTouchEnd:c},buttonClasses:"\n      transition-all duration-100\n      ".concat(i?"scale-95 opacity-80":"scale-100 opacity-100","\n    ")}}},79951:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>h});var r=n(89099),o=n(14232),i=n(13848),a=n(31931),s=n(42009),l=n(48166),c=n(94566),u=n(37876);function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach(function(t){var r,o,i;r=e,o=t,i=n[t],(o=function(e){var t=function(e,t){if("object"!=m(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=m(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==m(t)?t:t+""}(o))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],l=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return s}}(e,t)||p(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){if(e){if("string"==typeof e)return b(e,t);var n=({}).toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(e,t):void 0}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}let h=function(){var e,t=(0,r.useRouter)().query.gameId,n=(0,c.useUIStore)(function(e){return e.setReadOnlyMode}),m=(0,a.Q5)(function(e){return e.setCurrentGroup}),d=g((0,o.useState)(!0),2),h=d[0],v=d[1],y=g((0,o.useState)(null),2),w=y[0],S=y[1],G=g((0,o.useState)(null),2),j=G[0],P=G[1],V=g((0,o.useState)([]),2),N=V[0],I=V[1],E=g((0,o.useState)([]),2),D=E[0],x=E[1],O=g((0,o.useState)(null),2),A=O[0],C=O[1],R=g((0,o.useState)(!1),2),k=R[0],M=R[1];if((0,o.useEffect)(function(){if(!t||"string"!=typeof t){P(null),I([]),C(null),S(void 0!==t?"Ung\xfcltige Spiel-ID.":null),v(void 0!==t);return}k||(console.log("[GameView] Setting ReadOnly mode."),n(!0),M(!0)),S(null),v(!0),console.log("[GameView] Setting up game listener for gameId: ".concat(t));var e=(0,s.doc)(i.db,"activeGames",t),r=(0,s.onSnapshot)(e,function(e){e.exists()?(console.log("[GameView] Received game data snapshot."),P(e.data())):(console.warn("[GameView] Game document ".concat(t," does not exist.")),S("Spiel nicht gefunden oder bereits archiviert."),P(null))},function(e){console.error("[GameView] Error listening to game document:",e),S("Fehler beim Laden des Spiels."),P(null),v(!1)});return function(){console.log("[GameView] Cleaning up game listener for gameId: ".concat(t)),r()}},[t,n,k]),(0,o.useEffect)(function(){if(!t||"string"!=typeof t)return void I([]);console.log("[GameView] Setting up rounds listener for gameId: ".concat(t));var e=(0,s.collection)(i.db,"activeGames",t,"rounds"),n=(0,s.query)(e,(0,s.orderBy)("roundNumber","asc")),r=(0,s.onSnapshot)(n,function(e){console.log("[GameView] Received rounds data snapshot.");var t=[];e.forEach(function(e){t.push(f({id:e.id},e.data()))}),I(t)},function(e){console.error("[GameView] Error listening to rounds collection:",e),I([])});return function(){console.log("[GameView] Cleaning up rounds listener for gameId: ".concat(t)),r()}},[t]),(0,o.useEffect)(function(){x([]);var e=null==j?void 0:j.sessionId;if(console.log("[GameView] Attempting to load summaries for sessionId:",e),!e||"string"!=typeof e)return void console.log("[GameView] No sessionId found in gameData, skipping completed games listener.");console.log("[GameView] Setting up completed games listener for sessionId: ".concat(e));var t=(0,s.collection)(i.db,"jassSessions",e,"jassGameSummaries"),n=(0,s.query)(t,(0,s.orderBy)("gameNumber","asc")),r=(0,s.onSnapshot)(n,function(e){console.log("[GameView] Received completed games snapshot.");var t=[];e.forEach(function(e){t.push(f({id:e.id},e.data()))}),console.log("[GameView] Fetched summaries:",t),x(t),console.log("[GameView] Loaded ".concat(t.length," completed games."))},function(e){console.error("[GameView] Error listening to completed games collection:",e),S("Fehler beim Laden der Spielhistorie."),x([])});return function(){console.log("[GameView] Cleaning up completed games listener for sessionId: ".concat(e)),r()}},[null==j?void 0:j.sessionId]),(0,o.useEffect)(function(){if(j&&N&&t&&"string"==typeof t){console.log("[GameView] All data sources available. Creating/Updating combined viewer data...");try{var e,n,r,o,i,a,l,c,u,m,d,g,y,G,P=Date.now();j.createdAt instanceof s.Timestamp?P=j.createdAt.toMillis():console.warn("[GameView] gameData.createdAt is not a Timestamp, using Date.now().");var V=N.map(function(e){var t,n,r={id:e.id||"round-".concat(e.roundNumber),roundId:e.roundNumber,actionType:"jass",timestamp:e.timestamp instanceof s.Timestamp?e.timestamp.toMillis():Date.now(),startingPlayer:e.startingPlayer,scores:{top:(null==(t=e.scores)?void 0:t.top)||0,bottom:(null==(n=e.scores)?void 0:n.bottom)||0},isRoundFinalized:!0,isCompleted:!0,currentPlayer:e.startingPlayer,weisPoints:{top:e.weisTop||0,bottom:e.weisBottom||0},jassPoints:{top:e.topPoints||0,bottom:e.bottomPoints||0},weisActions:[],roundState:{roundNumber:e.roundNumber,nextPlayer:e.startingPlayer}};return f(f({},r),{},{cardStyle:"french",farbe:e.gespielteFarbe||e.farbe})}),I={striche:0,points:0,weisPoints:0},E={1:f({},I),2:f({},I),3:f({},I),4:f({},I)},x={id:null!=(e=j.currentGameNumber)?e:1,gameNumber:null!=(n=j.currentGameNumber)?n:1,activeGameId:t,timestamp:P,sessionId:j.sessionId,currentRound:j.currentRound,startingPlayer:j.startingPlayer,initialStartingPlayer:j.initialStartingPlayer,currentPlayer:j.currentPlayer,isGameStarted:!0,isRoundCompleted:!1,isGameCompleted:"completed"===j.status,teams:{top:{striche:null!=(r=null==(o=j.striche)?void 0:o.top)?r:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0},jassPoints:0,weisPoints:null!=(i=null==(a=j.weisPoints)?void 0:a.top)?i:0,total:null!=(l=null==(c=j.scores)?void 0:c.top)?l:0,bergActive:!1,bedankenActive:!1,isSigned:!1,playerStats:E},bottom:{striche:null!=(u=null==(m=j.striche)?void 0:m.bottom)?u:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0},jassPoints:0,weisPoints:null!=(d=null==(g=j.weisPoints)?void 0:g.bottom)?d:0,total:null!=(y=null==(G=j.scores)?void 0:G.bottom)?y:0,bergActive:!1,bedankenActive:!1,isSigned:!1,playerStats:E}},roundHistory:V,currentHistoryIndex:0,historyState:{lastNavigationTimestamp:Date.now()}},O=function(e){if(Array.isArray(e))return b(e)}(D)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(D)||p(D)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),A=D.some(function(e){return e.gameNumber===x.gameNumber});x.isGameCompleted||A?x.isGameCompleted&&!A?(console.log("[GameView] Current game marked as completed, adding its representation until summary arrives."),O.push(x)):A&&console.log("[GameView] Current game number ".concat(x.gameNumber," already found in completed summaries. Not adding duplicate.")):O.push(x),O.sort(function(e,t){var n=function(e){if("gameNumber"in e&&"number"==typeof e.gameNumber)return e.gameNumber;if("id"in e){if("number"==typeof e.id)return e.id;if("string"==typeof e.id){var t=parseInt(e.id,10);return isNaN(t)?0:t}}return 0},r=n(e),o=n(t);return r-o}),console.log("[GameView] Data just before setting viewerGamesData:",{completed:D,current:x,combined:O}),C(O),S(null),v(!1)}catch(e){console.error("[GameView] Error creating combined viewer game data:",e),S("Fehler bei der Datenaufbereitung."),C(null),v(!1)}}else!t||w||h?t||w||(v(!1),S(null),C(null)):(v(!0),C(null))},[j,N,D,t,w]),(0,o.useEffect)(function(){if(j&&k&&j.sessionId){var e=j.sessionId;console.log("[GameView] Session gefunden mit ID: ".concat(e,", suche nach zugeh\xf6riger Gruppe..."));var t=(0,s.doc)(i.db,"jassSessions",e),n=null,r=(0,s.onSnapshot)(t,function(t){if(t.exists()){var r=t.data().gruppeId;if(r){console.log("[GameView] Gruppe f\xfcr Session ".concat(e," gefunden: ").concat(r));var o=(0,s.doc)(i.db,"groups",r);n=(0,s.onSnapshot)(o,function(e){if(e.exists()){var t=e.data();console.log("[GameView] Gruppeneinstellungen geladen:",t),m(f({id:r},t))}else console.log("[GameView] Gruppe mit ID ".concat(r," existiert nicht mehr."))},function(e){console.error("[GameView] Fehler beim Laden der Gruppe ".concat(r,":"),e)})}else console.log("[GameView] Session ".concat(e," hat keine zugeh\xf6rige Gruppe."))}else console.log("[GameView] Session mit ID ".concat(e," nicht gefunden."))},function(t){console.error("[GameView] Fehler beim Listener f\xfcr Session ".concat(e,":"),t)});return function(){console.log("[GameView] Cleanup Session- und Gruppen-Listener"),r(),n&&n()}}},[j,k,m]),console.log("[GameView] Checking render conditions:",{isLoading:h,error:w,gameDataExists:!!j,viewerGamesDataExists:!!A}),h)return console.log("[GameView] Rendering: Loading"),(0,u.jsx)("div",{className:"flex justify-center items-center min-h-screen text-white",children:"Lade Spiel..."});if(w)return console.log("[GameView] Rendering: Error -",w),(0,u.jsxs)("div",{className:"flex justify-center items-center min-h-screen text-red-500",children:["Fehler: ",w]});if(!A||0===A.length)return console.log("[GameView] Rendering: Not Available (viewerGamesData is null or empty)"),(0,u.jsx)("div",{className:"flex justify-center items-center min-h-screen text-yellow-500",children:"Spieldaten nicht verf\xfcgbar oder noch nicht geladen."});var T=A[A.length-1],F={top:0,bottom:0},L={top:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0},bottom:{berg:0,sieg:0,matsch:0,schneider:0,kontermatsch:0}},_={top:0,bottom:0};T&&("teams"in T&&T.teams?T.teams.top&&T.teams.bottom&&(F={top:T.teams.top.total,bottom:T.teams.bottom.total},L={top:T.teams.top.striche,bottom:T.teams.bottom.striche},_={top:T.teams.top.weisPoints,bottom:T.teams.bottom.weisPoints}):"finalStriche"in T&&T.finalStriche&&(F=T.finalScores,L=T.finalStriche,_=T.weisPoints));var U={games:A,playerNames:null!=(e=null==j?void 0:j.playerNames)?e:{1:"P1",2:"P2",3:"P3",4:"P4"},currentScores:F,currentStriche:L,weisPoints:_};return console.log("[GameView] Final props for GameViewerKreidetafel:",U),(0,u.jsx)(l.A,{gameData:U})}}},e=>{e.O(0,[7141,2366,9732,6738,4264,3219,8166,636,6593,8792],()=>e(e.s=34712)),_N_E=e.O()}]);